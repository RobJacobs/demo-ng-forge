"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[1205],{29374:(W,C,l)=>{l.d(C,{g:()=>y});const y={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},41205:(W,C,l)=>{l.r(C),l.d(C,{default:()=>ut});var y=l(71670),_=l(18100),I=(l(6010),l(26763)),M=l(84489),f=l(1897),O=l(55025),v=l(32995),E=l(67087),A=l(63321),R=l(48500),m=l(53661),Z=l(44054),U=l(30801),S=l(55050),z=l(9497),et=(l(83382),l(19420),l(20891)),st=l(10465),N=l(71182),rt=l(15794),at=l(34524),ot=l(49722),$=l(4583),nt=l(33300),J=l(68230);const X=new A.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function Y(r){return K.apply(this,arguments)}function K(){return(K=(0,y.Z)(function*(r){return"string"==typeof r?(0,S.sJ)(r)||{data:r}:new Promise((n,s)=>{const p=new FileReader;p.readAsDataURL(r),p.onload=()=>n((0,S.sJ)(p.result)),p.onerror=d=>s(d)})})).apply(this,arguments)}const B=new Set(["Feature Layer","Table"]),it=new A.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let j=class extends R.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,U.Ds)((0,y.Z)(function*(){yield r.load();const n=r.sourceJSON.editingInfo?.lastEditDate;if(null==n)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const s=n!==r.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:s,updates:s?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}}))}load(r){const n=(0,m.pC)(r)?r.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,n)),Promise.resolve(this)}get queryTask(){const{capabilities:r,parsedUrl:n,dynamicDataSource:s,infoFor3D:p,gdbVersion:d,spatialReference:h,fieldsIndex:i}=this.layer,t=(0,E.Z)("featurelayer-pbf")&&r?.query.supportsFormatPBF&&(0,m.Wi)(p);return new ot.Z({url:n.path,pbfSupported:t,fieldsIndex:i,infoFor3D:p,dynamicDataSource:s,gdbVersion:d,sourceSpatialReference:h,queryAttachmentsSupported:r?.operations?.supportsQueryAttachments??!1})}addAttachment(r,n){var s=this;return(0,y.Z)(function*(){yield s.load();const p=r.attributes[s.layer.objectIdField],d=s.layer.parsedUrl.path+"/"+p+"/addAttachment",h=s._getLayerRequestOptions(),i=s._getFormDataForAttachment(n,h.query);try{const t=yield(0,f.default)(d,{body:i});return s._createFeatureEditResult(t.data.addAttachmentResult)}catch(t){throw s._createAttachmentErrorResult(p,t)}})()}updateAttachment(r,n,s){var p=this;return(0,y.Z)(function*(){yield p.load();const d=r.attributes[p.layer.objectIdField],h=p.layer.parsedUrl.path+"/"+d+"/updateAttachment",i=p._getLayerRequestOptions({query:{attachmentId:n}}),t=p._getFormDataForAttachment(s,i.query);try{const e=yield(0,f.default)(h,{body:t});return p._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw p._createAttachmentErrorResult(d,e)}})()}applyEdits(r,n){var s=this;return(0,y.Z)(function*(){yield s.load();const p=s.layer.infoFor3D,d=(0,m.pC)(p),h=d||(n?.globalIdUsed??!1),i=r.addFeatures?.map(P=>s._serializeFeature(P,p)).filter(m.pC)??[],t=r.updateFeatures?.map(P=>s._serializeFeature(P,p)).filter(m.pC)??[],e=s._getFeatureIds(r.deleteFeatures,h);(0,nt.P)(i,t,s.layer.spatialReference);const u=[],c=[],g=[...r.deleteAttachments??[]];for(const P of r.addAttachments??[])u.push(yield s._serializeAttachment(P));for(const P of r.updateAttachments??[])c.push(yield s._serializeAttachment(P));const F=u.length||c.length||g.length?{adds:u,updates:c,deletes:g}:null;let D,x=null;if(d){x=new Map;const P=[];for(const V of r.addAssets??[])P.push(s._serializeAssetMapEditAndUploadAssets(V,x));const Q=yield Promise.all(P);D=Q.length?{adds:Q,updates:[],deletes:[]}:void 0}const T={gdbVersion:n?.gdbVersion||s.layer.gdbVersion,rollbackOnFailure:n?.rollbackOnFailureEnabled,useGlobalIds:h,returnEditMoment:n?.returnEditMoment,usePreviousEditMoment:n?.usePreviousEditMoment,sessionId:n?.sessionId};n?.returnServiceEditsOption?(T.edits=JSON.stringify([{id:s.layer.layerId,adds:i,updates:t,deletes:e,attachments:F,assetMaps:(0,m.Wg)(D)}]),T.returnServiceEditsOption=X.toJSON(n?.returnServiceEditsOption),T.returnServiceEditsInSourceSR=n?.returnServiceEditsInSourceSR):(T.adds=i.length?JSON.stringify(i):null,T.updates=t.length?JSON.stringify(t):null,T.deletes=e.length?h?JSON.stringify(e):e.join(","):null,T.attachments=F&&JSON.stringify(F),T.assetMaps=(0,m.pC)(D)?JSON.stringify(D):void 0);const lt=s._getLayerRequestOptions({method:"post",query:T}),q=n?.returnServiceEditsOption?s.layer.url:s.layer.parsedUrl.path,G=yield(0,f.default)(q+"/applyEdits",lt);if(!s.layer.capabilities.operations?.supportsEditing&&s.layer.effectiveCapabilities?.operations?.supportsEditing&&(yield M.id?.findCredential(s.layer.url)?.refreshToken()),d&&null!=G.data&&null!=G.data.assetMaps){const P=G.data,Q=s.layer.objectIdField,V=[];for(const L of P.addResults)L.success&&V.push(L.objectId);for(const L of P.updateResults)L.success&&V.push(L.objectId);const ct=s._createRequestQueryOptions(),w=yield(0,f.default)(q+"/query",{...ct,query:{f:"json",formatOf3DObjects:"3D_glb",where:`OBJECTID IN (${V.join(",")})`,outFields:`${Q}`}});if(w&&w.data&&w.data.assetMaps&&(0,m.pC)(x)){const L=w.data.assetMaps;for(const dt of L){const k=x.get(dt.parentGlobalId).geometry;(0,m.pC)(k)&&"mesh"===k.type&&k.updateExternalSource({source:[{name:dt.assetName,source:dt.assetName}],extent:k.extent})}}}return s._createEditsResult(G)})()}deleteAttachments(r,n){var s=this;return(0,y.Z)(function*(){yield s.load();const p=r.attributes[s.layer.objectIdField],d=s.layer.parsedUrl.path+"/"+p+"/deleteAttachments";try{return(yield(0,f.default)(d,s._getLayerRequestOptions({query:{attachmentIds:n.join(",")},method:"post"}))).data.deleteAttachmentResults.map(s._createFeatureEditResult)}catch(h){throw s._createAttachmentErrorResult(p,h)}})()}fetchRecomputedExtents(r={}){var n=this;return this.load({signal:r.signal}).then((0,y.Z)(function*(){const p=n._getLayerRequestOptions({...r,query:{returnUpdates:!0}}),{layerId:d,url:h}=n.layer,{data:i}=yield(0,f.default)(`${h}/${d}`,p),{id:t,extent:e,fullExtent:u,timeExtent:c}=i,g=e||u;return{id:t,fullExtent:g&&st.Z.fromJSON(g),timeExtent:c&&O.Z.fromJSON({start:c[0],end:c[1]})}}))}queryAttachments(r,n={}){var s=this;return(0,y.Z)(function*(){yield s.load();const p=s._getLayerRequestOptions(n);return s.queryTask.executeAttachmentQuery(r,p)})()}queryFeatures(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.execute(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryFeaturesJSON(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeJSON(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryObjectIds(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForIds(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryFeatureCount(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForCount(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryExtent(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForExtent(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryRelatedFeatures(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeRelationshipQuery(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryRelatedFeaturesCount(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeRelationshipQueryForCount(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryTopFeatures(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeTopFeaturesQuery(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryTopObjectIds(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForTopIds(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryTopExtents(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForTopExtents(r,{...n,query:s._createRequestQueryOptions(n)})})()}queryTopCount(r,n){var s=this;return(0,y.Z)(function*(){return yield s.load(),s.queryTask.executeForTopCount(r,{...n,query:s._createRequestQueryOptions(n)})})()}fetchPublishingStatus(){var r=this;return(0,y.Z)(function*(){if(!(0,$.M8)(r.layer.url))return"unavailable";const n=(0,S.v_)(r.layer.url,"status"),s=yield(0,f.default)(n,{query:{f:"json"}});return it.fromJSON(s.data.status)})()}_createRequestQueryOptions(r){const n={...this.layer.customParameters,token:this.layer.apiKey,...r?.query};return this.layer.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),n}_fetchService(r,n){var s=this;return(0,y.Z)(function*(){if(!r){const{data:d}=yield(0,f.default)(s.layer.parsedUrl.path,s._getLayerRequestOptions({query:(0,E.Z)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:n}));r=d}s.sourceJSON=s._patchServiceJSON(r);const p=r.type;if(!B.has(p))throw new v.Z("feature-layer-source:unsupported-type",`Source type "${p}" is not supported`)})()}_patchServiceJSON(r){if("Table"!==r.type&&r.geometryType&&!r?.drawingInfo?.renderer&&!r.defaultSymbol){const n=(0,at.bU)(r.geometryType).renderer;(0,Z.RB)("drawingInfo.renderer",n,r)}return"esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),r}_serializeFeature(r,n){const{geometry:s,attributes:p}=r;if((0,m.pC)(n)&&(0,m.pC)(r.geometry)&&"mesh"===r.geometry.type){const d={...p},h=r.geometry,i=h.origin,t=h.transform;if(d[n.transformFieldRoles.originX]=i.x,d[n.transformFieldRoles.originY]=i.y,d[n.transformFieldRoles.originZ]=i.z,(0,m.pC)(t)){const e=t.translation,u=t.scale,c=t.rotation;d[n.transformFieldRoles.translationX]=e[0],d[n.transformFieldRoles.translationY]=-e[2],d[n.transformFieldRoles.translationZ]=e[1],d[n.transformFieldRoles.scaleX]=u[0],d[n.transformFieldRoles.scaleY]=u[1],d[n.transformFieldRoles.scaleZ]=u[2],d[n.transformFieldRoles.rotationX]=c[0],d[n.transformFieldRoles.rotationY]=c[2],d[n.transformFieldRoles.rotationZ]=c[1],d[n.transformFieldRoles.rotationDeg]=c[3]}return{geometry:null,attributes:d}}return(0,m.Wi)(s)?{attributes:p}:"mesh"===s.type||"extent"===s.type?null:{geometry:s.toJSON(),attributes:p}}_serializeAttachment(r){var n=this;return(0,y.Z)(function*(){const{feature:s,attachment:p}=r,{globalId:d,name:h,contentType:i,data:t,uploadId:e}=p,u={globalId:d,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(s&&(u.parentGlobalId="attributes"in s?s.attributes&&s.attributes[n.layer.globalIdField]:s.globalId),e)u.uploadId=e;else if(t){const c=yield Y(t);c&&(u.contentType=c.mediaType,u.data=c.data),t instanceof File&&(u.name=t.name)}return h&&(u.name=h),i&&(u.contentType=i),u})()}_serializeAssetMapEditAndUploadAssets(r,n){var s=this;return(0,y.Z)(function*(){const p=s.layer.url;let d=null;try{const c=new Blob([r.data],{type:r.mimeType}),g=new FormData;g.append("f","json"),g.append("file",c,`${r.assetName}`);const F={body:g,method:"post",responseType:"json"},{data:D}=yield(0,f.default)(`${p}/uploads/upload`,F);if(!D.success)throw new v.Z("feature-layer-source:upload-failure","Expected upload to be successfull.");d={assetType:r.assetType,assetUploadId:D.item.itemID}}catch{d=null}if((0,m.Wi)(d)){const c=yield Y(new Blob([r.data]));if(!c.isBase64)throw new v.Z("feature-layer-source:uploadAssets-failure","Expected gltf data in base64 format after conversion.");d={assetType:r.assetType,assetData:c.data}}if((0,m.Wi)(d))throw new v.Z("feature-layer-source:uploadAssets-failure","Unable to prepare uploadAsset request options.");const h={method:"post",query:{f:"json",assets:JSON.stringify([d])},responseType:"json"},i=yield(0,f.default)((0,S.v_)(s.layer.parsedUrl.path,"uploadAssets"),h);if(1!==i.data.uploadResults.length||!i.data.uploadResults[0].success)throw new v.Z("feature-layer-source:uploadAssets-failure","Bad response.");const t=i.data.uploadResults[0].assetHash,e=[];r.flags&rt.i.PROJECT_VERTICES&&e.push("PROJECT_VERTICES");const u={globalId:r.assetMapGlobalId,parentGlobalId:r.featureGlobalId,assetName:r.assetName,assetHash:t,flags:e};return n.set(r.featureGlobalId,r.feature),u})()}_getFeatureIds(r,n){const s=r?.[0];return s?this._canUseGlobalIds(n,r)?this._getGlobalIdsFromFeatureIdentifier(r):"objectId"in s?this._getObjectIdsFromFeatureIdentifier(r):this._getIdsFromFeatures(r):[]}_getIdsFromFeatures(r){const n=this.layer.objectIdField;return r.map(s=>s.attributes&&s.attributes[n])}_canUseGlobalIds(r,n){return r&&"globalId"in n[0]}_getObjectIdsFromFeatureIdentifier(r){return r.map(n=>n.objectId)}_getGlobalIdsFromFeatureIdentifier(r){return r.map(n=>n.globalId)}_createEditsResult(r){const n=r.data,{layerId:s}=this.layer,p=[];let d=null;if(Array.isArray(n))for(const t of n)p.push({id:t.id,editedFeatures:t.editedFeatures}),t.id===s&&(d={addResults:t.addResults??[],updateResults:t.updateResults??[],deleteResults:t.deleteResults??[],attachments:t.attachments,editMoment:t.editMoment});else d=n;const h=d?.attachments,i={addFeatureResults:d?.addResults?.map(this._createFeatureEditResult,this)??[],updateFeatureResults:d?.updateResults?.map(this._createFeatureEditResult,this)??[],deleteFeatureResults:d?.deleteResults?.map(this._createFeatureEditResult,this)??[],addAttachmentResults:h&&h.addResults?h.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:h&&h.updateResults?h.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:h&&h.deleteResults?h.deleteResults.map(this._createFeatureEditResult,this):[]};if(d?.editMoment&&(i.editMoment=d.editMoment),p.length>0){i.editedFeatureResults=[];for(const t of p){const{editedFeatures:e}=t,u=e?.spatialReference?new J.Z(e.spatialReference):null;i.editedFeatureResults.push({layerId:t.id,editedFeatures:{adds:e?.adds?.map(c=>this._createEditedFeature(c,u))||[],updates:e?.updates?.map(c=>({original:this._createEditedFeature(c[0],u),current:this._createEditedFeature(c[1],u)}))||[],deletes:e?.deletes?.map(c=>this._createEditedFeature(c,u))||[],spatialReference:u}})}}return i}_createEditedFeature(r,n){return new I.Z({attributes:r.attributes,geometry:(0,N.im)({...r.geometry,spatialReference:n})})}_createFeatureEditResult(r){const n=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:n?new v.Z("feature-layer-source:edit-failure",n.description,{code:n.code}):null}}_createAttachmentErrorResult(r,n){return{objectId:r,globalId:null,error:new v.Z("feature-layer-source:attachment-failure",n.details.messages&&n.details.messages[0]||n.message,{code:n.details.httpStatus||n.details.messageCode})}}_getFormDataForAttachment(r,n){const s=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(s)for(const p in n){const d=n[p];null!=d&&(s.set?s.set(p,d):s.append(p,d))}return s}_getLayerRequestOptions(r={}){const{parsedUrl:n,gdbVersion:s,dynamicDataSource:p}=this.layer;return{...r,query:{gdbVersion:s,layer:p?JSON.stringify({source:p}):void 0,...n.query,f:"json",...this._createRequestQueryOptions(r)},responseType:"json"}}};(0,_._)([(0,z.Cb)()],j.prototype,"type",void 0),(0,_._)([(0,z.Cb)({constructOnly:!0})],j.prototype,"layer",void 0),(0,_._)([(0,z.Cb)({readOnly:!0})],j.prototype,"queryTask",null),j=(0,_._)([(0,et.j)("esri.layers.graphics.sources.FeatureLayerSource")],j);const ut=j},49722:(W,C,l)=>{l.d(C,{Z:()=>h});var y=l(71670),_=l(18100),b=l(6365),I=l(32995),M=l(67087),f=l(53661),O=l(30801),v=l(55050),E=l(9497),m=(l(83382),l(19420),l(20891)),Z=l(38491),U=l(25820),S=l(61028),tt=(l(6010),l(78170)),H=l(28665),et=l(10465);function N(){return(N=(0,y.Z)(function*(i,t,e){const u=(0,U.en)(i);return(0,tt.Vr)(u,H.Z.from(t),{...e}).then(c=>({count:c.data.count,extent:et.Z.fromJSON(c.data.extent)}))})).apply(this,arguments)}var rt=l(40455),at=l(60355),ot=l(83970),$=l(50805);function nt(i,t){return t}function J(i,t,e,u){switch(e){case 0:return B(i,t+u,0);case 1:return"lowerLeft"===i.originPosition?B(i,t+u,1):function it({translate:i,scale:t},e,u){return i[u]-e*t[u]}(i,t+u,1)}}function X(i,t,e,u){return 2===e?B(i,t,2):J(i,t,e,u)}function Y(i,t,e,u){return 2===e?B(i,t,3):J(i,t,e,u)}function K(i,t,e,u){return 3===e?B(i,t,3):X(i,t,e,u)}function B({translate:i,scale:t},e,u){return i[u]+e*t[u]}class j{constructor(t){this._options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=nt,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(t){if(this._options.applyTransform&&(t.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!t.hasZ)return;const e=(0,ot.k)(t.geometryType,this._options.sourceSpatialReference,t.spatialReference);if(!(0,f.Wi)(e))for(const u of t.features)e(u.geometry)}createSpatialReference(){return{}}addField(t,e){const u=t.fields;(0,f.O3)(u),u.push(e);const c=u.map(g=>g.name);this._attributesConstructor=function(){for(const g of c)this[g]=null}}addFeature(t,e){t.features.push(e)}prepareFeatures(t){switch(this._transform=t.transform,this._options.applyTransform&&t.transform&&(this._applyTransform=this._deriveApplyTransform(t)),this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++,t.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,u,c)=>this.addCoordinatePoint(e,u,c),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,u,c)=>this._addCoordinatePolygon(e,u,c),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,u,c)=>this._addCoordinatePolyline(e,u,c),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,u,c)=>this._addCoordinateMultipoint(e,u,c),this.createGeometry=e=>this._createMultipointGeometry(e)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(t,e,u){0===this._lengths.length&&(this._toAddInCurrentPath=e),this._lengths.push(e)}addQueryGeometry(t,e){const{queryGeometry:u,queryGeometryType:c}=e,g=(0,$.$g)(u.clone(),u,!1,!1,this._transform),F=(0,$.di)(g,c,!1,!1);t.queryGeometryType=c,t.queryGeometry={...F}}createPointGeometry(t){const e={x:0,y:0,spatialReference:t.spatialReference};return t.hasZ&&(e.z=0),t.hasM&&(e.m=0),e}addCoordinatePoint(t,e,u){const c=(0,f.s3)(this._transform,"transform");switch(e=this._applyTransform(c,e,u,0),u){case 0:t.x=e;break;case 1:t.y=e;break;case 2:"z"in t?t.z=e:t.m=e;break;case 3:t.m=e}}_transformPathLikeValue(t,e){let u=0;e<=1&&(u=this._previousCoordinate[e],this._previousCoordinate[e]+=t);const c=(0,f.s3)(this._transform,"transform");return this._applyTransform(c,t,e,u)}_addCoordinatePolyline(t,e,u){this._dehydratedAddPointsCoordinate(t.paths,e,u)}_addCoordinatePolygon(t,e,u){this._dehydratedAddPointsCoordinate(t.rings,e,u)}_addCoordinateMultipoint(t,e,u){0===u&&t.points.push([]);const c=this._transformPathLikeValue(e,u);t.points[t.points.length-1].push(c)}_createPolygonGeometry(t){return{rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,e,u){0===u&&0==this._toAddInCurrentPath--&&(t.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const c=this._transformPathLikeValue(e,u),g=t[t.length-1];0===u&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),g.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=c}_deriveApplyTransform(t){const{hasZ:e,hasM:u}=t;return e&&u?K:e?X:u?Y:J}}var ut=l(87096);function s(i,t,e){return p.apply(this,arguments)}function p(){return(p=(0,y.Z)(function*(i,t,e){const u=(0,U.en)(i),c={...e},g=H.Z.from(t),F=!g.quantizationParameters,{data:D}=yield(0,tt.qp)(u,g,new j({sourceSpatialReference:g.sourceSpatialReference,applyTransform:F}),c);return D})).apply(this,arguments)}let d=class extends b.Z{constructor(i){super(i),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return(0,v.mN)(this.url)}execute(i,t){var e=this;return(0,y.Z)(function*(){const u=yield e.executeJSON(i,t);return e.featureSetFromJSON(i,u,t)})()}executeJSON(i,t){var e=this;return(0,y.Z)(function*(){const u=e._normalizeQuery(i),c=null!=i.outStatistics?.[0],g=(0,M.Z)("featurelayer-pbf-statistics"),F=!c||g;let D;if(e.pbfSupported&&F)try{D=yield s(e.url,u,t)}catch(x){if("query:parsing-pbf"!==x.name)throw x;e.pbfSupported=!1}return e.pbfSupported&&F||(D=yield(0,at.F)(e.url,u,t)),e._normalizeFields(D.fields),D})()}featureSetFromJSON(i,t,e){var u=this;return(0,y.Z)(function*(){if(!u._queryIs3DObjectFormat(i)||(0,f.Wi)(u.infoFor3D)||!t.assetMaps||!t.features||!t.features.length)return ut.Z.fromJSON(t);const{meshFeatureSetFromJSON:c}=yield(0,O.Hl)(Promise.all([l.e(9565),l.e(571),l.e(8592),l.e(3936)]).then(l.bind(l,23936)),e);return c(i,u.infoFor3D,t)})()}executeForCount(i,t){return(0,S.P)(this.url,this._normalizeQuery(i),t)}executeForExtent(i,t){return function st(i,t,e){return N.apply(this,arguments)}(this.url,this._normalizeQuery(i),t)}executeForIds(i,t){return(0,rt.G)(this.url,this._normalizeQuery(i),t)}executeRelationshipQuery(i,t){var e=this;return(0,y.Z)(function*(){const[{default:u},{executeRelationshipQuery:c}]=yield(0,O.Hl)(Promise.all([Promise.resolve().then(l.bind(l,76356)),l.e(9044).then(l.bind(l,69044))]),t);return i=u.from(i),(e.gdbVersion||e.dynamicDataSource)&&((i=i.clone()).gdbVersion=i.gdbVersion||e.gdbVersion,i.dynamicDataSource=i.dynamicDataSource||e.dynamicDataSource),c(e.url,i,t)})()}executeRelationshipQueryForCount(i,t){var e=this;return(0,y.Z)(function*(){const[{default:u},{executeRelationshipQueryForCount:c}]=yield(0,O.Hl)(Promise.all([Promise.resolve().then(l.bind(l,76356)),l.e(9044).then(l.bind(l,69044))]),t);return i=u.from(i),(e.gdbVersion||e.dynamicDataSource)&&((i=i.clone()).gdbVersion=i.gdbVersion||e.gdbVersion,i.dynamicDataSource=i.dynamicDataSource||e.dynamicDataSource),c(e.url,i,t)})()}executeAttachmentQuery(i,t){var e=this;return(0,y.Z)(function*(){const{executeAttachmentQuery:u,fetchAttachments:c,processAttachmentQueryResult:g}=yield(0,O.Hl)(l.e(5414).then(l.bind(l,35414)),t),F=(0,U.en)(e.url);return g(F,yield e.queryAttachmentsSupported?u(F,i,t):c(F,i,t))})()}executeTopFeaturesQuery(i,t){var e=this;return(0,y.Z)(function*(){const{executeTopFeaturesQuery:u}=yield(0,O.Hl)(Promise.all([l.e(8592),l.e(3213)]).then(l.bind(l,43213)),t);return u(e.parsedUrl,i,e.sourceSpatialReference,t)})()}executeForTopIds(i,t){var e=this;return(0,y.Z)(function*(){const{executeForTopIds:u}=yield(0,O.Hl)(Promise.all([l.e(8592),l.e(3350)]).then(l.bind(l,93350)),t);return u(e.parsedUrl,i,t)})()}executeForTopExtents(i,t){var e=this;return(0,y.Z)(function*(){const{executeForTopExtents:u}=yield(0,O.Hl)(Promise.all([l.e(8592),l.e(8830)]).then(l.bind(l,38830)),t);return u(e.parsedUrl,i,t)})()}executeForTopCount(i,t){var e=this;return(0,y.Z)(function*(){const{executeForTopCount:u}=yield(0,O.Hl)(Promise.all([l.e(8592),l.e(7390)]).then(l.bind(l,77390)),t);return u(e.parsedUrl,i,t)})()}_normalizeQuery(i){let t=H.Z.from(i);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===i?t.clone():t,t.gdbVersion=i.gdbVersion||this.gdbVersion,t.dynamicDataSource=i.dynamicDataSource?Z.n.from(i.dynamicDataSource):this.dynamicDataSource),(0,f.pC)(this.infoFor3D)&&this._queryIs3DObjectFormat(i)){t=t===i?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e){t.formatOf3DObjects=e;break}"3D_gltf"!==e||t.formatOf3DObjects||(t.formatOf3DObjects=e)}if(!t.formatOf3DObjects)throw new I.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,f.Wi)(t.outFields)||!t.outFields.includes("*")){t=t===i?t.clone():t,(0,f.Wi)(t.outFields)&&(t.outFields=[]);const{originX:e,originY:u,originZ:c,translationX:g,translationY:F,translationZ:D,scaleX:x,scaleY:T,scaleZ:lt,rotationX:q,rotationY:G,rotationZ:P,rotationDeg:Q}=this.infoFor3D.transformFieldRoles;t.outFields.push(e,u,c,g,F,D,x,T,lt,q,G,P,Q)}}return t}_normalizeFields(i){if((0,f.pC)(this.fieldsIndex)&&(0,f.pC)(i))for(const t of i){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(i){return(0,f.pC)(this.infoFor3D)&&!0===i.returnGeometry&&"xyFootprint"!==i.multipatchOption&&!i.outStatistics}};(0,_._)([(0,E.Cb)({type:Z.n})],d.prototype,"dynamicDataSource",void 0),(0,_._)([(0,E.Cb)()],d.prototype,"fieldsIndex",void 0),(0,_._)([(0,E.Cb)()],d.prototype,"gdbVersion",void 0),(0,_._)([(0,E.Cb)()],d.prototype,"infoFor3D",void 0),(0,_._)([(0,E.Cb)({readOnly:!0})],d.prototype,"parsedUrl",null),(0,_._)([(0,E.Cb)()],d.prototype,"pbfSupported",void 0),(0,_._)([(0,E.Cb)()],d.prototype,"queryAttachmentsSupported",void 0),(0,_._)([(0,E.Cb)()],d.prototype,"sourceSpatialReference",void 0),(0,_._)([(0,E.Cb)({type:String})],d.prototype,"url",void 0),d=(0,_._)([(0,m.j)("esri.tasks.QueryTask")],d);const h=d},34524:(W,C,l)=>{l.d(C,{Dm:()=>v,Hq:()=>E,MS:()=>A,bU:()=>M});var y=l(67087),_=l(88684),b=l(29374),I=l(66071);function M(R){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===R||"esriGeometryMultipoint"===R?I.I4:"esriGeometryPolyline"===R?I.ET:I.lF}}}const f=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let O=1;function v(R,m){if((0,y.Z)("esri-csp-restrictions"))return()=>({[m]:null,...R});try{let Z=`this.${m} = null;`;for(const S in R)Z+=`this${f.test(S)?`.${S}`:`["${S}"]`} = ${JSON.stringify(R[S])};`;const U=new Function(`\n      return class AttributesClass$${O++} {\n        constructor() {\n          ${Z};\n        }\n      }\n    `)();return()=>new U}catch{return()=>({[m]:null,...R})}}function E(R={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,_.d9)(R)}}]}function A(R,m){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:R},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:m,supportsDelete:m,supportsEditing:m,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:m,supportsExceedsLimitStatistics:!0},query:b.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:m,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},61028:(W,C,l)=>{l.d(C,{P:()=>M});var y=l(71670),_=l(25820),b=l(78170),I=l(28665);function M(O,v,E){return f.apply(this,arguments)}function f(){return(f=(0,y.Z)(function*(O,v,E){const A=(0,_.en)(O);return(0,b.hH)(A,I.Z.from(v),{...E}).then(R=>R.data.count)})).apply(this,arguments)}},40455:(W,C,l)=>{l.d(C,{G:()=>M});var y=l(71670),_=l(25820),b=l(78170),I=l(28665);function M(O,v,E){return f.apply(this,arguments)}function f(){return(f=(0,y.Z)(function*(O,v,E){const A=(0,_.en)(O);return(0,b.Ev)(A,I.Z.from(v),{...E}).then(R=>R.data.objectIds)})).apply(this,arguments)}}}]);
//# sourceMappingURL=1205.4b9d149543b32b8f.js.map