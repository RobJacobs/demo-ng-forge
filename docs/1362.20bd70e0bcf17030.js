"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[1362],{71362:(U,p,n)=>{n.r(p),n.d(p,{default:()=>F});var o=n(71670),m=n(11823),E=n(32995),P=n(28191),c=n(53661),d=n(30801),u=n(53492),g=n(50805),O=n(63689),h=n(19482),M=n(59266),f=n(70554),D=n(65210),T=n(66010),C=n(19346);class F{constructor(){var t=this;this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=function(){var r=(0,o.Z)(function*(e){const{objectIdField:a}=t._queryEngine,i=yield(0,T.Bm)(t._getFeatureUrl??"",t._featureType.typeName,t._getFeatureOutputFormat,{customParameters:t._customParameters,dateFields:t._queryEngine.fieldsIndex.dateFields.map(s=>s.name),signal:e});yield(0,f.O3)(i),(0,d.k_)(e);const _=(0,f.lG)(i,{geometryType:t._queryEngine.geometryType,hasZ:!1,objectIdField:a});if(!(0,u.fS)(t._queryEngine.spatialReference,u.Zn))for(const s of _)(0,c.pC)(s.geometry)&&(s.geometry=(0,g.GH)((0,h.iV)((0,g.di)(s.geometry,t._queryEngine.geometryType,!1,!1),u.Zn,t._queryEngine.spatialReference)));let l=1;for(const s of _){const y={};(0,D.O0)(t._fieldsIndex,y,s.attributes,!0),s.attributes=y,null==s.attributes[a]&&(s.objectId=s.attributes[a]=l++)}return _});return function(e){return r.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(t,r){var e=this;return(0,o.Z)(function*(){const{getFeatureUrl:a,getFeatureOutputFormat:i,spatialReference:_,fields:l,geometryType:s,featureType:y,objectIdField:j,customParameters:v}=t;e._featureType=y,e._customParameters=v,e._getFeatureUrl=a,e._getFeatureOutputFormat=i,e._fieldsIndex=new C.Z(l),yield e._checkProjection(_),(0,d.k_)(r),e._queryEngine=new M.q({fields:l,geometryType:s,hasM:!1,hasZ:!1,objectIdField:j,spatialReference:_,timeInfo:null,featureStore:new O.Z({geometryType:s,hasM:!1,hasZ:!1})});const I=yield e._snapshotFeatures((0,c.Wg)(r.signal));return e._queryEngine.featureStore.addMany(I),{extent:(yield e._queryEngine.fetchRecomputedExtents()).fullExtent}})()}applyEdits(){return(0,o.Z)(function*(){throw new E.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")})()}queryFeatures(t={},r={}){var e=this;return(0,o.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQuery(t,r.signal)})()}queryFeatureCount(t={},r={}){var e=this;return(0,o.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForCount(t,r.signal)})()}queryObjectIds(t={},r={}){var e=this;return(0,o.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForIds(t,r.signal)})()}queryExtent(t={},r={}){var e=this;return(0,o.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForExtent(t,r.signal)})()}querySnapping(t,r={}){var e=this;return(0,o.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForSnapping(t,r.signal)})()}refresh(t){var r=this;return(0,o.Z)(function*(){return r._customParameters=t,r._snapshotTask?.abort(),r._snapshotTask=(0,m.vr)(r._snapshotFeatures),r._snapshotTask.promise.then(e=>{r._queryEngine.featureStore.clear(),e&&r._queryEngine.featureStore.addMany(e)},e=>{r._queryEngine.featureStore.clear(),(0,d.D_)(e)||P.Z.getLogger("esri.layers.WFSLayer").error(new E.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))}),yield r._waitSnapshotComplete(),{extent:(yield r._queryEngine.fetchRecomputedExtents()).fullExtent}})()}_waitSnapshotComplete(){var t=this;return(0,o.Z)(function*(){if(t._snapshotTask&&!t._snapshotTask.finished){try{yield t._snapshotTask.promise}catch{}return t._waitSnapshotComplete()}})()}_checkProjection(t){return(0,o.Z)(function*(){try{yield(0,h._W)(u.Zn,t)}catch{throw new E.Z("unsupported-projection","Projection not supported",{spatialReference:t})}})()}}}}]);
//# sourceMappingURL=1362.20bd70e0bcf17030.js.map