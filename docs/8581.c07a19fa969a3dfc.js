"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[8581],{30248:(We,oe,_)=>{_.d(oe,{Z:()=>U});var E=_(53661);class U{constructor(F){this.size=0,this._start=0,this.maxSize=F,this._buffer=new Array(F)}get entries(){return this._buffer}enqueue(F){if(this.size===this.maxSize){const D=this._buffer[this._start];return this._buffer[this._start]=F,this._start=(this._start+1)%this.maxSize,D}return this._buffer[(this._start+this.size++)%this.maxSize]=F,null}dequeue(){if(0===this.size)return null;const F=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,F}peek(){return 0===this.size?null:this._buffer[this._start]}find(F){if(0===this.size)return null;for(const D of this._buffer)if((0,E.pC)(D)&&F(D))return D;return null}clear(F){let D=this.dequeue();for(;(0,E.pC)(D);)F&&F(D),D=this.dequeue()}}},75683:(We,oe,_)=>{_.d(oe,{a:()=>D});var E=_(32995),U=_(28191),X=_(20753),F=_(52300);function D(N){return(0,F.hj)(N.minDataValue)&&(0,F.hj)(N.maxDataValue)&&null!=N.minSize&&null!=N.maxSize?X.X.SIZE_MINMAX_VALUE:(N.expression&&"view.scale"===N.expression||N.valueExpression&&"$view.scale"===N.valueExpression)&&Array.isArray(N.stops)?X.X.SIZE_SCALE_STOPS:(null!=N.field||N.expression&&"view.scale"!==N.expression||N.valueExpression&&"$view.scale"!==N.valueExpression)&&(Array.isArray(N.stops)||"levels"in N&&N.levels)?X.X.SIZE_FIELD_STOPS:(null!=N.field||N.expression&&"view.scale"!==N.expression||N.valueExpression&&"$view.scale"!==N.valueExpression)&&null!=N.valueUnit?X.X.SIZE_UNIT_VALUE:(U.Z.getLogger("esri.views.2d.engine.webgl").error(new E.Z("mapview-bad-type","Found invalid size VisualVariable",N)),X.X.NONE)}},52770:(We,oe,_)=>{_.r(oe),_.d(oe,{default:()=>zs});var E=_(71670),U=_(18100),X=_(31882),F=_(67087),D=_(7521),N=_(9497),_e=(_(83382),_(19420),_(20891)),ye=_(53492),xe=_(51015),Re=_(6365),g=_(53661),b=_(30801),L=_(50805),Ae=_(59266),Le=_(19346),me=_(59690),De=_(4583),Pe=_(1897),ue=_(32995),Ee=_(28191),Ge=_(28247),Ce=_(6099),He=_(79264),Ie=_(78170),w=_(80416),ke=_(74617),Te=_(33510),Z=_(93846),ve=_(80074),Be=_(58583);const s=268435455;class Ut{constructor(){this.fieldMap=new Map,this.fields=[],this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}hasField(e){return this.fieldMap.has(e)}isDateField(e){return(null!=e&&this.fieldMap.get(e)?.isDate)??!1}getFieldIndex(e){return null!=e?this.fieldMap.get(e)?.index:void 0}}function Lt(n){const i=n.asUnsafe(),r=i.getLength(),a=i.pos()+r,o={name:"",isDate:!1};for(;i.pos()<a&&i.next();)switch(i.tag()){case 1:o.name=i.getString();break;case 2:"esriFieldTypeDate"===(0,Be.O7)(i.getEnum())&&(o.isDate=!0);break;default:i.skip()}return o}function Dt(n){return n.toLowerCase().trim()}const $e=268435455,Ne={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(128e3),decoded:new Int32Array(128e3)}};function lt(n){return n<=Ne.small.delta.length?Ne.small:(n<=Ne.large.delta.length||(Ne.large.delta=new Int32Array(Math.round(1.25*n)),Ne.large.decoded=new Int32Array(Math.round(1.25*n))),Ne.large)}function gt(n){return n.toLowerCase().trim()}function wt(n){for(;n.next();){if(1===n.tag())return n.getMessage();n.skip()}return null}function Ht(n,e,t,i,r,a){return.5*Math.abs(n*i+t*a+r*e-n*a-t*e-r*i)}function Je(n,e,t,i){return n*i-t*e==0&&n*t+e*i>0}class Ve extends ve.s{static fromBuffer(e,t,i=!1){const r=t.geometryType,a=function Bt(n){try{const t=new ke.Z(new Uint8Array(n),new DataView(n));for(;t.next();){if(2===t.tag())return wt(t.getMessage());t.skip()}}catch(e){const t=new ue.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});Ee.Z.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(t)}return null}(e),o=function Pt(n,e,t=!1){const h=n.asUnsafe(),l=h.pos(),c=new Ut;let f=0,p=0,A=null,R=null,S=null,C=!1;for(;h.next();)switch(h.tag()){case 1:A=h.getString();break;case 3:R=h.getString();break;case 12:S=h.processMessage(Be.G$);break;case 9:if(c.exceededTransferLimit=h.getBool(),c.exceededTransferLimit){c.offsets.geometry=t?new Float64Array(8e3):new Int32Array(8e3),c.centroid=t?new Float64Array(16e3):new Int32Array(16e3);for(let v=0;v<c.centroid.length;v++)c.centroid[v]=s}break;case 13:{const v=Lt(n),G=v.name,B=Dt(v.name),O={fieldName:G,index:f++,isDate:v.isDate};c.fields.push(O),c.fieldMap.set(v.name,O),c.fieldMap.set(B,O);break}case 15:{const v=h.getLength(),G=h.pos()+v;if(!c.exceededTransferLimit){const x=c.centroid;c.offsets.geometry.push(0),x.push(s),x.push(s)}!C&&c.exceededTransferLimit&&(C=!0,c.offsets.attributes=t?new Float64Array(8e3*f):new Uint32Array(8e3*f));let B=p*f;for(;h.pos()<G&&h.next();)switch(h.tag()){case 1:{C?c.offsets.attributes[B++]=h.pos():c.offsets.attributes.push(h.pos());const O=h.getLength();h.skipLen(O);break}case 2:if(e){const O=h.getLength(),x=h.pos()+O;for(;h.pos()<x&&h.next();)switch(h.tag()){case 3:{h.getUInt32();const P=h.getSInt64(),k=h.getSInt64();c.centroid[2*p]=P,c.centroid[2*p+1]=k;break}default:h.skip()}}else{c.offsets.geometry[p]=h.pos();const O=h.getLength();c.vertexCount+=O,h.skipLen(O)}break;case 4:{const O=h.getLength(),x=h.pos()+O;for(;h.pos()<x&&h.next();)switch(h.tag()){case 3:{h.getUInt32();const P=h.getSInt64(),k=h.getSInt64();c.centroid[2*p]=P,c.centroid[2*p+1]=k;break}default:h.skip()}break}default:h.skip()}p++,c.hasFeatures=!0;break}default:h.skip()}const M=A||R;if(!M)throw new ue.Z("FeatureSet has no objectId or globalId field name");return c.featureCount=p,c.fieldCount=f,c.objectIdFieldIndex=c.getFieldIndex(M),c.transform=S,c.displayIds=new Uint32Array(c.featureCount),c.groupIds=new Uint16Array(c.featureCount),h.move(l),c}(a,"esriGeometryPoint"===r,i),u=ve.s.createInstance();return new Ve(u,a,o,t)}constructor(e,t,i,r){super(e,r),this._hasNext=!1,this._isPoints=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._geometryType=r.geometryType,this._reader=t,this._header=i,this._hasNext=i.hasFeatures,this._isPoints="esriGeometryPoint"===r.geometryType}get geometryType(){return this._geometryType}get _size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}hasField(e){return this._header.hasField(e)||this._header.hasField(gt(e))}getFieldNames(){return this._header.fields.map(e=>e.fieldName)}getSize(){return this._size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){let e="";return this._header.fields.forEach(({index:t})=>{e+=this._readAttributeAtIndex(t)+"."}),e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(e){this._header.groupIds[this._featureIndex]=e}readLegacyFeature(){if(void 0===this._cache.legacyFeature){const e=this.readCentroid(),t={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null};return this._cache.legacyFeature=t,t}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){const e=new Te.u_(this.readGeometry(),this.readAttributes(),this.readCentroid());return e.objectId=this.getObjectId(),e.displayId=this.getDisplayId(),this._cache.optFeature=e,e}return this._cache.optFeature}getXHydrated(){const e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return(0,g.Wi)(t)?e:e*t.scale[0]+t.translate[0]}getYHydrated(){const e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return(0,g.Wi)(t)?e:t.translate[1]-e*t.scale[1]}getX(){return this._header.centroid[2*this._featureIndex]*this._sx+this._tx}getY(){return this._header.centroid[2*this._featureIndex+1]*this._sy+this._ty}readLegacyPointGeometry(){return{x:this.getX(),y:this.getY()}}readLegacyGeometry(e){const t=this.readGeometry(e);return(0,L.di)(t,this.geometryType,!1,!1)}readLegacyCentroid(){const e=this.readCentroid();if(!e)return null;const[t,i]=e.coords;return{x:t,y:i}}readGeometryArea(){return this._cache.area||this.readGeometry(!0),this._cache.area}readUnquantizedGeometry(e=!1){if(void 0===this._cache.unquantGeometry){const t=this.readGeometry(e);if(!t)return this._cache.unquantGeometry=void 0,null;const i=lt(t.coords.length).decoded,r=t.clone(i),a=r.coords;let o=0;for(const u of r.lengths){for(let d=1;d<u;d++){const h=2*(o+d),l=2*(o+d-1);a[h]+=a[l],a[h+1]+=a[l+1]}o+=u}return this._cache.unquantGeometry=r,r}return this._cache.unquantGeometry}readHydratedGeometry(){if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===$e)return null;const r=this.getXHydrated(),a=this.getYHydrated();return new Z.Z([],[r,a])}const e=this.readGeometry();if(!e)return null;const t=e.clone(),i=this.getQuantizationTransform();return(0,g.pC)(i)&&(0,L.$g)(t,t,this.hasZ,this.hasM,i),t}readGeometry(e=!1){if(void 0===this._cache.geometry){let t=null;if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===$e)return null;const i=this.getX(),r=this.getY();t=new Z.Z([],[i,r])}else{const i=this._header.offsets.geometry[this._featureIndex],r=this._reader;if(0===i){const a=this._readServerCentroid();if(!a)return null;const[o,u]=a.coords;return this.createQuantizedExtrudedQuad(o,u)}r.move(i);try{if(t=e?this._parseGeometryForDisplay(r):this._parseGeometry(r),null===t){const a=this._readServerCentroid();if(!a)return null;const[o,u]=a.coords;return this.createQuantizedExtrudedQuad(o,u)}}catch(a){return console.error("Failed to parse geometry!",a),null}}return this._cache.geometry=t,t}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){let e;return e=this._computeCentroid(),e||(e=this._readServerCentroid()),this._cache.centroid=e??void 0,e??null}return this._cache.centroid}copy(){const e=this._reader.clone(),t=new Ve(this.instance,e,this._header,this.fullSchema());return this.copyInto(t),t}next(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readAttribute(e,t){const i=this._header.hasField(e)?e:gt(e),r=this._header.getFieldIndex(i);if(null==r)return;const a=this._readAttributeAtIndex(r);return t&&null!=a&&this._header.isDateField(i)?new Date(a):a}_readAttributes(){const e={};return this._header.fields.forEach(({fieldName:t,index:i})=>{e[t]=this._readAttributeAtIndex(i)}),e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext}_readAttributeAtIndex(e){const i=this._reader;return i.move(this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e]),function Zt(n){const l=n.getLength(),c=n.pos()+l;for(;n.pos()<c&&n.next();)switch(n.tag()){case 1:return n.getString();case 2:return n.getFloat();case 3:return n.getDouble();case 4:return n.getSInt32();case 5:return n.getUInt32();case 6:return n.getInt64();case 7:return n.getUInt64();case 8:return n.getSInt64();case 9:return n.getBool();default:return n.skip(),null}return null}(i)}_readServerCentroid(){const e=this._header.centroid[2*this._featureIndex]+this._tx;return e===$e?null:new Z.Z([],[e,this._header.centroid[2*this._featureIndex+1]+this._ty])}_parseGeometry(e){const r=e.asUnsafe(),a=r.getLength(),o=r.pos()+a,u=[],d=[];for(;r.pos()<o&&r.next();)switch(r.tag()){case 2:{const h=r.getUInt32(),l=r.pos()+h;for(;r.pos()<l;)d.push(r.getUInt32());break}case 3:{const h=r.getUInt32(),l=r.pos()+h;for(u.push(r.getSInt32()+this._tx),u.push(r.getSInt32()+this._ty),this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();r.pos()<l;)u.push(r.getSInt32()),u.push(r.getSInt32()),this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();break}default:r.skip()}return new Z.Z(d,u)}_parseGeometryForDisplay(e){const r=e.asUnsafe(),a=r.getLength(),o=r.pos()+a,u=[],d=[];let h=0,l=0,c=null,f=0;const p="esriGeometryPolygon"===this.geometryType;for(;r.pos()<o&&r.next();)switch(r.tag()){case 2:{const y=r.getUInt32(),m=r.pos()+y;for(;r.pos()<m;){const I=r.getUInt32();u.push(I),h+=I}c=lt(2*h).delta;break}case 3:{r.getUInt32();const y=2+(this.hasZ?1:0)+(this.hasM?1:0);(0,g.O3)(c);for(const m of u)if(l+y*m>c.length)for(let I=0;I<m;I++)r.getSInt32(),r.getSInt32(),this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();else if(p){const I=this.getAreaSimplificationThreshold(m,this._header.vertexCount);let T=2,A=1;const R=!1;let S=r.getSInt32(),C=r.getSInt32();c[l++]=S,c[l++]=C,this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();let M=r.getSInt32(),v=r.getSInt32();for(this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();T<m;){let G=r.getSInt32(),B=r.getSInt32();this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32();const O=S+M,x=C+v;Ht(S,C,O,x,O+G,x+B)>=I?(f+=-.5*(O-S)*(x+C),A>1&&Je(c[l-2],c[l-1],M,v)?(c[l-2]+=M,c[l-1]+=v):(c[l++]=M,c[l++]=v,A++),S=O,C=x):(G+=M,B+=v),M=G,v=B,T++}A<3||R?l-=2*A:(f+=-.5*(S+M-S)*(C+v+C),Je(c[l-2],c[l-1],M,v)?(c[l-2]+=M,c[l-1]+=v,d.push(A)):(c[l++]=M,c[l++]=v,d.push(++A)))}else{let I=0,T=r.getSInt32(),A=r.getSInt32();this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32(),c[l++]=T,c[l++]=A,I+=1;for(let R=1;R<m;R++){const S=r.getSInt32(),C=r.getSInt32(),M=T+S,v=A+C;f+=-.5*(M-T)*(v+A),this.hasZ&&r.getSInt32(),this.hasM&&r.getSInt32(),R>2&&Je(c[l-2],c[l-1],S,C)?(c[l-2]+=S,c[l-1]+=C):(c[l++]=S,c[l++]=C,I+=1),T=M,A=v}d.push(I)}break}default:r.skip()}if(this._cache.area=f,!d.length)return null;if(this._tx||this._ty){let y=0;(0,g.O3)(c);for(const m of d)c[2*y]+=this._tx,c[2*y+1]+=this._ty,y+=m}return new Z.Z(d,c)}}class Qe{constructor(e){this.service=e}destroy(){}}function Ke(){return(Ke=(0,E.Z)(function*(n){const e=new Ge.Z;return yield e.open(n,{}),e})).apply(this,arguments)}class Yt extends Qe{constructor(e){super(e),this._portsOpen=function qt(n){return Ke.apply(this,arguments)}(e.source).then(t=>this.client=t)}destroy(){this.client.close(),this.client=null}executeQuery(e,t){var i=this;return(0,E.Z)(function*(){yield i._portsOpen;const r=yield i.client.invoke("queryFeatures",e.toJSON(),t);return w.i.fromFeatureSet(r,i.service)})()}}class Xt extends Qe{executeQuery(e,t){var i=this;return(0,E.Z)(function*(){const{data:r}=yield(0,Ie.n7)(i.service.source,e,t);return Ve.fromBuffer(r,i.service,!e.quantizationParameters)})()}}class zt extends Qe{executeQuery(e,t){var i=this;return(0,E.Z)(function*(){const{source:r,capabilities:a,spatialReference:o,objectIdField:u,geometryType:d}=i.service;if((0,g.pC)(e.quantizationParameters)&&!a.query.supportsQuantization){const l=e.clone(),c=(0,Ce.vY)((0,g.Wg)(l.quantizationParameters));l.quantizationParameters=null;const{data:f}=yield(0,Ie.JT)(r,l,o,t),p=(0,L.h_)(f,u);return(0,L.RZ)(c,p),w.i.fromOptimizedFeatureSet(p,i.service)}const{data:h}=yield(0,Ie.JT)(r,e,i.service.spatialReference,t);return"esriGeometryPoint"===d&&(h.features=h.features?.filter(l=>{if((0,g.pC)(l.geometry)){const c=l.geometry;return Number.isFinite(c.x)&&Number.isFinite(c.y)}return!0})),w.i.fromFeatureSet(h,i.service)})()}}class jt extends Qe{executeQuery(e,t){var i=this;return(0,E.Z)(function*(){const{capabilities:r}=i.service;if(e.quantizationParameters&&!r.query.supportsQuantization){const o=e.clone(),u=(0,Ce.vY)((0,g.Wg)(o.quantizationParameters));o.quantizationParameters=null;const d=yield(0,He.WW)(i.service.source,e,t);return(0,L.RZ)(u,d),w.i.fromOptimizedFeatureSet(d,i.service)}const a=yield(0,He.WW)(i.service.source,e,t);return w.i.fromOptimizedFeatureSet(a,i.service)})()}}var Wt=_(55025),et=_(95442),re=_(51118),$t=_(28665),qe=_(30248);class H{constructor(){this.version=0,this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}static create(e){const t=new H;for(const i in e){const r=e[i];if("object"==typeof r)for(const a in r)t[i][a]=r[a];t[i]=r}return t}static empty(){return H.create({})}static all(){return H.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}unset(e){this.version=e.version,e.source&&(this.source=!1),e.targets.feature&&(this.targets.feature=!1),e.targets.aggregate&&(this.targets.aggregate=!1),e.storage.filters&&(this.storage.filters=!1),e.storage.data&&(this.storage.data=!1),e.mesh&&(this.mesh=!1),e.queryFilter&&(this.queryFilter=!1)}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){let e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(const r of this.why.mesh)t+=`    + ${r}\n`}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(const r of this.why.source)t+=`    + ${r}\n`}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed"),console.debug(`Applying ${e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow"} update of cost ${e}/45 `),console.debug(t)}toJSON(){return{queryFilter:this.queryFilter,source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh}}}class Jt{constructor(e,t){this.requests={done:new Array,stream:new qe.Z(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._done=!1,this.didSend=!1,this.tile=e,this._version=t}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length&&(0,g.Wi)(this.edits)}get edits(){return this._edits}get done(){return this._done}end(){this._done=!0}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach(t=>t.message.status.unset(e)),this._version=e.version,(0,g.pC)(this._edits)&&this._edits.status.unset(e)}add(e){e.message.status=e.message.status??H.empty(),e.message.status.version=this._version,(0,F.Z)("esri-2d-update-debug")&&console.debug(this.tile.id,"DataTileSubscription:add",this._version),e.message.end&&this.requests.done.forEach(t=>{(0,g.pC)(t.message)&&t.message.end&&(t.message.end=!1)}),this.requests.done.push(e)}edit(e,t){const i=e.getQuantizationTransform(),r=e.fullSchema(),a=Array.from(e.features()).filter(g.pC),o=[...t,...a.map(u=>u.objectId)];this.removeIds(o),this._invalidate(),(0,g.Wi)(this._edits)?this._edits={type:"append",addOrUpdate:w.i.fromOptimizedFeatures(a,r,(0,g.Wg)(i)),id:this.tile.id,status:H.empty(),end:!0}:(this.requests.done.forEach(u=>u.message.end=!1),(0,g.Wg)(this._edits.addOrUpdate).append(e.features()))}*readers(){for(const{message:e}of this.requests.done)(0,g.pC)(e.addOrUpdate)&&(yield e.addOrUpdate);(0,g.pC)(this._edits)&&(0,g.pC)(this._edits.addOrUpdate)&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=H.empty();(0,g.pC)(this._edits)&&(this._edits.status=H.empty())}removeIds(e){this._invalidate();for(const{message:t}of this.requests.done){const i=t.addOrUpdate;(0,g.pC)(i)&&(i.removeIds(e),i.isEmpty&&((0,F.Z)("esri-2d-update-debug")&&console.debug("Removing FeatureSetReader"),t.addOrUpdate=null))}(0,g.pC)(this._edits)&&(0,g.pC)(this._edits.addOrUpdate)&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter(t=>t.message.addOrUpdate||t.message.end)}abort(){this._abortController.abort()}}class ft extends Re.Z{constructor(e){super(),this.events=new et.Z,this._resolver=(0,b.hh)(),this._didEdit=!1,this._subscriptions=new Map,this._outSR=e.outSR,this._serviceInfo=e.serviceInfo,this._onTileUpdateMessage=e.onMessage}_onMessage(e){var t=this;return(0,E.Z)(function*(){const i=t._subscriptions.get(e.id);if(!i)return;const r={...e,remove:e.remove??[],status:e.status??H.empty()};return(0,b.R8)(t._onTileUpdateMessage(r,i.options))})()}update(e,t){const i=t.fields.length;t.outFields=function Kt(n,e){const t=new Set;return n&&n.forEach(i=>t.add(i)),e&&e.forEach(i=>t.add(i)),t.has("*")?["*"]:Array.from(t)}(this._schema?.outFields,t.outFields),t.outFields=t.outFields.length>=.75*i?["*"]:t.outFields,t.outFields.sort();const r=(0,re.Hg)(this._schema,t);if(!r)return;(0,F.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Source:",r);const o={returnCentroid:"esriGeometryPolygon"===this._serviceInfo.geometryType,returnGeometry:!0,timeReferenceUnknownClient:"stream"!==this._serviceInfo.type&&this._serviceInfo.timeReferenceUnknownClient,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:["orderByFields"in this._serviceInfo&&this._serviceInfo.orderByFields?this._serviceInfo.orderByFields:this._serviceInfo.objectIdField+" ASC"],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment,timeExtent:t.timeExtent?Wt.Z.fromJSON(t.timeExtent):null},u=this._schema&&(0,re.uD)(r,"outFields");this._schema&&(0,re.V7)(r,["timeExtent","definitionExpression","gdbVersion","historicMoment","customParameters"])&&(e.why.mesh.push("Layer filter and/or custom parameters changed"),e.why.source.push("Layer filter and/or custom parameters changed"),e.mesh=!0,e.source=!0,e.queryFilter=!0),u&&(e.why.source.push("Layer required fields changed"),e.source=!0),(0,re.Hg)(o,this._queryInfo)&&(this._queryInfo=o),this._schema=t,this._resolver.resolve()}whenInitialized(){return this._resolver.promise}applyUpdate(e){var t=this;return(0,E.Z)(function*(){if(e.queryFilter||e.source&&t._didEdit)return t.refresh(e.version),void(t._didEdit=!1);t._subscriptions.forEach(i=>i.applyUpdate(e)),yield t.resend()})()}refresh(e,t){for(const i of this._tiles())this.unsubscribe(i),this.subscribe(i,e)}subscribe(e,t){const i=new Jt(e,t);this._subscriptions.set(e.id,i)}unsubscribe(e){const t=this.getSubscription(e.id);(0,g.pC)(t)&&t.abort(),this._subscriptions.delete(e.id)}createQuery(e={}){const t=this._queryInfo.historicMoment?new Date(this._queryInfo.historicMoment):null;return new $t.Z({...this._queryInfo,historicMoment:t,...e})}getSubscription(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null}queryLastEditDate(){return(0,E.Z)(function*(){throw new Error("Service does not support query type")})()}query(e,t){return(0,E.Z)(function*(){throw new Error("Service does not support query")})()}*_tiles(){const e=Array.from(this._subscriptions.values());for(const t of e)yield t.tile}edit(e,t){var i=this;return(0,E.Z)(function*(){const r=Array.from(i._subscriptions.values()),a=r.map(({tile:o})=>o);for(const o of r)o.removeIds(t);if(e.length){const o=a.map(d=>{const h=i.createTileQuery(d);return h.objectIds=e,{tile:d,query:h}}).map(function(){var d=(0,E.Z)(function*({tile:h,query:l}){return{tile:h,result:yield i.query(l,{query:{tile:(0,F.Z)("esri-tiles-debug")?h.id.replace(/\//g,"."):void 0}}),query:l}});return function(h){return d.apply(this,arguments)}}()),u=(yield(0,b.WW)(o)).map(function(){var d=(0,E.Z)(function*({tile:h,result:l}){if(!l.hasFeatures&&!t.length&&!e.length)return;const c=i._subscriptions.get(h.key.id);c&&c.edit(l,e)});return function(h){return d.apply(this,arguments)}}());yield(0,b.as)(u)}i._didEdit=!0})()}}var tt=_(67532);class st extends ft{constructor(e){var t,i;super(e),t=this,this.type="feature",this.mode="on-demand",this._adapter=function Qt(n){const{capabilities:e}=n;return function Vt(n){return"ogc-source"===n?.type}(n.source)?new jt(n):function kt(n){return Array.isArray(n.source)}(n)?new Yt(n):e.query.supportsFormatPBF&&(0,F.Z)("featurelayer-pbf")?new Xt(n):new zt(n)}(e.serviceInfo),this._queue=new tt.e({concurrency:8,process:(i=(0,E.Z)(function*(r){if((0,b.k_)(r),(0,g.pC)(r.tile)){const a=r.tile.key.id,{signal:o}=r,u=(0,F.Z)("esri-tiles-debug")?{tile:a.replace(/\//g,"."),depth:r.depth}:void 0,d=yield t._adapter.executeQuery(r.query,{signal:o,query:{...u,...t._schema?.customParameters}});return d.level=r.tile.key.level,d}return t._adapter.executeQuery(r.query,{...r,query:t._schema?.customParameters})}),function(a){return i.apply(this,arguments)})}),this._patchQueue=new tt.e({concurrency:8,process:function(){var i=(0,E.Z)(function*(r){if((0,b.k_)(r),(0,g.pC)(r.tile)){const a=r.tile.key.id,{signal:o}=r,u=(0,F.Z)("esri-tiles-debug")?{tile:a.replace(/\//g,"."),depth:r.depth}:void 0,d=yield t._adapter.executeQuery(r.query,{signal:o,query:{...u,...t._schema?.customParameters}});return d.level=r.tile.key.level,d}return t._adapter.executeQuery(r.query,{...r,query:t._schema?.customParameters})});return function(a){return i.apply(this,arguments)}}()})}destroy(){super.destroy(),this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()}get updating(){return!!this._queue.length||Array.from(this._subscriptions.values()).some(e=>!e.done)}get maxRecordCountFactor(){const{query:e}=this._serviceInfo.capabilities;return e.supportsMaxRecordCountFactor?4:null}get maxPageSize(){const{query:e}=this._serviceInfo.capabilities;return(e.maxRecordCount??8e3)*(0,g.Pt)(this.maxRecordCountFactor,1)}get pageSize(){return Math.min(8e3,this.maxPageSize)}enableEvent(e,t){}subscribe(e,t){super.subscribe(e,t);const i=this._subscriptions.get(e.id);this._fetchDataTile(e).catch(r=>{(0,b.D_)(r)||Ee.Z.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource").error(new ue.Z("mapview-query-error","Encountered error when fetching tile",{tile:e,error:r}))}).then(()=>i.end())}unsubscribe(e){super.unsubscribe(e)}readers(e){return this._subscriptions.get(e).readers()}query(e,t={}){var i=this;return(0,E.Z)(function*(){const r=t.query??{};return i._adapter.executeQuery(e,{...t,query:{...r,...i._schema?.customParameters}})})()}queryLastEditDate(){var e=this;return(0,E.Z)(function*(){const t=e._serviceInfo.source,i={...t.query,f:"json"};return(yield(0,Pe.default)(t.path,{query:i,responseType:"json"})).data.editingInfo.lastEditDate})()}createTileQuery(e,t={}){const i=this._serviceInfo.geometryType,r=this.createQuery(t);r.quantizationParameters=t.quantizationParameters??e.getQuantizationParameters(),r.resultType="tile",r.geometry=e.extent,this._serviceInfo.capabilities.query.supportsQuantization?"esriGeometryPolyline"===i&&(r.maxAllowableOffset=e.resolution*(0,F.Z)("feature-polyline-generalization-factor")):"esriGeometryPolyline"!==i&&"esriGeometryPolygon"!==i||(r.maxAllowableOffset=e.resolution,"esriGeometryPolyline"===i&&(r.maxAllowableOffset*=(0,F.Z)("feature-polyline-generalization-factor")));const a=this._serviceInfo.capabilities.query;return r.defaultSpatialReferenceEnabled=a.supportsDefaultSpatialReference,r.compactGeometryEnabled=a.supportsCompactGeometry,r}_executePatchQuery(e,t,i,r){var a=this;return(0,E.Z)(function*(){const o=t.clone();o.outFields=[a._serviceInfo.objectIdField,...i],o.returnCentroid=!1,o.returnGeometry=!1;const u=(0,g.pC)(o.start)?o.start/8e3:0;return a._patchQueue.push({tile:e,query:o,signal:r.signal,depth:u})})()}_resend(e,t){var i=this;return(0,E.Z)(function*(){const{query:r,message:a}=e,o=(0,g.pC)(r.outFields)?r.outFields:[],u=i._queryInfo.outFields,d=u.filter(h=>!o.includes(h));if((0,g.Wi)(a.addOrUpdate))i._onMessage({...a,type:"append"});else if(d.length)try{const h=i._subscriptions.get(a.id).tile,l=yield i._executePatchQuery(h,r,d,t);(0,b.k_)(t),r.outFields=u,a.addOrUpdate.joinAttributes(l),i._onMessage({...a,end:a.end,type:"append"})}catch{}else i._onMessage({...a,type:"append"})})()}_resendSubscription(e){var t=this;return(0,E.Z)(function*(){if((0,F.Z)("esri-2d-update-debug")&&console.debug(e.tile.id,"Resend Subscription"),e.empty)return t._onMessage({id:e.tile.id,addOrUpdate:null,end:!1,type:"append"});const i=e.signal;for(const r of e.requests.done)yield t._resend(r,{signal:i});return(0,g.pC)(e.edits)?t._onMessage(e.edits):void 0})()}resend(){var e=this;return(0,E.Z)(function*(){const t=Array.from(e._subscriptions.values());yield Promise.all(t.map(i=>e._resendSubscription(i)))})()}}const pt=(0,F.Z)("esri-mobile"),_t={maxDrillLevel:pt?1:4,maxRecordCountFactor:pt?1:3};class ts extends st{constructor(e){super(e)}_fetchDataTile(e){var t=this;return(0,E.Z)(function*(){const i=t._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,r=t._subscriptions.get(e.key.id),a=r.signal,o=e.getQuantizationParameters();let u=0;const d=function(){var h=(0,E.Z)(function*(l,c){const f=t._queryInfo,p=t.createTileQuery(l,{maxRecordCountFactor:i?_t.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:o});u++;try{const y=yield t._queue.push({tile:e,query:p,signal:a,depth:c});if(u--,(0,b.k_)(a),!y)return;if(f!==t._queryInfo)return void d(l,c);if(y.exceededTransferLimit&&c<_t.maxDrillLevel){for(const I of l.createChildTiles())d(I,c+1);return}const m={id:e.id,addOrUpdate:y,end:0===u,type:"append"};r.add({query:p,message:m}),t._onMessage(m)}catch(y){(0,b.D_)(y)||t._onMessage({id:e.id,addOrUpdate:null,end:!0,type:"append"})}});return function(c,f){return h.apply(this,arguments)}}();d(e,0)})()}}class ss extends st{constructor(e){super(e)}_fetchDataTile(e){var t=this;return(0,E.Z)(function*(){const a=t._subscriptions.get(e.key.id);let o=!1,u=0,d=0;const h=(f,p)=>{d--,(0,b.k_)(a);const y=e.id,m=f.reader,I=f.query;if(!m.exceededTransferLimit){if(o=!0,0!==p&&!m.hasFeatures){const R={id:y,addOrUpdate:m,end:0===d,type:"append"};return a.add({message:R,query:I}),void t._onMessage(R)}const A={id:y,addOrUpdate:m,end:0===d,type:"append"};return a.add({message:A,query:I}),void t._onMessage(A)}const T={id:y,addOrUpdate:m,end:o&&0===d,type:"append"};a.add({message:T,query:I}),t._onMessage(T)};let l=0,c=0;for(;!o&&c++<20;){let f;for(let p=0;p<l+1;p++){const y=u++;d++,f=t._fetchDataTilePage(e,y,a).then(m=>m&&h(m,y)).catch(m=>{o=!0,(0,b.D_)(m)||(Ee.Z.getLogger("esri.views.2d.layers.features.sources.PagedFeatureSource").error(new ue.Z("mapview-query-error","Encountered error when fetching tile",{tile:e,error:m})),t._onMessage({id:e.id,addOrUpdate:null,end:o,type:"append"}))})}yield f,(0,b.k_)(a),l=Math.min(l+2,6)}})()}_fetchDataTilePage(e,t,i){var r=this;return(0,E.Z)(function*(){(0,b.k_)(i);const a=r._queryInfo,o={start:r.pageSize*t,num:r.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};(0,g.pC)(r.maxRecordCountFactor)&&(o.maxRecordCountFactor=r.maxRecordCountFactor);const u=r.createTileQuery(e,o);try{const d=i.signal,h=yield r._queue.push({tile:e,query:u,signal:d,depth:t});return(0,b.k_)(i),h?a!==r._queryInfo?r._fetchDataTilePage(e,t,i):{reader:h,query:u}:null}catch(d){return(0,b.H9)(d),null}})()}}var rs=_(37313),is=_(10002);function ns(n,e,t){const i=n.getXHydrated(),r=n.getYHydrated(),a=e.getColumnForX(i),o=Math.floor(e.normalizeCol(a));return`${t}/${Math.floor(e.getRowForY(r))}/${o}`}function rt(n,e){if((0,g.Wi)(n))return null;const t=e.transform,i=n.getQuantizationTransform();if((0,g.Wi)(i)){const[I,T]=t.scale,[A,R]=t.translate;return n.transform(-A/I,R/T,1/I,1/-T)}const[r,a]=i.scale,[o,u]=i.translate,[d,h]=t.scale,[l,c]=t.translate;return n.transform((o-l)/d,(-u+c)/h,r/d,a/h)}class as extends st{constructor(e){super(e),this.mode="snapshot",this._loading=!0,this._controller=new AbortController,this._downloadPromise=null,this._didSendEnd=!1,this._queries=new Array,this._invalidated=!1,this._hasAggregates=!1,this._random=new rs.Z(1e3),this._store=e.store,this._markedIdsBufId=this._store.storage.createBitset()}destroy(){super.destroy(),this._controller.abort()}get loading(){return this._loading}get _signal(){return this._controller.signal}update(e,t){super.update(e,t),null==this._featureCount&&(this._featureCount=t.initialFeatureCount),(0,g.pC)(t.changedFeatureCount)&&(this._featureCount=t.changedFeatureCount),this._hasAggregates=!!e.targets?.aggregate}resend(e=!1){var t=this;return(0,E.Z)(function*(){if(yield t._downloadPromise,t._invalidated||e){const r=(0,g.s3)(t._featureCount,"Expected featureCount to be defined");return t._invalidated=!1,t._subscriptions.forEach(a=>a.clear()),t._downloadPromise=t._download(r),void(yield t._downloadPromise)}const i=t._queries.map(({query:r,reader:a})=>t._sendPatchQuery(r,a));yield Promise.all(i),t._subscriptions.forEach(r=>{r.requests.done.forEach(a=>t._onMessage(a.message))})})()}refresh(e,t){var i=this;return(0,E.Z)(function*(){t&&(i._featureCount=t.featureCount),yield i.resend(!0)})()}_sendPatchQuery(e,t){var i=this;return(0,E.Z)(function*(){const r=(0,g.pC)(e.outFields)?e.outFields:[],a=i._queryInfo.outFields,o=a.filter(l=>!r.includes(l));if(!o.length)return;const u=e.clone(),d=i._signal;u.returnGeometry=!1,u.returnCentroid=!1,u.outFields=o,e.outFields=a;const h=yield i._queue.push({query:u,depth:0,signal:d});(0,b.k_)({signal:d}),t.joinAttributes(h)})()}_fetchDataTile(e){var t=this;return(0,E.Z)(function*(){if(!t._downloadPromise){const h=(0,g.s3)(t._featureCount,"Expected featureCount to be defined");t._downloadPromise=t._download(h)}const i=t._store.search(e),r=t._subscriptions.get(e.key.id),a=i.length-1;for(let h=0;h<a;h++){const l=rt(i[h],e),c={type:"append",id:e.id,addOrUpdate:l,end:!1,status:H.empty()};r.add({query:null,message:c}),t._hasAggregates||(yield(0,b.e4)(1)),t._onMessage(c)}const o=rt(a>=0?i[a]:null,e),d={type:"append",id:e.id,addOrUpdate:o,end:t._didSendEnd,status:H.empty()};r.add({query:null,message:d}),t._onMessage(d)})()}_download(e){var t=this;return(0,E.Z)(function*(){try{yield t.whenInitialized();const i=t._store.storage.getBitset(t._markedIdsBufId),r=new Set;i.clear();const a=Math.ceil(e/t.pageSize),o=Array.from({length:a},(u,d)=>d).sort((u,d)=>t._random.getInt()-t._random.getInt()).map(u=>t._downloadPage(u,i,r));yield Promise.all(o),t._store.sweepFeatures(i,t._store.storage),t._store.sweepFeatureSets(r)}catch(i){Ee.Z.getLogger("esri.views.2d.layers.features.sources.SnapshotFeatureSource").error("mapview-snapshot-source","Encountered and error when downloading feature snapshot",i)}t._sendEnd(),t._loading=!1})()}_downloadPage(e,t,i){var r=this;return(0,E.Z)(function*(){const a=r.pageSize,o={start:e*a,num:a,cacheHint:!0};(0,g.pC)(r.maxRecordCountFactor)&&(o.maxRecordCountFactor=r.maxRecordCountFactor);const u=r.createQuery(o),d=r._signal,h=yield r._queue.push({query:u,depth:e,signal:d});(0,b.k_)({signal:d}),r._queries.push({query:u,reader:h}),r._store.insert(h),i.add(h.instance);const l=h.getCursor();for(;l.next();)t.set(l.getDisplayId());r._send(h)})()}_send(e){if(!this._subscriptions.size)return;let t=null;const i=new Map,r=new Set,a=new Map;this._subscriptions.forEach(o=>{const u=o.tile;i.set(u.key.id,null),t=u.tileInfoView,r.add(u.level);const{row:d,col:h}=u.key,l=`${u.level}/${d}/${h}`,c=a.get(l)??[];c.push(o),a.set(l,c)});for(const o of r){const u=t.getLODInfoAt(o),d=e.getCursor();for(;d.next();){const h=ns(d,u,o),l=d.getIndex();if(a.has(h))for(const c of a.get(h)){const f=c.tile.id;let p=i.get(f);(0,g.Wi)(p)&&(p=[],i.set(f,p)),p.push(l)}}}i.forEach((o,u)=>{if((0,g.pC)(o)){const d=this._subscriptions.get(u),h={type:"append",id:u,addOrUpdate:rt(is.t.from(e,o),d.tile),end:!1,status:H.empty()};d.add({query:null,message:h}),this._onMessage(h)}})}_sendEnd(){this._subscriptions.forEach(e=>{const t={type:"append",id:e.tile.id,addOrUpdate:null,end:!0,status:H.empty()};e.add({query:null,message:t}),this._onMessage(t)}),this._didSendEnd=!0}}var os=_(34662),us=_(93142);const yt="__esri_timestamp__";class ds{constructor(e,t,i,r,a=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=r,this.store=e,this.objectIdField=t,this.purgeInterval=a,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}removeById(e){this._removed.push(e)}removeByTrackId(e){const t=this._trackIdToObservations.get(e);if(t)for(const i of t.entries)this._removed.push(i)}add(e){if(this._useGeneratedIds){const a=this._nextId();e.attributes[this.objectIdField]=a,e.objectId=a}else e.objectId=e.attributes[this.objectIdField];const t=e.objectId;if(this._addOrUpdated.set(t,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return(0,g.Wi)(this._trackIdLessObservations)&&(this._trackIdLessObservations=new qe.Z(1e5)),void this._trackIdLessObservations.enqueue(t);const i=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(i)){const a=(0,g.pC)(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,o=(0,us.uZ)(a,0,1e3);this._trackIdToObservations.set(i,new qe.Z(o))}const r=this._trackIdToObservations.get(i)?.enqueue(t);(0,g.pC)(r)&&(this._addOrUpdated.has(r)?this._addOrUpdated.delete(r):this._removed.push(r))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),i=performance.now();i-this._lastPurge>=this.purgeInterval&&(this._purge(i),this._lastPurge=i);const r=[];if((0,g.pC)(t))for(const o of t){const u=this.store.removeById(o);(0,g.pC)(u)&&r.push(u)}const a=[];if((0,g.pC)(e)){const o=new Set((0,g.Pt)(t,[]));for(const u of e)o.has(u.objectId)||(u.attributes[yt]=i,this.store.add(u),a.push(u))}(a.length||r?.length)&&this.store.update(a,r)}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach(i=>e[t++]=i),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;(0,g.pC)(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField)for(const i of this._trackIdToObservations.values())if(t>e.displayCount&&i.size){const r=(0,g.Wg)(i.dequeue());this._removed.push(r),t--}if((0,g.pC)(this._trackIdLessObservations)){let i=t-e.displayCount;for(;i-- >0;){const r=this._trackIdLessObservations.dequeue();(0,g.pC)(r)&&this._removed.push(r)}}}}_purgeByAge(e){const t=this._timeInfo?.startTimeField;if(!e.age||!t)return;const r=this._maxAge-60*e.age*1e3;this.store.forEach(a=>{a.attributes[t]<r&&this._removed.push(a.objectId)})}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const i=e-60*t.ageReceived*1e3;this.store.forEach(r=>{r.attributes[yt]<i&&this._removed.push(r.objectId)})}_purgeTracks(){this._trackIdToObservations.forEach((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)})}}var cs=_(81665);function gs(n,e){const t=n.weakClone();if((0,g.pC)(n.geometry)){const i=(0,L.Jd)(e,n.geometry.coords[0]),r=(0,L.IN)(e,n.geometry.coords[1]);t.geometry=new Z.Z([],[i,r])}return t}class ms{constructor(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map,this._index=null}get _features(){const e=[];return this._objectIdToFeature.forEach(t=>e.push(t)),e}add(e){this._objectIdToFeature.set(e.objectId,e),this._index=null}get(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null}forEach(e){this._objectIdToFeature.forEach(e)}search(e){return this._index||(this._index=function _s(n,e){const t=(0,os.r)(9,function ps(n){return"esriGeometryPoint"===n?e=>(0,g.pC)(e.geometry)?{minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]}:{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}:e=>{let t=1/0,i=1/0,r=-1/0,a=-1/0;return(0,g.pC)(e.geometry)&&e.geometry.forEachVertex((o,u)=>{t=Math.min(t,o),i=Math.min(i,u),r=Math.max(r,o),a=Math.max(a,u)}),{minX:t,minY:i,maxX:r,maxY:a}}}(e));return t.load(n),t}(this._features,this._geometryType)),function ys(n,e){return n.search({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]})}(this._index,e)}clear(){this._index=null,this._objectIdToFeature.clear()}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._objectIdToFeature.size}}let Oe=class extends ft{constructor(n){super(n),this.type="stream",this._updateIntervalId=0,this._level=0,this._updateInfo={websocket:0,client:0},this._isPaused=!1,this._inUpdate=!1;const{outSR:e}=n,{geometryType:t,objectIdField:i,timeInfo:r,purgeOptions:a,source:o,spatialReference:u,serviceFilter:d,maxReconnectionAttempts:h,maxReconnectionInterval:l,updateInterval:c,customParameters:f,enabledEventTypes:p}=n.serviceInfo,y=new ms(this._onUpdate.bind(this),t),m=new ds(y,i,r,a),I=(0,cs.createConnection)(o,u,e,t,d,h,l,f??{});this._store=y,this._manager=m,this._connection=I,this._quantize=function fs(n){return"esriGeometryPoint"===n?gs:(e,t)=>{const i=e.weakClone(),r=new Z.Z,u=(0,L.Nh)(r,e.geometry,!1,!1,n,t,!1,!1);return i.geometry=u,i}}(t),this._enabledEventTypes=new Set(p),this._handles=[this._connection.on("data-received",T=>this._onFeature(T)),this._connection.on("message-received",T=>this._onWebSocketMessage(T))],this._initUpdateInterval=()=>{let T=performance.now();this._updateIntervalId=setInterval(()=>{const A=performance.now(),R=A-T;if(R>2500){T=A;const S=Math.round(this._updateInfo.client/(R/1e3)),C=Math.round(this._updateInfo.websocket/(R/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:S,websocket:C})}n.canAcceptRequest()&&!this._inUpdate&&this._manager.checkForUpdates()},c)},this._initUpdateInterval()}destroy(){super.destroy(),this._clearUpdateInterval(),this._handles.forEach(n=>n.remove()),this._connection.destroy()}_fetchDataTile(){}get connectionStatus(){return this._isPaused?"paused":this._connection?.connectionStatus}get errorString(){return this._connection?.errorString}updateCustomParameters(n){this._connection.updateCustomParameters(n)}pauseStream(){this._isPaused||(this._isPaused=!0,this._clearUpdateInterval())}resumeStream(){this._isPaused&&(this._isPaused=!1,this._initUpdateInterval())}sendMessageToSocket(n){this._connection.sendMessageToSocket(n)}sendMessageToClient(n){this._connection.sendMessageToClient(n)}enableEvent(n,e){e?this._enabledEventTypes.add(n):this._enabledEventTypes.delete(n)}get updating(){return!1}subscribe(n,e){super.subscribe(n,e);const t=this._subscriptions.get(n.id);this._level=n.level;const i=this._getTileFeatures(n);this._onMessage({type:"append",id:n.key.id,addOrUpdate:i,end:!0}),t.didSend=!0}unsubscribe(n){super.unsubscribe(n)}*readers(n){const e=this._subscriptions.get(n),{tile:t}=e;yield this._getTileFeatures(t)}createTileQuery(n){throw new Error("Service does not support tile  queries")}resend(){var n=this;return(0,E.Z)(function*(){n._subscriptions.forEach(e=>{const{tile:t}=e,i={type:"append",id:t.id,addOrUpdate:n._getTileFeatures(t),end:!0};n._onMessage(i)})})()}_getTileFeatures(n){const e=this._store.search(n).map(t=>this._quantize(t,n.transform));return w.i.fromOptimizedFeatures(e,this._serviceInfo,n.transform)}_onWebSocketMessage(n){if(this._enabledEventTypes.has("message-received")&&this.events.emit("message-received",n),"type"in n)switch(n.type){case"delete":if(n.objectIds)for(const e of n.objectIds)this._manager.removeById(e);if(n.trackIds)for(const e of n.trackIds)this._manager.removeByTrackId(e);break;case"clear":this._store.forEach(e=>this._manager.removeById(e.objectId))}}_onFeature(n){this._updateInfo.websocket++;try{this._enabledEventTypes.has("data-received")&&this.events.emit("data-received",n);const e=(0,L.XA)(n,this._serviceInfo.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(e)}catch{}}_clearUpdateInterval(){clearInterval(this._updateIntervalId),this._updateIntervalId=0}_onUpdate(n,e){var t=this;return(0,E.Z)(function*(){t._inUpdate=!0;try{(0,g.pC)(n)&&(t._updateInfo.client+=n.length),t._subscriptions.forEach((r,a)=>{r.didSend&&r.tile.level===t._level&&t._onMessage({type:"append",id:a,addOrUpdate:null,clear:!0,end:!1})});const i=[];t._subscriptions.forEach((r,a)=>{if(!r.didSend||r.tile.level!==t._level)return;const u={type:"append",id:a,addOrUpdate:t._getTileFeatures(r.tile),remove:[],end:!1,status:H.empty()};r.requests.stream.enqueue(u),i.push(t._onMessage(u))}),yield Promise.all(i),t._subscriptions.forEach((r,a)=>{r.didSend&&r.tile.level===t._level&&t._onMessage({type:"append",id:a,addOrUpdate:null,end:!0})})}catch{}t._inUpdate=!1})()}};(0,U._)([(0,N.Cb)()],Oe.prototype,"_isPaused",void 0),(0,U._)([(0,N.Cb)()],Oe.prototype,"connectionStatus",null),(0,U._)([(0,N.Cb)()],Oe.prototype,"errorString",null),Oe=(0,U._)([(0,_e.j)("esri.views.2d.layers.features.sources")],Oe);var Ts=_(25534);function ze(n,e,t,i){i%2&&(i+=1);let r=0,a=0,o=-90,u=90,d=-180,h=180;for(let l=0;l<i/2;l++){for(let c=0;c<5;c++){const f=(d+h)/2,p=t>f?1:0;r|=p<<29-(c+5*l),d=(1-p)*d+p*f,h=(1-p)*f+p*h}for(let c=0;c<5;c++){const f=(o+u)/2,p=e>f?1:0;a|=p<<29-(c+5*l),o=(1-p)*o+p*f,u=(1-p)*f+p*u}}n.geohashX=r,n.geohashY=a}function je(n,e,t,i,r){r%2&&(r+=1);let a=0,o=0,u=-90,d=90,h=-180,l=180;for(let c=0;c<r/2;c++){for(let f=0;f<5;f++){const p=(h+l)/2,y=i>p?1:0;a|=y<<29-(f+5*c),h=(1-y)*h+y*p,l=(1-y)*p+y*l}for(let f=0;f<5;f++){const p=(u+d)/2,y=t>p?1:0;o|=y<<29-(f+5*c),u=(1-y)*u+y*p,d=(1-y)*p+y*d}}n[2*e]=a,n[2*e+1]=o}_(6010),new Float64Array(2),new Float64Array(2);var de=_(68230),ce=_(19482);class St{constructor(e=[],t,i=8096){this.onRelease=r=>{},this._nodes=0,this._root=new nt(this,0,0,0),this._statisticFields=e,this._pool=i?new qe.Z(8096):null,this._serviceInfo=t}destroy(){this.clear()}_acquire(e,t,i){this._nodes++;let r=null;return(0,g.pC)(this._pool)&&(r=this._pool.dequeue()),(0,g.pC)(r)?r.realloc(e,t,i):r=new nt(this,e,t,i),r}_release(e){this.onRelease(e),this._nodes--,(0,g.pC)(this._pool)&&this._pool.enqueue(e)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){return(0,g.R2)(this._pool,0,e=>e.size)}get depth(){let e=0;return this.forEach(t=>e=Math.max(e,t.depth)),e}dropLevels(e){this.forEach(t=>{if(t.depth>=e)for(let i=0;i<t.children.length;i++){const r=t.children[i];r&&this._release(r)}}),this.forEach(t=>{if(t.depth>=e)for(let i=0;i<t.children.length;i++)t.children[i]=null})}clear(){this.forEach(e=>this._release(e)),this._root=new nt(this,0,0,0)}insert(e,t,i=0){const r=w.i.fromOptimizedFeatures([e],this._serviceInfo).getCursor();r.next();const a=r.readGeometry();if(!a)return;const[o,u]=a.coords;this.insertCursor(r,e.displayId,o,u,e.geohashX,e.geohashY,t,i)}insertCursor(e,t,i,r,a,o,u,d=0){let h=this._root,l=0,c=0,f=0;for(;null!==h;){if(h.depth>=d&&(h.count+=1,h.xTotal+=i,h.yTotal+=r,h.xGeohashTotal+=a,h.yGeohashTotal+=o,h.referenceId=t,this._updateStatisticsCursor(e,h,1)),l>=u)return void h.add(t);const p=Math.ceil((l+1)/2),y=Math.floor((l+1)/2),m=1-l%2,I=30-(3*p+2*y),T=30-(2*p+3*y),A=(a&7*m+3*(1-m)<<I)>>I,R=(o&3*m+7*(1-m)<<T)>>T,S=A+R*(8*m+4*(1-m));c=c<<3*m+2*(1-m)|A,f=f<<2*m+3*(1-m)|R,null==h.children[S]&&(h.children[S]=this._acquire(c,f,l+1)),l+=1,h=h.children[S]}}remove(e,t){const i=w.i.fromOptimizedFeatures([e],this._serviceInfo).getCursor();i.next();const r=i.readGeometry();if(!r)return;const[a,o]=r.coords;this.removeCursor(i,a,o,e.geohashX,e.geohashY,t)}removeCursor(e,t,i,r,a,o){let u=this._root,d=0;for(;null!==u;){if(u.count-=1,u.xTotal-=t,u.yTotal-=i,u.xGeohashTotal-=r,u.yGeohashTotal-=a,this._updateStatisticsCursor(e,u,-1),d>=o)return void u.remove(e.getDisplayId());const h=Math.ceil((d+1)/2),l=Math.floor((d+1)/2),c=1-d%2,f=30-(3*h+2*l),p=30-(2*h+3*l),y=((r&7*c+3*(1-c)<<f)>>f)+((a&3*c+7*(1-c)<<p)>>p)*(8*c+4*(1-c)),m=u.children[y];1===m?.count&&(this._release(m),u.children[y]=null),d+=1,u=m}}forEach(e){let t=this._root;for(;null!==t;){const i=this._linkChildren(t)||t.next;e(t),t=i}}find(e,t,i){return this._root.find(e,t,i,0,0,0)}findIf(e){let t=null;return this.forEach(i=>{e(i)&&(t=i)}),t}findAllIf(e){const t=[];return this.forEach(i=>{e(i)&&t.push(i)}),t}findSingleOccupancyNode(e,t,i,r,a){let o=this._root;for(;null!==o;){const u=o.depth,d=o.xNode,h=o.yNode,l=1-u%2,c=o.xGeohashTotal/o.count,f=o.yGeohashTotal/o.count;if(1===o.count&&e<c&&c<=i&&t<f&&f<=r)return o;if(u>=a){o=o.next;continue}const p=Math.ceil((u+1)/2),y=Math.floor((u+1)/2),m=30-(3*p+2*y),I=30-(2*p+3*y),T=~((1<<m)-1),A=~((1<<I)-1),S=(t&A)>>I,C=(i&T)>>m,M=(r&A)>>I,v=d<<3*l+2*(1-l),G=h<<2*l+3*(1-l),B=v+8*l+4*(1-l),O=G+4*l+8*(1-l),x=Math.max(v,(e&T)>>m),P=Math.max(G,S),k=Math.min(B,C),Y=Math.min(O,M);let j=null,ne=null;for(let V=P;V<=Y;V++)for(let se=x;se<=k;se++){const Q=o.children[se-v+(V-G)*(8*l+4*(1-l))];Q&&(j||(j=Q,j.next=o.next),ne&&(ne.next=Q),ne=Q,Q.next=o.next)}o=j||o.next}return null}getRegionDisplayIds(e){let t=this._root;const{bounds:i,geohashBounds:r,level:a}=e,[o,u,d,h]=i,l=[];for(;null!==t;){const c=t.depth,f=t.xNode,p=t.yNode;if(c>=a){const J=t.xTotal/t.count,Q=t.yTotal/t.count;J>=o&&J<=d&&Q>=u&&Q<=h&&t.displayIds.forEach(ge=>l.push(ge)),t=t.next;continue}const y=Math.ceil((c+1)/2),m=Math.floor((c+1)/2),I=1-c%2,T=30-(3*y+2*m),A=30-(2*y+3*m),R=~((1<<T)-1),S=~((1<<A)-1),M=(r.yLL&S)>>A,v=(r.xTR&R)>>T,G=(r.yTR&S)>>A,B=f<<3*I+2*(1-I),O=p<<2*I+3*(1-I),x=B+8*I+4*(1-I),P=O+4*I+8*(1-I),k=Math.max(B,(r.xLL&R)>>T),Y=Math.max(O,M),j=Math.min(x,v),ne=Math.min(P,G);let V=null,se=null;for(let J=Y;J<=ne;J++)for(let Q=k;Q<=j;Q++){const ae=t.children[Q-B+(J-O)*(8*I+4*(1-I))];ae&&(V||(V=ae,V.next=t.next),se&&(se.next=ae),se=ae,ae.next=t.next)}t=V||t.next}return l}getRegionStatistics(e){let t=this._root,i=0,r=0,a=0;const o={},{bounds:u,geohashBounds:d,level:h}=e,[l,c,f,p]=u;let y=0;for(;null!==t;){const m=t.depth,I=t.xNode,T=t.yNode;if(m>=h){const fe=t.xTotal/t.count,pe=t.yTotal/t.count;fe>l&&fe<=f&&pe>c&&pe<=p&&(i+=t.count,r+=t.xTotal,a+=t.yTotal,1===t.count&&(y=t.referenceId),this._aggregateStatistics(o,t.statistics)),t=t.next;continue}const A=Math.ceil((m+1)/2),R=Math.floor((m+1)/2),S=1-m%2,C=30-(3*A+2*R),M=30-(2*A+3*R),v=~((1<<C)-1),G=~((1<<M)-1),O=(d.yLL&G)>>M,x=(d.xTR&v)>>C,P=(d.yTR&G)>>M,k=I<<3*S+2*(1-S),Y=T<<2*S+3*(1-S),j=k+8*S+4*(1-S),ne=Y+4*S+8*(1-S),V=Math.max(k,(d.xLL&v)>>C),se=Math.max(Y,O),J=Math.min(j,x),Q=Math.min(ne,P);let ge=null,ae=null;for(let fe=se;fe<=Q;fe++)for(let pe=V;pe<=J;pe++){const q=t.children[pe-k+(fe-Y)*(8*S+4*(1-S))];if(q){if(fe!==se&&fe!==Q&&pe!==V&&pe!==J){const bt=q.xTotal/q.count,xt=q.yTotal/q.count;bt>l&&bt<=f&&xt>c&&xt<=p&&(i+=q.count,r+=q.xTotal,a+=q.yTotal,1===q.count&&(y=q.referenceId),this._aggregateStatistics(o,q.statistics));continue}ge||(ge=q,ge.next=t.next),ae&&(ae.next=q),ae=q,q.next=t.next}}t=ge||t.next}return{count:i,attributes:this.normalizeStatistics(o,i),xTotal:r,yTotal:a,referenceId:y}}getBins(e){const t=[],{geohashBounds:i,level:r}=e;let a=this._root;for(;null!==a;){const o=a.depth,u=a.xNode,d=a.yNode;if(o>=r){t.push(a),a=a.next;continue}const h=Math.ceil((o+1)/2),l=Math.floor((o+1)/2),c=1-o%2,f=30-(3*h+2*l),p=30-(2*h+3*l),y=~((1<<f)-1),m=~((1<<p)-1),T=(i.yLL&m)>>p,A=(i.xTR&y)>>f,R=(i.yTR&m)>>p,S=u<<3*c+2*(1-c),C=d<<2*c+3*(1-c),M=S+8*c+4*(1-c),v=C+4*c+8*(1-c),G=Math.max(S,(i.xLL&y)>>f),B=Math.max(C,T),O=Math.min(M,A),x=Math.min(v,R);let P=null,k=null;for(let Y=B;Y<=x;Y++)for(let j=G;j<=O;j++){const V=a.children[j-S+(Y-C)*(8*c+4*(1-c))];V&&(P||(P=V,P.next=a.next),k&&(k.next=V),k=V,V.next=a.next)}a=P||a.next}return t}_linkChildren(e){let t=null,i=null;for(let r=0;r<=e.children.length;r++){const a=e.children[r];a&&(t||(t=a,t.next=e.next),i&&(i.next=a),i=a,a.next=e.next)}return t}_updateStatisticsCursor(e,t,i){for(const r of this._statisticFields){const a=r.name,o=r.inField?e.readAttribute(r.inField):e.getComputedNumericAtIndex(r.inFieldIndex);switch(r.statisticType){case"min":if(isNaN(o))break;if(!t.statistics[a]){t.statistics[a]={value:o};break}t.statistics[a].value=Math.min(t.statistics[a].value,o);break;case"max":if(isNaN(o))break;if(!t.statistics[a]){t.statistics[a]={value:o};break}t.statistics[a].value=Math.max(t.statistics[a].value,o);break;case"count":break;case"sum":case"avg":{t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});const u=t.statistics[a].value,d=t.statistics[a].nanCount??0;null==o||isNaN(o)?t.statistics[a].nanCount=d+i:t.statistics[a].value=u+i*o;break}case"avg_angle":{t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});const u=t.statistics[a].x,d=t.statistics[a].y,h=t.statistics[a].nanCount??0,l=Math.PI/180;null==o||isNaN(o)?t.statistics[a].nanCount=h+i:(t.statistics[a].x=u+i*Math.cos(o*l),t.statistics[a].y=d+i*Math.sin(o*l));break}case"mode":t.statistics[a]||(t.statistics[a]={}),t.statistics[a][o]=(t.statistics[a][o]||0)+i}}}_aggregateStatistics(e,t){for(const i of this._statisticFields){const r=i.name;switch(i.statisticType){case"min":if(!e[r]){e[r]={value:t[r].value};break}e[r].value=Math.min(e[r].value,t[r].value);break;case"max":if(!e[r]){e[r]={value:t[r].value};break}e[r].value=Math.max(e[r].value,t[r].value);break;case"count":break;case"sum":case"avg":case"avg_angle":case"mode":e[r]||(e[r]={});for(const a in t[r])e[r][a]=(e[r][a]||0)+t[r][a]}}}normalizeStatistics(e,t){const i={};for(const r of this._statisticFields){const a=r.name;switch(r.statisticType){case"min":case"max":{const o=e[a];if(!t||!o)break;i[a]=o.value;break}case"count":if(!t)break;i[a]=t;break;case"sum":{if(!t)break;const{value:o,nanCount:u}=e[a];if(!(t-u))break;i[a]=o;break}case"avg":{if(!t)break;const{value:o,nanCount:u}=e[a];if(!(t-u))break;i[a]=o/(t-u);break}case"avg_angle":{if(!t)break;const{x:o,y:u,nanCount:d}=e[a];if(!(t-d))break;const c=180/Math.PI,f=Math.atan2(u/(t-d),o/(t-d))*c;i[a]=f;break}case"mode":{const o=e[a];let u=0,d=0,h=null;for(const l in o){const c=o[l];c===u?d+=1:c>u&&(u=c,d=1,h=l)}i[a]="null"===h||d>1?null:h;break}}}return i}}class nt{constructor(e,t,i,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.referenceId=0,this.displayIds=new Set,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this._tree=e,this.children=new Array(32);for(let a=0;a<this.children.length;a++)this.children[a]=null;this.xNode=t,this.yNode=i,this.depth=r}realloc(e,t,i){for(let r=0;r<this.children.length;r++)this.children[r]=null;return this.xNode=e,this.yNode=t,this.depth=i,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.displayId=0,this.referenceId=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this.displayIds.clear(),this}get id(){return`${this.xNode}.${this.yNode}`}add(e){this.displayIds.add(e)}remove(e){this.displayIds.delete(e)}getAttributes(){const e=this._tree.normalizeStatistics(this.statistics,this.count);return e.referenceId=null,e.aggregateId=this.id,e.aggregateCount=this.count,e}getGeometry(e,t){const i=this.getLngLatBounds(),[r,a,o,u]=i,d=(0,ce.iV)({rings:[[[r,a],[r,u],[o,u],[o,a],[r,a]]]},de.Z.WGS84,e),h=(0,L.Uy)(new Z.Z,d,!1,!1);return(0,g.pC)(t)?(0,L.Nh)(new Z.Z,h,!1,!1,"esriGeometryPolygon",t,!1,!1):h}getGeometryCentroid(e,t){const i=this.getLngLatBounds(),[r,a,o,u]=i,d=(0,ce.iV)({x:(r+o)/2,y:(a+u)/2},de.Z.WGS84,e),h=(0,L.dd)(new Z.Z,d);return(0,g.pC)(t)?(0,L.Nh)(new Z.Z,h,!1,!1,"esriGeometryPoint",t,!1,!1):h}getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),i=Math.floor(e/2);return function Ns(n,e){let t=-90,i=90,r=-180,a=180;for(let o=0;o<e;o++){const u=Math.ceil((o+1)/2),d=Math.floor((o+1)/2),h=1-o%2,l=30-(3*u+2*d),c=30-(2*u+3*d),p=2*h+3*(1-h),m=(7*h+3*(1-h)<<l&n.geohashX)>>l,I=(3*h+7*(1-h)<<c&n.geohashY)>>c;for(let T=3*h+2*(1-h)-1;T>=0;T--){const A=(r+a)/2,R=m&1<<T?1:0;r=(1-R)*r+R*A,a=(1-R)*A+R*a}for(let T=p-1;T>=0;T--){const A=(t+i)/2,R=I&1<<T?1:0;t=(1-R)*t+R*A,i=(1-R)*A+R*i}}return[r,t,a,i]}({geohashX:this.xNode<<30-(3*t+2*i),geohashY:this.yNode<<30-(2*t+3*i)},this.depth)}find(e,t,i,r,a,o){if(r>=i)return this;const u=1-r%2,d=3*u+2*(1-u),h=2*u+3*(1-u),l=30-a-d,c=30-o-h,p=this.children[((e&7*u+3*(1-u)<<l)>>l)+((t&3*u+7*(1-u)<<c)>>c)*(8*u+4*(1-u))];return null==p?null:p.find(e,t,i,r+1,a+d,o+h)}}var Rt=_(73327),le=_(86355),at=_(21288),At=_(56162),Ct=_(55733),vt=_(10465);const ot=Ee.Z.getLogger("esri.view.2d.layers.features.support.BinStore"),Us=(0,Rt.Ue)();function Ot(n){return 57.29577951308232*n}class Ds extends At.J{constructor(e,t,i,r){super(e,i),this.type="bin",this.events=new et.Z,this.objectIdField="aggregateId",this.featureAdapter=me.k,this._geohashLevel=5,this._geohashBuf=[],this._serviceInfo=r,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=(0,ce._W)(t,de.Z.WGS84),this._bitsets.geohash=i.getBitset(i.createBitset()),this._bitsets.inserted=i.getBitset(i.createBitset())}destroy(){this._tree&&this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}updateSchema(e,t){var i=()=>super.updateSchema,r=this;return(0,E.Z)(function*(){const a=r._schema;try{yield i().call(r,e,t),yield r._projectionSupportCheck}catch{}r._fields=r._schema.params.fields;const o=(0,re.Hg)(a,t);t&&(!(0,g.Wi)(o)||e.source||e.storage.filters)?(((0,re.uD)(o,"params.fields")||(0,re.uD)(o,"params")||!r._tree||e.source)&&(r._tree&&r._tree.destroy(),r._tree=new St(r._statisticFields,r._serviceInfo),r._tree.onRelease=u=>u.displayId&&r._storage.releaseDisplayId(u.displayId),r._geohashLevel=r._schema.params.fixedBinLevel,r._rebuildTree(),(0,F.Z)("esri-2d-update-debug")&&ot.info("Aggregate mesh needs update due to tree changing")),(0,F.Z)("esri-2d-update-debug")&&ot.info("Aggregate mesh needs update due to tree changing"),e.targets[t.name]=!0,e.mesh=!1):a&&(e.mesh=!0)})()}clear(){this._rebuildTree()}sweepFeatures(e,t){this._bitsets.inserted.forEachSet(i=>{if(!e.has(i)){const r=t.lookupByDisplayIdUnsafe(i);this._remove(r)}})}sweepAggregates(e,t,i){}onTileData(e,t,i,r,a=!0){if(!this._schema||(0,g.Wi)(t.addOrUpdate))return t;this.events.emit("changed");const o=this._getTransforms(e,this._spatialReference);{const d=t.addOrUpdate.getCursor();for(;d.next();)this._update(d,r)}if(t.status.mesh||!a)return t;const u=new Array;this._getBinsForTile(u,e,o,i),t.addOrUpdate=w.i.fromOptimizedFeatures(u,{...this._serviceInfo,geometryType:"esriGeometryPolygon"}),t.addOrUpdate.attachStorage(i),t.end=!0,t.isRepush||(t.clear=!0);{const d=t.addOrUpdate.getCursor();for(;d.next();){const h=d.getDisplayId();this._bitsets.computed.unset(h),this.setComputedAttributes(i,d,h,e.scale)}}return t}forEachBin(e){this._tree.forEach(e)}forEach(e){this._tree.forEach(t=>{if(t.depth!==this._geohashLevel)return;const i=this._toFeatureJSON(t),r=w.i.fromFeatures([i],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,fields:this.fields}).getCursor();r.next(),e(r)})}forEachInBounds(e,t){}forEachBounds(e,t){const{hasM:i,hasZ:r}=this.geometryInfo;for(const a of e){const o=(0,L.$)(Us,a.readGeometry(),r,i);(0,g.Wi)(o)||t(o)}}onTileUpdate(e){}getAggregate(e){const t=(0,at.QS)(e,!0),i=this._tree.findIf(r=>r.displayId===t);return(0,g.yw)(i,r=>this._toFeatureJSON(r))}getAggregates(){return this._tree.findAllIf(e=>e.depth===this._geohashLevel).map(this._toFeatureJSON.bind(this))}getDisplayId(e){const t=this._tree.findIf(i=>i.id===e);return(0,g.yw)(t,i=>i.displayId)}getFeatureDisplayIdsForAggregate(e){const t=this._tree.findIf(i=>i.id===e);return(0,g.R2)(t,[],i=>Array.from(i.displayIds))}getDisplayIdForReferenceId(e){const t=this._tree.findIf(i=>1===i.displayIds.size&&i.displayIds.has(e));return(0,g.yw)(t,i=>i.displayId)}_toFeatureJSON(e){const t=this._spatialReference;return{displayId:e.displayId,attributes:e.getAttributes(),geometry:(0,L.di)(e.getGeometry(t),"esriGeometryPolygon",!1,!1),centroid:null}}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),i=e.getXHydrated(),r=e.getYHydrated(),a=this._geohashBuf[2*t],o=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,i,r,a,o,this._geohashLevel))}_update(e,t){const i=e.getDisplayId(),r=this._bitsets.inserted,a=t.isVisible(i);if(a===r.has(i))return;if(!a)return void this._remove(e);const o=e.getXHydrated(),u=e.getYHydrated();this._setGeohash(i,o,u)&&(this._tree.insertCursor(e,i,o,u,this._geohashBuf[2*i],this._geohashBuf[2*i+1],this._geohashLevel),r.set(i))}_setGeohash(e,t,i){if(this._bitsets.geohash.has(e))return!0;const r=this._geohashBuf;if(this._spatialReference.isWebMercator){const a=Ot(t/le.sv.radius),o=a-360*Math.floor((a+180)/360);je(r,e,Ot(Math.PI/2-2*Math.atan(Math.exp(-i/le.sv.radius))),o,12)}else{const a=(0,ce.iV)({x:t,y:i},this._spatialReference,de.Z.WGS84);if(!a)return!1;je(r,e,a.y,a.x,12)}return this._bitsets.geohash.set(e),!0}_getBinsForTile(e,t,i,r){try{const a=this._getGeohashBounds(t),o=this._tree.getBins(a);for(const u of o){u.displayId||(u.displayId=r.createDisplayId(!0));let d=null;const h=u.getGeometry(this._spatialReference,i.tile);h||(d=u.getGeometryCentroid(this._spatialReference,i.tile));const l=new Te.u_(h,u.getAttributes(),d);l.objectId=u.id,l.displayId=u.displayId,e.push(l)}}catch{return void ot.error("Unable to get bins for tile",t.key.id)}}_getGeohash(e,t,i){const r={geohashX:0,geohashY:0};return ze(r,t,e,i),r}_getGeohashBounds(e){const t=this._getGeohashLevel(e.key.level),i=[e.extent.xmin,e.extent.ymin,e.extent.xmax,e.extent.ymax],r=Ct.Z.fromExtent(vt.Z.fromBounds(i,this._spatialReference)),a=(0,ce.iV)(r,this._spatialReference,de.Z.WGS84,{densificationStep:64*e.resolution}),o=(0,L.Uy)(new Z.Z,a,!1,!1),u=o.coords.filter((m,I)=>!(I%2)),d=o.coords.filter((m,I)=>I%2),h=Math.min(...u),l=Math.min(...d),c=Math.max(...u),f=Math.max(...d),p=this._getGeohash(h,l,t),y=this._getGeohash(c,f,t);return{bounds:i,geohashBounds:{xLL:p.geohashX,yLL:p.geohashY,xTR:y.geohashX,yTR:y.geohashY},level:t}}_getGeohashLevel(e){return this._schema.params.fixedBinLevel}_getTransforms(e,t){const i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},r=(0,ye.C5)(t);if(!r)return{tile:i,left:null,right:null};const[a,o]=r.valid;return{tile:i,left:{...i,translate:[o,e.bounds[3]]},right:{...i,translate:[a-o+e.bounds[0],e.bounds[3]]}}}}var z=_(80696);const Gs=(0,Rt.Ue)();class ht extends Te.nd{constructor(e,t,i,r,a){super(new Z.Z([],[t,i]),r,null,e),this.geohashBoundsInfo=a}get count(){return this.attributes.cluster_count}static create(e,t,i,r,a,o,u,d){const h=new ht(t,i,r,o,u);return h.displayId=e.createDisplayId(!0),h.referenceId=d,h.tileLevel=a,h}update(e,t,i,r,a,o){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=i,this.attributes=r,this.geohashBoundsInfo=a,this.referenceId=null,this.referenceId=o,this}toJSON(){return{attributes:{...this.attributes,aggregateId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}}function be(n){return 57.29577951308232*n}class Bs extends At.J{constructor(e,t,i,r){super(e,i),this.type="cluster",this.events=new et.Z,this.objectIdField="aggregateId",this.featureAdapter=me.k,this._geohashLevel=0,this._tileLevel=0,this._aggregateValueRanges={},this._aggregateValueRangesChanged=!1,this._geohashBuf=[],this._clusters=new Map,this._tiles=new Map,this._serviceInfo=r,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=(0,ce._W)(t,de.Z.WGS84),this._bitsets.geohash=i.getBitset(i.createBitset()),this._bitsets.inserted=i.getBitset(i.createBitset())}destroy(){this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}updateSchema(e,t){var i=()=>super.updateSchema,r=this;return(0,E.Z)(function*(){const a=r._schema;try{yield i().call(r,e,t),yield r._projectionSupportCheck}catch{}r._fields=r._schema.params.fields;const o=(0,re.Hg)(a,t);t&&(!(0,g.Wi)(o)||e.source||e.storage.filters)?(((0,re.uD)(o,"params.fields")||!r._tree||e.source)&&(r._tree&&r._tree.destroy(),r._tree=new St(r._statisticFields,r._serviceInfo),r._rebuildTree(),(0,F.Z)("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),(0,F.Z)("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",o),e.targets[t.name]=!0,e.mesh=!1,r._aggregateValueRanges={}):a&&(e.mesh=!0)})()}clear(){this._rebuildTree()}sweepFeatures(e,t){this._bitsets.inserted.forEachSet(i=>{if(!e.has(i)){const r=t.lookupByDisplayIdUnsafe(i);this._remove(r)}})}sweepAggregates(e,t,i){this._clusters.forEach((r,a)=>{r&&r.tileLevel!==i&&(e.releaseDisplayId(r.displayId),t.unsetAttributeData(r.displayId),this._clusters.delete(a))})}onTileData(e,t,i,r,a=!0){if(!this._schema||(0,g.Wi)(t.addOrUpdate))return t;this.events.emit("changed");const o=this._getTransforms(e,this._spatialReference);{const h=t.addOrUpdate.getCursor();for(;h.next();)this._update(h,r)}if(t.status.mesh||!a)return t;const u=new Array;this._getClustersForTile(u,e,this._schema.params.clusterRadius,i,o),t.addOrUpdate=w.i.fromOptimizedFeatures(u,this._serviceInfo),t.addOrUpdate.attachStorage(i),t.clear=!0,t.end=!0;{const h=t.addOrUpdate.getCursor();for(;h.next();){const l=h.getDisplayId();this._bitsets.computed.unset(l),this.setComputedAttributes(i,h,l,e.scale)}}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t}onTileUpdate({added:e,removed:t}){if(e.length){const r=e[0].level;this._tileLevel=r,this._setGeohashLevel(r)}if(!this._schema)return;const i=this._schema.params.clusterRadius;t.forEach(r=>{this._tiles.delete(r.key.id),this._markTileClustersForDeletion(r,i)})}getAggregate(e){for(const t of this._clusters.values())if((t?.displayId&at._I)==(e&at._I))return t.toJSON();return null}getAggregates(){const e=[];for(const t of this._clusters.values())t?.tileLevel===this._tileLevel&&e.push(t.toJSON());return e}getDisplayId(e){const t=this._clusters.get(e);return t?t.displayId:null}getFeatureDisplayIdsForAggregate(e){const t=this._clusters.get(e);return t?this._tree.getRegionDisplayIds(t.geohashBoundsInfo):[]}getDisplayIdForReferenceId(e){for(const t of this._clusters.values())if(t?.referenceId===e)return t.displayId;return null}getAggregateValueRanges(){return this._aggregateValueRanges}forEach(e){this._clusters.forEach(t=>{if(!t)return;const i=t.toJSON(),r=w.i.fromFeatures([i],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,fields:this.fields}).getCursor();r.next(),e(r)})}forEachInBounds(e,t){}forEachBounds(e,t){const{hasM:i,hasZ:r}=this.geometryInfo;for(const a of e){const o=(0,L.$)(Gs,a.readGeometry(),r,i);(0,g.Wi)(o)||t(o)}}size(){let e=0;return this.forEach(t=>e++),e}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),i=e.getXHydrated(),r=e.getYHydrated(),a=this._geohashBuf[2*t],o=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,i,r,a,o,this._geohashLevel))}_update(e,t){const i=e.getDisplayId(),r=this._bitsets.inserted,a=t.isVisible(i);if(a===r.has(i))return;if(!a)return void this._remove(e);const o=e.getXHydrated(),u=e.getYHydrated();this._setGeohash(i,o,u)&&(this._tree.insertCursor(e,i,o,u,this._geohashBuf[2*i],this._geohashBuf[2*i+1],this._geohashLevel),r.set(i))}_setGeohash(e,t,i){if(this._bitsets.geohash.has(e))return!0;const r=this._geohashBuf;if(this._spatialReference.isWebMercator){const a=be(t/le.sv.radius),o=a-360*Math.floor((a+180)/360);je(r,e,be(Math.PI/2-2*Math.atan(Math.exp(-i/le.sv.radius))),o,12)}else{const a=(0,ce.iV)({x:t,y:i},this._spatialReference,de.Z.WGS84);if(!a)return!1;je(r,e,a.y,a.x,12)}return this._bitsets.geohash.set(e),!0}_getClustersForTile(e,t,i,r,a,o=!0){const u=this._schema.params.clusterPixelBuffer,d=2*i,h=Math.ceil(2**t.key.level*z.I_/d)+1,l=Math.ceil(u/d)+0,c=Math.ceil(z.I_/d),{row:f,col:p}=t.key,m=f*z.I_,I=Math.floor(p*z.I_/d)-l,T=Math.floor(m/d)-l,A=I+c+2*l,R=T+c+2*l,S=t.tileInfoView.getLODInfoAt(t.key.level);for(let C=I;C<=A;C++)for(let M=T;M<=R;M++){let v=C;S.wrap&&(v=C<0?C+h:C%h);const G=S.wrap&&C<0,B=S.wrap&&C%h!==C,O=this._lookupCluster(r,S,t.key.level,v,M,t);if((0,g.pC)(O)){const x=(0,g.yw)(a,P=>G?P.left:B?P.right:P.tile);if(o&&(0,g.Wi)(x)||!O.count)continue;if((0,g.pC)(x)&&o){const P=O.geometry.clone();let k=O.attributes;P.coords[0]=(0,L.Jd)(x,P.coords[0]),P.coords[1]=(0,L.IN)(x,P.coords[1]),1===O.count&&(0,g.pC)(O.referenceId)&&(k={...O.attributes,referenceId:O.referenceId});const Y=new Te.u_(P,k);Y.displayId=O.displayId,e.push(Y)}}}}_getGeohashLevel(e){return Math.min(Math.ceil(e/2+2),12)}_setGeohashLevel(e){const t=this._getGeohashLevel(e),i=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==i)return this._geohashLevel=i,this._rebuildTree(),void this._bitsets.geohash.clear()}_getTransforms(e,t){const i={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},r=(0,ye.C5)(t);if(!r)return{tile:i,left:null,right:null};const[a,o]=r.valid;return{tile:i,left:{...i,translate:[o,e.bounds[3]]},right:{...i,translate:[a-o+e.bounds[0],e.bounds[3]]}}}_getClusterId(e,t,i){return(15&e)<<28|(16383&t)<<14|16383&i}_markForDeletion(e,t,i){const r=this._getClusterId(e,t,i);this._clusters.delete(r)}_getClusterBounds(e,t,i){const r=this._schema.params.clusterRadius,a=2*r;let o=i%2?t*a:t*a-r;const u=i*a;let d=o+a;const l=2**e.level*z.I_;e.wrap&&o<0&&(o=0),e.wrap&&d>l&&(d=l);const f=u/z.I_,p=d/z.I_,y=(u-a)/z.I_;return[e.getXForColumn(o/z.I_),e.getYForRow(f),e.getXForColumn(p),e.getYForRow(y)]}_getGeohash(e,t,i){const r={geohashX:0,geohashY:0};return ze(r,t,e,i),r}_getGeohashBounds(e,t){const i=this._getGeohashLevel(e.key.level);if(this._spatialReference.isWebMercator){const[m,I,T,A]=t,R={x:m,y:I},S={x:T,y:A};let C=0,M=0,v=0,G=0;{const x=be(R.x/le.sv.radius);C=x-360*Math.floor((x+180)/360),M=be(Math.PI/2-2*Math.atan(Math.exp(-R.y/le.sv.radius)))}{const x=be(S.x/le.sv.radius);v=x-360*Math.floor((x+180)/360),G=be(Math.PI/2-2*Math.atan(Math.exp(-S.y/le.sv.radius)))}const B={geohashX:0,geohashY:0},O={geohashX:0,geohashY:0};return ze(B,M,C,i),ze(O,G,v,i),{bounds:[m,I,T,A],geohashBounds:{xLL:B.geohashX,yLL:B.geohashY,xTR:O.geohashX,yTR:O.geohashY},level:i}}const r=Ct.Z.fromExtent(vt.Z.fromBounds(t,this._spatialReference)),a=(0,ce.iV)(r,this._spatialReference,de.Z.WGS84,{densificationStep:64*e.resolution});if(!a)return null;const o=(0,L.Uy)(new Z.Z,a,!1,!1),u=o.coords.filter((m,I)=>!(I%2)),d=o.coords.filter((m,I)=>I%2),h=Math.min(...u),l=Math.min(...d),c=Math.max(...u),f=Math.max(...d),p=this._getGeohash(h,l,i),y=this._getGeohash(c,f,i);return{bounds:t,geohashBounds:{xLL:p.geohashX,yLL:p.geohashY,xTR:y.geohashX,yTR:y.geohashY},level:i}}_lookupCluster(e,t,i,r,a,o){const u=this._getClusterId(i,r,a),d=this._clusters.get(u),h=this._getClusterBounds(t,r,a),l=this._getGeohashBounds(o,h);if((0,g.Wi)(l))return null;const c=this._tree.getRegionStatistics(l),{count:f,xTotal:p,yTotal:y,referenceId:m}=c,I=f?p/f:0,T=f?y/f:0;if(0===f)return this._clusters.set(u,null),null;const A={cluster_count:f,...c.attributes},R=(0,g.pC)(d)?d.update(I,T,i,A,l,m):ht.create(e,u,I,T,i,A,l,m);if(0===f){const[S,C,M,v]=h;R.geometry.coords[0]=(S+M)/2,R.geometry.coords[1]=(C+v)/2}return this._clusters.set(u,R),this._updateAggregateValueRangeForCluster(R,R.tileLevel),R}_updateAggregateValueRangeForCluster(e,t){const i=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},r=i.minValue,a=i.maxValue;i.minValue=Math.min(r,e.count),i.maxValue=Math.max(a,e.count),this._aggregateValueRanges[t]=i,r===i.minValue&&a===i.maxValue||(this._aggregateValueRangesChanged=!0)}_markTileClustersForDeletion(e,t){const i=2*t,r=Math.ceil(z.I_/i),{row:a,col:o}=e.key,d=a*z.I_,h=Math.floor(o*z.I_/i),l=Math.floor(d/i);for(let c=h;c<h+r;c++)for(let f=l;f<l+r;f++)this._markForDeletion(e.key.level,c,f)}}var ws=_(26440);function ie(n){if(!(0,b.D_)(n)&&!function Qs(n){return"worker:port-closed"===n.name}(n))throw n}function Mt(n){return"feature"===n.type&&"snapshot"===n.mode}let $=class extends Re.Z{constructor(){super(...arguments),this._storage=new ws.O,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this._didEdit=!1,this._updateVersion=1,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}initialize(){this._initStores(),this._initSource(),this._updateQueue=new tt.e({concurrency:"stream"===this._source.type?1:4,process:(n,e)=>this._onTileMessage(n,{signal:e})}),this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this)),(0,D.gx)(()=>!this.updating,()=>this.onIdle())]),this._checkUpdating=setInterval(()=>this.notifyChange("updating"),300)}_initSource(){this._source=function Es(n,e,t,i,r,a){const o=function Is(n,e,t,i,r,a){switch(n.type){case"snapshot":return{type:"feature",origin:"snapshot",featureCount:(0,g.Pt)(n.featureCount,0),serviceInfo:n,onMessage:i,outSR:e,tileInfoView:t,canAcceptRequest:r,store:a};case"stream":return{type:"stream",serviceInfo:n,onMessage:i,outSR:e,canAcceptRequest:r};case"memory":case"on-demand":return{type:"feature",serviceInfo:n,onMessage:i,outSR:e,origin:function o(u){return Array.isArray(u)?"local":"path"in u&&(0,De.M8)(u.path)?"hosted":"unknown"}(n.source),tileInfoView:t,canAcceptRequest:r}}}(n,e,t,i,r,a);switch(o.type){case"feature":switch(o.origin){case"hosted":case"local":return new ss(o);case"snapshot":return new as(o);default:return new ts(o)}case"stream":return new Oe(o)}}(this.service,this.spatialReference,this.tileStore.tileScheme,(i,r)=>(this._invalidated=!0,this._patchTile(i,r)),()=>this._updateQueue&&this._updateQueue.length<50,this.featureStore),this._proxyEvents()}_proxyEvents(){if("stream"===this._source.type){const n=this._source.events,e=this._source;this.addHandles([(0,D.YP)(()=>e.connectionStatus,t=>this.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:t}).catch(ie),{initial:!0}),(0,D.YP)(()=>e.errorString,t=>this.remoteClient.invoke("setProperty",{propertyName:"errorString",value:t}).catch(ie),{initial:!0}),n.on("data-received",t=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:t.attributes,centroid:t.centroid,geometry:t.geometry}}).catch(ie)),n.on("message-received",t=>this.remoteClient.invoke("emitEvent",{name:"message-received",event:t}).catch(ie)),n.on("updateRate",t=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...t}}).catch(ie))])}}_initAttributeStore(n){this.attributeStore||(this.attributeStore=new Ts.Z({type:"remote",initialize:(e,t)=>(0,b.R8)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t}).catch(ie)),update:(e,t)=>(0,b.R8)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t}).catch(ie)),render:e=>(0,b.R8)(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}).catch(ie))},n,()=>this.notifyChange("updating")))}_initStores(){this.featureStore=new me.p({geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},this._storage,"snapshot"===this.service.type?"snapshot":"on-demand")}_initQueryEngine(n){const e=this;this.featureQueryEngine?.destroy(),this.featureQueryEngine=new Ae.q({definitionExpression:n.schema.source.definitionExpression??void 0,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds:t=>(0,g.Wi)(e.aggregateStore)?[]:e.aggregateStore.getFeatureDisplayIdsForAggregate(t).map(i=>e.getObjectId(i))},timeInfo:this.service.timeInfo})}_initAggregateQueryEngine(n,e){if(this.aggregateQueryEngine?.destroy(),(0,g.Wi)(n))return;const t=e.targets.aggregate.params.fields.slice();this.aggregateQueryEngine=new Ae.q({definitionExpression:void 0,fields:t,geometryType:n.geometryInfo.geometryType,objectIdField:n.objectIdField,hasM:n.geometryInfo.hasM,hasZ:n.geometryInfo.hasZ,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!1,featureStore:n,aggregateAdapter:{getFeatureObjectIds:i=>[]}})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.featureQueryEngine?.destroy(),this.aggregateQueryEngine?.destroy(),this.attributeStore?.destroy();for(const n of this.tileStore.tiles)this._source.unsubscribe(n);clearInterval(this._checkUpdating)}get fieldsIndex(){return new Le.Z(this.service.fields)}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){const n=this._source.updating,e=!!this._updateQueue.length,t=!this.attributeStore||this.attributeStore.isUpdating(),i=n||e||t;return(0,F.Z)("esri-2d-log-updating")&&console.log(`Updating FeatureController2D: ${i}\n  -> updatingSource ${n}\n  -> updateQueue ${e}\n  -> updatingAttributeStore ${t}\n`),i}updateCustomParameters(n){"stream"===this._source.type&&this._source.updateCustomParameters(n)}enableEvent(n){this._source.enableEvent(n.name,n.value)}pause(){this._updateQueue.pause(),this._updateQueue.clear()}resume(){this._updateQueue.resume()}pauseStream(){"stream"===this._source.type&&this._source.pauseStream()}resumeStream(){"stream"===this._source.type&&this._source.resumeStream()}sendMessageToSocket(n){"stream"===this._source.type&&this._source.sendMessageToSocket(n)}sendMessageToClient(n){"stream"===this._source.type&&this._source.sendMessageToClient(n)}_initAggregateStore(n){const e=n.schema.targets?.aggregate?.type;if((0,g.yw)(this.config,i=>i.schema.targets?.aggregate?.type)!==e&&((0,g.pC)(this.aggregateStore)&&(this.removeHandles("valueRangesChanged"),this.aggregateStore.destroy(),this.aggregateStore=null),e)){switch(e){case"cluster":this.aggregateStore=new Bs({geometryInfo:{geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},this.spatialReference,this._storage,this.service),this.addHandles(this.aggregateStore.events.on("valueRangesChanged",r=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:r.valueRanges}}).catch(ie)}),"valueRangesChanged");break;case"bin":this.aggregateStore=new Ds({geometryInfo:{geometryType:"esriGeometryPolygon",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields},this.spatialReference,this._storage,this.service)}this.aggregateStore.onTileUpdate({added:this.tileStore.tiles,removed:[]})}}update(n,e){var t=this;return(0,E.Z)(function*(){t._updateVersion++,t._initQueryEngine(e),t._initAttributeStore(e),t.pause(),yield Promise.all([t._source.update(n,e.schema.source),t.featureStore.updateSchema(n,e.schema.targets.feature),t.attributeStore.update(n,e),t.attributeStore.updateFilters(n,e,t)]),t._initAggregateStore(e),(0,g.pC)(t.aggregateStore)&&(yield t.aggregateStore.updateSchema(n,e.schema.targets.aggregate)),t._initAggregateQueryEngine(t.aggregateStore,e.schema),(0,F.Z)("esri-2d-update-debug")&&n.describe(),t._set("config",e)})()}applyUpdate(n){var e=this;return(0,E.Z)(function*(){n.version=e._updateVersion,(0,F.Z)("esri-2d-update-debug")&&console.debug(`Applying update ${n.version}`),n.mesh&&e.clearTiles(),e._updateQueue.resume(),yield e._source.applyUpdate(n),e.notifyChange("updating"),yield(0,D.N1)(()=>!e.updating),(0,g.pC)(e.aggregateStore)&&(yield(0,b.e4)(10),yield(0,D.N1)(()=>!e.updating))})()}onEdits({edits:n}){var e=this;return(0,E.Z)(function*(){(0,F.Z)("esri-2d-update-debug")&&console.debug("Applying Edit:",n),e._didEdit=!0;try{const t=n.removed.map(r=>r.objectId&&-1!==r.objectId?r.objectId:e._lookupObjectIdByGlobalId(r.globalId)),i=n.addOrModified.map(({objectId:r})=>r);e.featureStore.invalidate(),yield e._source.edit(i,t),e.clearTiles(),e.notifyChange("updating"),(0,g.pC)(e.aggregateStore)&&e.aggregateStore.clear(),yield e._source.resend(),yield(0,D.N1)(()=>!e.updating)}catch{}})()}refresh(n){var e=this;return(0,E.Z)(function*(){if(!n.dataChanged){const t=H.empty();return t.storage.filters=!0,e.applyUpdate(t)}e.featureStore.invalidate(),e.clearTiles(),e._source.refresh(e._updateVersion,n),e._cleanupNeeded=!0,e.notifyChange("updating"),yield(0,D.N1)(()=>!e.updating)})()}clearTiles(){for(const n of this.tileStore.tiles)this.processor.onTileClear(n)}onTileUpdate(n){(0,g.pC)(this.aggregateStore)&&this.aggregateStore.onTileUpdate(n);for(const e of n.added)this._source.subscribe(e,this._updateVersion),this._level=e.level;for(const e of n.removed)this._source.unsubscribe(e),this._cleanupNeeded=!0,this._tileToResolver.has(e.id)&&(this._tileToResolver.get(e.id).resolve(),this._tileToResolver.delete(e.id));this.notifyChange("updating")}onIdle(){var n=this;return(0,E.Z)(function*(){n._invalidated&&(n._invalidated=!1,((0,g.pC)(n.aggregateStore)||"heatmap"===n.processor.type)&&(yield n._repushCurrentLevelTiles())),n._markAndSweep()})()}querySummaryStatistics({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.featureQueryEngine.executeQueryForSummaryStatistics(n,e)})()}queryAggregateSummaryStatistics({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.aggregateQueryEngine.executeQueryForSummaryStatistics(n,e)})()}queryUniqueValues({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.featureQueryEngine.executeQueryForUniqueValues(n,e)})()}queryAggregateUniqueValues({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.aggregateQueryEngine.executeQueryForUniqueValues(n,e)})()}queryClassBreaks({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.featureQueryEngine.executeQueryForClassBreaks(n,e)})()}queryAggregateClassBreaks({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.aggregateQueryEngine.executeQueryForClassBreaks(n,e)})()}queryHistogram({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.featureQueryEngine.executeQueryForHistogram(n,e)})()}queryAggregateHistogram({query:n,params:e}){var t=this;return(0,E.Z)(function*(){return t.aggregateQueryEngine.executeQueryForHistogram(n,e)})()}queryExtent(n){return this.featureQueryEngine.executeQueryForExtent(n)}queryAggregates(n){return this.aggregateQueryEngine.executeQuery(n)}queryAggregateCount(n){return this.aggregateQueryEngine.executeQueryForCount(n)}queryAggregateIds(n){return this.aggregateQueryEngine.executeQueryForIds(n)}queryFeatures(n){return this.featureQueryEngine.executeQuery(n)}queryVisibleFeatures(n){var e=this;return(0,E.Z)(function*(){const t=yield e.featureQueryEngine.executeQuery(n),i=t.objectIdFieldName;return t.features=t.features.filter(r=>{const o=e.getDisplayId(r.attributes[i]);return(0,g.yw)(o,u=>e.attributeStore.isVisible(u))}),t})()}queryFeatureCount(n){return this.featureQueryEngine.executeQueryForCount(n)}queryLatestObservations(n){return this.featureQueryEngine.executeQueryForLatestObservations(n)}queryObjectIds(n){return this.featureQueryEngine.executeQueryForIds(n)}queryStatistics(){var n=this;return(0,E.Z)(function*(){return n.featureStore.storeStatistics})()}getObjectId(n){return this.featureStore.lookupObjectId(n,this._storage)}getDisplayId(n){if((0,g.pC)(this.aggregateStore)){const e=this.aggregateStore.getDisplayId(n);if((0,g.Wi)(e)){const t=this.featureStore.lookupDisplayId(n);return this.aggregateStore.getDisplayIdForReferenceId(t)}return e}return this.featureStore.lookupDisplayId(n)}getFeatures(n){const e=[],t=[];for(const i of n){const r=(0,g.pC)(this.aggregateStore)?this.getAggregate(i):null;if((0,g.pC)(r))if((0,g.pC)(r.attributes.referenceId)){const a=this.getFeature(r.attributes.referenceId);(0,g.pC)(a)&&e.push(a)}else t.push(r);else{const a=this.getFeature(i);(0,g.pC)(a)&&e.push(a)}}return{features:e,aggregates:t}}getFeature(n){const e=this.featureStore.lookupFeatureByDisplayId(n,this._storage);if((0,g.Wi)(e))return null;const t=e.readHydratedGeometry(),i=(0,L.di)(t,e.geometryType,e.hasZ,e.hasM);return{attributes:e.readAttributes(),geometry:i}}getAggregate(n){return(0,g.Wi)(this.aggregateStore)?null:this.aggregateStore.getAggregate(n)}getAggregates(){return(0,g.Wi)(this.aggregateStore)?[]:this.aggregateStore.getAggregates()}setHighlight(n){var e=this;return(0,E.Z)(function*(){const t=(0,g.lV)(n.map(i=>e.getDisplayId(i)));return e.attributeStore.setHighlight(n,t)})()}_lookupObjectIdByGlobalId(n){const e=this.service.globalIdField;if((0,g.Wi)(e))throw new Error("Expected globalIdField to be defined");let t=null;if(this.featureStore.forEach(i=>{n===i.readAttribute(e)&&(t=i.getObjectId())}),(0,g.Wi)(t))throw new Error(`Expected to find a feature with globalId ${n}`);return t}_repushCurrentLevelTiles(){var n=this;return(0,E.Z)(function*(){const e=n.tileStore.tiles.filter(i=>i.level===n._level);e.map(function(){var i=(0,E.Z)(function*(r){return n._patchTile({type:"append",id:r.key.id,clear:!0,addOrUpdate:null,end:!1})});return function(r){return i.apply(this,arguments)}}());const t=e.map(function(){var i=(0,E.Z)(function*(r){return n._patchTile({type:"append",id:r.key.id,addOrUpdate:w.i.fromOptimizedFeatures([],n.service),remove:[],end:!0,isRepush:!0,status:H.empty()})});return function(r){return i.apply(this,arguments)}}());yield Promise.all(t)})()}_maybeForceCleanup(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()}_patchTile(n,e){const t=this._updateQueue.push(n,e).then(()=>{this.notifyChange("updating")}).catch(i=>{this.notifyChange("updating")});return this.notifyChange("updating"),t}_onTileMessage(n,e){var t=this;return(0,E.Z)(function*(){if((0,b.k_)(e),(0,F.Z)("esri-2d-update-debug")){const o=(0,g.yw)(n.addOrUpdate,u=>u.hasFeatures);console.debug(n.id,`FeatureController:onTileMessage: [clear:${n.clear}, end:${n.end}, features: ${o}]`)}const i=t.tileStore.get(n.id);if(!i)return;if(n.clear)return t.processor.onTileClear(i);const r=n.status;t._cleanupNeeded=!0;const a=[];for(const o of n.remove??[]){const u=t.featureStore.lookupDisplayId(o);u&&a.push(u)}n.remove=a;try{if((0,g.Wi)(n.addOrUpdate))return void t.processor.onTileMessage(i,{...n,addOrUpdate:null},(0,g.pC)(t.aggregateStore),e).catch(b.H9);if(n.addOrUpdate.setArcadeSpatialReference(t.spatialReference),t.featureStore.hasInstance(n.addOrUpdate.instance)&&r.targets.feature||(r.targets.feature=!0,t.featureStore.onTileData(i,n)),(!r.storage.data||!r.storage.filters)&&(r.storage.data=!0,r.storage.filters=!0,t.attributeStore.onTileData(i,n),"stream"===t._source.type||t._didEdit?(yield t.attributeStore.sendUpdates(),(0,b.k_)(e)):t.attributeStore.sendUpdates()),(0,g.pC)(t.aggregateStore)&&!r.targets.aggregate){r.targets.aggregate=!0;const o=Mt(t._source)&&t._source.loading,u=!Mt(t._source)||o||n.end;if(t.aggregateStore.onTileData(i,n,t._storage,t.attributeStore,u),!u)return;r.mesh||(t.attributeStore.onTileData(i,n),yield t.attributeStore.sendUpdates())}if(!r.mesh){r.mesh=!0;const o=(0,g.pC)(t.aggregateStore)&&"cluster"===t.aggregateStore.type;yield t.processor.onTileMessage(i,n,o,e),(0,b.k_)(e)}t._maybeForceCleanup()}catch(o){(0,b.H9)(o)}})()}_mark(n,e,t){const i=(4294901760&this._storage.getInstanceId(n))>>>16;n&&(e.add(i),t.set(n))}_markAndSweep(){if(this._lastCleanup=performance.now(),"feature"===this._source.type&&"snapshot"===this._source.mode||"stream"!==this._source.type&&!this._cleanupNeeded)return;this._cleanupNeeded=!1;const n=this._storage.getBitset(this._markedIdsBufId),e=new Set;n.clear();for(const t of this.tileStore.tiles)for(const i of this._source.readers(t.id)){const r=i.getCursor();for(;r.next();){let a=r.getDisplayId();if(!a){const o=r.getObjectId();a=this.featureStore.lookupDisplayId(o)}this._mark(a,e,n)}}"symbol"===this.processor.type&&this.processor.forEachBufferId(t=>{this._mark(t,e,n)}),this._updateQueue.forEach(t=>{for(const i of t.remove??[]){const r=this.featureStore.lookupDisplayId(i);this._mark(r,e,n)}}),(0,g.pC)(this.aggregateStore)&&(this.aggregateStore.sweepFeatures(n,this.featureStore),"sweepAggregates"in this.aggregateStore&&this.aggregateStore.sweepAggregates(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(n,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(e)}};(0,U._)([(0,N.Cb)({constructOnly:!0})],$.prototype,"tileStore",void 0),(0,U._)([(0,N.Cb)()],$.prototype,"config",void 0),(0,U._)([(0,N.Cb)({readOnly:!0})],$.prototype,"fieldsIndex",null),(0,U._)([(0,N.Cb)()],$.prototype,"processor",void 0),(0,U._)([(0,N.Cb)({constructOnly:!0})],$.prototype,"remoteClient",void 0),(0,U._)([(0,N.Cb)({constructOnly:!0})],$.prototype,"service",void 0),(0,U._)([(0,N.Cb)()],$.prototype,"spatialReference",null),(0,U._)([(0,N.Cb)()],$.prototype,"updating",null),$=(0,U._)([(0,_e.j)("esri.views.2d.layers.features.controllers.FeatureController2D")],$);const qs=$;var Ys=_(43908),Xs=_(45396);let Se=class extends X.r{constructor(){super(...arguments),this.controller=null,this.processor=null,this.remoteClient=null,this.tileStore=null,this.service=null,this.viewState=null,this._paused=!1,this._pendingTileUpdates=[]}initialize(){this.handles.add((0,D.YP)(()=>this.updating,n=>{this.remoteClient.invoke("setUpdating",n).catch(e=>{})}))}destroy(){this.stop(),this.controller?.destroy(),this.processor?.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||this.controller.updating}stop(){this._paused=!0,Array.isArray(this.service?.source)&&(this.service.source.forEach(n=>n.close()),this.service.source.length=0),this.tileStore?.updateTiles({added:[],removed:this.tileStore.tiles.map(n=>n.id)}),this.tileStore?.destroy(),this.tileStore=null,this._pendingTileUpdates.length=0}startup({service:n,config:e,tileInfo:t,tiles:i}){var r=this;return(0,E.Z)(function*(){if(r._paused=!0,Array.isArray(r.service?.source)&&(r.service.source.forEach(a=>a.close()),r.service.source.length=0),r.service=n,!r.tileStore||!(0,ye.fS)(r.tileStore.tileScheme.spatialReference,t.spatialReference)){const a=new Xs.Z(xe.Z.fromJSON(t));i.added.length=i.removed.length=0,r.tileStore?.updateTiles({added:[],removed:r.tileStore.tiles.map(o=>o.id)}),r.tileStore?.destroy(),r.tileStore=new Ys.Z(a),r._pendingTileUpdates.length=0}for(yield r._createProcessorAndController(e),yield r.update({config:e}),r.controller.resume(),r.tileStore.clear(),r.tileStore.updateTiles(i),r._paused=!1;r._pendingTileUpdates.length;)r.tileStore.updateTiles(r._pendingTileUpdates.pop())})()}updateTiles(n){var e=this;return(0,E.Z)(function*(){e._paused?e._pendingTileUpdates.push(n):e.tileStore?.updateTiles(n)})()}update({config:n}){var e=this;return(0,E.Z)(function*(){const t=H.empty();return yield Promise.all([e.processor.update(t,n),e.controller.update(t,n)]),t.toJSON()})()}applyUpdate(n){var e=this;return(0,E.Z)(function*(){return e.controller.applyUpdate(H.create(n))})()}_createProcessorAndController(n){var e=this;return(0,E.Z)(function*(){yield Promise.all([e._handleControllerConfig(n),e._handleProcessorConfig(n)]),e.controller.processor=e.processor})()}_handleControllerConfig(n){var e=this;return(0,E.Z)(function*(){return e._createController(e.service,n)})()}_handleProcessorConfig(n){var e=this;return(0,E.Z)(function*(){return e._createProcessor(e.service,n)})()}_createController(n,e){var t=this;return(0,E.Z)(function*(){t.controller&&t.controller.destroy();const{tileStore:i,remoteClient:r}=t,a=new qs({service:n,tileStore:i,remoteClient:r});return t.controller=a,a})()}_createProcessor(n,e){var t=this;return(0,E.Z)(function*(){const i=e.schema.processors[0].type,r=(yield function Ue(n){return"heatmap"===n?Promise.all([_.e(8592),_.e(113)]).then(_.bind(_,70113)):Promise.all([_.e(323),_.e(1850),_.e(9764),_.e(8592),_.e(3632)]).then(_.bind(_,62386))}(i)).default,{remoteClient:a,tileStore:o}=t,u=new r({service:n,config:e,tileStore:o,remoteClient:a});return t.processor&&t.processor.destroy(),t.processor=u,u})()}};(0,U._)([(0,N.Cb)()],Se.prototype,"controller",void 0),(0,U._)([(0,N.Cb)()],Se.prototype,"processor",void 0),(0,U._)([(0,N.Cb)()],Se.prototype,"updating",null),(0,U._)([(0,N.Cb)()],Se.prototype,"viewState",void 0),Se=(0,U._)([(0,_e.j)("esri.views.2d.layers.features.Pipeline")],Se);const zs=Se},69923:(We,oe,_)=>{var E,U,X,F,D,N,we,Ze,_e,ye,xe,Ue,Re,g,b,L,Ae,Le,me,De,Pe,ue,s;_.d(oe,{Br:()=>L,Ho:()=>me,LR:()=>N,Ld:()=>Ee,Lm:()=>Pe,Lu:()=>He,MX:()=>U,No:()=>Re,OU:()=>ue,Se:()=>w,Tg:()=>Ae,V7:()=>ve,VI:()=>g,VY:()=>Ce,Wf:()=>we,Y5:()=>Z,_g:()=>Ge,cw:()=>xe,db:()=>F,e8:()=>Ue,g:()=>Ze,l1:()=>Le,lP:()=>b,lk:()=>E,q_:()=>Ie,qi:()=>De,w0:()=>D,wb:()=>_e,xS:()=>ye,zi:()=>X}),(s=E||(E={}))[s.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",s[s.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",s[s.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",function(s){s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(U||(U={})),function(s){s[s.ZERO=0]="ZERO",s[s.ONE=1]="ONE",s[s.SRC_COLOR=768]="SRC_COLOR",s[s.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",s[s.SRC_ALPHA=770]="SRC_ALPHA",s[s.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",s[s.DST_ALPHA=772]="DST_ALPHA",s[s.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",s[s.DST_COLOR=774]="DST_COLOR",s[s.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",s[s.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",s[s.CONSTANT_COLOR=32769]="CONSTANT_COLOR",s[s.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",s[s.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",s[s.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(X||(X={})),function(s){s[s.ADD=32774]="ADD",s[s.SUBTRACT=32778]="SUBTRACT",s[s.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(F||(F={})),function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s[s.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",s[s.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",s[s.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",s[s.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(D||(D={})),function(s){s[s.FRONT=1028]="FRONT",s[s.BACK=1029]="BACK",s[s.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(N||(N={})),function(s){s[s.CW=2304]="CW",s[s.CCW=2305]="CCW"}(we||(we={})),function(s){s[s.BYTE=5120]="BYTE",s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.SHORT=5122]="SHORT",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.INT=5124]="INT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.FLOAT=5126]="FLOAT"}(Ze||(Ze={})),function(s){s[s.NEVER=512]="NEVER",s[s.LESS=513]="LESS",s[s.EQUAL=514]="EQUAL",s[s.LEQUAL=515]="LEQUAL",s[s.GREATER=516]="GREATER",s[s.NOTEQUAL=517]="NOTEQUAL",s[s.GEQUAL=518]="GEQUAL",s[s.ALWAYS=519]="ALWAYS"}(_e||(_e={})),function(s){s[s.ZERO=0]="ZERO",s[s.KEEP=7680]="KEEP",s[s.REPLACE=7681]="REPLACE",s[s.INCR=7682]="INCR",s[s.DECR=7683]="DECR",s[s.INVERT=5386]="INVERT",s[s.INCR_WRAP=34055]="INCR_WRAP",s[s.DECR_WRAP=34056]="DECR_WRAP"}(ye||(ye={})),function(s){s[s.NEAREST=9728]="NEAREST",s[s.LINEAR=9729]="LINEAR",s[s.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",s[s.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",s[s.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",s[s.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(xe||(xe={})),function(s){s[s.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ue||(Ue={})),function(s){s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_3D=32879]="TEXTURE_3D",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Re||(Re={})),function(s){s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s[s.ALPHA=6406]="ALPHA",s[s.RGB=6407]="RGB",s[s.RGBA=6408]="RGBA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.RED=6403]="RED",s[s.RG=33319]="RG",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER"}(g||(g={})),function(s){s[s.RGBA4=32854]="RGBA4",s[s.R16F=33325]="R16F",s[s.RG16F=33327]="RG16F",s[s.RGB32F=34837]="RGB32F",s[s.RGBA16F=34842]="RGBA16F",s[s.R32F=33326]="R32F",s[s.RG32F=33328]="RG32F",s[s.RGBA32F=34836]="RGBA32F",s[s.R11F_G11F_B10F=35898]="R11F_G11F_B10F",s[s.RGB8=32849]="RGB8",s[s.RGBA8=32856]="RGBA8",s[s.RGB5_A1=32855]="RGB5_A1",s[s.R8=33321]="R8",s[s.RG8=33323]="RG8",s[s.R8I=33329]="R8I",s[s.R8UI=33330]="R8UI",s[s.R16I=33331]="R16I",s[s.R16UI=33332]="R16UI",s[s.R32I=33333]="R32I",s[s.R32UI=33334]="R32UI",s[s.RG8I=33335]="RG8I",s[s.RG8UI=33336]="RG8UI",s[s.RG16I=33337]="RG16I",s[s.RG16UI=33338]="RG16UI",s[s.RG32I=33339]="RG32I",s[s.RG32UI=33340]="RG32UI",s[s.RGB16F=34843]="RGB16F",s[s.RGB9_E5=35901]="RGB9_E5",s[s.SRGB8=35905]="SRGB8",s[s.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",s[s.RGB565=36194]="RGB565",s[s.RGBA32UI=36208]="RGBA32UI",s[s.RGB32UI=36209]="RGB32UI",s[s.RGBA16UI=36214]="RGBA16UI",s[s.RGB16UI=36215]="RGB16UI",s[s.RGBA8UI=36220]="RGBA8UI",s[s.RGB8UI=36221]="RGB8UI",s[s.RGBA32I=36226]="RGBA32I",s[s.RGB32I=36227]="RGB32I",s[s.RGBA16I=36232]="RGBA16I",s[s.RGB16I=36233]="RGB16I",s[s.RGBA8I=36238]="RGBA8I",s[s.RGB8I=36239]="RGB8I",s[s.R8_SNORM=36756]="R8_SNORM",s[s.RG8_SNORM=36757]="RG8_SNORM",s[s.RGB8_SNORM=36758]="RGB8_SNORM",s[s.RGBA8_SNORM=36759]="RGBA8_SNORM",s[s.RGB10_A2=32857]="RGB10_A2",s[s.RGB10_A2UI=36975]="RGB10_A2UI"}(b||(b={})),function(s){s[s.FLOAT=5126]="FLOAT",s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.BYTE=5120]="BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.SHORT=5122]="SHORT",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.INT=5124]="INT",s[s.HALF_FLOAT=5131]="HALF_FLOAT",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(L||(L={})),function(s){s[s.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",s[s.STENCIL_INDEX8=36168]="STENCIL_INDEX8",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s[s.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",s[s.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",s[s.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",s[s.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ae||(Ae={})),function(s){s[s.STATIC_DRAW=35044]="STATIC_DRAW",s[s.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",s[s.STREAM_DRAW=35040]="STREAM_DRAW",s[s.STATIC_READ=35045]="STATIC_READ",s[s.DYNAMIC_READ=35049]="DYNAMIC_READ",s[s.STREAM_READ=35041]="STREAM_READ",s[s.STATIC_COPY=35046]="STATIC_COPY",s[s.DYNAMIC_COPY=35050]="DYNAMIC_COPY",s[s.STREAM_COPY=35042]="STREAM_COPY"}(Le||(Le={})),function(s){s[s.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",s[s.VERTEX_SHADER=35633]="VERTEX_SHADER"}(me||(me={})),function(s){s[s.FRAMEBUFFER=36160]="FRAMEBUFFER",s[s.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",s[s.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(De||(De={})),function(s){s[s.TEXTURE=0]="TEXTURE",s[s.RENDER_BUFFER=1]="RENDER_BUFFER",s[s.CUBEMAP=2]="CUBEMAP"}(Pe||(Pe={})),function(s){s[s.NONE=0]="NONE",s[s.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",s[s.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",s[s.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",s[s.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(ue||(ue={}));const Ee=33984;var Ge,Ce;(function(s){s[s.Texture=0]="Texture",s[s.BufferObject=1]="BufferObject",s[s.VertexArrayObject=2]="VertexArrayObject",s[s.Shader=3]="Shader",s[s.Program=4]="Program",s[s.FramebufferObject=5]="FramebufferObject",s[s.Renderbuffer=6]="Renderbuffer",s[s.Sync=7]="Sync",s[s.COUNT=8]="COUNT"})(Ge||(Ge={})),function(s){s[s.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",s[s.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",s[s.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",s[s.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",s[s.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",s[s.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",s[s.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",s[s.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",s[s.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",s[s.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",s[s.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",s[s.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",s[s.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",s[s.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",s[s.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",s[s.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Ce||(Ce={}));const He=33306;var Ie,w,ke,Te,Z,ve,Be;(function(s){s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ie||(Ie={})),function(s){s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_VEC2=35664]="FLOAT_VEC2",s[s.FLOAT_VEC3=35665]="FLOAT_VEC3",s[s.FLOAT_VEC4=35666]="FLOAT_VEC4",s[s.INT=5124]="INT",s[s.INT_VEC2=35667]="INT_VEC2",s[s.INT_VEC3=35668]="INT_VEC3",s[s.INT_VEC4=35669]="INT_VEC4",s[s.BOOL=35670]="BOOL",s[s.BOOL_VEC2=35671]="BOOL_VEC2",s[s.BOOL_VEC3=35672]="BOOL_VEC3",s[s.BOOL_VEC4=35673]="BOOL_VEC4",s[s.FLOAT_MAT2=35674]="FLOAT_MAT2",s[s.FLOAT_MAT3=35675]="FLOAT_MAT3",s[s.FLOAT_MAT4=35676]="FLOAT_MAT4",s[s.SAMPLER_2D=35678]="SAMPLER_2D",s[s.SAMPLER_CUBE=35680]="SAMPLER_CUBE",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",s[s.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",s[s.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",s[s.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",s[s.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",s[s.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",s[s.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",s[s.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",s[s.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",s[s.SAMPLER_3D=35679]="SAMPLER_3D",s[s.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",s[s.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",s[s.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",s[s.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",s[s.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",s[s.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",s[s.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",s[s.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",s[s.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",s[s.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",s[s.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",s[s.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(w||(w={})),function(s){s[s.OBJECT_TYPE=37138]="OBJECT_TYPE",s[s.SYNC_CONDITION=37139]="SYNC_CONDITION",s[s.SYNC_STATUS=37140]="SYNC_STATUS",s[s.SYNC_FLAGS=37141]="SYNC_FLAGS"}(ke||(ke={})),function(s){s[s.UNSIGNALED=37144]="UNSIGNALED",s[s.SIGNALED=37145]="SIGNALED"}(Te||(Te={})),function(s){s[s.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",s[s.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",s[s.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",s[s.WAIT_FAILED=37149]="WAIT_FAILED"}(Z||(Z={})),function(s){s[s.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(ve||(ve={})),function(s){s[s.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Be||(Be={}))}}]);
//# sourceMappingURL=8581.c07a19fa969a3dfc.js.map