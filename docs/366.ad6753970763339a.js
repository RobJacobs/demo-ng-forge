"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[366],{30248:(lt,U,u)=>{u.d(U,{Z:()=>b});var M=u(53661);class b{constructor(y){this.size=0,this._start=0,this.maxSize=y,this._buffer=new Array(y)}get entries(){return this._buffer}enqueue(y){if(this.size===this.maxSize){const g=this._buffer[this._start];return this._buffer[this._start]=y,this._start=(this._start+1)%this.maxSize,g}return this._buffer[(this._start+this.size++)%this.maxSize]=y,null}dequeue(){if(0===this.size)return null;const y=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,y}peek(){return 0===this.size?null:this._buffer[this._start]}find(y){if(0===this.size)return null;for(const g of this._buffer)if((0,M.pC)(g)&&y(g))return g;return null}clear(y){let g=this.dequeue();for(;(0,M.pC)(g);)y&&y(g),g=this.dequeue()}}},48524:(lt,U,u)=>{u.d(U,{Z:()=>rt});var M=u(18100),b=u(6365),y=(u(32995),u(31882)),g=u(67087),I=(u(28191),u(53661)),B=u(60756),_=u(9497),Y=(u(83382),u(19420),u(20891)),dt=u(55798),G=u(80696),S=u(93142),V=u(43065);class ot{constructor(e,i,a){this._debugMap=new Map,this._width=e*a,this._height=i*a,this._pixelRatio=a;const r=Math.ceil(this._width/1),d=Math.ceil(this._height/1);this._cols=r,this._rows=d,this._cells=V.p.create(r*d)}insertMetrics(e){const i=this._hasCollision(e);return 0===i&&this._markMetrics(e),i}getCellId(e,i){return e+i*this._cols}has(e){return this._cells.has(e)}hasRange(e,i){return this._cells.hasRange(e,i)}set(e){this._cells.set(e)}setRange(e,i){this._cells.setRange(e,i)}_collide(e,i,a,r){const d=e-a/2,m=i-r/2,C=d+a,z=m+r;if(C<0||z<0||d>this._width||m>this._height)return 1;const E=(0,S.uZ)(Math.floor(d/1),0,this._cols),A=(0,S.uZ)(Math.floor(m/1),0,this._rows),k=(0,S.uZ)(Math.ceil(C/1),0,this._cols),W=(0,S.uZ)(Math.ceil(z/1),0,this._rows);for(let K=A;K<=W;K++)for(let it=E;it<=k;it++){const ft=this.getCellId(it,K);if(this.has(ft))return 2}return 0}_mark(e,i,a,r,d){const m=e-a/2,C=i-r/2,z=m+a,E=C+r,A=(0,S.uZ)(Math.floor(m/1),0,this._cols),k=(0,S.uZ)(Math.floor(C/1),0,this._rows),W=(0,S.uZ)(Math.ceil(z/1),0,this._cols),K=(0,S.uZ)(Math.ceil(E/1),0,this._rows);for(let it=k;it<=K;it++)for(let ft=A;ft<=W;ft++){const bt=this.getCellId(ft,it);this._debugMap.set(bt,d),this.set(bt)}return!1}_hasCollision(e){const i=e.id;let a=0,r=0;e.save();do{const d=e.boundsCount;a+=d;for(let m=0;m<d;m++){const C=e.boundsComputedAnchorX(m),z=e.boundsComputedAnchorY(m),E=(e.boundsWidth(m)+2)*this._pixelRatio,A=(e.boundsHeight(m)+2)*this._pixelRatio;switch(this._collide(C,z,E,A)){case 2:return 2;case 1:r++}}}while(e.peekId()===i&&e.next());return e.restore(),a===r?1:0}_markMetrics(e){const i=e.id;e.save();do{const a=e.boundsCount;for(let r=0;r<a;r++){const d=e.boundsComputedAnchorX(r),m=e.boundsComputedAnchorY(r),C=(e.boundsWidth(r)+2)*this._pixelRatio,z=(e.boundsHeight(r)+2)*this._pixelRatio;this._mark(d,m,C,z,e.id)}}while(e.peekId()===i&&e.next());e.restore()}}var j=u(1611),X=u(72902);const vt=Math.PI;function mt(p,e){switch(e.transformationType){case X.hL.Additive:return function yt(p,e){return p+(H(e.minSize,p)||e.minDataValue)}(p,e);case X.hL.Constant:return function ht(p,e){const i=p.stops;let a=i&&i.length&&i[0].size;return null==a&&(a=p.minSize),H(a,e)}(e,p);case X.hL.ClampedLinear:return function nt(p,e){const i=e.minDataValue,a=e.maxDataValue,r=(p-i)/(a-i),d=H(e.minSize,p),m=H(e.maxSize,p);return p<=i?d:p>=a?m:d+r*(m-d)}(p,e);case X.hL.Proportional:return function Mt(p,e){const i=p/e.minDataValue,a=H(e.minSize,p),r=H(e.maxSize,p);let d=null;return d=i*a,(0,S.uZ)(d,a,r)}(p,e);case X.hL.Stops:return function wt(p,e){const[i,a,r]=function St(p,e){if(!e)return;let i=0,a=e.length-1;return e.some((r,d)=>p<r?(a=d,!0):(i=d,!1)),[i,a,(p-e[i])/(e[a]-e[i])]}(p,e.cache.ipData);if(i===a)return H(e.stops[i].size,p);{const d=H(e.stops[i].size,p);return d+(H(e.stops[a].size,p)-d)*r}}(p,e);case X.hL.RealWorldSize:return function xt(p,e){const i=j.a[e.valueUnit],a=H(e.minSize,p),r=H(e.maxSize,p),{valueRepresentation:d}=e;let m=null;return m="area"===d?2*Math.sqrt(p/vt)/i:"radius"===d||"distance"===d?2*p/i:p/i,(0,S.uZ)(m,a,r)}(p,e);case X.hL.Identity:return p;case X.hL.Unknown:return null}}function H(p,e){return"number"==typeof p?p:mt(e,p)}function ut(p,e){const i=[];p.forEachTile(a=>i.push(a)),i.sort((a,r)=>a.instanceId-r.instanceId),i.forEach(a=>{(0,I.pC)(a.labelMetrics)&&a.isReady&&e(a,a.labelMetrics.getCursor())})}function J(p){return e=>(0,dt.F2)(mt(e,p))}function Ct(p,e){if(!function $(p){return p.layer&&("feature"===p.layer.type||"csv"===p.layer.type||"geojson"===p.layer.type||"ogc-feature"===p.layer.type||"stream"===p.layer.type||"subtype-group"===p.layer.type||"wfs"===p.layer.type)}(e))return;const a=e.layer.geometryType,r=!function at(p){for(const e of p){const i="featureReduction"in e&&e.featureReduction&&"labelingInfo"in e.featureReduction?e.featureReduction:void 0,a=[...e.labelingInfo||[],...i?.labelingInfo||[]];if(e.labelsVisible&&a.length&&a.some(r=>"none"===r.deconflictionStrategy))return!0}return!1}("subtype-group"===e.layer.type?e.layer.sublayers.items:[e.layer]),d={};if("subtype-group"!==e.layer.type){if("heatmap"===e.tileRenderer?.type)return;const z=function It(p){const e=null!=p&&"visualVariables"in p&&p.visualVariables;if(!e)return null;for(const i of e)if("size"===i.type)return J(i);return null}(e.layer.renderer);d[0]=z}const m=e.tileRenderer;(0,I.Wi)(m)||p.push({tileRenderer:m,vvEvaluators:d,deconflictionEnabled:r,geometryType:a,visible:e.layer.visible&&!e.suspended})}class Dt{run(e,i,a){const r=[];for(let d=e.length-1;d>=0;d--)Ct(r,e[d]);this._transformMetrics(r),this._runCollision(r,i,a)}_runCollision(e,i,a){const[r,d]=i.state.size,m=new ot(r,d,i.pixelRatio);for(const{tileRenderer:C,deconflictionEnabled:z,visible:E}of e){const A=C.featuresView.attributeView;z?E?(this._prepare(C),this._collideVisible(m,C,a),this._collideInvisible(m,C)):ut(C,(k,W)=>{for(;W.nextId();)A.setLabelMinZoom(W.id,255)}):ut(C,(k,W)=>{for(;W.nextId();)A.setLabelMinZoom(W.id,0),E&&m.insertMetrics(W)})}}_isFiltered(e,i,a){const r=i.getFilterFlags(e),d=!a.hasFilter||!!(r&G.Zd),m=(0,I.Wi)(a.featureEffect)||a.featureEffect.excludedLabelsVisible||!!(r&G.iV);return!(d&&m)}_prepare(e){const i=e.featuresView.attributeView,a=new Set;ut(e,(r,d)=>{for(;d.nextId();)if(!a.has(d.id)){if(a.add(d.id),this._isFiltered(d.id,i,e.layerView)){i.setLabelMinZoom(d.id,254);continue}0!==i.getLabelMinZoom(d.id)?i.setLabelMinZoom(d.id,255):i.setLabelMinZoom(d.id,0)}})}_collideVisible(e,i,a){const r=i.featuresView.attributeView,d=new Set;ut(i,(m,C)=>{for(;C.nextId();)if(!d.has(C.id))if(m.key.level===a){if(0===r.getLabelMinZoom(C.id))switch(e.insertMetrics(C)){case 1:break;case 2:r.setLabelMinZoom(C.id,254),d.add(C.id);break;case 0:r.setLabelMinZoom(C.id,0),d.add(C.id)}}else r.setLabelMinZoom(C.id,254)})}_collideInvisible(e,i){const a=i.featuresView.attributeView,r=new Set;ut(i,(d,m)=>{for(;m.nextId();)if(!r.has(m.id)&&255===a.getLabelMinZoom(m.id))switch(e.insertMetrics(m)){case 1:break;case 2:a.setLabelMinZoom(m.id,255),r.add(m.id);break;case 0:a.setLabelMinZoom(m.id,0),r.add(m.id)}})}_transformMetrics(e){for(const{tileRenderer:i,geometryType:a,vvEvaluators:r}of e)ut(i,(d,m)=>{const C=i.featuresView.attributeView,z=d.transforms.labelMat2d;z[4]=Math.round(z[4]),z[5]=Math.round(z[5]);const E="polyline"===a;for(;m.next();){const A=m.boundsCount,k=m.anchorX,W=m.anchorY;let K=m.size;const it=r[0];if((0,I.pC)(it)){const q=it(C.getVVSize(m.id));K=isNaN(q)||null==q||q===1/0?K:q}const ft=m.directionX*(K/2),bt=m.directionY*(K/2);for(let q=0;q<A;q++){let Rt=k,f=m.anchorY;if(E){let t=Rt+m.boundsX(q)+ft,n=f+m.boundsY(q)+bt;t=z[0]*t+z[2]*n+z[4],n=z[1]*t+z[3]*n+z[5],m.setBoundsComputedAnchorX(q,Math.floor(t)),m.setBoundsComputedAnchorY(q,Math.floor(n))}else{Rt=z[0]*k+z[2]*W+z[4],f=z[1]*k+z[3]*W+z[5];const t=Rt+m.boundsX(q)+ft,n=f+m.boundsY(q)+bt;m.setBoundsComputedAnchorX(q,t),m.setBoundsComputedAnchorY(q,n)}}}})}}let ct=class extends((0,y.p)(b.Z)){constructor(p){super(p),this._applyVisibilityPassThrottled=(0,B.P)(this._applyVisibilityPass,32,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new Dt}destroy(){this.collisionEngine=null,this._applyVisibilityPassThrottled=(0,I.hw)(this._applyVisibilityPassThrottled)}get updating(){return(0,g.Z)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(p){this._applyVisibilityPassThrottled(p)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(p){this._set("updateParameters",p),this.updateRequested&&(this.updateRequested=!1,this.update(p))}_applyVisibilityPass(p){const e=this.view;if(e)try{const i=e.featuresTilingScheme.getClosestInfoForScale(p.state.scale).level;this.collisionEngine.run(e.allLayerViews.items,p,i)}catch{}}};(0,M._)([(0,_.Cb)()],ct.prototype,"updateRequested",void 0),(0,M._)([(0,_.Cb)({readOnly:!0})],ct.prototype,"updateParameters",void 0),(0,M._)([(0,_.Cb)()],ct.prototype,"updating",null),(0,M._)([(0,_.Cb)()],ct.prototype,"view",void 0),ct=(0,M._)([(0,Y.j)("esri.views.2d.layers.labels.LabelManager")],ct);const rt=ct},41780:(lt,U,u)=>{var M,b,L,y;u.d(U,{Fr:()=>L,_K:()=>b,al:()=>M}),(y=M||(M={}))[y.FILL=1]="FILL",y[y.LINE=2]="LINE",y[y.SYMBOL=3]="SYMBOL",y[y.CIRCLE=4]="CIRCLE",function(y){y[y.BACKGROUND=0]="BACKGROUND",y[y.FILL=1]="FILL",y[y.OUTLINE=2]="OUTLINE",y[y.LINE=3]="LINE",y[y.ICON=4]="ICON",y[y.CIRCLE=5]="CIRCLE",y[y.TEXT=6]="TEXT",y[y.TILEINFO=7]="TILEINFO"}(b||(b={})),function(y){y[y.PAINTER_CHANGED=0]="PAINTER_CHANGED",y[y.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",y[y.LAYER_CHANGED=2]="LAYER_CHANGED",y[y.LAYER_REMOVED=3]="LAYER_REMOVED",y[y.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(L||(L={}))},15655:(lt,U,u)=>{u.d(U,{w:()=>g});const M={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}},y=new(u(78076).B)(function L(v){let I=M;return v.split("/").forEach(B=>{I&&(I=I[B])}),I});function g(v){return y.resolveIncludes(v)}},20533:(lt,U,u)=>{u.d(U,{Q:()=>I,g:()=>g});var M=u(67087),b=u(53661),L=u(91957);const y=(0,M.Z)("esri-2d-log-allocations");class g{constructor(_,T){this._array=_,this._pool=T}get array(){return this._array}get length(){return this._array.length}static create(_,T){const D=T.acquire(_);return new g(D,T)}expand(_){const T=this._pool.acquire(_);T.set(this._array),this._pool.release(this._array),this._array=T}destroy(){this._pool.release(this._array)}set(_,T){this._array.set(_._array,T)}slice(){const _=this._pool.acquire(this._array.byteLength);return _.set(this._array),new g(_,this._pool)}}class v{constructor(){this._data=new ArrayBuffer(v.BYTE_LENGTH),this._freeList=new L.m({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(_){const T=this._freeList.firstFit(_);return(0,b.Wi)(T)?null:new Uint32Array(this._data,T,_/Uint32Array.BYTES_PER_ELEMENT)}free(_){this._freeList.free(_.byteOffset,_.byteLength)}}class I{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*v.BYTE_LENGTH}acquire(_){if(this._bytesAllocated+=_,y&&console.log(`Allocating ${_}, (${this._bytesAllocated} / ${this._bytesTotal})`),_>v.BYTE_LENGTH)return new Uint32Array(_/Uint32Array.BYTES_PER_ELEMENT);for(const T of this._pages){const D=T.allocate(_);if((0,b.pC)(D))return D}return(0,b.s3)(this._addPage().allocate(_),"Expected to allocate page")}release(_){this._bytesAllocated-=_.byteLength,y&&console.log(`Freeing ${_.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const T=this._pagesByBuffer.get(_.buffer);T&&T.free(_)}_addPage(){const _=new v;return this._pages.push(_),this._pagesByBuffer.set(_.buffer,_),_}}},99896:(lt,U,u)=>{u.d(U,{Q:()=>I});var M=u(30248),b=u(95442),L=u(67087),y=u(53661),g=u(78696);const v=(0,L.Z)("esri-2d-profiler");class I{constructor(_,T){if(this._events=new b.Z,this._entries=new Map,this._timings=new M.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!v)return;this._ext=(0,g.mO)(_.gl,{}),this._debugOutput=T;const D=_.gl;if(this.enableCommandLogging)for(const Y in D)if("function"==typeof D[Y]){const dt=D[Y],G=Y.includes("draw");D[Y]=(...S)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:Y,args:S,isDrawCommand:G}),this._currentSummary&&(this._currentSummary.commands++,G&&this._currentSummary.drawCommands++),dt.apply(D,S))}}get enableCommandLogging(){return!("object"==typeof v&&v.disableCommands)}recordContainerStart(_){v&&(this._currentContainer=_)}recordContainerEnd(){v&&(this._currentContainer=null)}recordPassStart(_){v&&(this._currentPass=_,this._initSummary())}recordPassEnd(){v&&(this._currentPass=null,this._emitSummary())}recordBrushStart(_){v&&(this._currentBrush=_)}recordBrushEnd(){v&&(this._currentBrush=null)}recordStart(_){if(v&&(0,y.pC)(this._ext)){if(this._entries.has(_)){const D=this._entries.get(_),Y=this._ext.resultAvailable(D.query),dt=this._ext.disjoint();if(Y&&!dt){const G=this._ext.getResult(D.query)/1e6;let S=0;if((0,y.pC)(this._timings.enqueue(G))){const P=this._timings.entries,tt=P.length;let R=0;for(const Q of P)R+=Q;S=R/tt}const V=G.toFixed(2),N=S?S.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${_}, ${V} ms (${N} last 10 avg)\n${D.commandsLen} Commands (${D.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(D.summaries),console.log("Commands: ",D.commands),console.groupEnd()):console.log(`Frame report for ${_}, ${V} ms (${N} last 10 avg)`),this._debugOutput.innerHTML=`${V} (${N})`}for(const G of D.handles)G.remove();this._ext.deleteQuery(D.query),this._entries.delete(_)}const T={name:_,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(T.handles.push(this._events.on("command",D=>{T.commandsLen++,T.commands.push(D),D.isDrawCommand&&T.drawCommands++})),T.handles.push(this._events.on("summary",D=>{T.summaries.push(D)}))),this._ext.beginTimeElapsed(T.query),this._entries.set(_,T)}}recordEnd(_){v&&(0,y.pC)(this._ext)&&this._entries.has(_)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},22686:(lt,U,u)=>{u.d(U,{Z:()=>Rt});var M=u(71670),b=u(68327),L=u(1897),y=u(65489),g=u(32995),v=u(36416),I=u(28191),B=u(93142),_=u(53661),T=u(30801),D=u(55798),Y=u(80775),dt=u(12288),G=u(68757),S=u(80696),V=u(20753),N=u(67087),P=u(26057);class tt{constructor(t,n){this._width=0,this._height=0,this._free=[],this._width=t,this._height=n,this._free.push(new P.Z(0,0,t,n))}get width(){return this._width}get height(){return this._height}allocate(t,n){if(t>this._width||n>this._height)return new P.Z;let s=null,h=-1;for(let l=0;l<this._free.length;++l){const o=this._free[l];t<=o.width&&n<=o.height&&(null===s||o.y<=s.y&&o.x<=s.x)&&(s=o,h=l)}return null===s?new P.Z:(this._free.splice(h,1),s.width<s.height?(s.width>t&&this._free.push(new P.Z(s.x+t,s.y,s.width-t,n)),s.height>n&&this._free.push(new P.Z(s.x,s.y+n,s.width,s.height-n))):(s.width>t&&this._free.push(new P.Z(s.x+t,s.y,s.width-t,s.height)),s.height>n&&this._free.push(new P.Z(s.x,s.y+n,t,s.height-n))),new P.Z(s.x,s.y,t,n))}release(t){for(let n=0;n<this._free.length;++n){const s=this._free[n];if(s.y===t.y&&s.height===t.height&&s.x+s.width===t.x)s.width+=t.width;else if(s.x===t.x&&s.width===t.width&&s.y+s.height===t.y)s.height+=t.height;else if(t.y===s.y&&t.height===s.height&&t.x+t.width===s.x)s.x=t.x,s.width+=t.width;else{if(t.x!==s.x||t.width!==s.width||t.y+t.height!==s.y)continue;s.y=t.y,s.height+=t.height}this._free.splice(n,1),this.release(t)}this._free.push(t)}}var R=u(69923),Q=u(74697);const j=f=>Math.floor(f/256);class H{constructor(t,n,s){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=n,this._glyphSource=s,this._binPack=new tt(t-4,n-4),this._glyphData.push(new Uint8Array(t*n)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],n=[];for(let h=0;h<t.length;h++){const l=t[h];for(let o=0;o<11;o++)n.push(l)}const s={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(n)};this._recordGlyph(s)}getGlyphItems(t,n,s){var h=this;return(0,M.Z)(function*(){const l=h._getGlyphCache(t);return yield h._fetchRanges(t,n,s),n.map(o=>h._getMosaicItem(l,t,o))})()}bind(t,n,s,h){const l=this._getTexture(t,s);l.setSamplingMode(n),this._dirties[s]&&(l.setData(this._glyphData[s]),this._dirties[s]=!1),t.bindTexture(l,h)}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,n){return this._textures[n]||(this._textures[n]=new Q.x(t,{pixelFormat:R.VI.ALPHA,dataType:R.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[n]}_invalidate(){this._dirties[this._currentPage]=!0}_fetchRanges(t,n,s){var h=this;return(0,M.Z)(function*(){const l=function X(f){const t=new Set;for(const n of f)t.add(j(n));return t}(n),o=[];l.forEach(c=>{o.push(h._fetchRange(t,c,s))}),yield Promise.all(o)})()}_fetchRange(t,n,s){var h=this;return(0,M.Z)(function*(){if(!(n>256))return function vt(f,t,n){return f.has(t)||f.set(t,n().then(()=>{f.delete(t)}).catch(s=>{f.delete(t),(0,T.H9)(s)})),f.get(t)}(h._rangePromises,t+n,()=>h._glyphSource.getRange(t,n,s))})()}_getMosaicItem(t,n,s){if(!t[s]){const h=this._glyphSource.getGlyph(n,s);if(!h||!h.metrics)return f=s,{rect:new P.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:f,sdf:!0};const l=this._recordGlyph(h);t[s]={rect:l,page:this._currentPage,metrics:h.metrics,code:s,sdf:!0},this._invalidate()}var f;return t[s]}_recordGlyph(t){const n=t.metrics;let s;if(0===n.width)s=new P.Z(0,0,0,0);else{const l=n.width+6,o=n.height+6;s=this._binPack.allocate(l,o),s.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new tt(this.width-4,this.height-4),s=this._binPack.allocate(l,o));const c=this._glyphData[this._currentPage],w=t.bitmap;let x,O;if(w)for(let F=0;F<o;F++){x=l*F,O=this.width*(s.y+F)+s.x;for(let Z=0;Z<l;Z++)c[O+Z]=w[x+Z]}(0,N.Z)("esri-glyph-debug")&&this._showDebugPage(c)}return s}_showDebugPage(t){const n=document.createElement("canvas"),s=n.getContext("2d"),h=new ImageData(this.width,this.height),l=h.data;n.width=this.width,n.height=this.height,n.style.border="1px solid black";for(let o=0;o<t.length;++o)l[4*o+0]=t[o],l[4*o+1]=0,l[4*o+2]=0,l[4*o+3]=255;s.putImageData(h,0,0),document.body.appendChild(n)}}var yt=u(74617);class ht{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const n=t.getMessage();for(;n.next();)switch(n.tag()){case 3:{const s=n.getMessage();let h,l,o,c,w,x,O;for(;s.next();)switch(s.tag()){case 1:h=s.getUInt32();break;case 2:l=s.getBytes();break;case 3:o=s.getUInt32();break;case 4:c=s.getUInt32();break;case 5:w=s.getSInt32();break;case 6:x=s.getSInt32();break;case 7:O=s.getUInt32();break;default:s.skip()}s.release(),h&&(this._metrics[h]={width:o,height:c,left:w,top:x,advance:O},this._bitmaps[h]=l);break}default:n.skip()}n.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class nt{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,n){this._ranges[t]=n}}class Mt{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,n,s){const h=this._getFontStack(t);if(h.getRange(n))return Promise.resolve();const l=256*n,o=l+255,c=this._baseURL.replace("{fontstack}",t).replace("{range}",l+"-"+o);return(0,L.default)(c,{responseType:"array-buffer",...s}).then(w=>{h.addRange(n,new ht(new yt.Z(new Uint8Array(w.data),new DataView(w.data))))})}getGlyph(t,n){const s=this._getFontStack(t);if(!s)return;const h=Math.floor(n/256);if(h>256)return;const l=s.getRange(h);return l?{metrics:l.getMetrics(n),bitmap:l.getBitmap(n)}:void 0}_getFontStack(t){let n=this._glyphInfo[t];return n||(n=this._glyphInfo[t]=new nt),n}}var wt=u(1671);const xt=1e20;class St{constructor(t){this._svg=null,this.size=t;const n=document.createElement("canvas");n.width=n.height=t,this._context=n.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,n,s=31){this._initSVG();const h=this.createSVGString(t);return new Promise((l,o)=>{const c=new Image;c.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(h),c.onload=()=>{c.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(c,0,0,this.size,this.size);const x=this._context.getImageData(0,0,this.size,this.size),O=new Uint8Array(this.size*this.size*4);for(let F=0;F<this.size*this.size;F++){const Z=x.data[4*F+3]/255;this._gridOuter[F]=1===Z?0:0===Z?xt:Math.max(0,.5-Z)**2,this._gridInner[F]=1===Z?xt:0===Z?0:Math.max(0,Z-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let F=0;F<this.size*this.size;F++)(0,wt.I)(.5-(this._gridOuter[F]-this._gridInner[F])/(2*s),O,4*F);l(O)};const w=n&&n.signal;w&&(0,T.fu)(w,()=>o((0,T.zE)()))})}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t){const n=this._initSVG(),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",t),n.appendChild(s);const h=s.getBBox(),l=h.width/h.height,o=this.size/2;let c,w,x,O;l>1?(w=c=o/h.width,x=this.size/4,O=o-o*(1/l)/2):(c=w=o/h.height,x=o-o*l/2,O=this.size/4),s.setAttribute("style",`transform: matrix(${c}, 0, 0, ${w}, ${-h.x*c+x}, ${-h.y*w+O})`);const pt=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${n.innerHTML}</svg>`;return n.removeChild(s),pt}_edt(t,n,s){const h=this._f,l=this._d,o=this._v,c=this._z;for(let w=0;w<n;w++){for(let x=0;x<s;x++)h[x]=t[x*n+w];this._edt1d(h,l,o,c,s);for(let x=0;x<s;x++)t[x*n+w]=l[x]}for(let w=0;w<s;w++){for(let x=0;x<n;x++)h[x]=t[w*n+x];this._edt1d(h,l,o,c,n);for(let x=0;x<n;x++)t[w*n+x]=Math.sqrt(l[x])}}_edt1d(t,n,s,h,l){s[0]=0,h[0]=-xt,h[1]=+xt;for(let o=1,c=0;o<l;o++){let w=(t[o]+o*o-(t[s[c]]+s[c]*s[c]))/(2*o-2*s[c]);for(;w<=h[c];)c--,w=(t[o]+o*o-(t[s[c]]+s[c]*s[c]))/(2*o-2*s[c]);c++,s[c]=o,h[c]=w,h[c+1]=+xt}for(let o=0,c=0;o<l;o++){for(;h[c+1]<o;)c++;n[o]=(o-s[c])*(o-s[c])+t[s[c]]}}}var Tt=u(4645);function et(f){return f&&"static"===f.type}class _t{constructor(t,n,s=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||n<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=n,s>0&&(this._maxItemSize=s),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new tt(this._pageWidth,this._pageHeight);const h=Math.floor(this._pageWidth),l=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(h*l)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,n,s,h,l,o,c=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let w,x,O;if(et(s)?[w,x,O]=this._allocateImage(n[0],n[1]):(w=new P.Z(0,0,n[0],n[1]),x=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:s,size:[n[0]+2*S.fL,n[1]+2*S.fL],dirty:!0,texture:void 0})),w.width<=0||w.height<=0)return null;const F={rect:w,width:n[0],height:n[1],sdf:l,simplePattern:o,pixelRatio:c,page:x};return this._mosaicRects.set(t,F),et(s)&&this._copy({rect:w,spriteSize:n,spriteData:s.data,page:x,pageSize:O,repeat:h,sdf:l}),F}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const n={};for(const s of t)n[s]=this.getSpriteItem(s);return n}getMosaicItemPosition(t){const n=this.getSpriteItem(t),s=n&&n.rect;if(!s)return null;s.width=n.width,s.height=n.height;const o=S.fL,c=this._mosaicPages[n.page];return{size:[n.width,n.height],tl:[(s.x+o)/c[0],(s.y+o)/c[1]],br:[(s.x+o+n.width)/c[0],(s.y+o+n.height)/c[1]],page:n.page}}bind(t,n,s=0,h=0){const l=this._mosaicPages[s],o=l.mosaicsData;let c=l.texture;c||(c=function ut(f,t){return new Q.x(f,{pixelFormat:R.VI.RGBA,dataType:R.Br.UNSIGNED_BYTE,width:t[0],height:t[1]},null)}(t,l.size),l.texture=c),c.setSamplingMode(n),et(o)?(t.bindTexture(c,h),l.dirty&&(c.setData(new Uint8Array(o.data.buffer)),c.generateMipmap())):(o.data.bindFrame(t,c,h),c.generateMipmap()),l.dirty=!1}static _copyBits(t,n,s,h,l,o,c,w,x,O,F){let Z=h*n+s,pt=w*o+c;if(F){pt-=o;for(let st=-1;st<=O;st++,Z=((st+O)%O+h)*n+s,pt+=o)for(let gt=-1;gt<=x;gt++)l[pt+gt]=t[Z+(gt+x)%x]}else for(let st=0;st<O;st++){for(let gt=0;gt<x;gt++)l[pt+gt]=t[Z+gt];Z+=n,pt+=o}}_copy(t){if(t.page>=this._mosaicPages.length)return;const n=this._mosaicPages[t.page],s=n.mosaicsData;if(!et(n.mosaicsData))throw new g.Z("mapview-invalid-resource","unsuitable data type!");const h=t.spriteData,l=s.data;l&&h||console.error("Source or target images are uninitialized!"),_t._copyBits(h,t.spriteSize[0],0,0,l,t.pageSize[0],t.rect.x+S.fL,t.rect.y+S.fL,t.spriteSize[0],t.spriteSize[1],t.repeat),n.dirty=!0}_allocateImage(t,n){t+=2*S.fL,n+=2*S.fL;const s=Math.max(t,n);if(this._maxItemSize&&this._maxItemSize<s){const l=2**Math.ceil((0,Tt.k3)(t)),o=2**Math.ceil((0,Tt.k3)(n)),c=new P.Z(0,0,t,n);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(l*o)},size:[l,o],dirty:!0,texture:void 0}),[c,this._mosaicPages.length-1,[l,o]]}const h=this._binPack.allocate(t,n);if(h.width<=0){const l=this._mosaicPages[this._currentPage];return!l.dirty&&et(l.mosaicsData)&&(l.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new tt(this._pageWidth,this._pageHeight),this._allocateImage(t,n)}return[h,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const t of this._mosaicPages){const n=t.texture;n&&n.dispose();const s=t.mosaicsData;et(s)||s.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}}var $=u(52300),J=u(69354),It=u(90203),at=u(20877),Ct=u(5934);function Dt(f){return(0,J.HA)(f.frameDurations.reduce((t,n)=>t+n,0))}function p(f,t){const{width:n,height:s,getFrame:h}=f,l=f.frameDurations.slice(),o=l.pop();return l.push((0,J.HA)(o+t)),{frameDurations:l,getFrame:h,width:n,height:s}}class e{constructor(t,n,s,h){this._animation=t,this._repeatType=s,this._onFrameData=h,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let l=0;for(;n>l;)l+=this.timeToFrame,this.nextFrame();const o=this._animation.getFrame(this._currentFrame);this._onFrameData(o)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case at.of.None:this._currentFrame-=this._direction;break;case at.of.Loop:this._currentFrame=0;break;case at.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case at.of.None:this._currentFrame-=this._direction;break;case at.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case at.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}const r=document.createElement("canvas"),d=r.getContext("2d");class C{constructor(t,n,s,h){this._animation=t,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=function a(f,t,n,s){const h=null==t.playAnimation||t.playAnimation,l=function i(f,t,n,s){let h,{repeatType:l}=t;if(null==l&&(l=at.of.Loop),!0===t.reverseAnimation&&(f=function zt(f){const{width:t,height:n}=f;return{frameDurations:f.frameDurations.reverse(),getFrame:s=>f.getFrame(f.frameDurations.length-1-s),width:t,height:n}}(f)),null!=t.duration&&(f=function ct(f,t){const{width:n,height:s,getFrame:h}=f,l=t/Dt(f);return{frameDurations:f.frameDurations.map(o=>(0,J.HA)(o*l)),getFrame:h,width:n,height:s}}(f,(0,J.HA)(1e3*t.duration))),null!=t.repeatDelay){const o=1e3*t.repeatDelay;l===at.of.Loop?f=p(f,(0,J.HA)(o)):l===at.of.Oscillate&&(f=function rt(f,t){const{width:n,height:s,getFrame:h}=f,l=f.frameDurations.slice(),o=l.shift();return l.unshift((0,J.HA)(o+t)),{frameDurations:l,getFrame:h,width:n,height:s}}(p(f,(0,J.HA)(o/2)),(0,J.HA)(o/2)))}if(null!=t.startTimeOffset)h=(0,J.HA)(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){const o=(0,Ct.$)(n),x=(0,Ct.f)(o,null!=t.randomizeStartSeed?t.randomizeStartSeed:82749913);h=(0,J.HA)(x*Dt(f))}else h=(0,J.HA)(0);return new e(f,h,l,s)}(f,t,n,s);let o,c=l.timeToFrame;return function w(){o=h?setTimeout(()=>{l.nextFrame(),c=l.timeToFrame,w()},c):void 0}(),{remove:()=>{h&&clearTimeout(o)}}}(this._animation,s,h,o=>{this._frameData=o,n.requestRender()})}destroy(){this._playHandle.remove()}bindFrame(t,n,s){t.bindTexture(n,s),(0,_.Wi)(this._frameData)||(n.updateData(0,S.fL,S.fL,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)}}var z=u(31829),A=u(67532);const k=(0,dt.c)(),W="arial-unicode-ms-regular",it=I.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function ft(f,t){const n=Math.round((0,D.F2)(t)*window.devicePixelRatio);return Math.min(f,n*(n>=128?2:4))}const bt=(f,t,n)=>it.error(new g.Z(f,t,n));class q{static fromMosaic(t,n){return new q(t,n.page,n.sdf)}constructor(t,n,s){this.mosaicType=t,this.page=n,this.sdf=s}}class Rt{constructor(t,n,s){var h;this._requestRender=t,this.resourceManager=n,this._allowNonPowerOfTwo=s,this._invalidFontsMap=new Map,this._sdfConverter=new St(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new A.e({concurrency:10,process:(h=(0,M.Z)(function*(l,o){(0,T.k_)(o);try{return yield(0,L.default)(l,{responseType:"image",signal:o})}catch(c){throw(0,T.D_)(c)?c:new g.Z("mapview-invalid-resource",`Could not fetch requested resource at ${l}`,c)}}),function(o,c){return h.apply(this,arguments)})}),this._spriteMosaic=new _t(2048,2048,500),this._glyphSource=new Mt(`${b.default.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new H(1024,1024,this._glyphSource),this._rasterizer=new G.Z(n)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}rasterizeItem(t,n,s,h){var l=this;return(0,M.Z)(function*(){if((0,_.Wi)(t))return bt("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const o=yield l._rasterizeText(t,s,h);return o.forEach(c=>l._setTextureBinding(V.Un.GLYPH,c)),{glyphMosaicItems:o}}default:{if((0,$.Ll)(t))return bt("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const o=yield l._rasterizeSpriteSymbol(t,n,h);return(0,z.ok)(o)&&o&&l._setTextureBinding(V.Un.SPRITE,o),{spriteMosaicItem:o}}}})()}bindTextures(t,n,s,h=!1){if(0===s.textureBinding)return;const l=this._bindingInfos[s.textureBinding-1],o=l.page,c=h?R.cw.LINEAR_MIPMAP_LINEAR:R.cw.LINEAR;switch(l.mosaicType){case V.Un.SPRITE:{const w=this.sprites.getWidth(o),x=this.sprites.getHeight(o),O=(0,Y.s)(k,w,x);return this._spriteMosaic.bind(t,c,o,S.D3),n.setUniform1i("u_texture",S.D3),void n.setUniform2fv("u_mosaicSize",O)}case V.Un.GLYPH:{const O=(0,Y.s)(k,this.glyphs.width,this.glyphs.height);return this._glyphMosaic.bind(t,c,o,S.Al),n.setUniform1i("u_texture",S.Al),void n.setUniform2fv("u_mosaicSize",O)}default:it.error("mapview-texture-manager",`Cannot handle unknown type ${l.mosaicType}`)}}_hashMosaic(t,n){return 1|t<<1|(n.sdf?1:0)<<2|n.page<<3}_setTextureBinding(t,n){const s=this._hashMosaic(t,n);if(!this._hashToBindingIndex.has(s)){const h=q.fromMosaic(t,n);this._hashToBindingIndex.set(s,this._bindingInfos.length+1),this._bindingInfos.push(h)}n.textureBinding=this._hashToBindingIndex.get(s)}_rasterizeText(t,n,s){var h=this;return(0,M.Z)(function*(){let l,o;if("cim"in t)l=t.fontName,o=t.text;else{const x=t;l=(0,v.Yc)(x.font),o=x.text}const c=h._invalidFontsMap.has(l),w=n||(0,$.Jq)((0,y.E)(o)[0]);try{return yield h._glyphMosaic.getGlyphItems(c?W:l,w,s)}catch{return bt("mapview-invalid-resource",`Couldn't find font ${l}. Falling back to Arial Unicode MS Regular`),h._invalidFontsMap.set(l,!0),h._glyphMosaic.getGlyphItems(W,w,s)}})()}_rasterizeSpriteSymbol(t,n,s){var h=this;return(0,M.Z)(function*(){if((0,$.Gg)(t))return;const l=function E(f){switch(f.type){case"esriSMS":return`${f.style}.${f.path}`;case"esriSLS":return`${f.style}.${f.cap}`;case"esriSFS":return`${f.style}`;case"esriPFS":case"esriPMS":return f.imageData?`${f.imageData}${f.width}${f.height}`:`${f.url}${f.width}${f.height}`;default:return"mosaicHash"in f?f.mosaicHash:JSON.stringify(f)}}(t);if(h._spriteMosaic.has(l))return h._spriteMosaic.getSpriteItem(l);if((0,$.sG)(t)||(0,$.HX)(t)&&!(0,$.yP)(t))return h._handleAsyncResource(l,t,s);const c=h._rasterizer.rasterizeJSONResource(t,S.XD);if(c){const{size:w,image:x,sdf:O,simplePattern:F,rasterizationScale:Z}=c;return h._addItemToMosaic(l,w,{type:"static",data:x},(0,$.js)(t),O,F,Z)}return new g.Z("TextureManager","unrecognized or null rasterized image")})()}_handleAsyncResource(t,n,s){var h=this;return(0,M.Z)(function*(){if(h._ongoingRasterizations.has(t))return h._ongoingRasterizations.get(t);let l;l=(0,$.sG)(n)?h._handleSVG(n,t,s):h._handleImage(n,t,s),h._ongoingRasterizations.set(t,l);try{yield l,h._ongoingRasterizations.delete(t)}catch{h._ongoingRasterizations.delete(t)}return l})()}_handleSVG(t,n,s){var h=this;return(0,M.Z)(function*(){const o=yield h._sdfConverter.draw(t.path,s);return h._addItemToMosaic(n,[126,126],{type:"static",data:new Uint32Array(o.buffer)},!1,!0,!0)})()}_handleGIFOrPNG(t,n,s){var h=this;return(0,M.Z)(function*(){const l=(0,$.Gr)(t);yield h.resourceManager.fetchResource(l,s);let o=h.resourceManager.getResource(l);if((0,_.Wi)(o))return new g.Z("mapview-invalid-resource",`Could not fetch requested resource at ${l}.`);let c=o.width,w=o.height;if(o instanceof HTMLImageElement){"esriPMS"===t.type&&(c=Math.round(ft(o.width,(0,$.Ub)(t))),w=Math.round(o.height*(c/o.width)));const Z="cim"in t?t.cim.colorSubstitutions:void 0,{size:pt,sdf:st,image:gt}=h._rasterizer.rasterizeImageResource(c,w,o,Z);return h._addItemToMosaic(n,pt,{type:"static",data:gt},(0,$.js)(t),st,!1)}h._allowNonPowerOfTwo||(c=(0,B.fp)(o.width+2*S.fL)-2*S.fL,w=(0,B.fp)(o.height+2*S.fL)-2*S.fL),c===o.width&&w===o.height||(o=function m(f,t,n){r.width=t,r.height=n;const s=[],h=f.frameDurations.length;for(let l=0;l<h;l++){const o=f.getFrame(l);d.clearRect(0,0,t,n),o instanceof ImageData?d.drawImage((0,It.E0)(o),0,0,t,n):d.drawImage(o,0,0,t,n),s.push(d.getImageData(0,0,t,n))}return{width:t,height:n,frameDurations:f.frameDurations,getFrame:l=>s[l]}}(o,c,w));const F=new C(o,h._requestRender,t.animatedSymbolProperties||{},t.objectId);return h._addItemToMosaic(n,[F.width,F.height],{type:"animated",data:F},(0,$.js)(t),!1,!1)})()}_handleImage(t,n,s){var h=this;return(0,M.Z)(function*(){if((0,$.DQ)(t)||(0,$.iw)(t))return h._handleGIFOrPNG(t,n,s);const l=(0,$.Gr)(t);try{let o;const c=h.resourceManager.getResource(l);if((0,_.pC)(c)&&c instanceof HTMLImageElement)o=c;else{const{data:st}=yield h._imageRequestQueue.push(l,{...s});o=st}if((0,$.TB)(l))if("width"in t&&"height"in t)o.width=(0,D.F2)(t.width),o.height=(0,D.F2)(t.height);else if("cim"in t){const st=t.cim;o.width=(0,D.F2)(st.width??st.scaleX*st.size),o.height=(0,D.F2)(st.size)}if(!o.width||!o.height)return null;let w=o.width,x=o.height;"esriPMS"===t.type&&(w=Math.round(ft(o.width,(0,$.Ub)(t))),x=Math.round(o.height*(w/o.width)));const O="cim"in t?t.cim.colorSubstitutions:void 0,{size:F,sdf:Z,image:pt}=h._rasterizer.rasterizeImageResource(w,x,o,O);return h._addItemToMosaic(n,F,{type:"static",data:pt},(0,$.js)(t),Z,!1)}catch(o){if(!(0,T.D_)(o))return new g.Z("mapview-invalid-resource",`Could not fetch requested resource at ${l}. ${o.message}`)}})()}_addItemToMosaic(t,n,s,h,l,o,c){return this._spriteMosaic.addSpriteItem(t,n,s,h,l,o,c)}}},91957:(lt,U,u)=>{u.d(U,{a:()=>b,m:()=>L});var M=u(53661);class b{constructor(g){if(this.next=null,!Array.isArray(g))return void(this.data=g);this.data=g[0];let v=this;for(let I=1;I<g.length;I++)v.next=new b([g[I]]),v=v.next}*values(){let g=this;for(;g;)yield g.data,g=g.next}forEach(g){let v=this;for(;v;)g(v.data),v=v.next}find(g){return g(this.data)?this:this.next?.find(g)}max(g,v=this){const I=g(this.data)>g(v.data)?this:v;return this.next?this.next.max(g,I):I}remove(g,v=null){return this===g?v?(v.next=this.next,v):this.next:this.next?.remove(g,this)??null}get last(){return this.next?this.next.last:this}}class L{constructor(g){this._head=null,(0,M.Wi)(g)||(this._head=new b(g))}get head(){return this._head}maxAvailableSpace(){if((0,M.Wi)(this._head))return 0;const g=this._head.max(v=>v.end-v.start);return g.data.end-g.data.start}firstFit(g){if((0,M.Wi)(this._head))return null;let v=null,I=this._head;for(;I;){const B=I.data.end-I.data.start;if(B===g)return v?v.next=I.next:this._head=I.next,I.data.start;if(B>g){const _=I.data.start;return I.data.start+=g,_}v=I,I=I.next}return null}free(g,v){const I=g+v;if((0,M.Wi)(this._head)){const D=new b({start:g,end:I});return void(this._head=D)}if(I<=this._head.data.start){if(I===this._head.data.start)return void(this._head.data.start-=v);const D=new b({start:g,end:I});return D.next=this._head,void(this._head=D)}let B=this._head,_=B.next;for(;_;){if(_.data.start>=I){if(B.data.end===g)return B.data.end+=v,B.data.end===_.data.start?(B.data.end+=_.data.end-_.data.start,void(B.next=_.next)):void 0;if(_.data.start===I)return void(_.data.start-=v);const D=new b({start:g,end:I});return D.next=B.next,void(B.next=D)}B=_,_=_.next}if(g===B.data.end)return void(B.data.end+=v);const T=new b({start:g,end:I});B.next=T}}},50885:(lt,U,u)=>{u.d(U,{k:()=>dt});var M=u(32995),b=u(28191),L=u(53661),y=u(20753),g=u(5692),v=u(95223);const B=G=>`#define ${(G=>G.replace("-","_").toUpperCase())(G)}\n`;function _(G){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:B(G)+(0,v.w)("blend/blend.vert"),fragmentShader:B(G)+(0,v.w)("blend/blend.frag")}}}var T=u(69923),D=u(74697);const Y=b.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class dt{constructor(){this._size=[0,0]}dispose(S){this._backBufferTexture=(0,L.M2)(this._backBufferTexture),this._quad=(0,L.M2)(this._quad)}draw(S,V,N,P,tt){const{context:R,drawPhase:Q}=S;if(this._setupShader(R),P&&"normal"!==P&&Q!==y.jx.LABEL)return void this._drawBlended(S,V,N,P,tt);const ot=_("normal"),j=R.programCache.acquire(ot.shaders.vertexShader,ot.shaders.fragmentShader,ot.attributes);if(!j)return void Y.error(new M.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));R.useProgram(j),V.setSamplingMode(N),R.bindTexture(V,0),j.setUniform1i("u_layerTexture",0),j.setUniform1f("u_opacity",tt),R.setBlendingEnabled(!0),R.setBlendFunction(T.zi.ONE,T.zi.ONE_MINUS_SRC_ALPHA);const X=this._quad;X.draw(),X.unbind(),j.dispose()}_drawBlended(S,V,N,P,tt){const{context:R,state:Q,pixelRatio:ot,inFadeTransition:j}=S,{size:X}=Q,vt=R.getBoundFramebufferObject();let mt,H;if((0,L.pC)(vt)){const wt=vt.descriptor;mt=wt.width,H=wt.height}else mt=Math.round(ot*X[0]),H=Math.round(ot*X[1]);this._createOrResizeTexture(S,mt,H);const yt=this._backBufferTexture;vt.copyToTexture(0,0,mt,H,0,0,yt),R.setStencilTestEnabled(!1),R.setStencilWriteMask(0),R.setBlendingEnabled(!0),R.setDepthTestEnabled(!1),R.setDepthWriteEnabled(!1);const ht=_(P),nt=R.programCache.acquire(ht.shaders.vertexShader,ht.shaders.fragmentShader,ht.attributes);if(!nt)return void Y.error(new M.Z("mapview-BlendEffect",`Error creating shader program for blend mode ${P}`));R.useProgram(nt),yt.setSamplingMode(N),R.bindTexture(yt,0),nt.setUniform1i("u_backbufferTexture",0),V.setSamplingMode(N),R.bindTexture(V,1),nt.setUniform1i("u_layerTexture",1),nt.setUniform1f("u_opacity",tt),nt.setUniform1f("u_inFadeOpacity",j?1:0),R.setBlendFunction(T.zi.ONE,T.zi.ZERO);const Mt=this._quad;Mt.draw(),Mt.unbind(),nt.dispose(),R.setBlendFunction(T.zi.ONE,T.zi.ONE_MINUS_SRC_ALPHA)}_setupShader(S){this._quad||(this._quad=new g.Z(S,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(S,V,N){const{context:P}=S;null!==this._backBufferTexture&&V===this._size[0]&&N===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(V,N):this._backBufferTexture=new D.x(P,{target:T.No.TEXTURE_2D,pixelFormat:T.VI.RGBA,internalFormat:T.VI.RGBA,dataType:T.Br.UNSIGNED_BYTE,wrapMode:T.e8.CLAMP_TO_EDGE,samplingMode:T.cw.LINEAR,flipped:!1,width:V,height:N}),this._size[0]=V,this._size[1]=N)}}},50138:(lt,U,u)=>{u.d(U,{Q:()=>b});var M=u(95223);const b={shaders:{vertexShader:(0,M.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,M.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},64257:(lt,U,u)=>{u.d(U,{C:()=>b,y:()=>L});var M=u(95223);const b={shaders:{vertexShader:(0,M.w)("highlight/textured.vert"),fragmentShader:(0,M.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},L={shaders:{vertexShader:(0,M.w)("highlight/textured.vert"),fragmentShader:(0,M.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},59691:(lt,U,u)=>{u.d(U,{F:()=>y,c:()=>L});var M=u(95223),b=u(6156);const L={shaders:{vertexShader:(0,M.w)("magnifier/magnifier.vert"),fragmentShader:(0,M.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function y(g){return(0,b.H)(g,L)}},68211:(lt,U,u)=>{u.d(U,{H:()=>b});var M=u(95223);const b={shaders:{vertexShader:(0,M.w)("stencil/stencil.vert"),fragmentShader:(0,M.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},64657:(lt,U,u)=>{u.d(U,{Z:()=>p});var M=u(71670),b=u(18100),L=u(50231),y=u(6365),g=u(53661),v=u(9497),_=(u(83382),u(19420),u(20891)),T=u(35787),D=u(63056),Y=u(55798),dt=u(88682);const G="esri-zoom-box",S={container:`${G}__container`,overlay:`${G}__overlay`,background:`${G}__overlay-background`,box:`${G}__outline`};let N=class extends y.Z{constructor(e){super(e),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._handles=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(e){this._handles&&this._handles.forEach(i=>{i.remove()}),this._handles=null,this._destroyOverlay(),this._set("view",e),e&&(e.on("drag",["Shift"],i=>this._handleDrag(i,1),dt.f.INTERNAL),e.on("drag",["Shift","Ctrl"],i=>this._handleDrag(i,-1),dt.f.INTERNAL))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(e,i,a,r){this._box.x=e,this._box.y=i,this._box.width=a,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(e,i,a,r,d){const m=this.view,C=m.toMap((0,Y.vW)(e+.5*a,i+.5*r));let z=Math.max(a/m.width,r/m.height);-1===d&&(z=1/z),this._destroyOverlay(),this.navigation.end(),m.goTo({center:C,scale:m.scale*z})}_updateBox(e,i,a,r){const d=this._boxShape;d.setAttributeNS(null,"x",""+e),d.setAttributeNS(null,"y",""+i),d.setAttributeNS(null,"width",""+a),d.setAttributeNS(null,"height",""+r),d.setAttributeNS(null,"class",S.box)}_updateBackground(e,i,a,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,i,a,r,this.view.width,this.view.height))}_createContainer(){const e=document.createElement("div");e.className=S.container,this.view.root.appendChild(e),this._container=e}_createOverlay(){const e=this.view.width,i=this.view.height,a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+i+" L 0 "+i+" Z"),a.setAttributeNS(null,"class",S.background);const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),d.setAttributeNS(null,"class",S.overlay),d.appendChild(a),d.appendChild(r),this._container.appendChild(d),this._backgroundShape=a,this._boxShape=r,this._overlay=d}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(e,i,a,r,d,m){const C=e+a,z=i+r;return"M 0 0 L "+d+" 0 L "+d+" "+m+" L 0 "+m+" ZM "+e+" "+i+" L "+e+" "+z+" L "+C+" "+z+" L "+C+" "+i+" Z"}_handleDrag(e,i){const a=e.x,r=e.y,d=e.origin.x,m=e.origin.y;let C,z,E,A;switch(a>d?(C=d,E=a-d):(C=a,E=d-a),r>m?(z=m,A=r-m):(z=r,A=m-r),e.action){case"start":this._start();break;case"update":this._update(C,z,E,A);break;case"end":this._end(C,z,E,A,i)}e.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:e,y:i,width:a,height:r}=this._box;this._updateBox(e,i,a,r),this._updateBackground(e,i,a,r),this._rafId=requestAnimationFrame(this._redraw)}};(0,b._)([(0,v.Cb)()],N.prototype,"navigation",void 0),(0,b._)([(0,v.Cb)()],N.prototype,"view",null),N=(0,b._)([(0,_.j)("esri.views.2d.navigation.ZoomBox")],N);const P=N;u(6010);var R=u(7521),Q=u(92950),ot=u(77765);class j{constructor(i){this._gain=i,this.lastValue=void 0,this.filteredDelta=void 0}update(i){if(this.hasLastValue()){const a=this.computeDelta(i);this._updateDelta(a)}this.lastValue=i}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(i){return void 0===this.lastValue?NaN:i-this.lastValue}_updateDelta(i){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*i:i}}class X{constructor(i,a,r){this._initialVelocity=i,this._stopVelocity=a,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(i){return i>this.duration}get friction(){return this._friction}value(i){return this.valueFromInitialVelocity(this._initialVelocity,i)}valueDelta(i,a){const r=this.value(i);return this.value(i+a)-r}valueFromInitialVelocity(i,a){a=Math.min(a,this.duration);const r=1-this.friction;return i*(r**a-1)/Math.log(r)}}class vt extends X{constructor(i,a,r,d,m){super(i,a,r),this._sceneVelocity=d,this.direction=m}value(i){return super.valueFromInitialVelocity(this._sceneVelocity,i)}}class mt{constructor(i=300,a=12,r=.84){this._minimumInitialVelocity=i,this._stopVelocity=a,this._friction=r,this.enabled=!0,this._time=new j(.6),this._screen=[new j(.4),new j(.4)],this._scene=[new j(.6),new j(.6),new j(.6)],this._tmpDirection=(0,ot.c)()}add(i,a,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(i[0]),this._screen[1].update(i[1]),this._scene[0].update(a[0]),this._scene[1].update(a[1]),this._scene[2].update(a[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const i=this._screen[0].filteredDelta,a=this._screen[1].filteredDelta,r=null==i||null==a?0:Math.sqrt(i*i+a*a),d=this._time.filteredDelta,m=null==d||null==r?0:r/d;return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(i,a,r){(0,Q.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const d=(0,Q.l)(this._tmpDirection);d>0&&(0,Q.g)(this._tmpDirection,this._tmpDirection,1/d);const m=this._time.filteredDelta;return new vt(i,a,r,null==m?0:d/m,this._tmpDirection)}}let H=class extends y.Z{constructor(e){super(e),this.animationTime=0,this.momentumEstimator=new mt(500,6,.92),this.momentum=null,this.tmpMomentum=(0,ot.c)(),this.momentumFinished=!1,this.viewpoint=new L.Z({targetGeometry:new T.Z,scale:0,rotation:0}),this._previousDrag=null,(0,R.gx)(()=>this.momentumFinished,()=>this.navigation.stop())}begin(e,i){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(i),this._previousDrag=i}update(e,i){this.addToEstimator(i);let a=i.center.x,r=i.center.y;const d=this._previousDrag;a=d?d.center.x-a:-a,r=d?r-d.center.y:r,e.viewpoint=(0,D.Rx)(this.viewpoint,e.viewpoint,[a||0,r||0]),this._previousDrag=i}end(e,i){this.addToEstimator(i),this.momentum=e.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this._previousDrag=null,this.navigation.end()}addToEstimator(e){const i=e.center.x,a=e.center.y,r=(0,Y.s1)(-i,a),d=(0,ot.f)(-i,a,0);this.momentumEstimator.add(r,d,.001*e.timestamp)}onAnimationUpdate(e){this.navigation.animationManager?.animateContinous(e.viewpoint,(i,a)=>{const{momentum:r,animationTime:d,tmpMomentum:m}=this,C=.001*a;if(!(this.momentumFinished=!r||r.isFinished(d))){const z=r.valueDelta(d,C);(0,Q.g)(m,r.direction,z),(0,D.Rx)(i,i,m),e.constraints.constrainByGeometry(i)}this.animationTime+=C})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,b._)([(0,v.Cb)()],H.prototype,"momentumFinished",void 0),(0,b._)([(0,v.Cb)()],H.prototype,"viewpoint",void 0),(0,b._)([(0,v.Cb)()],H.prototype,"navigation",void 0),H=(0,b._)([(0,_.j)("esri.views.2d.navigation.actions.Pan")],H);const yt=H;var ht=u(80775),nt=u(83457),Mt=u(93142);class wt{constructor(i=2.5,a=.01,r=.95,d=12){this._minimumInitialVelocity=i,this._stopVelocity=a,this._friction=r,this._maxVelocity=d,this.enabled=!0,this.value=new j(.8),this.time=new j(.3)}add(i,a){if(this.enabled&&null!=a){if(this.time.hasLastValue()){if(this.time.computeDelta(a)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(i);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(a),this.value.update(i)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let i=this.value.filteredDelta/this.time.filteredDelta;return i=(0,Mt.uZ)(i,-this._maxVelocity,this._maxVelocity),Math.abs(i)<this._minimumInitialVelocity?null:this.createMomentum(i,this._stopVelocity,this._friction)}createMomentum(i,a,r){return new X(i,a,r)}}class xt extends wt{constructor(i=3,a=.01,r=.95,d=12){super(i,a,r,d)}add(i,a){const r=this.value.lastValue;if(null!=r){let d=i-r;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;i=r+d}super.add(i,a)}}class St extends X{constructor(i,a,r){super(i,a,r)}value(i){const a=super.value(i);return Math.exp(a)}valueDelta(i,a){const r=super.value(i),d=super.value(i+a)-r;return Math.exp(d)}}class Tt extends wt{constructor(i=2.5,a=.01,r=.95,d=12){super(i,a,r,d)}add(i,a){super.add(Math.log(i),a)}createMomentum(i,a,r){return new St(i,a,r)}}let et=class extends y.Z{constructor(e){super(e),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new xt(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new Tt,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new L.Z({targetGeometry:new T.Z,scale:0,rotation:0}),this.addHandles((0,R.gx)(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(e,i){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=i.angle,this._previousRadius=this._startRadius=i.radius,this._previousCenter=i.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,i.timestamp),this.addToZoomEstimator(i,1)}update(e,i){null===this._updateTimestamp&&(this._updateTimestamp=i.timestamp);const a=i.angle,r=i.radius,d=i.center,m=Math.abs(180*(a-this._startAngle)/Math.PI),C=Math.abs(r-this._startRadius),z=this._startRadius/r;if(this._previousRadius&&this._previousCenter){const E=r/this._previousRadius;let A=180*(a-this._previousAngle)/Math.PI;this._rotationDirection=A>=0?1:-1,this._zoomDirection=E>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&i.timestamp-this._updateTimestamp>200&&(this._zoomOnly=C-m>0),null===this._zoomOnly||this._zoomOnly?A=0:this.addToRotateEstimator(a-this._startAngle,i.timestamp)):A=0,this.addToZoomEstimator(i,z),this.navigation.setViewpoint([d.x,d.y],1/E,A,[this._previousCenter.x-d.x,d.y-this._previousCenter.y])}this._previousAngle=a,this._previousRadius=r,this._previousCenter=d}end(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}addToRotateEstimator(e,i){this._rotationMomentumEstimator.add(e,.001*i)}addToZoomEstimator(e,i){this._zoomMomentumEstimator.add(i,.001*e.timestamp)}canZoomIn(e){const a=e.constraints.effectiveMaxScale;return 0===a||e.scale>a}canZoomOut(e){const a=e.constraints.effectiveMinScale;return 0===a||e.scale<a}onAnimationUpdate(e){this.navigation.animationManager?.animateContinous(e.viewpoint,(i,a)=>{const r=!this.canZoomIn(e)&&this._zoomDirection>1||!this.canZoomOut(e)&&this._zoomDirection<1,d=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),m=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),C=.001*a;if(this._momentumFinished=d&&m,!this._momentumFinished){const z=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,C))*this._rotationDirection*180/Math.PI:0;let E=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,C)):1;const A=(0,nt.a)(),k=(0,nt.a)();if(this._previousCenter){(0,ht.s)(A,this._previousCenter.x,this._previousCenter.y),(0,D.Dq)(k,e.size,e.padding),(0,ht.j)(A,A,k);const{constraints:W,scale:K}=e,it=K*E;E<1&&!W.canZoomInTo(it)?(E=K/W.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):E>1&&!W.canZoomOutTo(it)&&(E=K/W.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,D.UZ)(i,e.viewpoint,E,z,A,e.size),e.constraints.constrainByGeometry(i)}}this._animationTime+=C})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,b._)([(0,v.Cb)()],et.prototype,"_momentumFinished",void 0),(0,b._)([(0,v.Cb)()],et.prototype,"viewpoint",void 0),(0,b._)([(0,v.Cb)()],et.prototype,"navigation",void 0),et=(0,b._)([(0,_.j)("esri.views.2d.navigation.actions.Pinch")],et);const _t=et,ut=(0,nt.a)(),$=(0,nt.a)();let J=class extends y.Z{constructor(e){super(e),this._previousCenter=(0,nt.a)(),this.viewpoint=new L.Z({targetGeometry:new T.Z,scale:0,rotation:0})}begin(e,i){this.navigation.begin(),(0,ht.s)(this._previousCenter,i.center.x,i.center.y)}update(e,i){const{state:{size:a,padding:r}}=e;(0,ht.s)(ut,i.center.x,i.center.y),(0,D.ni)($,a,r),e.viewpoint=(0,D.$H)(this.viewpoint,e.state.paddedViewState.viewpoint,(0,D.dI)($,this._previousCenter,ut)),(0,ht.c)(this._previousCenter,ut)}end(){this.navigation.end()}};(0,b._)([(0,v.Cb)()],J.prototype,"viewpoint",void 0),(0,b._)([(0,v.Cb)()],J.prototype,"navigation",void 0),J=(0,b._)([(0,_.j)("esri.views.2d.actions.Rotate")],J);const It=J,Dt=new L.Z({targetGeometry:new T.Z}),zt=[0,0];let rt=class extends y.Z{constructor(e){super(e),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new yt({navigation:this}),this.rotate=new It({navigation:this}),this.pinch=new _t({navigation:this}),this.zoomBox=new P({view:this.view,navigation:this})}destroy(){this.pan=(0,g.SC)(this.pan),this.rotate=(0,g.SC)(this.rotate),this.pinch=(0,g.SC)(this.pinch),this.zoomBox=(0,g.SC)(this.zoomBox),this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}zoom(e,i=this._getDefaultAnchor()){var a=this;return(0,M.Z)(function*(){if(a.stop(),a.begin(),a.view.constraints.snapToZoom&&a.view.constraints.effectiveLODs)return e<1?a.zoomIn(i):a.zoomOut(i);a.setViewpoint(i,e,0,[0,0])})()}zoomIn(e){var i=this;return(0,M.Z)(function*(){const a=i.view,r=a.constraints.snapToNextScale(a.scale);return i._zoomToScale(r,e)})()}zoomOut(e){var i=this;return(0,M.Z)(function*(){const a=i.view,r=a.constraints.snapToPreviousScale(a.scale);return i._zoomToScale(r,e)})()}setViewpoint(e,i,a,r){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,i,a,r),this.end()}setViewpointImmediate(e,i=0,a=[0,0],r=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,e,i,a)}continousRotateClockwise(){const e=this.get("view.viewpoint");this.animationManager?.animateContinous(e,i=>{(0,D.$H)(i,i,-1)})}continousRotateCounterclockwise(){const e=this.get("view.viewpoint");this.animationManager?.animateContinous(e,i=>{(0,D.$H)(i,i,1)})}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(e){const i=this.view.viewpoint;this.animationManager?.animateContinous(i,a=>{(0,D.Rx)(a,a,e),this.view.constraints.constrainByGeometry(a)})}_startTimer(e){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const i=performance.now()-(this._lastEventTimestamp??0);i<250?this._endTimer=this._startTimer(i):this._set("interacting",!1)},e)),this._endTimer}_getDefaultAnchor(){const{size:e,padding:{left:i,right:a,top:r,bottom:d}}=this.view;return zt[0]=.5*(e[0]-a+i),zt[1]=.5*(e[1]-d+r),zt}_zoomToScale(e,i=this._getDefaultAnchor()){var a=this;return(0,M.Z)(function*(){const{view:r}=a,{constraints:d,scale:m,viewpoint:C,size:z,padding:E}=r,A=d.canZoomInTo(e),k=d.canZoomOutTo(e);if(!(e<m&&!A||e>m&&!k))return(0,D.gG)(Dt,C,e/m,0,i,z,E),d.constrainByGeometry(Dt),r.goTo(Dt,{animate:!0})})()}_scaleRotateTranslateViewpoint(e,i,a,r,d){const{view:m}=this,{size:C,padding:z,constraints:E,scale:A,viewpoint:k}=m,W=A*a,K=E.canZoomInTo(W),it=E.canZoomOutTo(W);return(a<1&&!K||a>1&&!it)&&(a=1),(0,D.Rx)(k,k,d),(0,D.gG)(e,k,a,r,i,C,z),E.constrainByGeometry(e)}};(0,b._)([(0,v.Cb)()],rt.prototype,"animationManager",void 0),(0,b._)([(0,v.Cb)({type:Boolean,readOnly:!0})],rt.prototype,"interacting",void 0),(0,b._)([(0,v.Cb)()],rt.prototype,"pan",void 0),(0,b._)([(0,v.Cb)()],rt.prototype,"pinch",void 0),(0,b._)([(0,v.Cb)()],rt.prototype,"rotate",void 0),(0,b._)([(0,v.Cb)()],rt.prototype,"view",void 0),(0,b._)([(0,v.Cb)()],rt.prototype,"zoomBox",void 0),rt=(0,b._)([(0,_.j)("esri.views.2d.navigation.MapViewNavigation")],rt);const p=rt}}]);
//# sourceMappingURL=366.ad6753970763339a.js.map