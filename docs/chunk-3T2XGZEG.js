import{a as Ye}from"./chunk-MMIGPO7Y.js";import{a as ze}from"./chunk-MQY7VQHY.js";import{a as We}from"./chunk-BMCF6H6E.js";import{a as Xe}from"./chunk-7ANSU654.js";import"./chunk-WPAM5E2U.js";import"./chunk-YF5MWJQS.js";import{$b as Fe,Ab as L,Ac as He,Bc as $e,C as E,Eb as B,Fb as Pe,Lb as we,Mb as ye,Nb as Oe,Nc as Ke,Oc as Ue,Sb as q,Tb as H,Yb as $,Zb as Me,_b as Ee,c as _e,e as Ce,g as ve,gc as Te,hc as ke,i as V,ib as Se,ic as Ne,jc as Ve,kb as D,kc as De,lc as Ge,mb as xe,mc as Ie,nc as Re,nd as j,ob as G,od as Q,pb as I,qc as Ae,rb as S,rc as K,sb as u,sc as Le,sd as je,tc as U,td as Qe,ub as R,ud as Je,xb as A,yb as be,yc as Be,zc as qe}from"./chunk-LAD3HRCK.js";import{$a as ae,$b as m,Ab as le,Bb as z,Ca as ie,Cb as W,Db as f,Dc as ge,Eb as i,Fb as a,Gb as h,Hb as P,Ib as w,Jb as T,Kb as y,Nb as d,Ob as v,Vb as ce,Wa as p,Wb as me,Xb as O,ac as M,ba as re,gb as F,ha as g,hc as pe,ib as se,ic as k,jc as de,lb as b,lc as he,ma as _,mc as fe,na as C,qa as ne,qc as N,r as ee,v as te,x as oe,xc as ue,yb as X,zb as Y}from"./chunk-BPFPFXGP.js";import{a as J}from"./chunk-OY7QI42D.js";var tt={provide:Se,useExisting:re(()=>Z),multi:!0},Z=(()=>{let s=class s{constructor(){this.renderer=g(ae),this.elementRef=g(ie),this.threeStateEnabled=!1,this.onChange=e=>{},this.onTouched=()=>{}}hostChange(e){this.threeStateEnabled?(this.value=this.value===!0?!1:this.value===!1?null:!0,this.setCheckboxState()):this.value=this.elementRef.nativeElement.checked,this.onChange(this.value),this.onTouched()}hostBlur(){this.onTouched()}set threeState(e){this.threeStateEnabled!==e&&(this.threeStateEnabled=e,!this.threeStateEnabled&&this.elementRef.nativeElement.indeterminate&&(this.renderer.setProperty(this.elementRef.nativeElement,"indeterminate",!1),this.value=!1),this.setCheckboxState())}writeValue(e){this.value!==e&&(this.value=e,this.setCheckboxState())}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.renderer.setProperty(this.elementRef.nativeElement,"disabled",e)}setCheckboxState(){this.threeStateEnabled?this.value===!0?(this.renderer.setProperty(this.elementRef.nativeElement,"indeterminate",!1),requestAnimationFrame(()=>{this.renderer.setProperty(this.elementRef.nativeElement,"checked",!0)})):this.value===!1?(this.renderer.setProperty(this.elementRef.nativeElement,"indeterminate",!1),requestAnimationFrame(()=>{this.renderer.setProperty(this.elementRef.nativeElement,"checked",!1)})):(this.renderer.setProperty(this.elementRef.nativeElement,"checked",!1),requestAnimationFrame(()=>{this.renderer.setProperty(this.elementRef.nativeElement,"indeterminate",!0)})):this.renderer.setProperty(this.elementRef.nativeElement,"checked",!!this.value)}};s.\u0275fac=function(o){return new(o||s)},s.\u0275dir=se({type:s,selectors:[["forge-checkbox","formControlName",""],["forge-checkbox","formControl",""],["forge-checkbox","ngModel",""]],hostBindings:function(o,t){o&1&&d("change",function(l){return t.hostChange(l)})("blur",function(){return t.hostBlur()})},inputs:{threeState:[2,"threeState","threeState",ge]},features:[pe([tt])]});let n=s;return n})();var et=(()=>{let s=class s{constructor(){this.dialogConfig=g(Ve),this.dialogRef=g(De),this.formGroup=new S({name:new u(null,{validators:[xe.required]}),description:new u,isDefault:new u,isPublic:new u})}ngOnInit(){this.record=this.dialogConfig,this.formGroup.patchValue(this.record)}onSave(){this.dialogRef.close(J(J({},this.record),this.formGroup.getRawValue()))}onCancel(){this.formGroup.markAsPristine(),this.dialogRef.close(!1)}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=F({type:s,selectors:[["app-search-save"]],decls:22,vars:3,consts:[["dialogTitle","Save search",3,"dialogClose"],["novalidate","","autocomplete","off",1,"form-grid",3,"formGroup"],["required","",3,"appFormControlInvalid"],["type","text","id","search-save--name","formControlName","name","autofocus",""],["for","search-save--name","slot","label"],["slot","support-text",1,"app--form-control-invalid"],["type","text","id","search-save--description","formControlName","description"],["for","search-save--description","slot","label"],["formControlName","isDefault"],["formControlName","isPublic"],["app-dialog-footer",""],["slot","end","variant","outlined",3,"click"],["slot","end","variant","raised",3,"click","disabled"]],template:function(o,t){o&1&&(i(0,"app-dialog-template",0),d("dialogClose",function(){return t.onCancel()}),i(1,"form",1)(2,"forge-text-field",2),h(3,"input",3),i(4,"label",4),m(5,"Name"),a(),i(6,"span",5),m(7,"A name is required"),a()(),i(8,"forge-text-field"),h(9,"input",6),i(10,"label",7),m(11,"Description"),a()(),i(12,"div")(13,"forge-checkbox",8),m(14," Make this your default search "),a(),i(15,"forge-checkbox",9),m(16," Make this search public "),a()()(),P(17,10),i(18,"forge-button",11),d("click",function(){return t.onCancel()}),m(19,"Cancel"),a(),i(20,"forge-button",12),d("click",function(){return t.onSave()}),m(21,"Save"),a(),w(),a()),o&2&&(p(),f("formGroup",t.formGroup),p(),f("appFormControlInvalid",t.formGroup.controls.name),p(18),f("disabled",t.formGroup.invalid||!t.formGroup.dirty))},dependencies:[V,B,R,D,G,I,A,L,H,q,Fe,Ee,$,U,K,Q,j,ze,Ye],styles:[`[_nghost-%COMP%]{display:contents}.form-grid[_ngcontent-%COMP%]{padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.form-grid--row-break[_ngcontent-%COMP%]{grid-column-start:1}.form-grid--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.form-grid--col-span.form-grid--col-span[_ngcontent-%COMP%]{width:auto}.form-grid--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.form-grid--col-span2.form-grid--col-span2[_ngcontent-%COMP%]{width:656px}.form-grid--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.form-grid--col-span3.form-grid--col-span3[_ngcontent-%COMP%]{width:992px}.form-grid[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}






/*# sourceMappingURL=search-save.component-YPH6SSLG.css.map */`]});let n=s;return n})();var nt=["searchesPopover"],it=()=>({name:"name"}),at=()=>({name:"dateOfBirth"}),st=()=>({name:"address"}),lt=n=>({"operator__addon--selected":n}),ct=(n,s)=>s.id;function mt(n,s){if(n&1&&(h(0,"forge-divider",30),i(1,"span",31),m(2),a(),i(3,"span",32),m(4),a()),n&2){let c=v();p(2),M(c.searchName),p(2),M(c.searchDescription)}}function pt(n,s){if(n&1){let c=y();i(0,"forge-list-item",35)(1,"button",34),m(2),a(),i(3,"div",8)(4,"forge-icon-button",36),d("mousedown",function(o){let t=_(c).$implicit,r=v(2);return C(r.onSearchAction(o,"edit",t.id))}),h(5,"forge-icon",37),a(),i(6,"forge-icon-button",38),d("mousedown",function(o){let t=_(c).$implicit,r=v(2);return C(r.onSearchAction(o,"delete",t.id))}),h(7,"forge-icon",39),a()()()}if(n&2){let c=s.$implicit;f("value",c.id),p(2),M(c.name)}}function dt(n,s){if(n&1){let c=y();i(0,"forge-list",33),d("forge-list-item-select",function(o){_(c);let t=v();return C(t.onSearchAction(o,"search",o.detail.value))}),i(1,"forge-list-item")(2,"button",34),m(3,"Add new search"),a()(),h(4,"forge-divider"),z(5,pt,8,2,"forge-list-item",35,ct),a()}if(n&2){let c=v();p(5),W(c.searchCache.searches)}}function ht(n,s){n&1&&T(0)}function ft(n,s){n&1&&T(0)}function ut(n,s){n&1&&T(0)}function gt(n,s){if(n&1){let c=y();i(0,"forge-icon-button",40,4),d("click",function(o){let t=_(c).name,r=O(1),l=v();return C(l.onOperatorPopoverOpen(o,r,t))}),h(2,"forge-icon",41),a()}if(n&2){let c,e=s.name,o=v(),t=O(51);f("ngClass",de(2,lt,(c=o.formGroup.get(e))==null?null:c.value.operator))("forgePopover",t)}}function _t(n,s){n&1&&h(0,"forge-icon",44)}function Ct(n,s){if(n&1&&(i(0,"forge-list-item",43)(1,"button",34),m(2),a(),X(3,_t,1,0,"forge-icon",44),a()),n&2){let c=s.$implicit,e=v(2);f("value",c.value)("selected",(e.operatorPopoverFormGroup==null?null:e.operatorPopoverFormGroup.value.operator)===c.value),p(2),M(c.label),p(),Y((e.operatorPopoverFormGroup==null?null:e.operatorPopoverFormGroup.value.operator)===c.value?3:-1)}}function vt(n,s){if(n&1){let c=y();i(0,"forge-list",42),d("forge-list-item-select",function(o){_(c);let t=v();return C(t.onOperatorSelected(o.detail.value))}),z(1,Ct,4,4,"forge-list-item",43,le),a()}if(n&2){let c=v();p(),W(c.operatorOptions)}}var Xt=(()=>{let s=class s{constructor(){this.destroyRef=g(ne),this.dialogService=g(Ge),this.toastService=g(je),this.dataService=g(Xe),this.searchesPopover=ue("searchesPopover"),this.storageKey="search-searches",this.searchCache={activeSearchId:void 0,searches:[]},this.formGroup=new S({name:new S({value:new u,operator:new u}),dateOfBirth:new S({value:new u,operator:new u}),address:new S({value:new u,operator:new u}),include:new u,facet:new u}),this.facetOptions=[],this.operatorOptions=[{value:null,label:"None"},{value:0,label:"Equal"},{value:1,label:"Not equal"},{value:2,label:"Greater than"},{value:3,label:"Less than"},{value:4,label:"Greater than equal to"},{value:5,label:"Less than equal to"},{value:6,label:"Range"},{value:7,label:"Contains"},{value:8,label:"Not contains"},{value:9,label:"Empty"}],this.nameFilter=e=>te(this.dataService.getPeople().pipe(oe(o=>o.data.filter(t=>t.firstName.toLocaleLowerCase().includes(e.toLocaleLowerCase())||t.lastName.toLocaleLowerCase().includes(e.toLocaleLowerCase())).map(t=>({label:`${t.firstName} ${t.lastName}`,value:t.id}))))),this.facetFilter=e=>ee(this.facetOptions)}ngOnInit(){this.dataService.getSearches(this.storageKey).pipe(Pe(this.destroyRef)).subscribe({next:e=>{this.searchCache.searches=e||[];let o=this.searchCache.searches.find(t=>t.id===this.searchCache.activeSearchId);E(o)&&(this.searchName=o?.name,this.searchDescription=o?.description,this.formGroup.patchValue(o?.filters))}});for(let e=0;e<20;e++)this.facetOptions.push({value:e,label:`Facet Option ${e}`})}onSearch(){}onSaveSearch(e){let o=E(e)?e:this.searchCache.searches.find(r=>r.id===this.searchCache.activeSearchId),t={id:o?.id,name:o?.name,description:o?.description,isDefault:o?.isDefault,isPublic:o?.isPublic,filters:this.formGroup.value};this.dialogService.open(et,{data:t,options:{persistent:!0}}).afterClosed.subscribe({next:r=>{if(r){if(E(r.id)){let l=this.searchCache.searches.findIndex(x=>x.id===r.id);l!==-1&&(this.searchCache.searches[l]=r)}else r.id=this.searchCache.searches.length?Math.max(...this.searchCache.searches.map(l=>l.id))+1:1,this.searchCache.searches.push(r);this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:()=>{this.searchCache.activeSearchId=r.id,this.searchName=r.name,this.searchDescription=r.description,this.toastService.show({message:"Search saved"})},error:()=>this.toastService.show({message:"Search save failed"})})}}})}onClearSearch(){this.formGroup.controls.include.setValue(null),this.formGroup.reset()}onSearchAction(e,o,t){if(e.stopPropagation(),this.searchesPopover()?.close(),!E(t))this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="",this.formGroup.reset();else{let r=this.searchCache.searches.find(l=>l.id===t);if(E(r))switch(o){case"search":this.searchCache.activeSearchId=r?.id,this.searchName=r?.name,this.searchDescription=r?.description,this.formGroup.patchValue(r?.filters),this.onSearch();break;case"edit":this.searchCache.activeSearchId=r?.id,this.searchName=r?.name,this.searchDescription=r?.description,this.formGroup.patchValue(r?.filters);break;case"copy":{let l=JSON.parse(JSON.stringify(r));l.id=void 0,l.name=`${l.name} copy`,l.isDefault=!1,this.onSaveSearch(l);break}case"delete":{let l=this.searchCache.searches.findIndex(x=>x.id===r?.id);l!==-1&&(this.searchCache.searches.splice(l,1),this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:x=>{}})),this.searchCache.activeSearchId===r?.id&&(this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="");break}}}}onOperatorPopoverOpen(e,o,t){e.stopPropagation(),this.operatorPopoverFormGroup=this.formGroup.get(t),this.operatorPopover=o,this.operatorPopover.open()}onOperatorSelected(e){e=parseInt(e,10),this.operatorPopoverFormGroup?.get("operator")?.setValue(e),this.operatorPopover?.close()}};s.\u0275fac=function(o){return new(o||s)},s.\u0275cmp=F({type:s,selectors:[["app-search"]],viewQuery:function(o,t){o&1&&ce(t.searchesPopover,nt,5),o&2&&me()},decls:52,vars:18,consts:[["searchesPopover","forgePopover"],["searchesPopoverTemplate",""],["opertatorAddonTemplate",""],["operatorPopoverTemplate",""],["operatorPopover","forgePopover"],[1,"header"],["slot","start"],[1,"forge-typography--subheading4"],["slot","end"],["variant","outlined",3,"click"],["variant","outlined",3,"click","forgePopover","forgePopoverPlacement"],["name","arrow_drop_down"],["variant","raised",3,"click"],[1,"body"],["novalidate","","autocomplete","off",1,"form",3,"ngSubmit","formGroup"],["formGroupName","name"],["multiple","true","formControlName","value","allow-unmatched","true",3,"filter"],["type","text","id","search--name"],["for","search--name"],["slot","end","name","arrow_drop_down",1,"forge-dropdown-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["formGroupName","dateOfBirth"],["formControlName","value"],["type","text","id","search--date-of-birth"],["for","search--date-of-birth"],["formGroupName","address"],["type","text","id","search--address","formControlName","value"],["for","search--address","slot","label"],["formControlName","facet","label","Facet",3,"optionFilter"],["threeState","true","formControlName","include",2,"align-self","flex-end"],["vertical",""],[1,"forge-typography--heading2"],[1,"forge-typography--subheading1"],[1,"searches-popover",3,"forge-list-item-select"],["type","button"],[3,"value"],["aria-label","Edit",3,"mousedown"],["name","edit"],["aria-label","Delete",3,"mousedown"],["name","delete"],["slot","addon-end","density","medium","aria-label","Filter operator",1,"operator__addon",3,"click","ngClass","forgePopover"],["name","bolt"],[1,"operator-popover",3,"forge-list-item-select"],[3,"value","selected"],["name","check","slot","end"]],template:function(o,t){if(o&1){let r=y();i(0,"forge-toolbar",5)(1,"div",6)(2,"h2",7),m(3,"Search"),a(),X(4,mt,5,2),a(),i(5,"div",8)(6,"forge-button",9),d("click",function(){return _(r),C(t.onSaveSearch())}),m(7,"Save search"),a(),i(8,"forge-button",10,0),d("click",function(){_(r);let x=O(9);return C(x.open())}),i(10,"span"),m(11,"Saved searches"),a(),h(12,"forge-icon",11),a(),i(13,"forge-button",9),d("click",function(){return _(r),C(t.onClearSearch())}),m(14,"Clear all"),a(),i(15,"forge-button",12),d("click",function(){return _(r),C(t.onSearch())}),m(16,"Search"),a()()(),b(17,dt,7,0,"ng-template",null,1,N),i(19,"div",13)(20,"form",14),d("ngSubmit",function(){return _(r),C(t.onSearch())}),P(21,15),i(22,"forge-autocomplete",16)(23,"forge-text-field"),h(24,"input",17),i(25,"label",18),m(26,"Name"),a(),h(27,"forge-icon",19),b(28,ht,1,0,"ng-container",20),a()(),w(),P(29,21),i(30,"forge-date-picker",22)(31,"forge-text-field"),h(32,"input",23),i(33,"label",24),m(34,"Date"),a(),b(35,ft,1,0,"ng-container",20),a()(),w(),P(36,25),i(37,"forge-text-field"),h(38,"input",26),i(39,"label",27),m(40,"Address"),a(),b(41,ut,1,0,"ng-container",20),a(),w(),h(42,"app-autocomplete-range",28),i(43,"forge-checkbox",29),m(44,"Include"),a()(),i(45,"p"),m(46),he(47,"json"),a()(),b(48,gt,3,4,"ng-template",null,2,N)(50,vt,3,0,"ng-template",null,3,N)}if(o&2){let r=O(18),l=O(49);p(4),Y(t.searchCache.activeSearchId?4:-1),p(4),f("forgePopover",r)("forgePopoverPlacement","bottom-start"),p(12),f("formGroup",t.formGroup),p(2),f("filter",t.nameFilter),p(6),f("ngTemplateOutlet",l)("ngTemplateOutletContext",k(15,it)),p(7),f("ngTemplateOutlet",l)("ngTemplateOutletContext",k(16,at)),p(6),f("ngTemplateOutlet",l)("ngTemplateOutletContext",k(17,st)),p(),f("optionFilter",t.facetFilter),p(4),M(fe(47,13,t.formGroup.getRawValue()))}},dependencies:[V,_e,Ce,ve,B,R,D,G,I,A,L,be,Oe,ye,we,H,q,Me,$,Ne,ke,Te,Re,Ie,U,Le,Ae,K,He,qe,$e,Be,Ue,Ke,Q,j,Je,Qe,We,Z],styles:[`[_nghost-%COMP%]{display:grid;grid-template-rows:auto 1fr;overflow:hidden}  .searches-popover{min-width:280px}  .searches-popover *[slot=trailing]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin-right:-16px}  .operator-popover{min-width:200px}  .operator-popover forge-list-item{cursor:pointer}.header[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.header[_ngcontent-%COMP%]   forge-button[_ngcontent-%COMP%]{margin-left:16px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   forge-divider[_ngcontent-%COMP%]{margin:0 16px;height:32px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:16px}.body[_ngcontent-%COMP%]{overflow:auto;padding:24px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{background-color:var(--forge-theme-surface);border-radius:var(--forge-shape-medium);border-color:var(--forge-theme-outline);box-shadow:var(--forge-elevation-1);padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.body[_ngcontent-%COMP%]   .form--row-break[_ngcontent-%COMP%]{grid-column-start:1}.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.body[_ngcontent-%COMP%]   .form--col-span.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{width:auto}.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.body[_ngcontent-%COMP%]   .form--col-span2.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{width:656px}.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.body[_ngcontent-%COMP%]   .form--col-span3.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{width:992px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}.operator__addon--selected[_ngcontent-%COMP%]{color:var(--forge-theme-info)}






/*# sourceMappingURL=search.component-74QTMNHV.css.map */`]});let n=s;return n})();export{Xt as SearchComponent};
//# sourceMappingURL=chunk-3T2XGZEG.js.map
