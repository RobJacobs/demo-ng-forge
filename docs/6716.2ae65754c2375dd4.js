"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[6716],{43503:(H,b,o)=>{o.d(b,{Z:()=>jt});var A=o(71670),u=o(18100),m=o(26763),T=o(6365),M=o(7521),D=o(9497),l=(o(83382),o(19420),o(20891)),n=o(53661),h=o(55798);function g(s){return"constant"===s.kind?s.value[0]:s.values[s.values.length-1]}function p(s){const t=s.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function f(s){if(!s.hasVisualVariables("size"))return{kind:"constant",value:[(0,h.F2)(s.trailWidth)]};const t=s.getVisualVariablesForType("size")[0],e=[],a=[];let i;if(t.stops){for(const r of t.stops)e.push(r.value),a.push((0,h.F2)(r.size));i=t.stops.length}else e.push(t.minDataValue,t.maxDataValue),a.push((0,h.F2)(t.minSize),(0,h.F2)(t.maxSize)),i=2;return{kind:"ramp",stops:e,values:a,count:i}}function S(s){if(!s.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=s.getVisualVariablesForType("opacity")[0],e=[],a=[];for(const i of t.stops)e.push(i.value),a.push(i.opacity);return{kind:"ramp",stops:e,values:a,count:t.stops.length}}function _(s,t,e,a){switch(t){case"int":s.setUniform1iv(e,a);break;case"float":s.setUniform1fv(e,a);break;case"vec2":s.setUniform2fv(e,a);break;case"vec3":s.setUniform3fv(e,a);break;case"vec4":s.setUniform4fv(e,a)}}function R(s,t,e,a){"constant"===a.kind?_(s,e,`u_${t}`,a.value):(_(s,"float",`u_${t}_stops`,a.stops),_(s,e,`u_${t}_values`,a.values),s.setUniform1i(`u_${t}_count`,a.count))}function B(s,t){return s===t||!(!(0,n.pC)(s)||!(0,n.pC)(t))&&s.equals(t)}function N(s,t){if(!function W(s,t){let e=!0;return e=e&&s.collisions===t.collisions,e=e&&s.density===t.density,e=e&&s.interpolate===t.interpolate,e=e&&s.lineCollisionWidth===t.lineCollisionWidth,e=e&&s.lineSpacing===t.lineSpacing,e=e&&s.maxTurnAngle===t.maxTurnAngle,e=e&&s.minSpeedThreshold===t.minSpeedThreshold,e=e&&s.segmentLength===t.segmentLength,e=e&&s.smoothing===t.smoothing,e=e&&s.velocityScale===t.velocityScale,e=e&&s.verticesPerLine===t.verticesPerLine,e}(s.simulationSettings,t.simulationSettings)||!B(s.timeExtent,t.timeExtent))return!1;let e=!0;return e=e&&s.loadImagery===t.loadImagery,e=e&&s.createFlowMesh===t.createFlowMesh,e=e&&s.color.kind===t.color.kind,e=e&&s.opacity.kind===t.opacity.kind,e=e&&s.size.kind===t.size.kind,e}var j=o(30801),z=o(10615),d=o(69923),q=o(74697),tt=o(19955),L=o(33269);class et{constructor(t){this._params=t,this.animated=!1}isCompatible(t){if(!(t instanceof et&&B(this._params.timeExtent,t._params.timeExtent)))return!1;let e=!0;return e=e&&this._params.loadImagery===t._params.loadImagery,e=e&&this._params.color.kind===t._params.color.kind,e=e&&this._params.opacity.kind===t._params.opacity.kind,e}load(t,e){var a=this;return(0,A.Z)(function*(){const{extent:i,size:r}=t;(0,j.k_)(e);const c=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e);return new ht(c,{color:a._params.color,opacity:a._params.opacity})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.bindTexture(a.texture,0),r.setUniform1i("u_texture",0),r.setUniform1f("u_Min",a.min),r.setUniform1f("u_Max",a.max),R(r,"color","vec4",this._params.color),R(r,"opacity","float",this._params.opacity),i.bindVAO(a.vertexArray),i.drawArrays(d.MX.TRIANGLE_STRIP,0,4)}}const Q=new Map;Q.set("a_position",0),Q.set("a_texcoord",1);const ct={geometry:[new L.G("a_position",2,d.g.UNSIGNED_SHORT,0,8),new L.G("a_texcoord",2,d.g.UNSIGNED_SHORT,4,8)]},dt={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:Q};class ht{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:a,height:i}=this._flowData,r=z.f.createVertex(e,d.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,a,0,1,1,0,i,0,0,a,i,1,0])),c=new tt.U(e,Q,ct,{geometry:r}),y=[];"ramp"===this._values.color.kind&&y.push("vvColor"),"ramp"===this._values.opacity.kind&&y.push("vvOpacity");const v=t.painter.materialManager.getProgram(dt,y);let U=1e6,k=-1e6;for(let C=0;C<i;C++)for(let I=0;I<a;I++)if(0!==this._flowData.mask[C*a+I]){const Y=this._flowData.data[2*(C*a+I)+0],$=this._flowData.data[2*(C*a+I)+1],J=Math.sqrt(Y*Y+$*$);U=Math.min(U,J),k=Math.max(k,J)}const V=new Uint8Array(4*a*i);for(let C=0;C<i;C++)for(let I=0;I<a;I++)if(0!==this._flowData.mask[C*a+I]){const Y=this._flowData.data[2*(C*a+I)+0],$=this._flowData.data[2*(C*a+I)+1],J=(Math.sqrt(Y*Y+$*$)-U)/(k-U);V[4*(C*a+I)+0]=255*J,V[4*(C*a+I)+1]=0,V[4*(C*a+I)+2]=0,V[4*(C*a+I)+3]=255}else V[4*(C*a+I)+0]=0,V[4*(C*a+I)+1]=0,V[4*(C*a+I)+2]=0,V[4*(C*a+I)+3]=0;const Wt=new q.x(e,{pixelFormat:d.VI.RGBA,internalFormat:d.VI.RGBA,samplingMode:d.cw.LINEAR,dataType:d.Br.UNSIGNED_BYTE,wrapMode:d.e8.CLAMP_TO_EDGE,flipped:!0,width:a,height:i},V);this.vertexArray=c,this.program=v,this.texture=Wt,this.min=U,this.max=k,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}class at{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof at&&N(this._params,t._params)}load(t,e){var a=this;return(0,A.Z)(function*(){const{extent:i,size:r}=t;(0,j.k_)(e);const c=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e),{vertexData:y,indexData:v}=yield a._params.createFlowMesh("Particles",a._params.simulationSettings,c,e);return new mt(y,v,{color:a._params.color,opacity:a._params.opacity,size:a._params.size})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniform1f("u_time",e.time),r.setUniform1f("u_trailLength",this._params.trailLength),r.setUniform1f("u_flowSpeed",this._params.flowSpeed),r.setUniform1f("u_featheringSize",this._params.featheringSize),r.setUniform1f("u_featheringOffset",this._params.featheringOffset),r.setUniform1f("u_introFade",this._params.introFade?1:0),r.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),r.setUniform1f("u_decayRate",this._params.decayRate),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),r.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),R(r,"color","vec4",this._params.color),R(r,"opacity","float",this._params.opacity),R(r,"size","float",this._params.size),i.bindVAO(a.vertexArray),i.drawElements(d.MX.TRIANGLES,a.indexCount,d.g.UNSIGNED_INT,0)}}const G=new Map;G.set("a_xyts0",0),G.set("a_xyts1",1),G.set("a_typeIdDurationSeed",2),G.set("a_extrudeInfo",3);const ut={geometry:[new L.G("a_xyts0",4,d.g.FLOAT,0,64),new L.G("a_xyts1",4,d.g.FLOAT,16,64),new L.G("a_typeIdDurationSeed",4,d.g.FLOAT,32,64),new L.G("a_extrudeInfo",4,d.g.FLOAT,48,64)]},_t={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:G};class mt{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=z.f.createVertex(e,d.l1.STATIC_DRAW,this._vertexData),i=z.f.createIndex(e,d.l1.STATIC_DRAW,this._indexData),r=new tt.U(e,G,ut,{geometry:a},i),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const y=t.painter.materialManager.getProgram(_t,c);this.vertexArray=r,this.program=y,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}class st{constructor(t){this._styles=t}get animated(){return this._styles.reduce((t,e)=>t||e.animated,!1)}isCompatible(t){if(!(t instanceof st)||this._styles.length!==t._styles.length)return!1;const e=this._styles.length;for(let a=0;a<e;a++)if(!this._styles[a].isCompatible(t._styles[a]))return!1;return!0}load(t,e){var a=this;return(0,A.Z)(function*(){const i=yield Promise.all(a._styles.map(r=>r.load(t,e)));return new pt(i)})()}render(t,e,a){for(let i=0;i<this._styles.length;i++)this._styles[i].render(t,e,a.resources[i])}}class pt{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce((t,e)=>t&&e.ready,!0)}}class rt{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof rt&&N(this._params,t._params)}load(t,e){var a=this;return(0,A.Z)(function*(){const{extent:i,size:r}=t;(0,j.k_)(e);const c=yield a._params.loadImagery(i,r[0],r[1],a._params.timeExtent,e),{vertexData:y,indexData:v}=yield a._params.createFlowMesh("Streamlines",a._params.simulationSettings,c,e);return new gt(y,v,{color:a._params.color,opacity:a._params.opacity,size:a._params.size})})()}render(t,e,a){const{context:i}=t,{program:r}=a;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(d.zi.ONE,d.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(r),r.setUniform1f("u_time",e.time),r.setUniform1f("u_trailLength",this._params.trailLength),r.setUniform1f("u_flowSpeed",this._params.flowSpeed),r.setUniform1f("u_featheringSize",this._params.featheringSize),r.setUniform1f("u_featheringOffset",this._params.featheringOffset),r.setUniform1f("u_introFade",this._params.introFade?1:0),r.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),r.setUniform1f("u_decayRate",this._params.decayRate),r.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),r.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),R(r,"color","vec4",this._params.color),R(r,"opacity","float",this._params.opacity),R(r,"size","float",this._params.size),i.bindVAO(a.vertexArray),i.drawElements(d.MX.TRIANGLES,a.indexCount,d.g.UNSIGNED_INT,0)}}const K=new Map;K.set("a_positionAndSide",0),K.set("a_timeInfo",1),K.set("a_extrude",2),K.set("a_speed",3);const ft={geometry:[new L.G("a_positionAndSide",3,d.g.FLOAT,0,36),new L.G("a_timeInfo",3,d.g.FLOAT,12,36),new L.G("a_extrude",2,d.g.FLOAT,24,36),new L.G("a_speed",1,d.g.FLOAT,32,36)]},yt={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:K};class gt{constructor(t,e,a){this._vertexData=t,this._indexData=e,this._values=a}attach(t){const{context:e}=t,a=z.f.createVertex(e,d.l1.STATIC_DRAW,this._vertexData),i=z.f.createIndex(e,d.l1.STATIC_DRAW,this._indexData),r=new tt.U(e,K,ft,{geometry:a},i),c=[];"ramp"===this._values.color.kind&&c.push("vvColor"),"ramp"===this._values.opacity.kind&&c.push("vvOpacity"),"ramp"===this._values.size.kind&&c.push("vvSize");const y=t.painter.materialManager.getProgram(yt,c);this.vertexArray=r,this.program=y,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}var nt=o(45809),it=o(40334),Mt=o(23418);class At extends Mt.Z{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:(0,it.c)(),displayViewMat3:(0,it.c)()}}dispose(){}prepareState(t){const{context:e}=t;e.setColorMask(!0,!0,!0,!0),e.setStencilFunction(d.wb.EQUAL,0,255)}draw(t,e){const{requestRender:a,allowDelayedRender:i}=t,{displayData:r}=e;if((0,n.Wi)(r)||("loaded"===r.state.name&&r.attach(t),"attached"!==r.state.name))return;const c=r.state.resources;i&&!c.ready&&(0,n.pC)(a)?a():(this._visualState.time=t.time/1e3,this._visualState.dvsMat3=e.transforms.dvs,this._visualState.displayViewMat3=t.state.displayViewMat3,r.flowStyle.render(t,this._visualState,c),r.flowStyle.animated&&(0,n.pC)(a)&&a())}}var Ot=o(20753),Rt=o(83345);class Ct extends Rt.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[At],target:()=>this.children,drawPhase:Ot.jx.MAP});return[...super.prepareRenderPasses(t),e]}}o(6010);var lt=o(28191),ot=o(93142),It=o(35787);class Tt{constructor(t,e,a,i){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=a,this.pixelRatio=i}load(){var t=this;return(0,A.Z)(function*(){const e=new AbortController;t.state={name:"loading",abortController:e};const a={extent:t.extent,size:t.size,pixelRatio:t.pixelRatio},i=yield t.flowStyle.load(a,e.signal);t.state={name:"loaded",resources:i}})()}attach(t){if("loaded"!==this.state.name)return void lt.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio||(this.flowStyle=t.flowStyle,0))}}var X=o(38974),Ut=o(99390);class bt extends Ut.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){(0,n.pC)(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if((0,n.Wi)(e))return;const r=[0,0];t.toScreen(r,[e.extent.xmin,e.extent.ymax]);const c=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,y=(0,ot.Vl)(t.rotation),{dvs:v}=this.transforms;(0,X.j)(v,[-1,1,0]),(0,X.d)(v,v,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,X.h)(v,v,[r[0],r[1],0]),(0,X.r)(v,v,y),(0,X.d)(v,v,[c*t.pixelRatio,c*t.pixelRatio,1])}_createTransforms(){return{dvs:(0,it.c)()}}}var Ft=o(10465);let Z=class extends T.Z{constructor(s){super(s),this._flowDisplayObject=new bt,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(s){const{flowStyle:t}=this.flowContainer;if((0,n.Wi)(t))return void this._clear();const{extent:e,rotation:a,resolution:i,pixelRatio:r}=s.state,c=function Vt(s,t){const e=new It.Z({x:(s.xmax+s.xmin)/2,y:(s.ymax+s.ymin)/2,spatialReference:s.spatialReference}),a=s.xmax-s.xmin,i=s.ymax-s.ymin,r=Math.abs(Math.cos((0,ot.Vl)(t))),c=Math.abs(Math.sin((0,ot.Vl)(t))),y=r*a+c*i,v=c*a+r*i,U=new Ft.Z({xmin:e.x-y/2,ymin:e.y-v/2,xmax:e.x+y/2,ymax:e.y+v/2,spatialReference:s.spatialReference});return U.centerAt(e),U}(e,a);c.expand(1.15);const y=[Math.round((c.xmax-c.xmin)/i),Math.round((c.ymax-c.ymin)/i)],v=new Tt(t,c,y,r);if((0,n.pC)(this._loading)){if(this._loading.update(v))return;this._loading.detach(),this._loading=null}!(0,n.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(v)||(v.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},U=>{(0,j.D_)(U)||(lt.Z.getLogger(this.declaredClass).error("A resource failed to load.",U),this._loading=null)}),this._loading=v)}_clear(){this._flowDisplayObject.clear(),(0,n.pC)(this._loading)&&(this._loading.detach(),this._loading=null)}};(0,u._)([(0,D.Cb)()],Z.prototype,"_loading",void 0),(0,u._)([(0,D.Cb)()],Z.prototype,"flowContainer",void 0),(0,u._)([(0,D.Cb)()],Z.prototype,"updating",null),Z=(0,u._)([(0,l.j)("esri.views.2d.engine.flow.FlowStrategy")],Z);const zt=Z;let F=class extends T.Z{constructor(){var s;super(...arguments),s=this,this._loadImagery=(t,e,a,i,r)=>(0,nt.KK)(this.layer,t,e,a,i,r),this._createFlowMesh=(t,e,a,i)=>this.layer.createFlowMesh({meshType:t,flowData:a,simulationSettings:e},{signal:i}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=(0,A.Z)(function*(){s._updateVisualization()})}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:s}=this,t=()=>{this._loadImagery=(e,a,i,r,c)=>(0,nt.KK)(s,e,a,i,r,c),this._updateVisualization()};this.addHandles("multidimensionalDefinition"in s?(0,M.YP)(()=>s.multidimensionalDefinition,t):[(0,M.YP)(()=>s.mosaicRule,t),(0,M.YP)(()=>s.renderingRule,t),(0,M.YP)(()=>s.definitionExpression,t)]),this.container=new Ct,this._strategy=new zt({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(s){s.stationary?this._strategy.update(s):this.layerView.requestUpdate()}hitTest(s){return new m.Z({attributes:{},geometry:s.clone(),layer:this.layer})}moveEnd(){}doRefresh(){return(0,A.Z)(function*(){})()}_updateVisualization(){const s=this.layer.renderer;if(null==s||"flow"!==s.type)return;const t=function St(s,t){const{flowSpeed:e,trailLength:a}=s,i=function P(s){const t=g(f(s)),e=t,i=Math.max(t/2,5),r=Math.round((0,h.F2)(s.maxPathLength)/i)+1,{density:y}=s;return{smoothing:(0,h.F2)(s.smoothing),interpolate:!0,velocityScale:"flow-from"===s.flowRepresentation?1:-1,verticesPerLine:r,minSpeedThreshold:.001,segmentLength:i,maxTurnAngle:1,collisions:!0,lineCollisionWidth:e,lineSpacing:10,density:y}}(s);let r=null;const c={opacity:S(s),size:f(s)};let y=function E(s){if(!s.hasVisualVariables("color"))return{kind:"constant",value:p(s.color)};const t=s.getVisualVariablesForType("color")[0],e=[],a=[];for(const i of t.stops)e.push(i.value),Array.prototype.push.apply(a,p(i.color));return{kind:"ramp",stops:e,values:a,count:t.stops.length}}(s);"none"===s.background?c.color=y:("constant"===y.kind&&(y={kind:"ramp",stops:[0,1],values:[0,0,0,1,y.value[0],y.value[1],y.value[2],y.value[3]],count:2}),r=new et({loadImagery:t.loadImagery,timeExtent:t.timeExtent,color:y,opacity:{kind:"constant",value:[1]}}),c.color={kind:"constant",value:[.1,.1,.1,1]});const v={loadImagery:t.loadImagery,createFlowMesh:t.createFlowMesh,simulationSettings:i,timeExtent:t.timeExtent,trailLength:a,flowSpeed:e,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:c.color,opacity:c.opacity,size:c.size},U="butt"===s.trailCap||g(f(s))<=4?new rt(v):new at(v);return(0,n.pC)(r)?new st([r,U]):U}(s,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=t,this.layerView.requestUpdate()}};(0,u._)([(0,D.Cb)()],F.prototype,"_strategy",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"attached",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"container",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"layer",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"layerView",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"type",void 0),(0,u._)([(0,D.Cb)()],F.prototype,"updating",null),(0,u._)([(0,D.Cb)()],F.prototype,"timeExtent",void 0),F=(0,u._)([(0,l.j)("esri.views.2d.engine.flow.FlowView2D")],F);const jt=F},65565:(H,b,o)=>{o.d(b,{Z:()=>w});var A=o(53661),u=o(23418),m=o(69923);const T=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),M={beaufort_ft:T,beaufort_m:T,beaufort_km:T,beaufort_mi:T,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),single_arrow:new Float32Array([0,92/255,230/255,1]),wind_speed:new Float32Array([0,0,0,1])},D=[0,20];class w extends u.Z{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:l}){l.setBlendingEnabled(!0),l.setBlendFunctionSeparate(m.zi.ONE,m.zi.ONE_MINUS_SRC_ALPHA,m.zi.ONE,m.zi.ONE_MINUS_SRC_ALPHA),l.setColorMask(!0,!0,!0,!0),l.setStencilWriteMask(0),l.setStencilTestEnabled(!0),l.setStencilOp(m.xS.KEEP,m.xS.KEEP,m.xS.REPLACE)}draw(l,n){if((0,A.Wi)(n.source)||0===n.source.validPixelCount)return;const{context:h,timeline:P}=l;if(P.begin(this.name),h.setStencilFunction(m.wb.EQUAL,n.stencilRef,255),n.updateVectorFieldVAO(l),"scalar"===l.renderPass){const g=n.vaoData.scalar;g&&this._drawScalars(l,n,g.vao,g.elementCount)}else{const g=n.vaoData.magdir;g&&this._drawTriangles(l,n,g.vao,g.elementCount)}P.end(this.name)}_drawTriangles(l,n,h,P){const{context:g,painter:p,requestRender:x,allowDelayedRender:f}=l,{symbolizerParameters:E}=n,S=E.dataRange?["dataRange"]:[];"geographic"===E.rotationType&&S.push("rotationGeographic");const _=p.materialManager.getProgram(this._desc.magdir,S);if(f&&(0,A.pC)(x)&&!_.compiled)return void x();g.useProgram(_);const{coordScale:R,opacity:W,transforms:B}=n;_.setUniform2fv("u_coordScale",R),_.setUniform1f("u_opacity",W),_.setUniformMatrix3fv("u_dvsMat3",B.dvs);const{style:N,dataRange:j,rotation:z,symbolPercentRange:d}=E;_.setUniform4fv("u_colors",M[N]||M.single_arrow),_.setUniform2fv("u_dataRange",j||D),_.setUniform1f("u_rotation",z),_.setUniform2fv("u_symbolPercentRange",d);const q=this._getSymbolSize(l,n);_.setUniform2fv("u_symbolSize",q),g.bindVAO(h),g.drawElements(m.MX.TRIANGLES,P,m.g.UNSIGNED_INT,0)}_drawScalars(l,n,h,P){const{context:g,painter:p,requestRender:x,allowDelayedRender:f}=l,{symbolizerParameters:E}=n,S=[];"wind_speed"===E.style?S.push("innerCircle"):E.dataRange&&S.push("dataRange"),"geographic"===E.rotationType&&S.push("rotationGeographic");const _=p.materialManager.getProgram(this._desc.scalar,S);if(f&&(0,A.pC)(x)&&!_.compiled)return void x();g.useProgram(_);const{coordScale:R,opacity:W,transforms:B}=n;_.setUniform2fv("u_coordScale",R),_.setUniform1f("u_opacity",W),_.setUniformMatrix3fv("u_dvsMat3",B.dvs);const{dataRange:N,symbolPercentRange:j}=E;_.setUniform2fv("u_dataRange",N||D),_.setUniform2fv("u_symbolPercentRange",j);const z=this._getSymbolSize(l,n);_.setUniform2fv("u_symbolSize",z),g.bindVAO(h),g.drawElements(m.MX.TRIANGLES,P,m.g.UNSIGNED_INT,0)}_getSymbolSize(l,n){const h=n.key?2**(l.displayLevel-n.key.level):n.resolution/l.state.resolution,{symbolTileSize:P}=n.symbolizerParameters;return[P/(Math.round((n.width-n.offset[0])/P)*P)/h,P/(Math.round((n.height-n.offset[1])/P)*P)/h]}}},46483:(H,b,o)=>{o.d(b,{F:()=>P}),o(67087);var u=o(53661),m=o(38974),T=o(40334),M=o(12288),D=o(62265),w=o(99390),O=o(52300),l=o(10615),n=o(69923),h=o(19955);class P extends w.s{constructor(p=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=p}destroy(){(0,u.pC)(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(p){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(p)&&(this._symbolizerParameters=p,this.invalidateVAO())}get source(){return this._source}set source(p){this._source=p,this.invalidateVAO()}invalidateVAO(){!this._vaoInvalidated&&(0,u.pC)(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(p){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,u.pC)(this.source)&&(0,u.Wi)(this.vaoData)){const{style:x}=this.symbolizerParameters;switch(x){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const f=(0,D.wF)(this.source,this.symbolizerParameters),E=this._createVectorFieldVAO(p.context,f);this.vaoData={magdir:E}}break;case"simple_scalar":{const f=(0,D.K)(this.source,this.symbolizerParameters),E=this._createVectorFieldVAO(p.context,f);this.vaoData={scalar:E}}break;case"wind_speed":{const f=(0,D.wF)(this.source,this.symbolizerParameters),E=this._createVectorFieldVAO(p.context,f),S=(0,D.K)(this.source,this.symbolizerParameters),_=this._createVectorFieldVAO(p.context,S);this.vaoData={magdir:E,scalar:_}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,T.c)()}}setTransform(p){const x=(0,m.g)(this.transforms.dvs),[f,E]=p.toScreenNoRotation([0,0],[this.x,this.y]),S=this.resolution/this.pixelRatio/p.resolution,_=S*this.width,R=S*this.height,W=Math.PI*this.rotation/180;(0,m.h)(x,x,(0,M.f)(f,E)),(0,m.h)(x,x,(0,M.f)(_/2,R/2)),(0,m.r)(x,x,-W),(0,m.h)(x,x,(0,M.f)(-_/2,-R/2)),(0,m.k)(x,x,(0,M.f)(_,R)),(0,m.m)(this.transforms.dvs,p.displayViewMat3,x)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(p,x){const{vertexData:f,indexData:E}=x,S=l.f.createVertex(p,n.l1.STATIC_DRAW,new Float32Array(f)),_=l.f.createIndex(p,n.l1.STATIC_DRAW,new Uint32Array(E)),R=(0,O.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:n.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:n.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:n.g.FLOAT,normalized:!1}]});return{vao:new h.U(p,R.attributes,R.bufferLayouts,{geometry:S},_),elementCount:E.length}}}},53971:(H,b,o)=>{o.d(b,{Z:()=>w});var A=o(67087),u=o(20753),m=o(83345),T=o(26877),M=o(67135);const D=(O,l)=>O.key.level-l.key.level!=0?O.key.level-l.key.level:O.key.row-l.key.row!=0?O.key.row-l.key.row:O.key.col-l.key.col;class w extends m.Z{constructor(l){super(),this._tileInfoView=l}get requiresDedicatedFBO(){return!1}renderChildren(l){this.sortChildren(D),this.setStencilReference(l),super.renderChildren(l)}createRenderParams(l){const{state:n}=l,h=super.createRenderParams(l);return h.requiredLevel=this._tileInfoView.getClosestInfoForScale(n.scale).level,h.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(n.scale),h}prepareRenderPasses(l){const n=super.prepareRenderPasses(l);return n.push(l.registerRenderPass({name:"stencil",brushes:[M.Z],drawPhase:u.jx.DEBUG|u.jx.MAP|u.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,A.Z)("esri-tiles-debug")&&n.push(l.registerRenderPass({name:"tileInfo",brushes:[T.Z],drawPhase:u.jx.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(l){let n=1;for(const h of this.children)h.stencilRef=n++}}},34040:(H,b,o)=>{o.d(b,{Z:()=>l});var A=o(18100),u=o(28191),m=o(30801),T=o(7521),M=o(9497),O=(o(83382),o(19420),o(20891));const l=n=>{let h=class extends n{initialize(){this.handles.add((0,T.on)(()=>this.layer,"refresh",P=>{this.doRefresh(P.dataChanged).catch(g=>{(0,m.D_)(g)||u.Z.getLogger(this.declaredClass).error(g)})}),"RefreshableLayerView")}};return(0,A._)([(0,M.Cb)()],h.prototype,"layer",void 0),h=(0,A._)([(0,O.j)("esri.layers.mixins.RefreshableLayerView")],h),h}},24927:(H,b,o)=>{o.d(b,{V:()=>D,e:()=>T});var A=o(71670),u=o(53661),m=o(21230);function T(w){return M.apply(this,arguments)}function M(){return(M=(0,A.Z)(function*(w,O=w.popupTemplate){if((0,u.Wi)(O))return[];const l=yield O.getRequiredFields(w.fieldsIndex),{lastEditInfoEnabled:n}=O,{objectIdField:h,typeIdField:P,globalIdField:g,relationships:p}=w;if(l.includes("*"))return["*"];const x=n?yield(0,m.CH)(w):[],f=(0,m.Q0)(w.fieldsIndex,[...l,...x]);return P&&f.push(P),f&&h&&w.fieldsIndex?.has(h)&&!f.includes(h)&&f.push(h),f&&g&&w.fieldsIndex?.has(g)&&!f.includes(g)&&f.push(g),p&&p.forEach(E=>{const{keyField:S}=E;f&&S&&w.fieldsIndex?.has(S)&&!f.includes(S)&&f.push(S)}),f})).apply(this,arguments)}function D(w,O){return w.popupTemplate?w.popupTemplate:(0,u.pC)(O)&&O.defaultPopupTemplateEnabled&&(0,u.pC)(w.defaultPopupTemplate)?w.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=6716.2ae65754c2375dd4.js.map