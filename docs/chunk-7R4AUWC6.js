import{a as $e,d as Ke}from"./chunk-MKNTLGGJ.js";import{a as je,b as Je,c as Qe}from"./chunk-S3XPI6ZB.js";import{a as qe}from"./chunk-FTN2CJFM.js";import"./chunk-Z32YY6GL.js";import"./chunk-S5EE6QWY.js";import"./chunk-IJTEU5B7.js";import"./chunk-PSWJZLWW.js";import"./chunk-IKTHGKQP.js";import"./chunk-U63DCZL6.js";import"./chunk-BA35PLXE.js";import{Ac as J,Ad as Le,B as F,Bb as R,Bd as Be,Cb as ue,Eb as L,Fc as Ne,Gc as Ge,Hc as De,Ic as Ve,Jb as B,Kb as fe,Qb as ge,Rb as _e,Sb as Ce,Uc as Ie,Vc as Ae,Xb as q,Yb as $,c as pe,d as me,dc as K,ec as ve,f as de,fc as Se,gc as xe,h as G,mb as D,nc as be,ob as he,oc as Pe,pc as we,qb as V,qc as ye,rb as I,rc as Me,sc as Oe,tb as S,tc as Fe,uc as Te,ud as Q,vb as f,vd as U,xc as ke,yb as A,yc as j,zc as Ee,zd as Re}from"./chunk-GBRF7Z4C.js";import{Db as z,Eb as H,Fb as re,Gb as W,Hb as Y,Hc as se,Ib as h,Jb as n,Kb as a,Lb as d,Pb as P,Qb as w,Rb as k,Sb as y,Vb as u,Wb as C,Xa as m,bc as ne,cc as ie,dc as M,hc as p,ia as v,ic as O,kb as T,na as g,oa as _,pb as b,qc as E,r as Z,ra as oe,rc as ae,tc as le,uc as ce,v as ee,x as te,yc as N}from"./chunk-YJ3NK6DP.js";import{a as X}from"./chunk-OY7QI42D.js";var Ue=(()=>{let l=class l{constructor(){this.dialogConfig=v(ye),this.dialogRef=v(Me),this.formGroup=new S({name:new f(null,{validators:[he.required]}),description:new f,isDefault:new f,isPublic:new f})}ngOnInit(){this.record=this.dialogConfig,this.formGroup.patchValue(this.record)}onSave(){this.dialogRef.close(X(X({},this.record),this.formGroup.getRawValue()))}onCancel(){this.formGroup.markAsPristine(),this.dialogRef.close(!1)}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=T({type:l,selectors:[["app-search-save"]],decls:22,vars:3,consts:[["dialogTitle","Save search","label","Save search",3,"dialogClose"],["novalidate","","autocomplete","off",1,"form-grid",3,"formGroup"],["required","",3,"appFormControlInvalid"],["type","text","id","search-save--name","formControlName","name","appAutoFocus",""],["for","search-save--name","slot","label"],["slot","support-text",1,"app--form-control-invalid"],["type","text","id","search-save--description","formControlName","description"],["for","search-save--description","slot","label"],["formControlName","isDefault"],["formControlName","isPublic"],["app-dialog-footer",""],["slot","end","variant","outlined",3,"click"],["slot","end","variant","filled",3,"click","disabled"]],template:function(t,e){t&1&&(n(0,"app-dialog-template",0),u("dialogClose",function(){return e.onCancel()}),n(1,"form",1)(2,"forge-text-field",2),d(3,"input",3),n(4,"label",4),p(5,"Name"),a(),n(6,"span",5),p(7,"A name is required"),a()(),n(8,"forge-text-field"),d(9,"input",6),n(10,"label",7),p(11,"Description"),a()(),n(12,"div")(13,"forge-checkbox",8),p(14," Make this your default search "),a(),n(15,"forge-checkbox",9),p(16," Make this search public "),a()()(),P(17,10),n(18,"forge-button",11),u("click",function(){return e.onCancel()}),p(19,"Cancel"),a(),n(20,"forge-button",12),u("click",function(){return e.onSave()}),p(21,"Save"),a(),w(),a()),t&2&&(m(),h("formGroup",e.formGroup),m(),h("appFormControlInvalid",e.formGroup.controls.name),m(18),h("disabled",e.formGroup.invalid||!e.formGroup.dirty))},dependencies:[G,B,A,D,V,I,R,L,$,q,xe,Se,K,J,j,U,Q,Qe,Ke,je],styles:[`[_nghost-%COMP%]{display:contents}.form-grid[_ngcontent-%COMP%]{padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.form-grid--row-break[_ngcontent-%COMP%]{grid-column-start:1}.form-grid--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.form-grid--col-span.form-grid--col-span[_ngcontent-%COMP%]{width:auto}.form-grid--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.form-grid--col-span2.form-grid--col-span2[_ngcontent-%COMP%]{width:656px}.form-grid--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.form-grid--col-span3.form-grid--col-span3[_ngcontent-%COMP%]{width:992px}.form-grid[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}






/*# sourceMappingURL=search-save.component-4XCFKCE6.css.map */`]});let i=l;return i})();var We=["searchesPopover"],Ye=()=>({name:"name"}),Ze=()=>({name:"dateOfBirth"}),et=()=>({name:"address"}),tt=i=>({"operator__addon--selected":i}),ot=(i,l)=>l.id;function rt(i,l){if(i&1&&(d(0,"forge-divider",30),n(1,"span",31),p(2),a(),n(3,"span",32),p(4),a()),i&2){let c=C();m(2),O(c.searchName),m(2),O(c.searchDescription)}}function nt(i,l){if(i&1){let c=y();n(0,"forge-list-item",35)(1,"button",34),p(2),a(),n(3,"div",8)(4,"forge-icon-button",36),u("mousedown",function(t){let e=g(c).$implicit,o=C(2);return _(o.onSearchAction(t,"edit",e.id))}),d(5,"forge-icon",37),a(),n(6,"forge-icon-button",38),u("mousedown",function(t){let e=g(c).$implicit,o=C(2);return _(o.onSearchAction(t,"delete",e.id))}),d(7,"forge-icon",39),a()()()}if(i&2){let c=l.$implicit;h("value",c.id),m(2),O(c.name)}}function it(i,l){if(i&1){let c=y();n(0,"forge-list",33),u("forge-list-item-select",function(t){g(c);let e=C();return _(e.onSearchAction(t,"search",t.detail.value))}),n(1,"forge-list-item")(2,"button",34),p(3,"Add new search"),a()(),d(4,"forge-divider"),W(5,nt,8,2,"forge-list-item",35,ot),a()}if(i&2){let c=C();m(5),Y(c.searchCache.searches)}}function at(i,l){i&1&&k(0)}function lt(i,l){i&1&&k(0)}function ct(i,l){i&1&&k(0)}function st(i,l){if(i&1){let c=y();n(0,"forge-icon-button",40,4),u("click",function(t){let e=g(c).name,o=M(1),s=C();return _(s.onOperatorPopoverOpen(t,o,e))}),d(2,"forge-icon",41),a()}if(i&2){let c,r=l.name,t=C(),e=M(51);h("ngClass",ae(2,tt,(c=t.formGroup.get(r))==null?null:c.value.operator))("forgePopover",e)}}function pt(i,l){i&1&&d(0,"forge-icon",44)}function mt(i,l){if(i&1&&(n(0,"forge-list-item",43)(1,"button",34),p(2),a(),z(3,pt,1,0,"forge-icon",44),a()),i&2){let c=l.$implicit,r=C(2);h("value",c.value)("selected",(r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===c.value),m(2),O(c.label),m(),H((r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===c.value?3:-1)}}function dt(i,l){if(i&1){let c=y();n(0,"forge-list",42),u("forge-list-item-select",function(t){g(c);let e=C();return _(e.onOperatorSelected(t.detail.value))}),W(1,mt,4,4,"forge-list-item",43,re),a()}if(i&2){let c=C();m(),Y(c.operatorOptions)}}var It=(()=>{let l=class l{constructor(){this.destroyRef=v(oe),this.dialogService=v(Oe),this.toastService=v(Re),this.dataService=v(qe),this.searchesPopover=se("searchesPopover"),this.storageKey="search-searches",this.searchCache={activeSearchId:void 0,searches:[]},this.formGroup=new S({name:new S({value:new f,operator:new f}),dateOfBirth:new S({value:new f,operator:new f}),address:new S({value:new f,operator:new f}),include:new f,facet:new f}),this.facetOptions=[],this.operatorOptions=[{value:null,label:"None"},{value:0,label:"Equal"},{value:1,label:"Not equal"},{value:2,label:"Greater than"},{value:3,label:"Less than"},{value:4,label:"Greater than equal to"},{value:5,label:"Less than equal to"},{value:6,label:"Range"},{value:7,label:"Contains"},{value:8,label:"Not contains"},{value:9,label:"Empty"}],this.nameFilter=r=>ee(this.dataService.getPeople().pipe(te(t=>t.data.filter(e=>e.firstName.toLocaleLowerCase().includes(r.toLocaleLowerCase())||e.lastName.toLocaleLowerCase().includes(r.toLocaleLowerCase())).map(e=>({label:`${e.firstName} ${e.lastName}`,value:e.id}))))),this.facetFilter=r=>Z(this.facetOptions)}ngOnInit(){this.dataService.getSearches(this.storageKey).pipe(fe(this.destroyRef)).subscribe({next:r=>{this.searchCache.searches=r||[];let t=this.searchCache.searches.find(e=>e.id===this.searchCache.activeSearchId);F(t)&&(this.searchName=t?.name,this.searchDescription=t?.description,this.formGroup.patchValue(t?.filters))}});for(let r=0;r<20;r++)this.facetOptions.push({value:r,label:`Facet Option ${r}`})}onSearch(){}onSaveSearch(r){let t=F(r)?r:this.searchCache.searches.find(o=>o.id===this.searchCache.activeSearchId),e={id:t?.id,name:t?.name,description:t?.description,isDefault:t?.isDefault,isPublic:t?.isPublic,filters:this.formGroup.value};this.dialogService.open(Ue,{data:e,options:{persistent:!0}}).afterClosed.subscribe({next:o=>{if(o){if(F(o.id)){let s=this.searchCache.searches.findIndex(x=>x.id===o.id);s!==-1&&(this.searchCache.searches[s]=o)}else o.id=this.searchCache.searches.length?Math.max(...this.searchCache.searches.map(s=>s.id))+1:1,this.searchCache.searches.push(o);this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:()=>{this.searchCache.activeSearchId=o.id,this.searchName=o.name,this.searchDescription=o.description,this.toastService.show({message:"Search saved",theme:"success"})},error:()=>this.toastService.show({message:"Search save failed",theme:"error"})})}}})}onClearSearch(){this.formGroup.controls.include.setValue(null),this.formGroup.reset()}onSearchAction(r,t,e){if(r.stopPropagation(),this.searchesPopover()?.close(),!F(e))this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="",this.formGroup.reset();else{let o=this.searchCache.searches.find(s=>s.id===e);if(F(o))switch(t){case"search":this.searchCache.activeSearchId=o?.id,this.searchName=o?.name,this.searchDescription=o?.description,this.formGroup.patchValue(o?.filters),this.onSearch();break;case"edit":this.searchCache.activeSearchId=o?.id,this.searchName=o?.name,this.searchDescription=o?.description,this.formGroup.patchValue(o?.filters);break;case"copy":{let s=JSON.parse(JSON.stringify(o));s.id=void 0,s.name=`${s.name} copy`,s.isDefault=!1,this.onSaveSearch(s);break}case"delete":{let s=this.searchCache.searches.findIndex(x=>x.id===o?.id);s!==-1&&(this.searchCache.searches.splice(s,1),this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:x=>{}})),this.searchCache.activeSearchId===o?.id&&(this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="");break}}}}onOperatorPopoverOpen(r,t,e){r.stopPropagation(),this.operatorPopoverFormGroup=this.formGroup.get(e),this.operatorPopover=t,this.operatorPopover.open()}onOperatorSelected(r){r=parseInt(r,10),this.operatorPopoverFormGroup?.get("operator")?.setValue(r),this.operatorPopover?.close()}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=T({type:l,selectors:[["app-search"]],viewQuery:function(t,e){t&1&&ne(e.searchesPopover,We,5),t&2&&ie()},decls:52,vars:18,consts:[["searchesPopover","forgePopover"],["searchesPopoverTemplate",""],["opertatorAddonTemplate",""],["operatorPopoverTemplate",""],["operatorPopover","forgePopover"],[1,"header"],["slot","start"],[1,"forge-typography--subheading4"],["slot","end"],["variant","outlined",3,"click"],["variant","outlined",3,"click","forgePopover","forgePopoverPlacement"],["name","arrow_drop_down"],["variant","filled",3,"click"],[1,"body"],["novalidate","","autocomplete","off",1,"form",3,"ngSubmit","formGroup"],["formGroupName","name"],["multiple","true","formControlName","value","allow-unmatched","true",3,"filter"],["type","text","id","search--name"],["for","search--name"],["slot","end","name","arrow_drop_down",1,"forge-dropdown-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["formGroupName","dateOfBirth"],["formControlName","value"],["type","text","id","search--date-of-birth"],["for","search--date-of-birth"],["formGroupName","address"],["type","text","id","search--address","formControlName","value"],["for","search--address","slot","label"],["formControlName","facet","label","Facet",3,"optionFilter"],["threeState","true","formControlName","include",2,"align-self","flex-end"],["vertical",""],[1,"forge-typography--heading2"],[1,"forge-typography--subheading1"],[1,"searches-popover",3,"forge-list-item-select"],["type","button"],[3,"value"],["aria-label","Edit",3,"mousedown"],["name","edit"],["aria-label","Delete",3,"mousedown"],["name","delete"],["slot","addon-end","density","medium","aria-label","Filter operator",1,"operator__addon",3,"click","ngClass","forgePopover"],["name","bolt"],[1,"operator-popover",3,"forge-list-item-select"],[3,"value","selected"],["name","check","slot","end"]],template:function(t,e){if(t&1){let o=y();n(0,"forge-toolbar",5)(1,"div",6)(2,"h2",7),p(3,"Search"),a(),z(4,rt,5,2),a(),n(5,"div",8)(6,"forge-button",9),u("click",function(){return g(o),_(e.onSaveSearch())}),p(7,"Save search"),a(),n(8,"forge-button",10,0),u("click",function(){g(o);let x=M(9);return _(x.open())}),n(10,"span"),p(11,"Saved searches"),a(),d(12,"forge-icon",11),a(),n(13,"forge-button",9),u("click",function(){return g(o),_(e.onClearSearch())}),p(14,"Clear all"),a(),n(15,"forge-button",12),u("click",function(){return g(o),_(e.onSearch())}),p(16,"Search"),a()()(),b(17,it,7,0,"ng-template",null,1,N),n(19,"div",13)(20,"form",14),u("ngSubmit",function(){return g(o),_(e.onSearch())}),P(21,15),n(22,"forge-autocomplete",16)(23,"forge-text-field"),d(24,"input",17),n(25,"label",18),p(26,"Name"),a(),d(27,"forge-icon",19),b(28,at,1,0,"ng-container",20),a()(),w(),P(29,21),n(30,"forge-date-picker",22)(31,"forge-text-field"),d(32,"input",23),n(33,"label",24),p(34,"Date"),a(),b(35,lt,1,0,"ng-container",20),a()(),w(),P(36,25),n(37,"forge-text-field"),d(38,"input",26),n(39,"label",27),p(40,"Address"),a(),b(41,ct,1,0,"ng-container",20),a(),w(),d(42,"app-autocomplete-range",28),n(43,"forge-checkbox",29),p(44,"Include"),a()(),n(45,"p"),p(46),le(47,"json"),a()(),b(48,st,3,4,"ng-template",null,2,N)(50,dt,3,0,"ng-template",null,3,N)}if(t&2){let o=M(18),s=M(49);m(4),H(e.searchCache.activeSearchId?4:-1),m(4),h("forgePopover",o)("forgePopoverPlacement","bottom-start"),m(12),h("formGroup",e.formGroup),m(2),h("filter",e.nameFilter),m(6),h("ngTemplateOutlet",s)("ngTemplateOutletContext",E(15,Ye)),m(7),h("ngTemplateOutlet",s)("ngTemplateOutletContext",E(16,Ze)),m(6),h("ngTemplateOutlet",s)("ngTemplateOutletContext",E(17,et)),m(),h("optionFilter",e.facetFilter),m(4),O(ce(47,13,e.formGroup.getRawValue()))}},dependencies:[G,pe,me,B,A,D,V,I,R,L,ue,Ce,_e,ge,$,q,ve,K,we,Pe,be,Te,Fe,J,Ee,ke,j,De,Ge,Ve,Ne,Ae,Ie,U,Q,Be,Le,$e,Je,de],styles:[`[_nghost-%COMP%]{display:grid;grid-template-rows:auto 1fr;overflow:hidden}  .searches-popover{min-width:280px}  .searches-popover *[slot=trailing]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin-right:-16px}  .operator-popover{min-width:200px}  .operator-popover forge-list-item{cursor:pointer}.header[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.header[_ngcontent-%COMP%]   forge-button[_ngcontent-%COMP%]{margin-left:16px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   forge-divider[_ngcontent-%COMP%]{margin:0 16px;height:32px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:16px}.body[_ngcontent-%COMP%]{overflow:auto;padding:24px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{background-color:var(--forge-theme-surface);border-radius:var(--forge-shape-medium);border:1px solid var(--forge-theme-outline);padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.body[_ngcontent-%COMP%]   .form--row-break[_ngcontent-%COMP%]{grid-column-start:1}.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.body[_ngcontent-%COMP%]   .form--col-span.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{width:auto}.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.body[_ngcontent-%COMP%]   .form--col-span2.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{width:656px}.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.body[_ngcontent-%COMP%]   .form--col-span3.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{width:992px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}.operator__addon--selected[_ngcontent-%COMP%]{color:var(--forge-theme-info)}






/*# sourceMappingURL=search.component-SCBN4I55.css.map */`]});let i=l;return i})();export{It as SearchComponent};
//# sourceMappingURL=chunk-7R4AUWC6.js.map
