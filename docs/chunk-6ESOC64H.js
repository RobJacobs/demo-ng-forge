import{a as Le,t as Be}from"./chunk-IURIFBWO.js";import"./chunk-G23G7C43.js";import"./chunk-25LYXCFV.js";import{b as Re}from"./chunk-OHW3R4WQ.js";import"./chunk-PSWJZLWW.js";import{a as Ae}from"./chunk-VT5BBUOX.js";import{a as D}from"./chunk-WTEGRGZ6.js";import"./chunk-MZMUE3P7.js";import"./chunk-Y5FC5JZC.js";import"./chunk-OSFEDCAA.js";import{Ab as C,Ac as ve,Bc as Se,C as v,Cc as xe,Cd as Ne,Db as re,Dd as Ie,Fc as be,Gc as Pe,Hc as we,Hd as ke,Ic as Oe,Id as De,Jb as ne,Jd as Ge,Lb as ie,Mb as ae,Nc as ye,Oc as Me,Pb as ce,Pc as Fe,Qb as se,Qc as Te,Wb as le,Yb as pe,Zb as me,ad as Ee,bd as Ve,c as H,cc as de,d as X,dc as he,f as Y,i as Z,kc as ue,lc as fe,rb as ee,uc as _e,vb as te,wb as oe,wc as ge,xc as Ce,yb as O}from"./chunk-WGIND62E.js";import{$b as b,Ab as N,Bb as K,Cb as I,Db as k,Eb as u,Fb as c,Fc as z,Gb as a,Hb as m,Lb as y,Mb as M,Nb as F,Ob as x,Rb as f,Sb as _,Va as s,Zb as J,_b as Q,ca as w,dc as l,ec as P,ha as d,ia as h,la as $,lb as q,mc as T,nc as U,o as L,qb as S,s as R,sc as j,tc as W,u as B,xc as E,zb as V}from"./chunk-UXY6XTJ4.js";import{a as G,b as A}from"./chunk-NCBA65HR.js";var $e=["searchesPopover"],qe=()=>({name:"name"}),Ke=()=>({name:"dateOfBirth"}),Je=()=>({name:"address"}),Qe=n=>({"operator__addon--selected":n}),Ue=(n,p)=>p.id;function je(n,p){if(n&1&&(m(0,"forge-divider",30),c(1,"span",31),l(2),a(),c(3,"span",32),l(4),a()),n&2){let e=_();s(2),P(e.searchName),s(2),P(e.searchDescription)}}function We(n,p){if(n&1){let e=x();c(0,"forge-list-item",35)(1,"button",34),l(2),a(),c(3,"div",8)(4,"forge-icon-button",36),f("mousedown",function(o){let t=d(e).$implicit,i=_(2);return h(i.onSearchAction(o,"edit",t.id))}),m(5,"forge-icon",37),a(),c(6,"forge-icon-button",38),f("mousedown",function(o){let t=d(e).$implicit,i=_(2);return h(i.onSearchAction(o,"delete",t.id))}),m(7,"forge-icon",39),a()()()}if(n&2){let e=p.$implicit;u("value",e.id),s(2),P(e.name)}}function ze(n,p){if(n&1){let e=x();c(0,"forge-list",33),f("forge-list-item-select",function(o){d(e);let t=_();return h(t.onSearchAction(o,"search",o.detail.value))}),c(1,"forge-list-item")(2,"button",34),l(3,"Add new search"),a()(),m(4,"forge-divider"),I(5,We,8,2,"forge-list-item",35,Ue),a()}if(n&2){let e=_();s(5),k(e.searchCache.searches)}}function He(n,p){n&1&&F(0)}function Xe(n,p){n&1&&F(0)}function Ye(n,p){n&1&&F(0)}function Ze(n,p){if(n&1){let e=x();c(0,"forge-icon-button",40,4),f("click",function(o){let t=d(e).name,i=b(1),g=_();return h(g.onOperatorPopoverOpen(o,i,t))}),m(2,"forge-icon",41),a()}if(n&2){let e,r=p.name,o=_(),t=b(51);u("ngClass",U(2,Qe,(e=o.formGroup.get(r))==null?null:e.value.operator))("forgePopover",t)}}function et(n,p){n&1&&m(0,"forge-icon",44)}function tt(n,p){if(n&1&&(c(0,"forge-list-item",43)(1,"button",34),l(2),a(),V(3,et,1,0,"forge-icon",44),a()),n&2){let e=p.$implicit,r=_(2);u("value",e.value)("selected",(r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===e.value),s(2),P(e.label),s(),N((r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===e.value?3:-1)}}function ot(n,p){if(n&1){let e=x();c(0,"forge-list",42),f("forge-list-item-select",function(o){d(e);let t=_();return h(t.onOperatorSelected(o.detail.value))}),I(1,tt,4,4,"forge-list-item",43,K),a()}if(n&2){let e=_();s(),k(e.operatorOptions)}}var St=(()=>{class n{constructor(){this.destroyRef=w($),this.dialogService=w(ve),this.toastService=w(ke),this.dataService=w(Ae),this.searchesPopover=z("searchesPopover"),this.storageKey="search-searches",this.searchCache={activeSearchId:void 0,searches:[]},this.formGroup=new O({name:new O({value:new C,operator:new C}),dateOfBirth:new O({value:new C,operator:new C}),address:new O({value:new C,operator:new C}),include:new C,facet:new C}),this.facetOptions=[],this.operatorOptions=[{value:null,label:"None"},{value:0,label:"Equal"},{value:1,label:"Not equal"},{value:2,label:"Greater than"},{value:3,label:"Less than"},{value:4,label:"Greater than equal to"},{value:5,label:"Less than equal to"},{value:6,label:"Range"},{value:7,label:"Contains"},{value:8,label:"Not contains"},{value:9,label:"Empty"}],this.nameFilter=e=>R(this.dataService.getPeople().pipe(B(r=>r.data.filter(o=>o.firstName.toLocaleLowerCase().includes(e.toLocaleLowerCase())||o.lastName.toLocaleLowerCase().includes(e.toLocaleLowerCase())).map(o=>({label:`${o.firstName} ${o.lastName}`,value:o.id}))))),this.facetFilter=e=>L(this.facetOptions)}ngOnInit(){this.dataService.getSearches(this.storageKey).pipe(se(this.destroyRef)).subscribe({next:e=>{this.searchCache.searches=e||[];let r=this.searchCache.searches.find(o=>o.id===this.searchCache.activeSearchId);v(r)&&(this.searchName=r?.name,this.searchDescription=r?.description,this.formGroup.patchValue(r?.filters))}});for(let e=0;e<20;e++)this.facetOptions.push({value:e,label:`Facet Option ${e}`})}onSearch(){}onSaveSearch(e){let r=v(e)?e:this.searchCache.searches.find(t=>t.id===this.searchCache.activeSearchId),o={title:"Save search",name:r?.name,description:r?.description,isDefault:r?.isDefault};this.dialogService.open(Be,{data:o,options:{persistent:!0}}).afterClosed.subscribe({next:t=>{if(t){if(v(r)){let i=this.searchCache.searches.findIndex(g=>g.id===r.id);i!==-1&&(this.searchCache.searches[i]=t)}else{let i=A(G({},t),{id:D.uniqueId(),filters:this.formGroup.value})}if(v(t.id)){let i=this.searchCache.searches.findIndex(g=>g.id===t.id);i!==-1&&(this.searchCache.searches[i]=t)}else t.id=D.uniqueId(),this.searchCache.searches.push(t);this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:()=>{this.searchCache.activeSearchId=t.id,this.searchName=t.name,this.searchDescription=t.description,this.toastService.show({message:"Search saved",theme:"success"})},error:()=>this.toastService.show({message:"Search save failed",theme:"error"})})}}})}onClearSearch(){this.formGroup.controls.include.setValue(null),this.formGroup.reset()}onSearchAction(e,r,o){if(e.stopPropagation(),this.searchesPopover()?.close(),!v(o))this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="",this.formGroup.reset();else{let t=this.searchCache.searches.find(i=>i.id===o);if(v(t))switch(r){case"search":this.searchCache.activeSearchId=t?.id,this.searchName=t?.name,this.searchDescription=t?.description,this.formGroup.patchValue(t?.filters),this.onSearch();break;case"edit":this.searchCache.activeSearchId=t?.id,this.searchName=t?.name,this.searchDescription=t?.description,this.formGroup.patchValue(t?.filters);break;case"copy":{let i=JSON.parse(JSON.stringify(t));i.id=void 0,i.name=`${i.name} copy`,i.isDefault=!1,this.onSaveSearch(i);break}case"delete":{let i=this.searchCache.searches.findIndex(g=>g.id===t?.id);i!==-1&&(this.searchCache.searches.splice(i,1),this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:g=>{}})),this.searchCache.activeSearchId===t?.id&&(this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="");break}}}}onOperatorPopoverOpen(e,r,o){e.stopPropagation(),this.operatorPopoverFormGroup=this.formGroup.get(o),this.operatorPopover=r,this.operatorPopover.open()}onOperatorSelected(e){e=parseInt(e,10),this.operatorPopoverFormGroup?.get("operator")?.setValue(e),this.operatorPopover?.close()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=q({type:n,selectors:[["app-search"]],viewQuery:function(r,o){r&1&&J(o.searchesPopover,$e,5),r&2&&Q()},decls:52,vars:18,consts:[["searchesPopover","forgePopover"],["searchesPopoverTemplate",""],["opertatorAddonTemplate",""],["operatorPopoverTemplate",""],["operatorPopover","forgePopover"],[1,"header"],["slot","start"],[1,"forge-typography--subheading4"],["slot","end"],["variant","outlined",3,"click"],["variant","outlined",3,"click","forgePopover","forgePopoverPlacement"],["name","arrow_drop_down"],["variant","filled",3,"click"],[1,"body"],["novalidate","","autocomplete","off",1,"form",3,"ngSubmit","formGroup"],["formGroupName","name"],["multiple","true","formControlName","value","allow-unmatched","true",3,"filter"],["slot","label","for","search--name"],["type","text","id","search--name"],["slot","end","name","arrow_drop_down",1,"forge-dropdown-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["formGroupName","dateOfBirth"],["formControlName","value"],["slot","label","for","search--date-of-birth"],["type","text","id","search--date-of-birth"],["formGroupName","address"],["slot","label","for","search--address"],["type","text","id","search--address","formControlName","value"],["formControlName","facet","label","Facet",3,"optionFilter"],["threeState","true","formControlName","include",2,"align-self","flex-end"],["vertical",""],[1,"forge-typography--heading2"],[1,"forge-typography--subheading1"],[1,"searches-popover",3,"forge-list-item-select"],["type","button"],[3,"value"],["aria-label","Edit",3,"mousedown"],["name","edit"],["aria-label","Delete",3,"mousedown"],["name","delete"],["slot","addon-end","density","medium","aria-label","Filter operator",1,"operator__addon",3,"click","ngClass","forgePopover"],["name","bolt"],[1,"operator-popover",3,"forge-list-item-select"],[3,"value","selected"],["name","check","slot","end"]],template:function(r,o){if(r&1){let t=x();c(0,"forge-toolbar",5)(1,"div",6)(2,"h2",7),l(3,"Search"),a(),V(4,je,5,2),a(),c(5,"div",8)(6,"forge-button",9),f("click",function(){return d(t),h(o.onSaveSearch())}),l(7,"Save search"),a(),c(8,"forge-button",10,0),f("click",function(){d(t);let g=b(9);return h(g.open())}),c(10,"span"),l(11,"Saved searches"),a(),m(12,"forge-icon",11),a(),c(13,"forge-button",9),f("click",function(){return d(t),h(o.onClearSearch())}),l(14,"Clear all"),a(),c(15,"forge-button",12),f("click",function(){return d(t),h(o.onSearch())}),l(16,"Search"),a()()(),S(17,ze,7,0,"ng-template",null,1,E),c(19,"div",13)(20,"form",14),f("ngSubmit",function(){return d(t),h(o.onSearch())}),y(21,15),c(22,"forge-autocomplete",16)(23,"forge-text-field")(24,"label",17),l(25,"Name"),a(),m(26,"input",18)(27,"forge-icon",19),S(28,He,1,0,"ng-container",20),a()(),M(),y(29,21),c(30,"forge-date-picker",22)(31,"forge-text-field")(32,"label",23),l(33,"Date of birth"),a(),m(34,"input",24),S(35,Xe,1,0,"ng-container",20),a()(),M(),y(36,25),c(37,"forge-text-field")(38,"label",26),l(39,"Address"),a(),m(40,"input",27),S(41,Ye,1,0,"ng-container",20),a(),M(),m(42,"app-autocomplete-range",28),c(43,"forge-checkbox",29),l(44,"Include"),a()(),c(45,"p"),l(46),j(47,"json"),a()(),S(48,Ze,3,4,"ng-template",null,2,E)(50,ot,3,0,"ng-template",null,3,E)}if(r&2){let t=b(18),i=b(49);s(4),N(o.searchCache.activeSearchId?4:-1),s(4),u("forgePopover",t)("forgePopoverPlacement","bottom-start"),s(12),u("formGroup",o.formGroup),s(2),u("filter",o.nameFilter),s(6),u("ngTemplateOutlet",i)("ngTemplateOutletContext",T(15,qe)),s(7),u("ngTemplateOutlet",i)("ngTemplateOutletContext",T(16,Ke)),s(6),u("ngTemplateOutlet",i)("ngTemplateOutletContext",T(17,Je)),s(),u("optionFilter",o.facetFilter),s(4),P(W(47,13,o.formGroup.getRawValue()))}},dependencies:[Z,H,X,ce,re,ee,te,oe,ae,ie,ne,me,pe,le,he,de,fe,ue,Ce,ge,_e,xe,Se,Oe,we,be,Pe,Fe,Me,Te,ye,Ve,Ee,Ie,Ne,Ge,De,Le,Re,Y],styles:[`[_nghost-%COMP%]{display:grid;grid-template-rows:auto 1fr;overflow:hidden}  .searches-popover{min-width:280px}  .searches-popover *[slot=trailing]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin-right:-16px}  .operator-popover{min-width:200px}  .operator-popover forge-list-item{cursor:pointer}.header[_ngcontent-%COMP%]   forge-button[_ngcontent-%COMP%]{margin-left:16px}.header[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   forge-divider[_ngcontent-%COMP%]{margin:0 16px;height:32px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:16px}.body[_ngcontent-%COMP%]{overflow:auto;padding:24px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{background-color:var(--forge-theme-surface);border-radius:var(--forge-shape-medium);border:1px solid var(--forge-theme-outline);padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.body[_ngcontent-%COMP%]   .form--row-break[_ngcontent-%COMP%]{grid-column-start:1}.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.body[_ngcontent-%COMP%]   .form--col-span.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{width:auto}.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.body[_ngcontent-%COMP%]   .form--col-span2.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{width:656px}.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.body[_ngcontent-%COMP%]   .form--col-span3.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{width:992px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}.operator__addon--selected[_ngcontent-%COMP%]{color:var(--forge-theme-warning)}






/*# sourceMappingURL=search.component-EFB74OWE.css.map */`]})}}return n})();export{St as SearchComponent};
//# sourceMappingURL=chunk-6ESOC64H.js.map
