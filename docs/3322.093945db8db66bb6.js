"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[3322],{23322:(G,A,b)=>{b.r(A),b.d(A,{default:()=>w});var v=b(53661),P=b(13878),B=b(50894),D=b(99038),F=b(92950),C=b(49533),x=b(21789),S=b(68230),V=b(20252),z=b(4085),J=b(37130),y=b(14726),N=b(9572);function m(f,t,l){return(0,v.pC)(f)&&f.attributeInfo.useElevation?t?function W(f,t){const l=new Float64Array(t);for(let r=0;r<t;r++)l[r]=f[3*r+2];return l}(t,l):null:(0,v.pC)(f)&&f.attributeInfo.storageInfo?(0,y.qM)(f.attributeInfo.storageInfo,f.buffer,l):null}function I(f){return null==f||"none"===f?null:"low-four-bit"===f?t=>15&t:"high-four-bit"===f?t=>(240&t)>>4:"absolute-value"===f?t=>Math.abs(t):"modulo-ten"===f?t=>t%10:null}function M(f){let t=0;for(const l of f||[])t|=1<<l;return t}class E{transform(t){const l=this._transform(t),r=[l.points.buffer,l.rgb.buffer];(0,v.pC)(l.pointIdFilterMap)&&r.push(l.pointIdFilterMap.buffer);for(const u of l.attributes)"buffer"in u.values&&(0,P.eP)(u.values.buffer)&&u.values.buffer!==l.rgb.buffer&&r.push(u.values.buffer);return Promise.resolve({result:l,transferList:r})}_transform(t){const l=function T(f,t){if(null==f.encoding||""===f.encoding){const l=(0,y.W7)(t,f);if((0,v.Wi)(l.vertexAttributes.position))return;const r=(0,y.I_)(t,l.vertexAttributes.position),u=l.header.fields,h=[u.offsetX,u.offsetY,u.offsetZ],n=[u.scaleX,u.scaleY,u.scaleZ],a=r.length/3,e=new Float64Array(3*a);for(let s=0;s<a;s++)e[3*s]=r[3*s]*n[0]+h[0],e[3*s+1]=r[3*s+1]*n[1]+h[1],e[3*s+2]=r[3*s+2]*n[2]+h[2];return e}if("lepcc-xyz"===f.encoding)return(0,N.Gi)(t).result}(t.schema,t.geometryBuffer);let r=l.length/3,u=null;const h=[],n=m(t.primaryAttributeData,l,r);(0,v.pC)(t.primaryAttributeData)&&n&&h.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:n});const a=m(t.modulationAttributeData,l,r);(0,v.pC)(t.modulationAttributeData)&&a&&h.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:a});let e=function Z(f,t,l,r){const{rendererJSON:u,isRGBRenderer:h}=f;let n=null,a=null;if(t&&h)n=t;else if(t&&"pointCloudUniqueValueRenderer"===u?.type){a=J.Z.fromJSON(u);const e=a.colorUniqueValueInfos;n=new Uint8Array(3*r);const s=I(a.fieldTransformType);for(let o=0;o<r;o++){const c=(s?s(t[o]):t[o])+"";for(let i=0;i<e.length;i++)if(e[i].values.includes(c)){n[3*o]=e[i].color.r,n[3*o+1]=e[i].color.g,n[3*o+2]=e[i].color.b;break}}}else if(t&&"pointCloudStretchRenderer"===u?.type){a=z.Z.fromJSON(u);const e=a.stops;n=new Uint8Array(3*r);const s=I(a.fieldTransformType);for(let o=0;o<r;o++){const c=s?s(t[o]):t[o],i=e.length-1;if(c<e[0].value)n[3*o]=e[0].color.r,n[3*o+1]=e[0].color.g,n[3*o+2]=e[0].color.b;else if(c>=e[i].value)n[3*o]=e[i].color.r,n[3*o+1]=e[i].color.g,n[3*o+2]=e[i].color.b;else for(let d=1;d<e.length;d++)if(c<e[d].value){const p=(c-e[d-1].value)/(e[d].value-e[d-1].value);n[3*o]=e[d].color.r*p+e[d-1].color.r*(1-p),n[3*o+1]=e[d].color.g*p+e[d-1].color.g*(1-p),n[3*o+2]=e[d].color.b*p+e[d-1].color.b*(1-p);break}}}else if(t&&"pointCloudClassBreaksRenderer"===u?.type){a=V.Z.fromJSON(u);const e=a.colorClassBreakInfos;n=new Uint8Array(3*r);const s=I(a.fieldTransformType);for(let o=0;o<r;o++){const c=s?s(t[o]):t[o];for(let i=0;i<e.length;i++)if(c>=e[i].minValue&&c<=e[i].maxValue){n[3*o]=e[i].color.r,n[3*o+1]=e[i].color.g,n[3*o+2]=e[i].color.b;break}}}else{n=new Uint8Array(3*r);for(let e=0;e<n.length;e++)n[e]=255}if(l&&a&&a.colorModulation){const e=a.colorModulation.minValue,s=a.colorModulation.maxValue,o=.3;for(let c=0;c<r;c++){const i=l[c],d=i>=s?1:i<=e?o:o+(1-o)*(i-e)/(s-e);n[3*c]=d*n[3*c],n[3*c+1]=d*n[3*c+1],n[3*c+2]=d*n[3*c+2]}}return n}(t.rendererInfo,n,a,r);if(t.filterInfo&&t.filterInfo.length>0&&(0,v.pC)(t.filterAttributesData)){const o=t.filterAttributesData.filter(v.pC).map(c=>{const i=m(c,l,r),d={attributeInfo:c.attributeInfo,values:i};return h.push(d),d});u=new Uint32Array(r),r=function k(f,t,l,r,u){const h=f.length/3;let n=0;for(let a=0;a<h;a++){let e=!0;for(let s=0;s<r.length&&e;s++){const{filterJSON:o}=r[s],c=u[s].values[a];switch(o.type){case"pointCloudValueFilter":{const i="exclude"===o.mode;o.values.includes(c)===i&&(e=!1);break}case"pointCloudBitfieldFilter":{const i=M(o.requiredSetBits),d=M(o.requiredClearBits);(c&i)===i&&!(c&d)||(e=!1);break}case"pointCloudReturnFilter":{const i=15&c,d=c>>>4&15,p=d>1,j=1===i,U=i===d;let O=!1;for(const g of o.includedReturns)if("last"===g&&U||"firstOfMany"===g&&j&&p||"lastOfMany"===g&&U&&p||"single"===g&&!p){O=!0;break}O||(e=!1);break}}}e&&(l[n]=a,f[3*n]=f[3*a],f[3*n+1]=f[3*a+1],f[3*n+2]=f[3*a+2],t[3*n]=t[3*a],t[3*n+1]=t[3*a+1],t[3*n+2]=t[3*a+2],n++)}return n}(l,e,u,t.filterInfo,o)}for(const o of t.userAttributesData){const c=m(o,l,r);h.push({attributeInfo:o.attributeInfo,values:c})}3*r<e.length&&(e=new Uint8Array(e.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(l,r,t.elevationOffset);const s=this._transformCoordinates(l,r,t.obb,S.Z.fromJSON(t.inSR),S.Z.fromJSON(t.outSR));return{obb:t.obb,points:s,rgb:e,attributes:h,pointIdFilterMap:u}}_transformCoordinates(t,l,r,u,h){if(!(0,x.CM)(t,u,0,t,h,0,l))throw new Error("Can't reproject");const n=(0,C.f)(r.center[0],r.center[1],r.center[2]),a=(0,C.c)(),e=(0,C.c)();(0,B.c)(R,r.quaternion);const s=new Float32Array(3*l);for(let o=0;o<l;o++)a[0]=t[3*o]-n[0],a[1]=t[3*o+1]-n[1],a[2]=t[3*o+2]-n[2],(0,F.q)(e,a,R),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(e[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(e[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(e[2])),s[3*o]=a[0],s[3*o+1]=a[1],s[3*o+2]=a[2];return s}_applyElevationOffsetInPlace(t,l,r){if(0!==r)for(let u=0;u<l;u++)t[3*u+2]+=r}}const R=(0,D.c)();function w(){return new E}}}]);
//# sourceMappingURL=3322.093945db8db66bb6.js.map