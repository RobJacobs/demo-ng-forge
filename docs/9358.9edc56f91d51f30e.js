"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[9358],{49358:(k,D,d)=>{d.r(D),d.d(D,{default:()=>ge});var m=d(71670),w=(d(6010),d(1897)),S=d(11823),N=d(32995),j=d(28191),P=d(30801),b=d(55050),R=d(21789),A=d(17409),p=d(53492),v=d(83550),O=d(33510),U=d(93846),T=d(63689),X=d(19482),ee=d(59266),te=d(49389),Z=d(21230);const $=/^\s*"([\S\s]*)"\s*$/,Q=/""/g,V="\n",ne=[","," ",";","|","\t"];function*B(s,n,e){let t=0;for(;t<=s.length;){const i=s.indexOf(n,t),r=s.substring(t,i>-1?i:void 0);t+=r.length+n.length,e&&!r.trim()||(yield r)}}function _(s){const n=s.includes("\r\n")?"\r\n":V;return B(s,n,!0)}function W(s,n){return B(s,n,!1)}function*q(s,n,e,t=(()=>Object.create(null))){const i=_(s);i.next();let r="",o="",a=0,u=t(),f=0;e:for(const E of i){const h=W(E,e);for(const y of h)if(r+=o+y,o="",a+=H(y),a%2==0){if(a>0){const F=$.exec(r);if(!F){u=t(),f=0,r="",a=0;continue e}u[n[f]]=F[1].replace(Q,'"'),f++}else u[n[f]]=r,f++;r="",a=0}else o=e;0===a?(yield u,u=t(),f=0):o=V}}function z(s,n){const e=M(s,n).filter(i=>null!=i),t=e.map(i=>(0,Z.q6)(i));for(let i=t.length-1;i>=0;i--)t[i]||(t.splice(i,1),e.splice(i,1));return{names:t,aliases:e}}function M(s,n){if(!s?.length)return[];const e=[];let t="",i="",r=0;const o=W(s,n);for(const a of o)if(t+=i+a,i="",r+=H(a),r%2==0){if(r>0){const u=$.exec(t);u&&e.push(u[1].replace(Q,'"'))}else e.push(t);t="",r=0}else i=n;return e}function H(s){let n=0,e=0;for(e=s.indexOf('"',e);e>=0;)n++,e=s.indexOf('"',e+1);return n}function re(s,n,e){n=(0,Z.q6)(n)?.toLowerCase(),e=(0,Z.q6)(e)?.toLowerCase();const t=s.map(o=>o.toLowerCase()),i=n?s[t.indexOf(n)]:null,r=e?s[t.indexOf(e)]:null;return{longitudeFieldName:i||s[t.indexOf(de.find(o=>t.includes(o)))],latitudeFieldName:r||s[t.indexOf(ue.find(o=>t.includes(o)))]}}function oe(s){if(!s.length)return"string";const n=/[^+-.,0-9]/;return s.map(e=>{let t=!1;if(""!==e){if(n.test(e))t=!0;else{let i=G(e);if(!isNaN(i))return/[.,]/.test(e)||!Number.isInteger(i)||i>214783647||i<-214783648?"double":"integer";if(e.includes("E")){if(i=Number(e),!isNaN(i))return"double";if(e.includes(",")){if(e=e.replace(",","."),i=Number(e),!isNaN(i))return"double";t=!0}else t=!0}else t=!0}return t?/^[-]?\d*[.,]?\d*$/.test(e)?"string":J(new Date(e),e)?"date":"string":"string"}}).reduce((e,t)=>void 0===e?t:void 0===t?e:e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0)}function J(s,n){if(!s||"[object Date]"!==Object.prototype.toString.call(s)||isNaN(s.getTime()))return!1;let e=!0;if(!ae&&/\d+\W*$/.test(n)){const t=n.match(/[a-zA-Z]{2,}/);if(t){let i=!1,r=0;for(;!i&&r<=t.length;)i=!le.test(t[r]),r++;e=!i}}return e}const G=function(){const s=(0,te.lt)(),n=new RegExp("^"+s.regexp+"$"),e=new RegExp("["+s.group+"\\s\\xa0]","g"),t=s.factor;return i=>{const r=n.exec(i);if(s.factor=t,!r)return NaN;let o=r[1];if(!r[1]){if(!r[2])return NaN;o=r[2],s.factor*=-1}return o=o.replace(e,"").replace(s.decimal,"."),+o*s.factor}}(),le=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,ae=Number.isNaN(new Date("technology 10").getTime()),ue=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],de=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];var K=d(34524),Y=d(19346),ce=d(68230);const fe=(0,K.bU)("esriGeometryPoint"),pe=["csv"],me=[0,0];class ye{constructor(n,e){this.x=n,this.y=e}}class ge{constructor(){var n=this;this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,m.Z)(function*(t){const i=yield n._fetch(t);return n._createFeatures(i)});return function(t){return e.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(n,e={}){var t=this;return(0,m.Z)(function*(){t._loadOptions=n;const[i]=yield Promise.all([t._fetch(e.signal),t._checkProjection(n?.parsingOptions?.spatialReference)]),r=function he(s,n){const e=n.parsingOptions||{},t={delimiter:e.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:e.latitudeField,longitudeFieldName:e.longitudeField}},i=t.layerDefinition={name:(0,b.vt)(n.url,pe)||"csv",drawingInfo:fe,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:e.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:e.spatialReference||{wkid:4326}}},r=_(s),o=r.next().value?.trim(),a=r.next().value?.trim();if(!o)throw new N.Z("csv-layer:empty-csv","CSV is empty",{csv:s});const{delimiter:u,locationInfo:f}=function ie(s,n,e){s=s.trim(),n=n?.trim();const t=[],i=Array.from(new Set([e?.delimiter,...ne])).filter(o=>null!=o);for(const o of i){const a=M(s,o).length,u=M(n,o).length??a;a>1&&t.push({weight:Math.min(a,u),delimiter:o})}const r=t.sort(({weight:o},{weight:a})=>a-o).map(({delimiter:o})=>o);for(const o of r){const a=re(z(s,o).names,e?.longitudeField,e?.latitudeField);if(a.longitudeFieldName&&a.latitudeFieldName)return{delimiter:o,locationInfo:a}}return{delimiter:r[0],locationInfo:null}}(o,a,e);if(!u)throw new N.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:o,secondLine:a,parsingOptions:e});if(!f)throw new N.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file",{firstLine:o,secondLine:a,parsingOptions:e});t.locationInfo=f,t.delimiter=u;const{names:E,aliases:h}=z(o,u),y=function se(s,n,e,t,i){const r=[],o=q(s,e,n),a=[];for(const u of o){if(10===a.length)break;a.push(u)}for(let u=0;u<e.length;u++){const f=e[u],E=t[u];if(f===i.longitudeFieldName||f===i.latitudeFieldName)r.push({name:f,type:"esriFieldTypeDouble",alias:E});else{let h,y;switch(oe(a.map(F=>F[f]))){case"integer":h="esriFieldTypeInteger";break;case"double":h="esriFieldTypeDouble";break;case"date":h="esriFieldTypeDate",y=36;break;default:h="esriFieldTypeString",y=255}r.push({name:f,type:h,alias:E,length:y})}}return r}(s,t.delimiter,E,h,t.locationInfo);if(e.fields?.length){const c=new Y.Z(e.fields);for(const l of y){const I=c.get(l.name);I&&Object.assign(l,I)}}if(!y.some(c=>"esriFieldTypeOID"===c.type&&(i.objectIdField=c.name,!0))){const c={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};i.objectIdField=c.name,y.unshift(c)}i.fields=y;const F=new Y.Z(i.fields);if(t.locationInfo&&(t.locationInfo.latitudeFieldName=F.get(t.locationInfo.latitudeFieldName).name,t.locationInfo.longitudeFieldName=F.get(t.locationInfo.longitudeFieldName).name),i.timeInfo){const c=i.timeInfo;if(c.startTimeField){const l=F.get(c.startTimeField);l?(c.startTimeField=l.name,l.type="esriFieldTypeDate"):c.startTimeField=null}if(c.endTimeField){const l=F.get(c.endTimeField);l?(c.endTimeField=l.name,l.type="esriFieldTypeDate"):c.endTimeField=null}if(c.trackIdField){const l=F.get(c.trackIdField);c.trackIdField=l?l.name:null}c.startTimeField||c.endTimeField||(i.timeInfo=null)}return t}(i,n);t._locationInfo=r.locationInfo,t._delimiter=r.delimiter,t._queryEngine=t._createQueryEngine(r);const o=yield t._createFeatures(i);t._queryEngine.featureStore.addMany(o);const{fullExtent:a,timeExtent:u}=yield t._queryEngine.fetchRecomputedExtents();if(r.layerDefinition.extent=a,u){const{start:f,end:E}=u;r.layerDefinition.timeInfo.timeExtent=[f,E]}return r})()}applyEdits(){return(0,m.Z)(function*(){throw new N.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQuery(n,e.signal)})()}queryFeatureCount(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForCount(n,e.signal)})()}queryObjectIds(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForIds(n,e.signal)})()}queryExtent(n={},e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForExtent(n,e.signal)})()}querySnapping(n,e={}){var t=this;return(0,m.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForSnapping(n,e.signal)})()}refresh(n){var e=this;return(0,m.Z)(function*(){e._loadOptions.customParameters=n,e._snapshotTask?.abort(),e._snapshotTask=(0,S.vr)(e._snapshotFeatures),e._snapshotTask.promise.then(r=>{e._queryEngine.featureStore.clear(),r&&e._queryEngine.featureStore.addMany(r)},r=>{e._queryEngine.featureStore.clear(),(0,P.D_)(r)||j.Z.getLogger("esri.layers.CSVLayer").error(new N.Z("csv-layer:refresh","An error occurred during refresh",{error:r}))}),yield e._waitSnapshotComplete();const{fullExtent:t,timeExtent:i}=yield e._queryEngine.fetchRecomputedExtents();return{extent:t,timeExtent:i}})()}_waitSnapshotComplete(){var n=this;return(0,m.Z)(function*(){if(n._snapshotTask&&!n._snapshotTask.finished){try{yield n._snapshotTask.promise}catch{}return n._waitSnapshotComplete()}})()}_fetch(n){var e=this;return(0,m.Z)(function*(){const{url:t,customParameters:i}=e._loadOptions;if(!t)throw new N.Z("csv-layer:invalid-source","url not defined");const r=(0,b.mN)(t);return(yield(0,w.default)(r.path,{query:{...r.query,...i},responseType:"text",signal:n})).data})()}_createQueryEngine(n){const{objectIdField:e,fields:t,extent:i,timeInfo:r}=n.layerDefinition,o=new T.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new ee.q({fields:t,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:r,objectIdField:e,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:o})}_createFeatures(n){var e=this;return(0,m.Z)(function*(){const{latitudeFieldName:t,longitudeFieldName:i}=e._locationInfo,{objectIdField:r,fieldsIndex:o,spatialReference:a}=e._queryEngine;let u=[];const f=[],E=o.fields.filter(l=>l.name!==r).map(l=>l.name);let h=0;const y={};for(const l of o.fields)if("esriFieldTypeOID"!==l.type&&"esriFieldTypeGlobalID"!==l.type){const I=(0,Z.os)(l);void 0!==I&&(y[l.name]=I)}const F=q(n,E,e._delimiter,(0,K.Dm)(y,r));for(const l of F){const I=e._parseCoordinateValue(l[t]),x=e._parseCoordinateValue(l[i]);if(null!=x&&null!=I&&!isNaN(I)&&!isNaN(x)){l[t]=I,l[i]=x;for(const g in l)if(g!==t&&g!==i)if(o.isDateField(g)){const C=new Date(l[g]);l[g]=J(C,l[g])?C.getTime():null}else if(o.isNumericField(g)){const C=G(l[g]);l[g]=isNaN(C)?null:C}l[r]=h,h++,u.push(new ye(x,I)),f.push(l)}}if(!(0,p.fS)({wkid:4326},a))if((0,p.sS)(a))for(const l of u)[l.x,l.y]=(0,v.hG)(l.x,l.y,me);else u=(0,R.oj)(A.N,u,ce.Z.WGS84,a,null,null);const c=[];for(let l=0;l<u.length;l++){const{x:I,y:x}=u[l],g=f[l];g[r]=l+1,c.push(new O.u_(new U.Z([],[I,x]),g,null,g[r]))}return c})()}_parseCoordinateValue(n){if(null==n||""===n)return null;let e=G(n);return(isNaN(e)||Math.abs(e)>181)&&(e=parseFloat(n)),e}_checkProjection(n){return(0,m.Z)(function*(){try{yield(0,X._W)(p.Zn,n)}catch{throw new N.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}},34524:(k,D,d)=>{d.d(D,{Dm:()=>b,Hq:()=>R,MS:()=>A,bU:()=>N});var m=d(67087),L=d(88684),w=d(29374),S=d(66071);function N(p){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===p||"esriGeometryMultipoint"===p?S.I4:"esriGeometryPolyline"===p?S.ET:S.lF}}}const j=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let P=1;function b(p,v){if((0,m.Z)("esri-csp-restrictions"))return()=>({[v]:null,...p});try{let O=`this.${v} = null;`;for(const T in p)O+=`this${j.test(T)?`.${T}`:`["${T}"]`} = ${JSON.stringify(p[T])};`;const U=new Function(`\n      return class AttributesClass$${P++} {\n        constructor() {\n          ${O};\n        }\n      }\n    `)();return()=>new U}catch{return()=>({[v]:null,...p})}}function R(p={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,L.d9)(p)}}]}function A(p,v){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:p},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:v,supportsDelete:v,supportsEditing:v,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:v,supportsExceedsLimitStatistics:!0},query:w.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:v,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);
//# sourceMappingURL=9358.9edc56f91d51f30e.js.map