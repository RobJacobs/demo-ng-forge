"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[9764],{40241:(Zt,St,u)=>{u.d(St,{b:()=>Z,j:()=>q});var k=u(71670),_t=u(74792),mt=u(67087);const $=128e3;let F=null,j=null;function q(){return tt.apply(this,arguments)}function tt(){return tt=(0,k.Z)(function*(){return F||(F=function H(){return ht.apply(this,arguments)}()),F}),tt.apply(this,arguments)}function ht(){return(ht=(0,k.Z)(function*(){j=yield((0,mt.Z)("esri-csp-restrictions")?yield u.e(8030).then(u.bind(u,68030)).then(N=>N.l):yield u.e(5956).then(u.bind(u,65956)).then(N=>N.l)).load({locateFile:N=>(0,_t.V)(`esri/core/libs/libtess/${N}`)})})).apply(this,arguments)}function Z(Mt,N){const W=Math.max(Mt.length,$);return j.triangulate(Mt,N,W)}},86636:(Zt,St,u)=>{u.d(St,{i:()=>mt});var k=u(63291),_t=u(5780);class mt{static getPlacement(F,j,q,tt,H){const ht=(0,_t.W)(j);if(!ht)return null;const Z=(0,k.GP)(F);return ht.execute(Z,j,q,tt,H)}}},35246:(Zt,St,u)=>{u.d(St,{z:()=>N});var k=u(20877),_t=u(80696);function mt(W,d){return W.x===d.x&&W.y===d.y}function F(W,d){return W.x=d.y,W.y=-d.x,W}function j(W,d){return W.x=-d.y,W.y=d.x,W}function q(W,d){return W.x=d.x,W.y=d.y,W}function tt(W,d){return W.x=-d.x,W.y=-d.y,W}function H(W){return Math.sqrt(W.x*W.x+W.y*W.y)}function ht(W,d){return W.x*d.y-W.y*d.x}function Z(W,d){return W.x*d.x+W.y*d.y}function Mt(W,d,L,p){return W.x=d.x*L+d.y*p,W.y=d.x*p-d.y*L,W}class N{constructor(d,L,p){this._writeVertex=d,this._writeTriangle=L,this._canUseThinTessellation=p,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(d,L){(function $(W){if(!W)return;const d=W.length;if(d<=1)return;let L=0;for(let p=1;p<d;p++)mt(W[p],W[L])||++L===p||(W[L]=W[p]);W.length=L+1})(d),this._canUseThinTessellation&&L.halfWidth<_t.tQ&&!L.offset?this._tessellateThin(d,L):this._tessellate(d,L)}_tessellateThin(d,L){if(d.length<2)return;const p=L.wrapDistance||65535;let S=L.initialDistance||0,nt=!1,at=d[0].x,ot=d[0].y;const m=d.length;for(let c=1;c<m;++c){nt&&(nt=!1,S=0);let g=d[c].x,T=d[c].y,b=g-at,D=T-ot,P=Math.sqrt(b*b+D*D);if(b/=P,D/=P,S+P>p){nt=!0;const _=(p-S)/P;P=p-S,g=(1-_)*at+_*g,T=(1-_)*ot+_*T,--c}const O=this._writeVertex(at,ot,0,0,b,D,D,-b,0,-1,S),K=this._writeVertex(at,ot,0,0,b,D,-D,b,0,1,S);S+=P;const I=this._writeVertex(g,T,0,0,b,D,D,-b,0,-1,S),y=this._writeVertex(g,T,0,0,b,D,-D,b,0,1,S);this._writeTriangle(O,K,I),this._writeTriangle(K,I,y),at=g,ot=T}}_tessellate(d,L){const S=d[d.length-1],nt=mt(d[0],S);if(d.length<(nt?3:2))return;const ot=L.pixelCoordRatio,m=null!=L.capType?L.capType:k.RL.BUTT,c=null!=L.joinType?L.joinType:k.AH.MITER,g=null!=L.miterLimit?Math.min(L.miterLimit,4):2,T=null!=L.roundLimit?Math.min(L.roundLimit,1.05):1.05,b=null!=L.halfWidth?L.halfWidth:2,D=!!L.textured;let P,O,K,I=null;const y=this._prevNormal,_=this._nextNormal;let rt=-1,Q=-1;const it=this._joinNormal;let ct,ft;const gt=this._textureNormalLeft,Rt=this._textureNormalRight,bt=this._textureNormal;let vt=-1,Tt=-1;const zt=L.wrapDistance||65535;let yt=L.initialDistance||0;const Ht=this._writeVertex,Yt=this._writeTriangle,Ct=(a,v,f,E,R,U)=>{const Y=Ht(O,K,ct,ft,f,E,a,v,R,U,yt);return vt>=0&&Tt>=0&&Y>=0&&Yt(vt,Tt,Y),vt=Tt,Tt=Y,Y};nt&&(P=d[d.length-2],_.x=S.x-P.x,_.y=S.y-P.y,Q=H(_),_.x/=Q,_.y/=Q);let X=!1;for(let a=0;a<d.length;++a){if(X&&(X=!1,yt=0),P&&(y.x=-_.x,y.y=-_.y,rt=Q,yt+rt>zt&&(X=!0)),X){const G=(zt-yt)/rt;rt=zt-yt,P={x:(1-G)*P.x+G*d[a].x,y:(1-G)*P.y+G*d[a].y},--a}else P=d[a];O=P.x,K=P.y;const v=a<=0&&!X,f=a===d.length-1;if(v||(yt+=rt),I=f?nt?d[1]:null:d[a+1],I?(_.x=I.x-O,_.y=I.y-K,Q=H(_),_.x/=Q,_.y/=Q):(_.x=void 0,_.y=void 0),!nt){if(v){j(it,_),ct=it.x,ft=it.y,m===k.RL.SQUARE&&(Ct(-_.y-_.x,_.x-_.y,_.x,_.y,0,-1),Ct(_.y-_.x,-_.x-_.y,_.x,_.y,0,1)),m===k.RL.ROUND&&(Ct(-_.y-_.x,_.x-_.y,_.x,_.y,-1,-1),Ct(_.y-_.x,-_.x-_.y,_.x,_.y,-1,1)),m!==k.RL.ROUND&&m!==k.RL.BUTT||(Ct(-_.y,_.x,_.x,_.y,0,-1),Ct(_.y,-_.x,_.x,_.y,0,1));continue}if(f){F(it,y),ct=it.x,ft=it.y,m!==k.RL.ROUND&&m!==k.RL.BUTT||(Ct(y.y,-y.x,-y.x,-y.y,0,-1),Ct(-y.y,y.x,-y.x,-y.y,0,1)),m===k.RL.SQUARE&&(Ct(y.y-y.x,-y.x-y.y,-y.x,-y.y,0,-1),Ct(-y.y-y.x,y.x-y.y,-y.x,-y.y,0,1)),m===k.RL.ROUND&&(Ct(y.y-y.x,-y.x-y.y,-y.x,-y.y,1,-1),Ct(-y.y-y.x,y.x-y.y,-y.x,-y.y,1,1));continue}}let E,R,U=-ht(y,_);if(Math.abs(U)<.01)Z(y,_)>0?(it.x=y.x,it.y=y.y,U=1,E=Number.MAX_VALUE,R=!0):(j(it,_),U=1,E=1,R=!1);else{it.x=(y.x+_.x)/U,it.y=(y.y+_.y)/U,E=H(it);const G=(E-1)*b*ot;R=E>4||G>rt&&G>Q}ct=it.x,ft=it.y;let Y=c;switch(c){case k.AH.BEVEL:E<1.05&&(Y=k.AH.MITER);break;case k.AH.ROUND:E<T&&(Y=k.AH.MITER);break;case k.AH.MITER:E>g&&(Y=k.AH.BEVEL)}switch(Y){case k.AH.MITER:if(Ct(it.x,it.y,-y.x,-y.y,0,-1),Ct(-it.x,-it.y,-y.x,-y.y,0,1),f)break;if(D){const G=X?0:yt;vt=this._writeVertex(O,K,ct,ft,_.x,_.y,it.x,it.y,0,-1,G),Tt=this._writeVertex(O,K,ct,ft,_.x,_.y,-it.x,-it.y,0,1,G)}break;case k.AH.BEVEL:{const G=U<0;let st,lt,J,Wt;if(G){const Lt=vt;vt=Tt,Tt=Lt,st=gt,lt=Rt}else st=Rt,lt=gt;if(R)J=G?j(this._innerPrev,y):F(this._innerPrev,y),Wt=G?F(this._innerNext,_):j(this._innerNext,_);else{const Lt=G?tt(this._inner,it):q(this._inner,it);J=Lt,Wt=Lt}const Et=G?F(this._bevelStart,y):j(this._bevelStart,y);Ct(J.x,J.y,-y.x,-y.y,st.x,st.y);const Kt=Ct(Et.x,Et.y,-y.x,-y.y,lt.x,lt.y);if(f)break;const xt=G?j(this._bevelEnd,_):F(this._bevelEnd,_);if(R){const Lt=this._writeVertex(O,K,ct,ft,-y.x,-y.y,0,0,0,0,yt);vt=this._writeVertex(O,K,ct,ft,_.x,_.y,Wt.x,Wt.y,st.x,st.y,yt),Tt=this._writeVertex(O,K,ct,ft,_.x,_.y,xt.x,xt.y,lt.x,lt.y,yt),this._writeTriangle(Kt,Lt,Tt)}else{if(D){const Lt=this._bevelMiddle;Lt.x=(Et.x+xt.x)/2,Lt.y=(Et.y+xt.y)/2,Mt(bt,Lt,-y.x,-y.y),Ct(Lt.x,Lt.y,-y.x,-y.y,bt.x,bt.y),Mt(bt,Lt,_.x,_.y),vt=this._writeVertex(O,K,ct,ft,_.x,_.y,Lt.x,Lt.y,bt.x,bt.y,yt),Tt=this._writeVertex(O,K,ct,ft,_.x,_.y,Wt.x,Wt.y,st.x,st.y,yt)}else{const Lt=vt;vt=Tt,Tt=Lt}Ct(xt.x,xt.y,_.x,_.y,lt.x,lt.y)}if(G){const Lt=vt;vt=Tt,Tt=Lt}break}case k.AH.ROUND:{const G=U<0;let st,lt;if(G){const At=vt;vt=Tt,Tt=At,st=gt,lt=Rt}else st=Rt,lt=gt;const J=G?tt(this._inner,it):q(this._inner,it);let Wt,Et;R?(Wt=G?j(this._innerPrev,y):F(this._innerPrev,y),Et=G?F(this._innerNext,_):j(this._innerNext,_)):(Wt=J,Et=J);const Kt=G?F(this._roundStart,y):j(this._roundStart,y),xt=G?j(this._roundEnd,_):F(this._roundEnd,_),Lt=Ct(Wt.x,Wt.y,-y.x,-y.y,st.x,st.y),It=Ct(Kt.x,Kt.y,-y.x,-y.y,lt.x,lt.y);if(f)break;const pt=this._writeVertex(O,K,ct,ft,-y.x,-y.y,0,0,0,0,yt);R||this._writeTriangle(vt,Tt,pt);const wt=tt(this._outer,J),Ot=this._writeVertex(O,K,ct,ft,_.x,_.y,xt.x,xt.y,lt.x,lt.y,yt);let Ut,Bt;const Jt=E>2;if(Jt){let At;E!==Number.MAX_VALUE?(wt.x/=E,wt.y/=E,At=Z(y,wt),At=(E*(At*At-1)+1)/At):At=-1,Ut=G?F(this._startBreak,y):j(this._startBreak,y),Ut.x+=y.x*At,Ut.y+=y.y*At,Bt=G?j(this._endBreak,_):F(this._endBreak,_),Bt.x+=_.x*At,Bt.y+=_.y*At}Mt(bt,wt,-y.x,-y.y);const Vt=this._writeVertex(O,K,ct,ft,-y.x,-y.y,wt.x,wt.y,bt.x,bt.y,yt);Mt(bt,wt,_.x,_.y);const jt=D?this._writeVertex(O,K,ct,ft,_.x,_.y,wt.x,wt.y,bt.x,bt.y,yt):Vt,ne=pt,te=D?this._writeVertex(O,K,ct,ft,_.x,_.y,0,0,0,0,yt):pt;let qt=-1,ee=-1;if(Jt&&(Mt(bt,Ut,-y.x,-y.y),qt=this._writeVertex(O,K,ct,ft,-y.x,-y.y,Ut.x,Ut.y,bt.x,bt.y,yt),Mt(bt,Bt,_.x,_.y),ee=this._writeVertex(O,K,ct,ft,_.x,_.y,Bt.x,Bt.y,bt.x,bt.y,yt)),D?Jt?(this._writeTriangle(ne,It,qt),this._writeTriangle(ne,qt,Vt),this._writeTriangle(te,jt,ee),this._writeTriangle(te,ee,Ot)):(this._writeTriangle(ne,It,Vt),this._writeTriangle(te,jt,Ot)):Jt?(this._writeTriangle(pt,It,qt),this._writeTriangle(pt,qt,ee),this._writeTriangle(pt,ee,Ot)):(this._writeTriangle(pt,It,Vt),this._writeTriangle(pt,jt,Ot)),R?(vt=this._writeVertex(O,K,ct,ft,_.x,_.y,Et.x,Et.y,st.x,st.y,yt),Tt=Ot):(vt=D?this._writeVertex(O,K,ct,ft,_.x,_.y,Et.x,Et.y,st.x,st.y,yt):Lt,this._writeTriangle(vt,te,Ot),Tt=Ot),G){const At=vt;vt=Tt,Tt=At}break}}}}}},29541:(Zt,St,u)=>{u.d(St,{_:()=>O}),u(22504),u(45396);var mt=u(67026),j=(u(90026),u(58988),u(80696)),q=u(21288),tt=u(20753),H=u(52300);const ht=new Map;ht.set(tt.LW.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),ht.set(tt.LW.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),ht.set(tt.LW.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),ht.set(tt.LW.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),ht.set(tt.LW.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var Mt=u(68741);class N{constructor(I,y,_){this._start={index:0,vertex:0};const rt=function Z(K,I,y){const{indicesPerRecord:_,multiplier:rt,verticesPerRecord:Q}=ht.get(K);return{recordBytes:y*j.XJ*Uint32Array.BYTES_PER_ELEMENT,indexBytes:rt*_*y*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:rt*Q*y*I}}(I,y,_),Q=y/4;this.geometryType=I,this._records=new Mt.Z(Int32Array,rt.recordBytes),this._indices=new Mt.Z(Uint32Array,rt.indexBytes),this._vertices=new Mt.Z(Uint32Array,rt.vertexBytes),this._metrics=new Mt.Z(Float32Array,0),this._strideInt=Q}serialize(I){const y=this._records.buffer(),_=this._indices.buffer(),rt=this._vertices.buffer(),Q=this._metrics.length?this._metrics.buffer():null,it=4*this._strideInt;return I.push(y,_,rt),{stride:it,records:y,indices:_,vertices:rt,metrics:Q}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/j.XJ}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(I){this._vertices.ensureSize(I)}indexEnsureSize(I){this._indices.ensureSize(I)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(I,y,_,rt,Q,it,ct,ft){this._records.push(I),this._records.push(y??0),this._records.push(_),this._records.push(rt),this._records.push(Q),this._records.push(it),this._records.push(ct),this._records.writeF32(ft)}writeIndex(I){this._indices.push(I)}writeVertex(I){this._vertices.push(I)}writeVertexF32(I){this._vertices.writeF32(I)}copyLastFrom(I,y,_){const rt=I._records.length-j.XJ,Q=I._records.getValue(rt),it=I._records.getValue(rt+1),ct=I._records.getValue(rt+2),ft=I._records.getValue(rt+4),gt=I._records.getValue(rt+6),Rt=I._records.getValue(rt+7),bt=this._vertices.length,vt=(I._start.vertex-this._vertices.length)/this._strideInt,Tt=this._indices.length,zt=this.vertexCount;for(let yt=I._start.index;yt!==I._indices.length;yt++){const Ht=I._indices.getValue(yt);this._indices.push(Ht-vt)}for(let yt=I._start.vertex;yt!==I._vertices.length;yt++){const Ht=I._vertices.getValue(yt);this._vertices.push(Ht)}for(let yt=bt;yt<=this._vertices.length;yt+=this._strideInt)this._vertices.i1616Add(yt,y,_);this._records.push(Q),this._records.push(it),this._records.push(ct),this._records.push(Tt),this._records.push(ft),this._records.push(zt),this._records.push(gt),this._records.push(Rt)}}var W=u(65342);function c(K){switch(K){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function g(K){switch(K){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}class O{constructor(I,y,_,rt,Q,it=0){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._version=0,this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=y,this.tileKey=I,this._hasAggregate=rt,this._pixelBufferEnabled=Q,this._version=it,this._symbologyType=_}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(I){const y=[];return y.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((_,rt)=>{const Q=1<<rt,it=c(Q),ct=g(Q),ft=(0,W.M)(new mt.Z(this.tileKey),it,ct,I),gt=this._serializeTileVertexData(this.tileKey,ft.id,_.vertexData);gt.message.bufferIds=_.displayIds,y.push(gt)}),y}_serializeTileVertexData(I,y,_){const rt=new Array;return{message:{tileKeyOrigin:I,tileKey:y,data:{[tt.LW.MARKER]:_.get(tt.LW.MARKER)?.serialize(rt),[tt.LW.FILL]:_.get(tt.LW.FILL)?.serialize(rt),[tt.LW.LINE]:_.get(tt.LW.LINE)?.serialize(rt),[tt.LW.TEXT]:_.get(tt.LW.TEXT)?.serialize(rt),[tt.LW.LABEL]:_.get(tt.LW.LABEL)?.serialize(rt)},version:this._version},transferList:rt}}featureStart(I,y){this._current.insertAfter=I,this._current.sortKey=y}featureEnd(){}recordStart(I,y,_,rt){this._current.writer=this._getVertexWriter(_),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=rt,this._current.id=I,this._current.materialKey=y,this._current.geometryType=_,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(I){this._current.writer.vertexEnsureSize(I)}indexEnsureSize(I){this._current.writer.indexEnsureSize(I)}vertexBounds(I,y,_,rt){this._current.bufferingEnabled&&this._addOverlap(I,y,_,rt)}vertexWrite(I){this._current.writer.writeVertex(I)}vertexWriteF32(I){this._current.writer.writeVertexF32(I)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(I){this._current.writer.writeIndex(I)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(I,y,_,rt,Q,it,ct,ft){this._current.writer=this._getVertexWriter(tt.LW.LABEL);const gt=this._current.writer.metricWriter;gt.push((0,q.jL)(I)),gt.push(y),gt.push(_),gt.push(rt),gt.push(Q),gt.push(it),gt.push(ct),gt.push(ft),gt.push(255),this._current.metricBoxLenPointer=gt.push(0)}metricEnd(){const I=this._current.writer.metricWriter;0===I.getValue(this._current.metricBoxLenPointer)&&I.seek(I.length-10)}metricBoxWrite(I,y,_,rt){const Q=this._current.writer.metricWriter;Q.incr(this._current.metricBoxLenPointer),Q.push(0),Q.push(0),Q.push(I),Q.push(y),Q.push(_),Q.push(rt)}recordEnd(){const I=this._current.vertStart,y=this._current.writer.vertexCount-I;if(!y)return!1;this.hasRecords=!0;const _=this._current.indexStart;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,_,this._current.writer.indexCount-_,I,y,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===tt.LW.LABEL)return!0;const Q=this._current.writer;for(let it=0;it<8;it++){const ct=1<<it;if(this._current.overlaps&ct){this._data.neighbors[it]||(this._data.neighbors[it]={vertexData:new Map,displayIds:new Set});const ft=this._data.neighbors[it],gt=this._current.geometryType;if(!ft.vertexData.has(gt)){const zt=(0,H.$_)(gt,this._symbologyType).geometry,yt=new N(gt,zt,j.Ip);ft.vertexData.set(gt,yt)}const Rt=ft.vertexData.get(this._current.geometryType),bt=8,vt=512*-c(ct)*bt,Tt=512*-g(ct)*bt;Rt?.copyLastFrom(Q,vt,Tt),ft.displayIds.add(this._current.id)}}return!0}_addOverlap(I,y,_,rt){this._current.overlaps|=255^((I<0+_?148:I>=j.I_-_?41:189)|(y<0+rt?224:y>=j.I_-rt?7:231))}_getVertexWriter(I){if(!this._data.self.has(I)){const y=this._data.self,_=(0,H.$_)(I,this._symbologyType).geometry;y.set(I,new N(I,_,this.hint.records))}return this._data.self.get(I)}}},13615:(Zt,St,u)=>{u.d(St,{j:()=>Ct});var k=u(71670),mt=(u(67087),u(53661)),$=u(30801),F=u(40241),j=u(21288),q=u(32995),tt=u(28191),H=u(93142),ht=u(55798),Z=u(53072),Mt=u(80309),N=u(20877),W=u(81925),d=u(9203),L=u(80696),p=u(20753),S=u(72375),nt=u(21605),at=u(85366);function m(X){return X.length-1}function g(X,a,v=1){const[f,E]=function ot(X,a){return X[a+1]}(X,a);return Math.sqrt(f*f+E*E)*v}class T{constructor(a,v,f,E,R){this._segments=a,this._index=v,this._distance=f,this._xStart=E,this._yStart=R,this._done=!1}static create(a){return new T(a,0,0,a[0][0],a[0][1])}clone(){return new T(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(a){return this._index===a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+1&&(1===this._distance||0===a._distance)}leq(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance}geq(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance}get _segment(){return this._segments[this._index+1]}get angle(){const a=this.dy;let f=Math.acos((0*a+-1*-this.dx)/(1*this.length));return a>0&&(f=2*Math.PI-f),f}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:a,dy:v}=this;return Math.sqrt(a*a+v*v)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<m(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(a,v){const f=this.backwardLength;if(a<=f)return this._distance=(f-a)/this.length,this;let E=this.backwardLength;for(;this.prev();){if(E+this.length>a)return this._seekBackwards(a-E);E+=this.length}return this._distance=0,v?this:null}seek(a,v=!1){if(a<0)return this._seekBackwards(Math.abs(a),v);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;let f=this.remainingLength;for(;this.next();){if(f+this.length>a)return this.seek(a-f,v);f+=this.length}return this._distance=1,v?this:null}}function b(X,a,v,f=!0){const E=function c(X){let a=0;for(let v=0;v<m(X);v++)a+=g(X,v);return a}(X),R=T.create(X),U=E/2;if(!f)return R.seek(U),void v(R.clone(),0,U+0*a,E);const Y=Math.max((E-a)/2,0),G=Math.floor(Y/a);R.seek(U-G*a);for(let lt=-G;lt<=G;lt++)R.x<512&&R.x>=0&&R.y<512&&R.y>=0&&v(R.clone(),lt,U+lt*a,E),R.seek(a)}function K(X,a){if(a<=0)return;const f=X.length;if(f<3)return;const E=[];let R=0;E.push(0);for(let J=1;J<f;J++)R+=(0,at.TK)(X[J],X[J-1]),E.push(R);a=Math.min(a,.2*R);const U=[];U.push(X[0][0]),U.push(X[0][1]);const Y=X[f-1][0],G=X[f-1][1],st=(0,at.lu)([0,0],X[0],X[1]);(0,at.Fv)(st),X[0][0]+=a*st[0],X[0][1]+=a*st[1],(0,at.lu)(st,X[f-1],X[f-2]),(0,at.Fv)(st),X[f-1][0]+=a*st[0],X[f-1][1]+=a*st[1];for(let J=1;J<f;J++)E[J]+=a;E[f-1]+=a;const lt=.5*a;for(let J=1;J<f-1;J++){let Wt=0,Et=0,Kt=0;for(let xt=J-1;xt>=0&&!(E[xt+1]<E[J]-lt);xt--){const Lt=lt+E[xt+1]-E[J],It=E[xt+1]-E[xt],pt=E[J]-E[xt]<lt?1:Lt/It;if(Math.abs(pt)<1e-6)break;const wt=pt*pt,Ot=pt*Lt-.5*wt*It,Ut=pt*It/a,Bt=X[xt+1],Jt=X[xt][0]-Bt[0],Vt=X[xt][1]-Bt[1];Wt+=Ut/Ot*(Bt[0]*pt*Lt+.5*wt*(Lt*Jt-It*Bt[0])-wt*pt*It*Jt/3),Et+=Ut/Ot*(Bt[1]*pt*Lt+.5*wt*(Lt*Vt-It*Bt[1])-wt*pt*It*Vt/3),Kt+=Ut}for(let xt=J+1;xt<f&&!(E[xt-1]>E[J]+lt);xt++){const Lt=lt-E[xt-1]+E[J],It=E[xt]-E[xt-1],pt=E[xt]-E[J]<lt?1:Lt/It;if(Math.abs(pt)<1e-6)break;const wt=pt*pt,Ot=pt*Lt-.5*wt*It,Ut=pt*It/a,Bt=X[xt-1],Jt=X[xt][0]-Bt[0],Vt=X[xt][1]-Bt[1];Wt+=Ut/Ot*(Bt[0]*pt*Lt+.5*wt*(Lt*Jt-It*Bt[0])-wt*pt*It*Jt/3),Et+=Ut/Ot*(Bt[1]*pt*Lt+.5*wt*(Lt*Vt-It*Bt[1])-wt*pt*It*Vt/3),Kt+=Ut}U.push(Wt/Kt),U.push(Et/Kt)}U.push(Y),U.push(G);for(let J=0,Wt=0;J<f;J++)X[J][0]=U[Wt++],X[J][1]=U[Wt++]}var I=u(36780);const y=tt.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),bt=function Rt(X){const a=new Map;return v=>(a.has(v)||a.set(v,X(v)),a.get(v))}(X=>{let a=0;if(0===X)return 1/0;for(;!(X%2);)a++,X/=2;return a}),vt=X=>Math.floor(127*X+127),Tt=X=>Math.floor(10*X),zt=X=>Math.round(X*(254/360));class yt extends I.Z{constructor(a,v,f,E){super(a,f.font?.size,f.haloSize||0,f.font?.size,f.color&&(0,d.aH)(f.color)||0,f.haloColor&&(0,d.aH)(f.haloColor)||0,f.horizontalAlignment,f.verticalAlignment,(0,W.NS)(v.labelPlacement)?N.v2.MAP:N.v2.SCREEN,f.font?.decoration,!1,f.angle||0,f.xoffset,f.yoffset,f.lineWidth,f.lineHeight,null,null,!1,null,null,f.backgroundColor&&(0,d.aH)(f.backgroundColor),f.borderLineColor&&(0,d.aH)(f.borderLineColor),f.borderLineSize),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=p.LW.LABEL,this._allowOverrun=v.allowOverrun??!1,this._repeatLabel=v.repeatLabel??!0,this._labelPosition=v.labelPosition??"curved";const R=function ft(X,a){const v=!!X.minScale&&a.scaleToZoom(X.minScale)||0;return(0,H.uZ)(v,0,25.5)}(v,E),U=function gt(X,a){const v=!!X.maxScale&&a.scaleToZoom(X.maxScale)||255;return(0,H.uZ)(v,0,25.5)}(v,E),Y=v.labelPlacement,[G,st]=(0,W.qv)(Y);this._xAlignD=G,this._yAlignD=st,this._minZoom=R,this._maxZoom=U,this._minBackgroundZoom=R,this._maxBackgroundZoom=U,this._refPlacementPadding=(0,ht.F2)(f.haloSize)+L.Iw,this._repeatLabelDistance=v.repeatLabelDistance?(0,ht.F2)(v.repeatLabelDistance):128;const lt=nt.Gq.load(a);lt.sdf=!0,this._materialKey=lt.data}static fromLabelClass(a,v){if("esriServerLinePlacementCenterAlong"===a.labelPlacement){const f=a.symbol;f.xoffset=0,f.yoffset=0,f.angle=0,f.font.decoration="none"}return new yt(a.materialKey,a,a.symbol,v)}get _shapedBox(){return(0,mt.Wg)(this._shapingInfo).bounds}setZoomLevel(a){this._zoomLevel=a}bindReferenceTemplate(a){let v=(0,W.g)(this._xAlignD),f=(0,W.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,mt.Wi)(a))return void(this._refSymbolAndPlacementOffset=(0,S.Jz)(0,0,vt(v),vt(f)));if("circle"===a.boundsType&&(v||f)){const U=Math.sqrt(v*v+f*f);v/=U,f/=U}const E=Math.max(a.height,a.width);this._refSymbolAndPlacementOffset=(0,S.Jz)(4*this._refPlacementPadding,E,vt(v),vt(f)),this._referenceSize=E,this._refPlacementDirX=v,this._refPlacementDirY=f,this._refOffsetX=a.xOffset,this._refOffsetY=a.yOffset}_write(a,v){if((0,mt.Wi)(this._shapingInfo))return;const f=this._shapingInfo,E=v.getDisplayId(),R="esriGeometryPolygon"===v.geometryType?v.readLegacyCentroid():v.readLegacyGeometry();if(R)switch(this._current={out:a,inId:E,inShaping:f,zoomLevel:this._zoomLevel},"esriGeometryPolyline"===v.geometryType&&"curved"===this._labelPosition&&(this._borderLineColor||this._backgroundColor)&&y.warnOnce("TextSymbol properties 'borderLineColor', 'borderLineSize', and 'backgroundColor' are not supported in curved labels"),v.geometryType){case"esriGeometryPolyline":this._placeLineLabels(R);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(R);break;default:((X,a="mapview-labeling")=>{y.error(new q.Z(a,X))})(`Geometry of type ${v.geometryType} is not supported`)}}_isVisible(a,v){const f=Tt(this._current.zoomLevel);return Tt(a)<=f&&f<=Tt(v)}_placePointLabels(a){const{out:v,inId:f,inShaping:E}=this._current;this._writeGlyphs(v,f,a,E)}_placeLineLabels(a){const v=function O(X,a){const v=a;for(let f=0;f<X.length;f++){let E=X[f];const R=[];R.push(E[0]);for(let Y=1;Y<E.length;Y++){let[G,st]=R[Y-1];G+=E[Y][0],st+=E[Y][1],R.push([G,st])}K(R,v);const U=[];U.push(R[0]);for(let Y=1;Y<R.length;Y++){const[G,st]=R[Y-1],[lt,J]=R[Y],Wt=Math.round(lt-G),Et=Math.round(J-st);U.push([Wt,Et])}X[f]=U,E=U}return X}(a.paths,this._current.inShaping.bounds.width),f=this._placeSubdivGlyphs.bind(this),E=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const R of v)b(R,E,f,this._repeatLabel)}_placeSubdivGlyphs(a,v,f,E){const R=bt(v),U=this._shapedBox.width/2,Y=Math.sqrt(this._repeatLabelDistance)/2,G=Math.min(f,E-f),st=this._current.inShaping.isMultiline?25:Math.log2(G/(Y+U/2)),lt=0===v?st:Math.min(R,st),J=Math.max(this._minZoom,this._current.zoomLevel+1-lt),Wt=this._current.zoomLevel-J,Et=this._shapedBox.width/2*2**Wt;this._current.inShaping.isMultiline?0===v&&this._placeStraight(a,J):this._allowOverrun&&Wt<0?this._placeStraightAlong(a,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(a,J):"curved"===this._labelPosition&&this._placeCurved(a,J,Et)}_placeStraight(a,v){const{out:f,inId:E,inShaping:R}=this._current,U=Math.ceil(a.angle*(180/Math.PI)%360),Y=Math.ceil((a.angle*(180/Math.PI)+180)%360);this._outLineLabelAngle=zt(U),this._writeGlyphs(f,E,a,R,v),this._outLineLabelAngle=zt(Y),this._writeGlyphs(f,E,a,R,v)}_placeCurved(a,v,f){const{out:E,inId:R}=this._current;E.metricStart(R,v,a.x,a.y,0,0,0,0);const U=a.clone(),Y=a.angle*(180/Math.PI)%360,G=(a.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=zt(Y),this._placeFirst(U,v,1),this._placeBack(a,U,v,f,1),this._placeForward(a,U,v,f,1),this._outLineLabelAngle=zt(G),this._placeFirst(U,v,0),this._placeBack(a,U,v,f,0),this._placeForward(a,U,v,f,0),E.metricEnd()}_placeStraightAlong(a,v){const{out:f,inId:E,inShaping:R}=this._current;f.metricStart(E,v,a.x,a.y,0,0,0,0);const U=a.clone(),Y=a.angle*(180/Math.PI)%360,G=(a.angle*(180/Math.PI)+180)%360,st=R.glyphs.length>0&&(this._borderLineColor||this._backgroundColor);if(this._maxBackgroundZoom=25,this._minBackgroundZoom=Math.max(v,0),st){const lt=nt.Gq.load(this._materialKey);lt.textureBinding=R.glyphs[0].textureBinding;const J=(0,Z.b)((0,Mt.c)(),-a.angle),[Wt,Et]=R.shapeBackground(J);this._outLineLabelAngle=zt(Y),f.recordStart(E,lt.data,this.geometryType,!0),this._writeBackgroundGeometry(f,E,a,Wt,Et),f.recordEnd(),this._outLineLabelAngle=zt(G),f.recordStart(E,lt.data,this.geometryType,!0),this._writeBackgroundGeometry(f,E,a,Wt,Et),f.recordEnd()}this._outLineLabelAngle=zt(Y),this._placeFirst(U,v,1,!0),this._outLineLabelAngle=zt(G),this._placeFirst(U,v,0,!0),f.metricEnd()}_placeBack(a,v,f,E,R){const U=a.clone();let Y=a.backwardLength+0;for(;U.prev()&&!(Y>=E);)this._placeOnSegment(U,v,Y,f,-1,R),Y+=U.length+0}_placeForward(a,v,f,E,R){const U=a.clone();let Y=a.remainingLength+0;for(;U.next()&&!(Y>=E);)this._placeOnSegment(U,v,Y,f,1,R),Y+=U.length+0}_placeFirst(a,v,f,E=!1){const R=a,U=this._current.inShaping,Y=U.glyphs,G=this._current.zoomLevel,{out:st,inId:lt}=this._current;for(const J of Y){const Wt=J.x>U.bounds.x?f:1-f,Et=Wt*a.remainingLength+(1-Wt)*a.backwardLength,Kt=Math.abs(J.x+J.width/2-U.bounds.x),xt=Math.max(0,G+Math.log2(Kt/(Et+0))),Lt=Math.max(v,E?0:xt);if(J.maxZoom=25,J.angle=a.angle+(1-f)*Math.PI,J.minZoom=Lt,this._writeGlyph(st,lt,R.x,R.y,J),f&&this._isVisible(J.minZoom,J.maxZoom)){const It=J.bounds;st.metricBoxWrite(It.center[0],It.center[1],It.width,It.height)}}}_placeOnSegment(a,v,f,E,R,U){const Y=this._current.inShaping.glyphs,{out:G,inId:st}=this._current,lt=this._current.inShaping,J=this._current.zoomLevel,Kt={x:a.x+f*-R*(a.dx/a.length),y:a.y+f*-R*(a.dy/a.length)};for(const xt of Y){const Lt=xt.x>lt.bounds.x?U:1-U;if(!(Lt&&1===R||!Lt&&-1===R))continue;const It=Math.abs(xt.x+xt.width/2-lt.bounds.x),pt=Math.max(0,J+Math.log2(It/f)-.1),wt=Math.max(E,J+Math.log2(It/(f+a.length+0)));if(0!==pt&&(xt.angle=a.angle+(1-U)*Math.PI,xt.minZoom=wt,xt.maxZoom=pt,this._writeGlyph(G,st,Kt.x,Kt.y,xt),U&&this._isVisible(xt.minZoom,xt.maxZoom))){const Ot=xt.bounds;G.metricBoxWrite(Ot.center[0]+(a.x-v.x),Ot.center[1]+(a.y-v.y),Ot.width,Ot.height)}}}_writeGlyphs(a,v,f,E,R=this._minZoom){if(f.x<0||f.x>=512||f.y<0||f.y>=512)return;if(E.glyphs.length>0&&(this._borderLineColor||this._backgroundColor)){const J=nt.Gq.load(this._materialKey);J.textureBinding=E.glyphs[0].textureBinding,a.recordStart(v,J.data,this.geometryType,!0),this._writeBackgroundGeometry(a,v,f,E.bounds,E.background),a.recordEnd()}const U=f.x+this._refOffsetX,Y=f.y-this._refOffsetY;for(const J of E.glyphs)J.minZoom=R,J.maxZoom=this._maxZoom,this._writeGlyph(a,v,U,Y,J);const lt=E.boundsT;a.metricStart(v,R,U,Y,this._refPlacementDirX,this._refPlacementDirY,this._referenceSize,this._materialKey),a.metricBoxWrite(lt.center[0],lt.center[1],lt.width,lt.height),a.metricEnd()}_writeVertexCommon(a,v,f,E){const R=this._color,U=this._haloColor,Y=(0,S.Jz)(0,0,this._size,this._haloSize),G=Math.max(E.minZoom,this._minZoom),st=Math.min(E.maxZoom,this._maxZoom),lt=(0,S.Jz)(Tt(G),Tt(st),this._outLineLabelAngle,0);a.vertexWrite(f),a.vertexWrite(v),a.vertexWrite(R),a.vertexWrite(U),a.vertexWrite(Y),a.vertexWrite(this._refSymbolAndPlacementOffset),a.vertexWrite(lt)}_writeBackgroundVertex(a,v,f,E,R,U){const Y=(0,S.Jz)(0,0,this._size,this._haloSize),G=(0,S.Jz)(0,0,0,0),st=(0,S.Jz)(Tt(this._minBackgroundZoom),Tt(this._maxBackgroundZoom),this._outLineLabelAngle,1);a.vertexWrite(f),a.vertexWrite(v),a.vertexWrite(E),a.vertexWrite(G),a.vertexWrite(Y),a.vertexWrite(this._refSymbolAndPlacementOffset),a.vertexWrite(st),a.vertexWrite(R),a.vertexWrite(U),a.vertexEnd()}}var Ht=u(79752),Yt=u(79222);class Ct{constructor(a,v,f){this._loadPromise=(0,F.j)(),this._geometryType=a,this._idField=v,this._templateStore=f}update(a,v){(0,mt.pC)(a.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(a.mesh.labels,v)),this._schema=a}_createLabelTemplates(a,v){const f=new Map;if("simple"===a.type){for(const E of a.classes){const R=yt.fromLabelClass(E,v);f.set(E.index,R)}return f}for(const E in a.classes){const R=a.classes[E];for(const U of R){const Y=yt.fromLabelClass(U,v);f.set(U.index,Y)}}return f}get templates(){return this._templateStore}analyze(a,v,f,E,R,U,Y){var G=this;return(0,k.Z)(function*(){if((0,$.Hc)(Y))return;let st;"dictionary"===f?.type&&(st=yield f.analyze(G._idField,a.copy(),v,R,U,Y));let lt=0;for(;a.next();){let J=null;if(J=st?st[lt++]:(0,mt.pC)(E)&&(0,j.nE)(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?E.match(G._idField,a,G._geometryType,R,U):f.match(G._idField,a,G._geometryType,R,U),a.setGroupId(J),(0,Yt.Sl)(J)){const Wt=G._templateStore.getDynamicTemplateGroup(J).templates;for(const Et of Wt)Et&&Et.analyze&&Et.analyze(G._templateStore,a,R,U)}}return yield G._loadPromise,G._templateStore.finalize(Y)})()}analyzeGraphics(a,v,f,E,R,U){var Y=this;return(0,k.Z)(function*(){if((0,$.Hc)(U))return;const G=a.getCursor();for(f&&(yield f.analyze(Y._idField,G.copy(),v,E,R,U));G.next();){let st=G.getGroupId();if(null!=st&&-1!==st||(st=f?.match(Y._idField,G,G.geometryType,E,R),G.setGroupId(st)),(0,Yt.Sl)(st)){const lt=Y._templateStore.getDynamicTemplateGroup(st).templates;for(const J of lt)J&&J.analyze&&J.analyze(Y._templateStore,G,E,R)}G.setGroupId(st)}return yield Y._loadPromise,Y._templateStore.finalize(U)})()}writeGraphic(a,v,f,E){const R=v.getGroupId(),U=v.getDisplayId(),Y=this._templateStore.getTemplateGroup(R);if(a.featureStart(v.insertAfter,0),null!=U){if((0,Yt.Sl)(R))for(const G of Y.templates)G&&G.bindFeature(v,null,null);if(Y){for(const G of Y.templates)G&&G.write(a,v,f,E);a.featureEnd()}}}writeCursor(a,v,f,E,R,U,Y){const G=v.getGroupId(),st=v.getDisplayId(),lt=this._templateStore.getTemplateGroup(G),J=lt.templates,Wt=this._getSortKeyValue(v,lt);if(a.featureStart(0,Wt),null!=st&&J){if((0,Yt.Sl)(G))for(const Et of J)Et.bindFeature(v,f,E);for(const Et of J)Et.write(a,v,R,Y);if((0,mt.pC)(U)&&a.hasRecords){const Et=U&&this._findLabelRef(J);this._writeLabels(a,v,U,Et,R,Y)}a.featureEnd()}}_getSortKeyValue(a,v){const f=this._schema.mesh.sortKey;if((0,mt.Wi)(f))return 0;let E=0;return E=!0===f.byRenderer&&null!=v.sortKey?v.sortKey:null!=f.fieldIndex?a.getComputedNumericAtIndex(f.fieldIndex):a.readAttribute(null!=f.field?f.field:this._idField),E*="asc"===f.order?1:-1,null==E||isNaN(E)?0:E}_findLabelRef(a){for(const v of a)if(v instanceof Ht.Z)return v;return null}_writeLabels(a,v,f,E,R,U){for(const Y of f)if((0,mt.pC)(Y)&&Y){const{glyphs:G,rtl:st,index:lt}=Y,J=this._labelTemplates.get(lt);if(!J)continue;J.setZoomLevel(R),J.bindReferenceTemplate(E),J.bindTextInfo(G,st),J.write(a,v,null,U)}}}},47526:(Zt,St,u)=>{u.d(St,{Z:()=>d});var k=u(53661),_t=u(55798),mt=u(53072),$=u(80309),F=u(80775),j=u(12288),q=u(50805),tt=u(86636),H=u(80696),ht=u(20753),Z=u(72375),Mt=u(21605);const N=3.14159265359/180,d=L=>class extends L{constructor(...p){super(...p),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._allowBorrowing=!0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=ht.LW.MARKER}_write(p,S,nt,at){const ot=S.getDisplayId();p.recordStart(ot,this._materialKey,this.geometryType,!0),this._writeGeometry(p,S,ot,nt,at),p.recordEnd()}_writeGeometry(p,S,nt,at,ot){if((0,k.pC)(this._markerPlacement))return this._writePlacedMarkers(p,S,at,ot);if(this._allowBorrowing=!0,!ot&&"esriGeometryPoint"===S.geometryType){const c=S.getX(),g=S.getY();return!p.hasAggregates&&p.hasPixelBufferEnabled&&(c<0||c>=513||g<0||g>=513)?void 0:this._writeVertices(p,nt,this._getPos(c,g),c,g)}const m=ot?(0,q.oB)((0,q.GH)(ot),2):"esriGeometryPolygon"===S.geometryType?S.readCentroid():S.readGeometryForDisplay();if(!(0,k.Wi)(m)){if(m.isPoint){const[c,g]=m.coords;return!p.hasAggregates&&p.hasPixelBufferEnabled&&(c<0||c>=512||g<0||g>=512)?void 0:this._writeVertices(p,nt,this._getPos(c,g),c,g)}m.forEachVertex((c,g)=>{const T=2*H.I_;c<-T||c>=T||g<-T||g>=T||this._writeVertices(p,nt,this._getPos(c,g),c,g)})}}_writePlacedMarkers(p,S,nt,at){const ot=at??S.readLegacyGeometryForDisplay(),m=tt.i.getPlacement(ot,(0,k.Wg)(this._markerPlacement),(0,_t.F2)(1),p.tileKey,nt.geometryEngine);if(!m)return;this._allowBorrowing="esriGeometryPolygon"!==S.geometryType;const c=S.getDisplayId(),g=(0,j.c)(),T=(0,$.c)();let P=m.next();for(;null!=P;){const O=P.tx,K=-P.ty;O>=-128&&O<=640&&K>=-128&&K<=640&&(this._applyTransformation(T,g,-P.getAngle()/N),this._writeVertices(p,c,this._getPos(O,K),O,K)),P=m.next()}}_writeVertices(p,S,nt,at,ot){const m=Mt.mE.load(this._materialKey);return m.symbologyType===ht.mD.HEATMAP?this._writeHeatmapVertices(p,S,nt):this._writeMarkerVertices(p,S,m,nt,at,ot)}_writeMarkerVertices(p,S,nt,at,ot,m){const c=nt.vvRotation,g=p.vertexCount();let T=this._computedWidth*this._vertexBoundsScaleX,b=this._computedHeight*this._vertexBoundsScaleY;if(this.angle){const D=Math.max(T,b);T=D,b=D}if(c){const D=Math.max(this.xOffset,this.yOffset);T+=D,b+=D}this._allowBorrowing&&p.vertexBounds(ot+this.xOffset,m-this.yOffset,T,b),p.vertexWrite(at),p.vertexWrite(this._offsetUpperLeft),p.vertexWrite(this._texUpperLeft),p.vertexWrite(this._bitestAndDistRatio),p.vertexWrite(S),p.vertexWrite(this._fillColor),p.vertexWrite(this._outlineColor),p.vertexWrite(this._sizeOutlineWidth),p.vertexWrite(this._minMaxZoom),p.vertexEnd(),p.vertexWrite(at),p.vertexWrite(this._offsetUpperRight),p.vertexWrite(this._texUpperRight),p.vertexWrite(this._bitestAndDistRatio),p.vertexWrite(S),p.vertexWrite(this._fillColor),p.vertexWrite(this._outlineColor),p.vertexWrite(this._sizeOutlineWidth),p.vertexWrite(this._minMaxZoom),p.vertexEnd(),p.vertexWrite(at),p.vertexWrite(this._offsetBottomLeft),p.vertexWrite(this._texBottomLeft),p.vertexWrite(this._bitestAndDistRatio),p.vertexWrite(S),p.vertexWrite(this._fillColor),p.vertexWrite(this._outlineColor),p.vertexWrite(this._sizeOutlineWidth),p.vertexWrite(this._minMaxZoom),p.vertexEnd(),p.vertexWrite(at),p.vertexWrite(this._offsetBottomRight),p.vertexWrite(this._texBottomRight),p.vertexWrite(this._bitestAndDistRatio),p.vertexWrite(S),p.vertexWrite(this._fillColor),p.vertexWrite(this._outlineColor),p.vertexWrite(this._sizeOutlineWidth),p.vertexWrite(this._minMaxZoom),p.vertexEnd(),this._writeIndices(p,g)}_writeHeatmapVertices(p,S,nt){const at=p.vertexCount();p.vertexWrite(nt),p.vertexWrite(this._offsetUpperLeft),p.vertexWrite(S),p.vertexEnd(),p.vertexWrite(nt),p.vertexWrite(this._offsetUpperRight),p.vertexWrite(S),p.vertexEnd(),p.vertexWrite(nt),p.vertexWrite(this._offsetBottomLeft),p.vertexWrite(S),p.vertexEnd(),p.vertexWrite(nt),p.vertexWrite(this._offsetBottomRight),p.vertexWrite(S),p.vertexEnd(),this._writeIndices(p,at)}_writeIndices(p,S){p.indexWrite(S+0),p.indexWrite(S+1),p.indexWrite(S+2),p.indexWrite(S+1),p.indexWrite(S+3),p.indexWrite(S+2)}_applyTransformation(p,S,nt=0){(0,mt.a)(p,(0,j.f)(this.xOffset,-this.yOffset)),null!=this.angle&&this.angle+nt!==0&&(0,mt.r)(p,p,N*(this.angle+nt));const at=this._computedWidth,ot=this._computedHeight,m=-(.5+this._anchorX)*at,c=-(.5-this._anchorY)*ot;(0,F.s)(S,m,c),(0,F.t)(S,S,p),this._offsetUpperLeft=(0,Z.UJ)(16*S[0],16*S[1]),this._offsets.xUpperLeft=S[0],this._offsets.yUpperLeft=S[1],(0,F.s)(S,m+at,c),(0,F.t)(S,S,p),this._offsetUpperRight=(0,Z.UJ)(16*S[0],16*S[1]),this._offsets.xUpperRight=S[0],this._offsets.yUpperRight=S[1],(0,F.s)(S,m,c+ot),(0,F.t)(S,S,p),this._offsetBottomLeft=(0,Z.UJ)(16*S[0],16*S[1]),this._offsets.xBottomLeft=S[0],this._offsets.yBottomLeft=S[1],(0,F.s)(S,m+at,c+ot),(0,F.t)(S,S,p),this._offsetBottomRight=(0,Z.UJ)(16*S[0],16*S[1]),this._offsets.xBottomRight=S[0],this._offsets.yBottomRight=S[1]}_getPos(p,S){return(0,Z.UJ)(Math.round(8*p),Math.round(8*S))}}},50552:(Zt,St,u)=>{u.d(St,{Z:()=>at});var k=u(53661),_t=u(55798),mt=u(50805),$=u(86636),F=u(80696),j=u(20753),q=u(72375),tt=u(21605),H=u(18659);const Z=(0,q.UJ)(4,4),Mt=(0,q.UJ)(4,2),N=(0,q.UJ)(4,6),W=[Mt,Mt,N,N],d=[Mt,N,Mt,N],L=[N,N,Z,Z],p=[Z,Z,N,N],S=[N,Z,N,Z],nt=[Z,N,Z,N],at=ot=>class extends ot{constructor(...m){super(...m),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=j.LW.TEXT,this._aux=(0,q.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(m,c){this._shapingInfo=m&&m.length?(0,k.yw)(m,g=>(0,H.Nr)(g,c,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:F.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM,hasBackground:!!this._backgroundColor,borderLineSize:this._borderLineSize})):null}_write(m,c,g,T){const b=c.getDisplayId();this._writeGeometry(m,c,b,g,T)}_writeGeometry(m,c,g,T,b){const D=this._shapingInfo;if((0,k.Wi)(D))return;if((0,k.pC)(this._textPlacement)){const O=b??c.readLegacyGeometryForDisplay();return this._writePlacedText(m,g,O,D,T)}const P=b?(0,mt.oB)((0,mt.GH)(b),2):"esriGeometryPolygon"===c.geometryType?c.readCentroid():c.readGeometryForDisplay();if(!(0,k.Wi)(P)){if(P.isPoint){const[O,K]=P.coords;return!m.hasAggregates&&m.hasPixelBufferEnabled&&(O<0||O>=512||K<0||K>=512)?void 0:this._writeGlyphs(m,g,{x:O,y:K},D)}P.forEachVertex((O,K)=>this._writeGlyphs(m,g,{x:O,y:K},D))}}_writePlacedText(m,c,g,T,b){const D=(0,k.Wg)(this._textPlacement),P=$.i.getPlacement(g,D,(0,_t.F2)(1),m.tileKey,b.geometryEngine);if(!P)return;let O=P.next();for(;null!=O;){const K=-O.getAngle();T.setRotation(K);const I=O.tx,y=-O.ty;I<0||I>=512||y<0||y>=512||(this._writeGlyphs(m,c,{x:I,y},T),T.setRotation(-K)),O=P.next()}}_writeGlyphs(m,c,g,T){const b=tt.m2.load(this._materialKey),D=(0,q.UJ)(Math.round(8*g.x),Math.round(8*g.y)),P=this._vertexBoundsScale,{bounds:O,background:K,glyphs:I}=T;I.length>0&&(this._borderLineColor||this._backgroundColor)&&(b.textureBinding=I[0].textureBinding,m.recordStart(c,b.data,this.geometryType,!0),this._writeBackgroundGeometry(m,c,g,O,K),m.recordEnd());const y=2*Math.max(O.width,O.height);for(const _ of T.glyphs)b.textureBinding=_.textureBinding,m.recordStart(c,b.data,this.geometryType,!0),m.vertexBounds(g.x+O.x+this._xOffset,g.y+O.y-this._yOffset,y*P,y*P),this._writeVertices(m,c,D,_),m.recordEnd()}_writeGlyph(m,c,g,T,b){const D=tt.m2.load(this._materialKey),P=(0,q.UJ)(Math.round(8*g),Math.round(8*T));D.textureBinding=b.textureBinding,m.recordStart(c,D.data,this.geometryType,!0);const O=b.bounds,K=this._vertexBoundsScale;m.vertexBounds(g+O.x*K,T+O.y*K,O.width*K,O.height*K),this._writeVertices(m,c,P,b),m.recordEnd()}_writeVertices(m,c,g,T){const b=m.vertexCount();this._writeVertexCommon(m,c,g,T),m.vertexWrite(T.offsets.upperLeft),m.vertexWrite(T.texcoords.upperLeft),m.vertexEnd(),this._writeVertexCommon(m,c,g,T),m.vertexWrite(T.offsets.upperRight),m.vertexWrite(T.texcoords.upperRight),m.vertexEnd(),this._writeVertexCommon(m,c,g,T),m.vertexWrite(T.offsets.lowerLeft),m.vertexWrite(T.texcoords.lowerLeft),m.vertexEnd(),this._writeVertexCommon(m,c,g,T),m.vertexWrite(T.offsets.lowerRight),m.vertexWrite(T.texcoords.lowerRight),m.vertexEnd(),m.indexWrite(b+0),m.indexWrite(b+1),m.indexWrite(b+2),m.indexWrite(b+1),m.indexWrite(b+3),m.indexWrite(b+2)}_writeVertexCommon(m,c,g,T){const b=this._color,D=this._haloColor,P=(0,q.Jz)(0,0,this._referenceSize,this._bitset),O=(0,q.Jz)(0,0,this._size,this._haloSize);m.vertexWrite(g),m.vertexWrite(c),m.vertexWrite(b),m.vertexWrite(D),m.vertexWrite(O),m.vertexWrite(P),m.vertexWrite(this._minMaxZoom)}_writeBackgroundVertex(m,c,g,T,b,D){const P=(0,q.Jz)(0,1,this._referenceSize,this._bitset),O=(0,q.Jz)(0,0,this._size,this._haloSize),K=(0,q.Jz)(0,0,0,0);m.vertexWrite(g),m.vertexWrite(c),m.vertexWrite(T),m.vertexWrite(K),m.vertexWrite(O),m.vertexWrite(P),m.vertexWrite(this._minMaxZoom),m.vertexWrite(b),m.vertexWrite(D),m.vertexEnd()}_writeBackgroundQuad(m,c,g,T,b,D){const P=m.vertexCount();this._writeBackgroundVertex(m,c,g,T,b.upperLeft,D[0]),this._writeBackgroundVertex(m,c,g,T,b.upperRight,D[1]),this._writeBackgroundVertex(m,c,g,T,b.lowerLeft,D[2]),this._writeBackgroundVertex(m,c,g,T,b.lowerRight,D[3]),m.indexWrite(P+0),m.indexWrite(P+1),m.indexWrite(P+2),m.indexWrite(P+1),m.indexWrite(P+3),m.indexWrite(P+2)}_writeBackgroundGeometry(m,c,g,T,b){const D=(0,q.UJ)(Math.round(8*g.x),Math.round(8*g.y)),{x:P,y:O,width:K,height:I}=T,y=2*Math.max(K,I);if(m.vertexBounds(g.x+P+this._xOffset,g.y+O-this._yOffset,y*this._vertexBoundsScale,y*this._vertexBoundsScale),this._backgroundColor&&this._writeBackgroundQuad(m,c,D,this._backgroundColor,b.main,[Z,Z,Z,Z]),this._borderLineColor||this._backgroundColor){const _=!!this._borderLineColor&&!!this._borderLineSize&&this._borderLineSize>0,[rt,Q,it,ct,ft]=_?[W,W,d,d,this._borderLineColor]:[L,p,S,nt,this._backgroundColor];this._writeBackgroundQuad(m,c,D,ft,b.top,rt),this._writeBackgroundQuad(m,c,D,ft,b.bot,Q),this._writeBackgroundQuad(m,c,D,ft,b.left,it),this._writeBackgroundQuad(m,c,D,ft,b.right,ct)}}}},79752:(Zt,St,u)=>{u.d(St,{Z:()=>W});var k=u(53661),_t=u(55798),mt=u(80309),$=u(12288),F=u(20877),j=u(9203),q=u(80696),tt=u(20753),H=u(72375),ht=u(21605),Z=u(85366),Mt=u(47526),N=u(65450);class W extends((0,Mt.Z)(N.Z)){constructor(L,p,S,nt,at,ot,m,c,g,T,b,D,P,O,K,I,y,_,rt,Q,it,ct,ft){super(),this.angle=nt,this.height=m,this.width=ot,this.xOffset=p*rt,this.yOffset=S*rt,this._markerPlacement=Q,this._effects=it,this._anchorX=I,this._anchorY=y,this._minMaxZoom=(0,H.UJ)(Math.round(ct*q.MI),Math.round(ft*q.MI));const gt=(O===F.v2.MAP?q.Tz:q.CQ)|(b?q.Uh:0)|(P?q.oK:0)|(D?q.e0:0),Rt=K&&K.sdf,bt=ht.mE.load(L);bt.sdf=Rt,bt.pattern=!0,bt.textureBinding=K.textureBinding,this._materialKey=bt.data,this._fillColor=at,this._outlineColor=g,this._sizeOutlineWidth=(0,H.Jz)(Math.round(Math.min(Math.sqrt(128*ot),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*T),255)),Math.round(Math.min(Math.sqrt(128*c),255)));const vt=K.rect.x+q.fL,Tt=K.rect.y+q.fL,zt=vt+K.width,yt=Tt+K.height;this._offsets.xUpperLeft=vt,this._offsets.yUpperLeft=Tt,this._offsets.xUpperRight=zt,this._offsets.yUpperRight=Tt,this._offsets.xBottomLeft=vt,this._offsets.yBottomLeft=yt,this._offsets.xBottomRight=zt,this._offsets.yBottomRight=yt,bt.symbologyType===tt.mD.PIE_CHART?(this._texUpperLeft=(0,H.UJ)(0,1),this._texUpperRight=(0,H.UJ)(1,1),this._texBottomLeft=(0,H.UJ)(0,0),this._texBottomRight=(0,H.UJ)(1,0)):(this._texUpperLeft=(0,H.UJ)(vt,Tt),this._texUpperRight=(0,H.UJ)(zt,Tt),this._texBottomLeft=(0,H.UJ)(vt,yt),this._texBottomRight=(0,H.UJ)(zt,yt)),ot*=_,m*=_,ot*=rt,m*=rt;const Ht=Math.round(64*_);this._bitestAndDistRatio=(0,H.UJ)(gt,Ht),this._computedWidth=ot,this._computedHeight=m;const Yt=(0,$.c)(),Ct=(0,mt.c)();this._applyTransformation(Ct,Yt)}static fromCIMMarker(L,p,S){const ot=L.size,m=(p&&p.width||1)/(p&&p.height||1)*L.scaleX,c=L.scaleSymbolsProportionally&&L.frameHeight?ot/L.frameHeight:1,g=(0,j.t2)(L.color),T=(0,j.t2)(L.outlineColor),b=(0,_t.F2)(ot),D=b*m,P=(0,_t.F2)(L.offsetX||0),O=(0,_t.F2)(L.offsetY||0),K=(0,_t.F2)(L.outlineWidth||0)*c,I=L.alignment||F.v2.SCREEN,y=(0,_t.F2)(L.referenceSize),[_,rt]=(0,Z._f)(L.scaleInfo,S);let Q=L.rotation||0;L.rotateClockwise||(Q=-Q);let it=0,ct=0;const ft=L.anchorPoint;ft&&(L.isAbsoluteAnchorPoint?ot&&(it=ft.x/(ot*m),ct=ft.y/ot):(it=ft.x,ct=ft.y));const gt=new W(L.materialKey,P,O,Q,g,D,b,y,T,K,L.colorLocked,L.scaleSymbolsProportionally,!1,I,p,it,ct,L.sizeRatio,(0,k.Pt)(L.scaleFactor,1),L.markerPlacement,L.effects,_,rt);return gt._vertexBoundsScaleX=L.maxVVSize?L.maxVVSize/D:1,gt._vertexBoundsScaleY=L.maxVVSize?L.maxVVSize/b:1,gt}static fromPictureMarker(L,p){const S=Math.round((0,_t.F2)(L.width)),nt=Math.round((0,_t.F2)(L.height)),at=q.ru,ot=Math.round((0,_t.F2)(L.xoffset||0)),m=Math.round((0,_t.F2)(L.yoffset||0)),c=new W(L.materialKey,ot,m,L.angle,at,S,nt,nt,0,0,!1,!1,!1,F.v2.SCREEN,p,0,0,1,1,null,null,Z.Xe,Z.eW);return c._vertexBoundsScaleX=L.maxVVSize?L.maxVVSize/L.width:1,c._vertexBoundsScaleY=L.maxVVSize?L.maxVVSize/L.height:1,c}static fromSimpleMarker(L,p){const S=(0,j.aH)(L.color),nt=Math.round((0,_t.F2)(L.size)),at=nt,ot=Math.round((0,_t.F2)(L.xoffset||0)),m=Math.round((0,_t.F2)(L.yoffset||0)),c=L.style,g=L.outline,T=0|(g?.color&&(0,j.aH)(g.color)),b=0|(g?.width&&Math.round((0,_t.F2)(g.width))),D=new W(L.materialKey,ot,m,L.angle,S,nt,at,at,T,b,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,F.v2.SCREEN,p,0,0,126/64,1,null,null,Z.Xe,Z.eW);return D.boundsType="esriSMSCircle"===c?"circle":"square",D._vertexBoundsScaleX=L.maxVVSize?L.maxVVSize/L.size:1,D._vertexBoundsScaleY=L.maxVVSize?L.maxVVSize/L.size:1,D}static fromLineSymbolMarker(L,p){const S=(0,j.aH)(L.color),at=Math.round((0,_t.F2)(6*L.lineWidth)),ot=at,m="cross"===L.style||"x"===L.style;let c;switch(L.placement){case"begin-end":c=F.Tx.Both;break;case"begin":c=F.Tx.JustBegin;break;case"end":c=F.Tx.JustEnd;break;default:c=F.Tx.None}const g={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:c,offsetAlongLine:0},T=new W(L.materialKey,0,0,0,S,at,ot,ot/6,S,m?Math.round((0,_t.F2)(L.lineWidth)):0,!1,!1,m,F.v2.MAP,p,0,0,126/64,1,g,null,Z.Xe,Z.eW);return T.boundsType="circle"===L.style?"circle":"square",T}}},65450:(Zt,St,u)=>{u.d(St,{Z:()=>mt});var k=u(53661),_t=u(46179);class mt{constructor(){this._materialKey=null}bindFeature(F,j,q){}write(F,j,q,tt){if((0,k.Wi)(this._effects)||0===this._effects?.length)return this._write(F,j,tt);const H=_t.j.executeEffects(this._effects,j.readLegacyGeometryForDisplay(),F.tileKey,tt.geometryEngine);let ht=_t.j.next(H);for(;ht;)this._write(F,j,tt,ht),ht=_t.j.next(H)}_write(F,j,q,tt){}}},79222:(Zt,St,u)=>{u.d(St,{Wr:()=>Ze,Sl:()=>Ee});var k=u(71670),_t=u(32995),mt=u(28191),$=u(30801),F=u(66071),j=u(20753),q=u(21605),tt=u(53661),H=u(55798),ht=u(9203),Z=u(80696),Mt=u(4645),N=u(72375),W=u(85366),d=u(50805),L=u(52300),S=(u(38306),u(40241)),nt=u(99220),at=u(93846);function ot(o,r,i,n,s,l,h){f=0;const x=(n-i)*l,M=s&&s.length,C=M?(s[0]-i)*l:x;let w,A,V,z,B,et=m(r,i,0,0,C,l,!0);if(et&&et.next!==et.prev){if(M&&(et=function K(o,r,i,n,s,l){const h=new Array;for(let x=0,M=n.length;x<M;x++){const C=m(o,r,0,n[x]*l,x<M-1?n[x+1]*l:i*l,l,!1);C===C.next&&(C.steiner=!0),h.push(O(C))}h.sort(Tt);for(const x of h)s=I(x,s);return s}(r,i,n,s,et,l)),x>80*l){w=V=r[0+i*l],A=z=r[1+i*l];for(let ut=l;ut<C;ut+=l){const dt=r[ut+i*l],Pt=r[ut+1+i*l];w=Math.min(w,dt),A=Math.min(A,Pt),V=Math.max(V,dt),z=Math.max(z,Pt)}B=Math.max(V-w,z-A),B=0!==B?1/B:0}g(et,o,l,w,A,B,h,0)}}function m(o,r,i,n,s,l,h){let x;if(h===function ft(o,r,i,n,s,l){let h=0;for(let x=n,M=s-l;x<s;x+=l)h+=(o[M+r*l]-o[x+r*l])*(o[x+1+r*l]+o[M+1+r*l]),M=x;return h}(o,r,0,n,s,l)>0)for(let M=n;M<s;M+=l)x=D(M+r*l,o[M+r*l],o[M+1+r*l],x);else for(let M=s-l;M>=n;M-=l)x=D(M+r*l,o[M+r*l],o[M+1+r*l],x);return x&&vt(x,x.next)&&(P(x),x=x.next),x}function c(o,r=o){if(!o)return o;let i,n=o;do{if(i=!1,n.steiner||!vt(n,n.next)&&0!==Q(n.prev,n,n.next))n=n.next;else{if(P(n),n=r=n.prev,n===n.next)break;i=!0}}while(i||n!==r);return r}function g(o,r,i,n,s,l,h,x){if(!o)return;!x&&l&&(o=_(o,n,s,l));let M=o;for(;o.prev!==o.next;){const C=o.prev,w=o.next;if(l?b(o,n,s,l):T(o))r.push(C.index/i+h),r.push(o.index/i+h),r.push(w.index/i+h),P(o),o=w.next,M=w.next;else if((o=w)===M){x?1===x?g(o=zt(o,r,i,h),r,i,n,s,l,h,2):2===x&&yt(o,r,i,n,s,l,h):g(c(o),r,i,n,s,l,h,1);break}}}function T(o){const r=o.prev,i=o,n=o.next;if(Q(r,i,n)>=0)return!1;let s=o.next.next;const l=s;let h=0;for(;s!==o.prev&&(0===h||s!==l);){if(h++,gt(r.x,r.y,i.x,i.y,n.x,n.y,s.x,s.y)&&Q(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function b(o,r,i,n){const s=o.prev,l=o,h=o.next;if(Q(s,l,h)>=0)return!1;const C=s.x>l.x?s.x>h.x?s.x:h.x:l.x>h.x?l.x:h.x,w=s.y>l.y?s.y>h.y?s.y:h.y:l.y>h.y?l.y:h.y,A=bt(s.x<l.x?s.x<h.x?s.x:h.x:l.x<h.x?l.x:h.x,s.y<l.y?s.y<h.y?s.y:h.y:l.y<h.y?l.y:h.y,r,i,n),V=bt(C,w,r,i,n);let z=o.prevZ,B=o.nextZ;for(;z&&z.z>=A&&B&&B.z<=V;){if(z!==o.prev&&z!==o.next&&gt(s.x,s.y,l.x,l.y,h.x,h.y,z.x,z.y)&&Q(z.prev,z,z.next)>=0||(z=z.prevZ,B!==o.prev&&B!==o.next&&gt(s.x,s.y,l.x,l.y,h.x,h.y,B.x,B.y)&&Q(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;z&&z.z>=A;){if(z!==o.prev&&z!==o.next&&gt(s.x,s.y,l.x,l.y,h.x,h.y,z.x,z.y)&&Q(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;B&&B.z<=V;){if(B!==o.prev&&B!==o.next&&gt(s.x,s.y,l.x,l.y,h.x,h.y,B.x,B.y)&&Q(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function D(o,r,i,n){const s=X.create(o,r,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function P(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function O(o){let r=o,i=o;do{(r.x<i.x||r.x===i.x&&r.y<i.y)&&(i=r),r=r.next}while(r!==o);return i}function I(o,r){const i=function y(o,r){let i=r;const n=o.x,s=o.y;let l,h=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const V=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(V<=n&&V>h){if(h=V,V===n){if(s===i.y)return i;if(s===i.next.y)return i.next}l=i.x<i.next.x?i:i.next}}i=i.next}while(i!==r);if(!l)return null;if(n===h)return l.prev;const x=l,M=l.x,C=l.y;let w,A=1/0;for(i=l.next;i!==x;)n>=i.x&&i.x>=M&&n!==i.x&&gt(s<C?n:h,s,M,C,s<C?h:n,s,i.x,i.y)&&(w=Math.abs(s-i.y)/(n-i.x),(w<A||w===A&&i.x>l.x)&&Rt(i,o)&&(l=i,A=w)),i=i.next;return l}(o,r);if(!i)return r;const n=Ct(i,o);return c(n,n.next),c(i,i.next)}function _(o,r,i,n){let s;for(;s!==o;s=s.next){if(s=s||o,null===s.z&&(s.z=bt(s.x,s.y,r,i,n)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,_(o,r,i,n);s.prevZ=s.prev,s.nextZ=s.next}return o.prevZ.nextZ=null,o.prevZ=null,function rt(o){let r,i=1;for(;;){let n,s=o;o=null,r=null;let l=0;for(;s;){l++,n=s;let h=0;for(;h<i&&n;h++)n=n.nextZ;let x=i;for(;h>0||x>0&&n;){let M;0===h?(M=n,n=n.nextZ,x--):0!==x&&n?s.z<=n.z?(M=s,s=s.nextZ,h--):(M=n,n=n.nextZ,x--):(M=s,s=s.nextZ,h--),r?r.nextZ=M:o=M,M.prevZ=r,r=M}s=n}if(r.nextZ=null,i*=2,l<2)return o}}(o)}function Q(o,r,i){return(r.y-o.y)*(i.x-r.x)-(r.x-o.x)*(i.y-r.y)}function it(o,r,i,n){return!!(vt(o,r)&&vt(i,n)||vt(o,n)&&vt(i,r))||Q(o,r,i)>0!=Q(o,r,n)>0&&Q(i,n,o)>0!=Q(i,n,r)>0}function gt(o,r,i,n,s,l,h,x){return(s-h)*(r-x)-(o-h)*(l-x)>=0&&(o-h)*(n-x)-(i-h)*(r-x)>=0&&(i-h)*(l-x)-(s-h)*(n-x)>=0}function Rt(o,r){return Q(o.prev,o,o.next)<0?Q(o,r,o.next)>=0&&Q(o,o.prev,r)>=0:Q(o,r,o.prev)<0||Q(o,o.next,r)<0}function bt(o,r,i,n,s){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-i)*s)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-n)*s)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function vt(o,r){return o.x===r.x&&o.y===r.y}function Tt(o,r){return o.x-r.x}function zt(o,r,i,n){let s=o;do{const l=s.prev,h=s.next.next;!vt(l,h)&&it(l,s,s.next,h)&&Rt(l,h)&&Rt(h,l)&&(r.push(l.index/i+n),r.push(s.index/i+n),r.push(h.index/i+n),P(s),P(s.next),s=o=h),s=s.next}while(s!==o);return s}function yt(o,r,i,n,s,l,h){let x=o;do{let M=x.next.next;for(;M!==x.prev;){if(x.index!==M.index&&Ht(x,M)){let C=Ct(x,M);return x=c(x,x.next),C=c(C,C.next),g(x,r,i,n,s,l,h,0),void g(C,r,i,n,s,l,h,0)}M=M.next}x=x.next}while(x!==o)}function Ht(o,r){return o.next.index!==r.index&&o.prev.index!==r.index&&!function ct(o,r){let i=o;do{if(i.index!==o.index&&i.next.index!==o.index&&i.index!==r.index&&i.next.index!==r.index&&it(i,i.next,o,r))return!0;i=i.next}while(i!==o);return!1}(o,r)&&Rt(o,r)&&Rt(r,o)&&function Yt(o,r){let i=o,n=!1;const s=(o.x+r.x)/2,l=(o.y+r.y)/2;do{i.y>l!=i.next.y>l&&i.next.y!==i.y&&s<(i.next.x-i.x)*(l-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==o);return n}(o,r)}function Ct(o,r){const i=X.create(o.index,o.x,o.y),n=X.create(r.index,r.x,r.y),s=o.next,l=r.prev;return o.next=r,r.prev=o,i.next=s,s.prev=i,n.next=i,i.prev=n,l.next=n,n.prev=l,n}class X{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(r,i,n){const s=f<a.length?a[f++]:new X;return s.index=r,s.x=i,s.y=n,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const a=new Array;let f=0;for(let o=0;o<8096;o++)a.push(new X);const R=new nt.bN(0,0,0,1,0),U=new nt.bN(0,0,0,1,0);function Y(o,r,i){let n=0;for(let s=1;s<i;s++)n+=(o[2*(r+s)]-o[2*(r+s-1)])*(o[2*(r+s)+1]+o[2*(r+s-1)+1]);return n}function G(o,r,i,n,s){let l=0;for(let x=i;x<n;x+=3){const M=2*(o[x]-s),C=2*(o[x+1]-s),w=2*(o[x+2]-s);l+=Math.abs((r[M]-r[w])*(r[C+1]-r[M+1])-(r[M]-r[C])*(r[w+1]-r[M+1]))}return l}R.setExtent(Z.I_),U.setExtent(Z.I_);var xt=u(20877),Lt=u(35246);const Ot=o=>class extends o{constructor(...r){super(...r),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=j.LW.LINE}writeGeometry(r,i,n,s){this._writeGeometry(r,i,n,s)}_initializeTessellator(r){const i=q.a.load(this._materialKey),n=q.dk.load(this._materialKey),s=this._tessellationOptions,h=this.tessellationProperties._halfWidth<Z.tQ&&!r&&!(i.vvSizeFieldStops||i.vvSizeMinMaxValue||i.vvSizeScaleStops||i.vvSizeUnitValue);this.tessellationProperties.minMaxZoom=this._minMaxZoom,s.wrapDistance=65535,s.textured=this._isDashed||this._hasPattern,s.offset=this.tessellationProperties.offset,s.halfWidth=this.tessellationProperties._halfWidth;const x=h?0:1,M=(0,q.CA)(n)?Bt:Ut;this._lineTessellator=new Lt.z(M(this.tessellationProperties,x,x),Jt(this.tessellationProperties),h)}_write(r,i,n,s){const l="esriGeometryPoint"===i.geometryType;r.recordStart(i.getDisplayId(),this._materialKey,this.geometryType,l),this._writeGeometry(r,i,s,l),r.recordEnd()}_writeGeometry(r,i,n,s){const l=n??i.readLegacyGeometryForDisplay(),h=this._getLines(l,s);(0,tt.Wi)(h)||this._writeVertices(r,i,h)}_getLines(r,i){if((0,tt.Wi)(r))return null;const n=r.paths||r.rings;return(0,tt.Wi)(n)?null:function Kt(o,r){U.setPixelMargin(r);const i=U,n=-r,s=Z.I_+r;let l=[],h=!1,x=0;for(;x<o.length;){const M=[],C=o[x];if(!C)return null;i.reset(nt.Vl.LineString);let[w,A]=C[0];if(h)i.moveTo(w,A);else{if(w<n||w>s||A<n||A>s){h=!0;continue}M.push({x:w,y:A})}let V=!1;const z=C.length;for(let B=1;B<z;++B)if(w+=C[B][0],A+=C[B][1],h)i.lineTo(w,A);else{if(w<n||w>s||A<n||A>s){V=!0;break}M.push({x:w,y:A})}if(V)h=!0;else{if(h){const B=i.resultWithStarts();if(B)for(const et of B)l.push(et)}else l.push({line:M,start:0});x++,h=!1}}return l=l.filter(M=>M.line.length>1),0===l.length?null:l}(n,i?256:16)}_writeVertices(r,i,n){const s=i.getDisplayId(),l=r.vertexCount(),h=this.tessellationProperties,x=this._tessellationOptions;h.out=r,h.id=s,h.indexCount=0,h.vertexCount=0,h.offset=l,x.capType=this._capType,x.joinType=this._joinType;const M=q.dk.load(this._materialKey);this.tessellationProperties.key=(0,q.CA)(M)?M:q.a.load(this._materialKey);for(const{line:C,start:w}of n)x.initialDistance=w%65535,this._lineTessellator.tessellate(C,x)}},Ut=(o,r,i)=>(n,s,l,h,x,M,C,w,A,V,z)=>{const B=(0,N.UJ)(z,Math.ceil(16*o._halfWidth)),et=(0,N.Jz)(Math.round(16*C),Math.round(16*w),Math.round(16*A),Math.round(16*V)),ut=(0,N.Jz)(16*x,16*M,0,o._bitset),dt=o.out;return dt.vertexBounds(n,s,r,i),dt.vertexWrite((0,N.UJ)(8*n,8*s)),dt.vertexWrite(o.id),dt.vertexWrite(o._fillColor),dt.vertexWrite(et),dt.vertexWrite(B),dt.vertexWrite(o._tl),dt.vertexWrite(o._br),dt.vertexWrite(ut),dt.vertexWrite((0,N.UJ)(Math.ceil(16*o._halfReferenceWidth),0)),dt.vertexWrite(o.minMaxZoom),dt.vertexEnd(),o.offset+o.vertexCount++},Bt=(o,r,i)=>(n,s,l,h,x,M,C,w,A,V,z)=>{const B=(0,N.UJ)(16*o._halfWidth,16*o._halfReferenceWidth),et=(0,N.Jz)(16*C+128,16*w+128,16*A+128,16*V+128),ut=o.out,dt=o._bitset<<24|o.id;ut.vertexBounds(n,s,r,i),ut.vertexWrite((0,N.UJ)(8*n,8*s)),ut.vertexWrite(dt),ut.vertexWrite(o._fillColor);const Pt=(0,q.Xp)(o.key);return Pt||(ut.vertexWrite(0),ut.vertexWrite(0)),ut.vertexWrite(0),ut.vertexWrite(B),ut.vertexWrite(et),Pt||ut.vertexWrite(o.minMaxZoom),ut.vertexEnd(),o.offset+o.vertexCount++},Jt=o=>(r,i,n)=>{const s=o.out;s.indexWrite(r),s.indexWrite(i),s.indexWrite(n),o.indexCount+=3};var Vt=u(65450);class jt extends(Ot(Vt.Z)){constructor(r,i,n,s,l,h,x,M,C,w,A,V,z,B,et,ut,dt,Pt,Ft,Dt){super();const kt=q.a.load(r);i&&(kt.sdf=i.sdf,kt.pattern=!0,kt.textureBinding=i.textureBinding),this._capType=s,this._joinType=l,this._miterLimitCosine=(0,W.NW)(h),this.tessellationProperties._fillColor=x,this.tessellationProperties._tl=M,this.tessellationProperties._br=C,this._hasPattern=w,this._isDashed=A,this._zOrder=dt,this._effects=Pt,this._minMaxZoom=(0,N.UJ)(Math.round(Ft*Z.MI),Math.round(Dt*Z.MI)),this._materialKey=kt.data,this.tessellationProperties._bitset=(z?Z.Uh:0)|(B?Z.SD:0)|(V?Z._6:0)|(et?Z.Iv:0),this.tessellationProperties._halfWidth=.5*n,this.tessellationProperties._halfReferenceWidth=.5*ut,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(r,i,n){const s=r.color,l=r.scaleFactor||1,h=!!r.dashTemplate;let x=r.cap;h&&x===xt.RL.ROUND&&(x=xt.RL.SQUARE);const M=r.join,C=(0,H.F2)(r.width)*l,w=(0,H.F2)(r.referenceWidth),A=(0,H.F2)(r.miterLimit),V=s&&(0,ht.t2)(s)||0,[z,B]=(0,W._f)(r.scaleInfo,n);if(!i)return new jt(r.materialKey,i,C,x,M,A,V,0,0,!1,h,r.scaleDash??!1,r.colorLocked??!1,!1,r.sampleAlphaOnly,w,r.zOrder,r.effects,z,B);const{rect:ut,width:dt,height:Pt}=i,Ft=ut.x+Z.fL,Dt=ut.y+Z.fL,kt=Ft+dt,Xt=Dt+Pt,oe=(0,N.UJ)(Ft,Dt),re=(0,N.UJ)(kt,Xt);return new jt(r.materialKey,i,C,x,M,A,V,oe,re,!0,h,r.scaleDash??!1,r.colorLocked??!1,!1,r.sampleAlphaOnly,w,r.zOrder,r.effects,z,B)}static fromFillOutline(r){const i=q.dk.load(r.materialKey);return(0,q.CA)(i)&&r.outline&&"esriSLSSolid"===r.outline?.style?jt.fromSimpleLine({hash:"",materialKey:r.materialKey,...r.outline},null,!0):null}static fromSimpleLine(r,i,n=!1){const{color:s}=r,l="esriSLSSolid"!==r.style&&"esriSLSNull"!==r.style,h=(0,L.ws)(r.cap||"round"),x=(0,L.xV)(r.join||"round");let M=s&&"esriSLSNull"!==r.style&&(0,ht.aH)(s)||0;"esriSLSNull"===r.style&&(M=0);const C=(0,H.F2)(r.width),w=r.miterLimit;if(!i)return new jt(r.materialKey,i,C,h,x,w,M,0,0,!1,l,!0,!1,n,!1,C,0,null,W.Xe,W.eW);const{rect:A,width:V,height:z}=i,B=A.x+Z.fL,et=A.y+Z.fL,ut=B+V,dt=et+z,Pt=(0,N.UJ)(B,et),Ft=(0,N.UJ)(ut,dt);return new jt(r.materialKey,i,C,h,x,w,M,Pt,Ft,!0,l,!0,!1,n,!1,C,0,null,W.Xe,W.eW)}static fromPictureLineSymbol(r,i,n,s){return mt.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate").error("PictureLineSymbol support does not exist!"),null}}const qt=o=>class extends o{constructor(...r){super(...r),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=j.LW.FILL}_maybeAddLineTemplate(r){this._lineTemplate=jt.fromFillOutline(r)}_write(r,i,n,s){const l="esriGeometryPoint"===i.geometryType,h=q.dk.load(this._materialKey);r.recordStart(i.getDisplayId(),this._materialKey,this.geometryType,l),this._writeGeometry(r,i,h,s,l),(0,q.CA)(h)&&(0,tt.pC)(this._lineTemplate)&&this._lineTemplate.writeGeometry(r,i,s,l),r.recordEnd()}_writeGeometry(r,i,n,s,l){const h=this._getGeometry(i,s,l);if((0,tt.Wi)(h))return;const x=[];if(!(h.maxLength>100)&&!this.forceLibtess&&function st(o,r){const{coords:i,lengths:n,hasIndeterminateRingOrder:s}=r,h=o;if(s)return!1;let x=0;for(let M=0;M<n.length;){let C=M,w=n[M],A=Y(i,x,w);const V=[];for(;++C<n.length;){const ut=n[C],dt=Y(i,x+w,ut);if(!(dt>0))break;A+=dt,V.push(x+w),w+=ut}const z=h.length;ot(h,i,x,x+w,V,2,0);const B=G(h,i,z,h.length,0),et=Math.abs(A);if(Math.abs((B-et)/Math.max(1e-7,et))>1e-5)return h.length=0,!1;M=C,x+=w}return!0}(x,h))return void(x.length&&this._writeVertices(r,i,h.coords,h.lengths,n,x));const M=function J(o){const{coords:r,lengths:i}=o,{buffer:n}=(0,S.b)(r,i);return n}(h);this._writeVertices(r,i,M,[M.length/2],n)}_writeVertex(r,i,n,s,l,h){const x=(0,N.UJ)(1*s,1*l);if(r.vertexBounds(s,l,0,0),r.vertexWrite(x),r.vertexWrite(i),n.symbologyType===j.mD.DOT_DENSITY)r.vertexWriteF32(1/Math.abs(h.readGeometryArea()));else{r.vertexWrite(this.fillColor);const M=(0,q.Xp)(n);M||(r.vertexWrite(this.tl),r.vertexWrite(this.br)),r.vertexWrite(this.aux21),r.vertexWrite(this.aux22),r.vertexWrite(this.aux3),M||r.vertexWrite(this._minMaxZoom)}}_writeVertices(r,i,n,s,l,h){const x=i.getDisplayId(),M=this._bitset<<24|x,C=s.reduce((z,B)=>z+B),w=(0,L.$_)(l.geometryType,l.symbologyType).geometry/4,A=r.vertexCount();r.vertexEnsureSize(w*C);let V=0;if(h)for(const z of h)this._writeVertex(r,M,l,n[2*z],n[2*z+1],i),V++;else for(let z=0;z<n.length;z+=2){const B=Math.round(n[z]),et=Math.round(n[z+1]);this._writeVertex(r,M,l,B,et,i),V++}r.indexEnsureSize(V);for(let z=0;z<V;z++)r.indexWrite(z+A)}_getGeometry(r,i,n){const s=i?(0,d.oB)((0,d.GH)(i),2):r.readGeometryForDisplay();return s?function Et(o,r){if((0,tt.Wi)(o))return null;if(!function Wt(o,r,i){let n=0;for(let s=0;s<o.lengths.length;s++){const l=o.lengths[s];for(let h=0;h<l;h++){const x=o.coords[2*(h+n)],M=o.coords[2*(h+n)+1];if(x<r||x>i||M<r||M>i)return!0}n+=l}return!1}(o,-128,Z.I_+128))return o;R.setPixelMargin(r),R.reset(nt.Vl.Polygon);let i=0;for(let h=0;h<o.lengths.length;h++){const x=o.lengths[h];let M=o.coords[2*(0+i)],C=o.coords[2*(0+i)+1];R.moveTo(M,C);for(let w=1;w<x;w++)M=o.coords[2*(w+i)],C=o.coords[2*(w+i)+1],R.lineTo(M,C);R.close(),i+=x}const n=R.result(!1);if(!n)return null;const s=[],l=[];for(const h of n){let x=0;for(const M of h)l.push(M.x),l.push(M.y),x++;s.push(x)}return new at.Z(s,l)}(s,n?256:8):null}};var ee=u(61850),At=u(2047);const ye=mt.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class ae extends Vt.Z{constructor(r){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=r}analyze(r,i,n,s,l){if(l&&0===l.length)return null;const h=l&&l.length>0,x=i.readLegacyFeature(),M=i.getObjectId(),C=this._materialCache,w=this._cimLayer.materialHash;if(!w)return ye.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const A="function"==typeof w?w(x,n,s,M):w,V=C.get(A);if(null!=V)return Promise.resolve(V);const z=this._ongoingMaterialRequestMap.get(A);if(z)return z;const B=this._cimLayer,et=(0,ee.S)(B.cim,this._cimLayer.materialOverrides);et.mosaicHash=A;const{type:ut,url:dt}=B,Pt={cim:et,type:ut,mosaicHash:A,url:dt,size:null,dashTemplate:null,text:null,fontName:null,objectId:M,animatedSymbolProperties:null};switch(ut){case"marker":Pt.size=(0,At.hf)(B.size,x,n,s),Pt.animatedSymbolProperties=(0,At.hf)(B.animatedSymbolProperties,x,n,s);break;case"line":Pt.dashTemplate=B.dashTemplate;break;case"text":Pt.text=(0,At.hf)(B.text,x,n,s),Pt.fontName=(0,At.hf)(B.fontName,x,n,s)}const Ft=r.getMosaicItem(Pt,l).then(Dt=>(h||(this._ongoingMaterialRequestMap.delete(A),C.set(A,Dt)),Dt)).catch(Dt=>(this._ongoingMaterialRequestMap.delete(A),ye.error(".analyze()",Dt.message),null));return h||this._ongoingMaterialRequestMap.set(A,Ft),Ft}}var Nt=u(31829);class ue extends(qt(ae)){constructor(r,i,n){if(super(r),this._minMaxZoom=(0,N.UJ)(Math.round(i*Z.MI),Math.round(n*Z.MI)),(0,W.mf)(r.color))this._dynamicPropertyMap.set("fillColor",(A,V,z)=>{const B=r.color(A,V,z);return B&&(0,ht.t2)(B)||0});else{const w=r.color;this.fillColor=w&&(0,ht.t2)(w)||0}const s="CIMMarkerPlacementInsidePolygon"===r.cim.placement?.type&&r.cim.placement.shiftOddRows?2:1,l=r.height;(0,W.mf)(l)?this._dynamicPropertyMap.set("_height",(A,V,z)=>l(A,V,z)*s):this._height=(l||0)*s;const h=r.offsetX;(0,W.mf)(h)?this._dynamicPropertyMap.set("_offsetX",(A,V,z)=>(0,H.F2)(h(A,V,z))):this._offsetX=(0,H.F2)(h||0);const x=r.offsetY;(0,W.mf)(x)?this._dynamicPropertyMap.set("_offsetY",(A,V,z)=>(0,H.F2)(-x(A,V,z))):this._offsetY=(0,H.F2)(-x||0);const M=r.scaleX;(0,W.mf)(M)?this._dynamicPropertyMap.set("_scaleX",M):this._scaleX=M||1;const C=r.angle;if((0,W.mf)(C)?this._dynamicPropertyMap.set("_angle",(A,V,z)=>(0,Mt.s5)(C(A,V,z))):this._angle=(0,Mt.s5)(C)||0,(0,tt.pC)(r.effects)){const w=r.effects;(0,W.mf)(w)?this._dynamicPropertyMap.set("_effects",w):this._effects=w}this._cimFillLayer=r,this._bitset=(r.colorLocked?Z.Uh:0)|(r.applyRandomOffset?Z.jk:0)|(r.sampleAlphaOnly?Z.Iv:0)|(r.hasUnresolvedReplacementColor?Z.vw:0),this._fillMaterialKey=r.materialKey}static fromCIMFill(r,i){const[n,s]=(0,W._f)(r.scaleInfo,i);return new ue(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature();this._dynamicPropertyMap.forEach((w,A)=>{this[A]=w(s,i,n)});const l=q.dk.load(this._fillMaterialKey),h=this._materialCache,x=(0,this._cimFillLayer.materialHash)(s,i,n),M=h.get(x);let C=null;if(M&&(0,Nt.ok)(M.spriteMosaicItem)&&(C=M.spriteMosaicItem),C){const{rect:w,width:A,height:V}=C,z=w.x+Z.fL,B=w.y+Z.fL,et=z+A,ut=B+V;let dt=Math.round((0,H.F2)(this._height));dt<=0&&(dt=ut-B);let Pt=Math.round((0,H.F2)(this._height/V*A||0));Pt<=0&&(Pt=et-z);const Ft=this._scaleX,Dt=1;this.tl=(0,N.UJ)(z,B),this.br=(0,N.UJ)(et,ut),this.aux21=(0,N.UJ)(Pt,dt),this.aux22=(0,N.UJ)(this._offsetX,this._offsetY),this.aux3=(0,N.Jz)(128*Ft,128*Dt,this._angle,0),l.sdf=C.sdf,l.pattern=!0,l.textureBinding=C.textureBinding}else this.tl=0,this.br=0,this.aux21=0,this.aux22=0,this.aux3=0,l.sdf=!1,l.pattern=!1,l.textureBinding=0;this._materialKey=l.data}}class _e extends(Ot(ae)){constructor(r,i,n){super(r),this._minMaxZoom=(0,N.UJ)(Math.round(i*Z.MI),Math.round(n*Z.MI)),this._cimLineLayer=r;let s=0;(0,W.mf)(r.width)||(s=.5*(0,H.F2)(r.width)),this._dynamicPropertyMap.set("_halfWidth",(A,V,z)=>(0,W.mf)(r.width)?.5*(0,H.F2)(r.width(A,V,z)):s),(0,W.mf)(r.cap)?this._dynamicPropertyMap.set("_capType",r.cap):this._capType=r.cap,(0,W.mf)(r.join)?this._dynamicPropertyMap.set("_joinType",r.join):this._joinType=r.join;const h=r.color;(0,W.mf)(h)?this._dynamicPropertyMap.set("_fillColor",(V,z,B)=>(0,ht.t2)(h(V,z,B))):this._fillColor=h&&(0,ht.t2)(h)||0;const x=r.miterLimit;if((0,W.mf)(x)?this._dynamicPropertyMap.set("_miterLimitCosine",(V,z,B)=>(0,W.NW)(x(V,z,B))):this._miterLimitCosine=(0,W.NW)(x),(0,tt.pC)(r.effects)){const A=r.effects;(0,W.mf)(A)?this._dynamicPropertyMap.set("_effects",A):this._effects=A}this._scaleFactor=r.scaleFactor||1,this._isDashed=null!=r.dashTemplate,this.tessellationProperties._bitset=(r.colorLocked?Z.Uh:0)|(r.scaleDash?Z._6:0)|(r.sampleAlphaOnly?Z.Iv:0),this._materialKey=r.materialKey,this._initializeTessellator(!0)}static fromCIMLine(r,i){const[n,s]=(0,W._f)(r.scaleInfo,i);return new _e(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature();this._dynamicPropertyMap.forEach((w,A)=>{this[A]=w(s,i,n)}),this._halfWidth*=this._scaleFactor;const l=this._materialCache,h=(0,this._cimLineLayer.materialHash)(s,i,n),x=l.get(h);let M=null;if(x&&(0,Nt.ok)(x.spriteMosaicItem)&&(M=x.spriteMosaicItem),M){this._hasPattern=!0;const{rect:w,width:A,height:V}=M,z=w.x+Z.fL,B=w.y+Z.fL,et=z+A,ut=B+V;this.tessellationProperties._tl=(0,N.UJ)(z,B),this.tessellationProperties._br=(0,N.UJ)(et,ut)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const C=q.a.load(this._materialKey);M&&(C.sdf=M.sdf,C.pattern=!0,C.textureBinding=M.textureBinding),this._materialKey=C.data}}var be=u(80309),Se=u(12288),Ie=u(47526);const Ce=(0,Se.c)(),we=(0,be.c)();class de extends((0,Ie.Z)(ae)){constructor(r,i,n){super(r),this._cimMarkerLayer=r,this._minMaxZoom=(0,N.UJ)(Math.round(i*Z.MI),Math.round(n*Z.MI));const s=r.color;(0,W.mf)(s)?this._dynamicPropertyMap.set("_fillColor",(z,B,et)=>(0,ht.t2)(s(z,B,et))):this._fillColor=(0,ht.t2)(s);const l=r.outlineColor;(0,W.mf)(l)?this._dynamicPropertyMap.set("_outlineColor",(z,B,et)=>(0,ht.t2)(l(z,B,et))):this._outlineColor=(0,ht.t2)(l);const h=r.size;(0,W.mf)(h)?this._dynamicPropertyMap.set("_size",(z,B,et)=>(0,H.F2)(h(z,B,et))):this._size=(0,H.F2)(h)||0;const x=r.scaleX;(0,W.mf)(x)?this._dynamicPropertyMap.set("_scaleX",x):this._scaleX=x;const M=r.offsetX;(0,W.mf)(M)?this._dynamicPropertyMap.set("xOffset",(z,B,et)=>(0,H.F2)(M(z,B,et))):this.xOffset=(0,H.F2)(M)||0;const C=r.offsetY;(0,W.mf)(C)?this._dynamicPropertyMap.set("yOffset",(z,B,et)=>(0,H.F2)(C(z,B,et))):this.yOffset=(0,H.F2)(C)||0;const w=r.outlineWidth;(0,W.mf)(w)?this._dynamicPropertyMap.set("_outlineWidth",(z,B,et)=>(0,H.F2)(w(z,B,et))):this._outlineWidth=(0,H.F2)(w)||0;const A=r.rotation;if((0,W.mf)(A)?this._dynamicPropertyMap.set("_angle",A):this._angle=A||0,(0,tt.pC)(r.effects)){const V=r.effects;(0,W.mf)(V)?this._dynamicPropertyMap.set("_effects",V):this._effects=V}if((0,tt.pC)(r.markerPlacement)){const V=r.markerPlacement;(0,W.mf)(V)?this._dynamicPropertyMap.set("_markerPlacement",V):this._markerPlacement=V}this._scaleFactor=(0,tt.Pt)(r.scaleFactor,1),this._bitSet=(r.alignment===xt.v2.MAP?1:0)|(r.colorLocked?1:0)<<1|(r.scaleSymbolsProportionally?1:0)<<3,this._materialKey=r.materialKey}static fromCIMMarker(r,i){const[n,s]=(0,W._f)(r.scaleInfo,i);return new de(r,n,s)}bindFeature(r,i,n){const s=r.readLegacyFeature(),l=r.getObjectId();this._dynamicPropertyMap.forEach((Ve,Ge)=>{this[Ge]=Ve(s,i,n)});const h=this._cimMarkerLayer.materialHash,x="function"==typeof h?h(s,i,n,l):h,M=this._materialCache.get(x);if(!M||!(0,Nt.ok)(M.spriteMosaicItem)||!M.spriteMosaicItem)return void mt.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate").error(new _t.Z("mapview-cim","Encountered an error when binding feature"));const C=M.spriteMosaicItem,w=this._cimMarkerLayer.sizeRatio,A=C.width/C.height*this._scaleX,V=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let z=this._size,B=z*A;const et=this.xOffset,ut=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const dt=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,H.F2)(this._cimMarkerLayer.frameHeight):1,Pt=this._outlineWidth*dt,Ft=(0,H.F2)(this._cimMarkerLayer.referenceSize);let Dt=0,kt=0;const Xt=this._cimMarkerLayer.anchorPoint;Xt&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(Dt=(0,H.F2)(Xt.x)/(this._size*A),kt=(0,H.F2)(Xt.y)/this._size):(Dt=Xt.x,kt=Xt.y)),this._anchorX=Dt,this._anchorY=kt,this._sizeOutlineWidth=(0,N.Jz)(Math.round(Math.min(Math.sqrt(128*B),255)),Math.round(Math.min(Math.sqrt(128*z),255)),Math.round(Math.min(Math.sqrt(128*Pt),255)),Math.round(Math.min(Math.sqrt(128*Ft),255))),this.angle=V;const oe=Math.round(64*w);this._bitestAndDistRatio=(0,N.UJ)(this._bitSet,oe);const re=C.rect.x+Z.fL,ie=C.rect.y+Z.fL,We=re+C.width,Pe=ie+C.height;this._texUpperLeft=(0,N.UJ)(re,ie),this._texUpperRight=(0,N.UJ)(We,ie),this._texBottomLeft=(0,N.UJ)(re,Pe),this._texBottomRight=(0,N.UJ)(We,Pe);const ce=q.mE.load(this._materialKey);ce.sdf=C.sdf,ce.pattern=!0,ce.textureBinding=C.textureBinding,this._materialKey=ce.data,B*=w,z*=w,B*=this._scaleFactor,z*=this._scaleFactor,B*=C.rect.width/C.width,z*=C.rect.height/C.height,this._computedWidth=B,this._computedHeight=z,this._applyTransformation(we,Ce),this.xOffset=et,this.yOffset=ut}}var ge=u(81925),Be=u(50552),ve=u(19805);class fe extends((0,Be.Z)(ae)){constructor(r,i,n){super(r),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=(0,N.UJ)(Math.round(i*Z.MI),Math.round(n*Z.MI));const s=r.scaleFactor||1;this._cimTextLayer=r;const l=r.color;(0,W.mf)(l)?this._dynamicPropertyMap.set("_color",(ut,dt,Pt)=>(0,ht.t2)(l(ut,dt,Pt))):this._color=(0,ht.t2)(l);const h=r.outlineColor;let x,C,A;if((0,W.mf)(h)?this._dynamicPropertyMap.set("_haloColor",(ut,dt,Pt)=>(0,ht.t2)(h(ut,dt,Pt))):this._haloColor=(0,ht.t2)(h),(0,W.mf)(r.size)||(x=Math.min(Math.round((0,H.F2)(r.size*r.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(et,ut,dt)=>(0,W.mf)(r.size)?Math.min(Math.round((0,H.F2)(r.size(et,ut,dt)*r.sizeRatio)),127):x),(0,W.mf)(r.outlineSize)?this._dynamicPropertyMap.set("_haloSize",(ut,dt,Pt)=>Math.min(Math.floor(5*(0,H.F2)(r.outlineSize(ut,dt,Pt)*r.sizeRatio)),127)):this._haloSize=Math.min(Math.floor(5*(0,H.F2)(r.outlineSize*r.sizeRatio)),127),(0,W.mf)(r.offsetX)||(C=Math.round((0,H.F2)(r.offsetX*r.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(et,ut,dt)=>(0,W.mf)(r.offsetX)?Math.round((0,H.F2)(r.offsetX(et,ut,dt)*r.sizeRatio)):C),(0,W.mf)(r.offsetY)||(A=Math.round((0,H.F2)(r.offsetY*r.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(et,ut,dt)=>(0,W.mf)(r.offsetY)?Math.round((0,H.F2)(r.offsetY(et,ut,dt)*r.sizeRatio)):A),(0,W.mf)(r.angle)?this._dynamicPropertyMap.set("_angle",r.angle):this._angle=r.angle,(0,W.mf)(r.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",r.horizontalAlignment):this._horizontalAlignment=r.horizontalAlignment,(0,W.mf)(r.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",r.verticalAlignment):this._verticalAlignment=r.verticalAlignment,(0,tt.pC)(r.effects)){const et=r.effects;(0,W.mf)(et)?this._dynamicPropertyMap.set("_effects",et):this._effects=et}if((0,tt.pC)(r.markerPlacement)){const et=r.markerPlacement;(0,W.mf)(et)?this._dynamicPropertyMap.set("_markerPlacement",et):this._textPlacement=et}(0,W.mf)(r.text)?this._dynamicPropertyMap.set("_text",r.text):this._text=r.text,this._backgroundColor=r.backgroundColor&&(0,ht.t2)(r.backgroundColor),this._borderLineColor=r.borderLineColor&&(0,ht.t2)(r.borderLineColor),this._borderLineSize=r.borderLineWidth,this._scaleFactor=s;const z=Math.min(Math.round((0,H.F2)(r.referenceSize*r.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*z)),this._materialKey=r.materialKey;const B=q.qr.load(this._materialKey);B.sdf=!0,this._bitset=(r.alignment===xt.v2.MAP?1:0)|(r.colorLocked?1:0)<<1,this._materialKey=B.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(r,i){const[n,s]=(0,W._f)(r.scaleInfo,i);return new fe(r,n,s)}analyze(r,i,n,s){var l=()=>super.analyze,h=this;return(0,k.Z)(function*(){const x=i.readLegacyFeature(),M=function ze(o,r,i,n){return"string"==typeof o.text?o.text:"function"==typeof o.text?o.text(r,i,n)??"":""}(h._cimTextLayer,x,n,s),C=yield l().call(h,r,i,n,s,(0,ve._)(M));return C&&C.glyphMosaicItems&&h._textToGlyphs.set(M,C.glyphMosaicItems),C})()}bindFeature(r,i,n){const s=r.readLegacyFeature();if(this._dynamicPropertyMap.forEach((h,x)=>{this[x]=h(s,i,n)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/Z.Ex,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,ge.kH)((0,tt.Pt)(this._horizontalAlignment,"center")),this._yAlignD=(0,ge.b7)((0,tt.Pt)(this._verticalAlignment,"baseline"));const l=this._textToGlyphs.get(this._text)??[];this.bindTextInfo(l,!1)}}class Qt extends(qt(Vt.Z)){constructor(r,i,n,s,l,h,x,M,C,w,A,V,z,B,et,ut){super(),this._effects=B;const dt=q.dk.load(r);i&&(dt.sdf=i.sdf,dt.pattern=!0,dt.textureBinding=i.textureBinding),this.fillColor=n,this.tl=s,this.br=l,this.aux21=(0,N.UJ)(h,x),this.aux22=(0,N.UJ)(M,C),this.aux3=(0,N.Jz)(w,A,V,0),this._bitset=z,this._minMaxZoom=(0,N.UJ)(Math.round(et*Z.MI),Math.round(ut*Z.MI)),this._materialKey=dt.data}static fromCIMFill(r,i,n){const s=r.color,l=s&&(0,ht.t2)(s)||0,h=r.materialKey,[x,M]=(0,W._f)(r.scaleInfo,n),C=(r.colorLocked?Z.Uh:0)|(r.applyRandomOffset?Z.jk:0)|(r.sampleAlphaOnly?Z.Iv:0)|(r.hasUnresolvedReplacementColor?Z.vw:0);if(!i)return new Qt(h,null,l,0,0,0,0,0,0,0,0,0,C,r.effects,x,M);const{rect:w,width:A,height:V}=i,z=r.scaleX||1,B=w.x+Z.fL,et=w.y+Z.fL,ut=B+A,dt=et+V,Pt=(0,H.F2)(r.height);let Ft=z*Pt;"CIMHatchFill"===r.cim.type&&(Ft*=A/V);let Dt=Math.round(Pt);Dt<=0&&(Dt=dt-et);let kt=Math.round(Ft);kt<=0&&(kt=ut-B);const Xt=(0,H.F2)(r.offsetX||0),oe=(0,H.F2)(-r.offsetY||0),re=(0,N.UJ)(B,et),ie=(0,N.UJ)(ut,dt);return new Qt(h,i,l,re,ie,kt,Dt,Xt,oe,128,128,(0,Mt.s5)(r.angle),C,r.effects,x,M)}static fromSimpleFill(r,i,n=!1){const{color:s}=r,l=s&&"esriSFSNull"!==r.style&&(0,ht.aH)(s)||0,h=n?Z.Uh:0,x=r.materialKey;let M;if(i){const{rect:C,width:w,height:A,pixelRatio:V}=i,z=C.x+Z.fL,B=C.y+Z.fL,et=z+w,ut=B+A,dt=(0,N.UJ)(z,B),Pt=(0,N.UJ)(et,ut);M=new Qt(x,i,l,dt,Pt,w/V,A/V,0,0,128,128,0,h,null,W.Xe,W.eW)}else M=new Qt(x,null,l,0,0,0,0,0,0,0,0,0,h,null,W.Xe,W.eW);return M._maybeAddLineTemplate(r),M}static fromPictureFill(r,i,n=!1){const s=Z.ru,{rect:l,width:h,height:x}=i,M=l.x+Z.fL,C=l.y+Z.fL,w=M+h,A=C+x,V=(0,N.UJ)(M,C),z=(0,N.UJ)(w,A),B=Math.round((0,H.F2)(r.width)),et=Math.round((0,H.F2)(r.height)),ut=(0,H.F2)(r.xoffset),dt=(0,H.F2)(-r.yoffset),Dt=new Qt(r.materialKey,i,s,V,z,B,et,ut,dt,128*r.xscale,128*r.yscale,0,n?Z.Uh:0,null,W.Xe,W.eW);return Dt._maybeAddLineTemplate(r),Dt}}var le=u(79752),Le=u(36780);class De{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var r=this;return(0,k.Z)(function*(){r._resolver?(yield r._resolver.promise,yield r.acquire()):r._resolver=(0,$.hh)()})()}release(){const r=this._resolver;this._resolver=null,r?.resolve()}}function me(){return(me=(0,k.Z)(function*(o,r,i){try{yield o.acquire(),yield r(i),o.release()}catch(n){throw o.release(),n}})).apply(this,arguments)}var he=u(50439);const Gt=mt.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Te={sortKey:null,templates:new Array},xe={isOutline:!1,placement:null,symbologyType:j.mD.DEFAULT,vvFlags:0},Oe={...F.eG,hash:JSON.stringify(F.eG),materialKey:(0,q.jj)(j.LW.MARKER,xe)},Ae={...F.wW,hash:JSON.stringify(F.wW),materialKey:(0,q.jj)(j.LW.LINE,xe)},Ue={...F.lj,hash:JSON.stringify(F.lj),materialKey:(0,q.jj)(j.LW.FILL,xe)};function $t(o,r){const i=o.length;return o.push(null),r.then(n=>o[i]=n),o}function Ee(o){return null!=o&&!!(1&o)}class Ze{constructor(r,i){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new De,this._fetchResource=r,this._tileInfo=i}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(r,i,n=null){this._initErrorTemplates();const s=r.hash,l=this._symbolToTemplate.get(s);if(null!=l)return l;const h=new Array,x={sortKey:n,templates:h};i&&this._createMeshTemplates(h,i,!0),this._createMeshTemplates(h,r,!1);const M=this._createGroupId("expanded-cim"===r.type&&Ke(r));return this._idToTemplateGroup.set(M,x),this._symbolToTemplate.set(s,M),M}getTemplateGroup(r){return this._idToTemplateGroup.get(r)??Te}getDynamicTemplateGroup(r){return this._idToTemplateGroup.has(r)?(Ee(r)||Gt.error("mapview-template-store",`Id ${r} does not refer to a dynamic template`),this._idToTemplateGroup.get(r)):Te}getMosaicItem(r,i){const n=this._createTemplateId(),s=new Promise(l=>this._idToResolver.set(n,l));return this._fetchQueue.push({symbol:r,id:n,glyphIds:i}),s}finalize(r){return this._fetchQueue.length||this._lock.isHeld()?function Re(o,r,i){return me.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),r):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Ue,!1),marker:this._createMeshTemplates([],Oe,!1),line:this._createMeshTemplates([],Ae,!1)})}_fetchAllQueuedResources(r){if(!this._fetchQueue.length)return Promise.resolve();const i=this._fetchQueue,n=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(n).then(()=>this._fetchResource(i,r).then(s=>{for(const{id:l,mosaicItem:h}of s)this._idToResolver.get(l)(h),this._idToResolver.delete(l)})).catch(s=>{(0,$.D_)(s)?this._fetchQueue=this._fetchQueue.concat(i):function Fe(o){return"worker:port-closed"===o.name}(s)||Gt.error(new _t.Z("mapview-template-store","Unable to fetch requested texture resources",s))})}_createGroupId(r){return this._idCounter++<<1|(r?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,Nt.ok)(n,Gt)?le.Z.fromSimpleMarker(r,n):i._markerError})()}_createPMS(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,Nt.ok)(n,Gt)?le.Z.fromPictureMarker(r,n):i._markerError})()}_createSFS(r,i){var n=this;return(0,k.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,Nt.ok)(s,Gt)?Qt.fromSimpleFill(r,s,i):n._fillError})()}_createPFS(r,i){var n=this;return(0,k.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,Nt.ok)(s,Gt)?Qt.fromPictureFill(r,s,i):n._fillError})()}_createSLS(r,i){var n=this;return(0,k.Z)(function*(){const{spriteMosaicItem:s}=yield n.getMosaicItem(r);return(0,Nt.ok)(s,Gt)?jt.fromSimpleLine(r,s):n._lineError})()}_createLMS(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem(r);return(0,Nt.ok)(n,Gt)?le.Z.fromLineSymbolMarker(r,n):i._markerError})()}_createTS(r){var i=this;return(0,k.Z)(function*(){const{glyphMosaicItems:n}=yield i.getMosaicItem(r);return Le.Z.fromText(r,n??[])})()}_createCIMText(r){var i=this;return(0,k.Z)(function*(){const{glyphMosaicItems:n}=yield i.getMosaicItem((0,he.x)(r),(0,ve._)(r.text));return(0,Nt.ok)(n,Gt)?Le.Z.fromCIMText(r,n,i._tileInfo):i._textError})()}_createCIMFill(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem((0,he.x)(r));return(0,Nt.ok)(n,Gt)?Qt.fromCIMFill(r,n,i._tileInfo):i._fillError})()}_createCIMLine(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem((0,he.x)(r));return(0,Nt.ok)(n,Gt)?jt.fromCIMLine(r,n,i._tileInfo):i._lineError})()}_createCIMMarker(r){var i=this;return(0,k.Z)(function*(){const{spriteMosaicItem:n}=yield i.getMosaicItem((0,he.x)(r));return(0,Nt.ok)(n,Gt)?le.Z.fromCIMMarker(r,n,i._tileInfo):i._markerError})()}_createCIM(r){var i=this;return(0,k.Z)(function*(){const n=r.templateHash;let s=i._cimTemplateCache.get(n);if(null!=s)return s;switch(r.type){case"marker":s=yield i._createCIMMarker(r);break;case"line":s=yield i._createCIMLine(r);break;case"fill":s=yield i._createCIMFill(r);break;case"text":s=yield i._createCIMText(r)}return i._cimTemplateCache.set(n,s),s})()}_createDynamicCIM(r){var i=this;return(0,k.Z)(function*(){const n=r.templateHash;let s=i._cimTemplateCache.get(n);if(null!=s)return s;switch(r.type){case"marker":s=de.fromCIMMarker(r,i._tileInfo);break;case"line":s=_e.fromCIMLine(r,i._tileInfo);break;case"fill":s=ue.fromCIMFill(r,i._tileInfo);break;case"text":s=fe.fromCIMText(r,i._tileInfo)}return i._cimTemplateCache.set(n,s),s})()}_createPrimitiveMeshTemplates(r,i,n){switch(i.type){case"esriSMS":return $t(r,this._createSMS(i));case"esriPMS":return $t(r,this._createPMS(i));case"esriSFS":return $t(r,this._createSFS(i,n));case"line-marker":return $t(r,this._createLMS(i));case"esriPFS":return $t(r,this._createPFS(i,n));case"esriSLS":return $t(r,this._createSLS(i,!1));case"esriTS":return $t(r,this._createTS(i));default:return Gt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),r}}_createMeshTemplates(r,i,n){if(i.type.includes("3d"))return Gt.error("3D symbols are not supported with MapView"),r;if("expanded-cim"===i.type){for(const s of i.layers)$t(r,"function"==typeof s.materialHash?this._createDynamicCIM(s):this._createCIM(s));return r}if("composite-symbol"===i.type){for(const s of i.layers)this._createPrimitiveMeshTemplates(r,s,n);return r}return"cim"===i.type||"label"===i.type||"web-style"===i.type?r:this._createPrimitiveMeshTemplates(r,i,n)}}const Ke=o=>{if(!o.layers)return!1;for(const r of o.layers)if("function"==typeof r.materialHash)return!0;return!1}},36780:(Zt,St,u)=>{u.d(St,{Z:()=>N});var k=u(65489),_t=u(55798),mt=u(20877),$=u(81925),F=u(9203),j=u(80696),q=u(72375),tt=u(21605),H=u(85366),ht=u(50552),Z=u(65450);class N extends((0,ht.Z)(Z.Z)){constructor(d,L,p,S,nt,at,ot,m,c,g,T,b,D,P,O,K,I,y,_,rt,Q,it,ct,ft){super(),this._xOffset=(0,_t.F2)(D),this._yOffset=(0,_t.F2)(P),this._decoration=g||"none",this._backgroundColor=it,this._borderLineColor=ct,this._borderLineSize=ft,this._color=nt,this._haloColor=at,this._haloSize=Math.min(Math.floor(5*(0,_t.F2)((0,_t.t_)(p))),127),this._size=Math.min(Math.round((0,_t.F2)(L)),127);const gt=Math.min(Math.round((0,_t.F2)(S||L)),127);this._referenceSize=Math.round(Math.sqrt(256*gt)),this._scale=this._size/j.Ex,this._angle=b,this._justify=(0,$.Hd)(ot||"center"),this._xAlignD=(0,$.kH)(ot||"center"),this._yAlignD=(0,$.b7)(m||"baseline"),this._baseline="baseline"===(m||"baseline"),this._bitset=(c===mt.v2.MAP?1:0)|(T?1:0)<<1;const Rt=tt.m2.load(d);Rt.sdf=!0,this._materialKey=Rt.data,this._lineWidth=(0,_t.F2)(O)||512,this._lineHeight=K||1,this._textPlacement=I,this._effects=y,this._isCIM=_??!1,this._minMaxZoom=(0,q.UJ)(Math.round(rt*j.MI),Math.round(Q*j.MI))}static fromText(d,L){const p=d.font?.size,S=new N(d.materialKey,p,d.haloSize||0,p,d.color&&(0,F.aH)(d.color)||0,d.haloColor&&(0,F.aH)(d.haloColor)||0,d.horizontalAlignment,d.verticalAlignment,mt.v2.SCREEN,d.font?.decoration,!1,d.angle||0,d.xoffset||0,d.yoffset||0,d.lineWidth||0,d.lineHeight||0,null,null,!1,H.Xe,H.eW,d.backgroundColor&&(0,F.aH)(d.backgroundColor),d.borderLineColor&&(0,F.aH)(d.borderLineColor),d.borderLineSize),[,nt]=(0,k.E)(d.text);return S.bindTextInfo(L??[],nt),S._vertexBoundsScale=d.maxVVSize&&p?d.maxVVSize/p:1,S}static fromCIMText(d,L,p){const S=d.scaleFactor||1,nt=d.size*d.sizeRatio*S,[at,ot]=(0,H._f)(d.scaleInfo,p),m=new N(d.materialKey,nt,d.outlineSize*d.sizeRatio,d.referenceSize,(0,F.t2)(d.color),(0,F.t2)(d.outlineColor),d.horizontalAlignment,d.verticalAlignment,d.alignment,d.decoration,d.colorLocked??!1,d.angle,d.offsetX*d.sizeRatio*S,d.offsetY*d.sizeRatio*S,512,1,d.markerPlacement,d.effects,!0,at,ot,d.backgroundColor?(0,F.t2)(d.backgroundColor):void 0,d.borderLineColor?(0,F.t2)(d.borderLineColor):void 0,d.borderLineWidth),[,c]=(0,k.E)(d.text);return m.bindTextInfo(L,c),m._vertexBoundsScale=d.maxVVSize?d.maxVVSize/nt:1,m}}},85366:(Zt,St,u)=>{u.d(St,{Fv:()=>F,NW:()=>tt,TK:()=>j,Xe:()=>k,_f:()=>W,eW:()=>_t,lu:()=>mt,mf:()=>q});const k=0,_t=100;function mt(d,L,p){return d[0]=L[0]-p[0],d[1]=L[1]-p[1],d}function $(d,L){return Math.sqrt(d*d+L*L)}function F(d){const L=$(d[0],d[1]);d[0]/=L,d[1]/=L}function j(d,L){return $(d[0]-L[0],d[1]-L[1])}function q(d){return"function"==typeof d}function tt(d=2){return 1/Math.max(d,1)}function W(d,L){return[!!d?.minScale&&L.scaleToZoom(d.minScale)||k,!!d?.maxScale&&L.scaleToZoom(d.maxScale)||_t]}},61995:(Zt,St,u)=>{u.d(St,{fL:()=>ht});var k=u(71670),_t=u(32995),mt=u(28191),$=u(61101),F=u(53661),j=u(77238),q=u(13763),tt=u(50439);const H=mt.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");function ht(m,c,g,T){return Z.apply(this,arguments)}function Z(){return(Z=(0,k.Z)(function*(m,c,g,T){switch(m.type){case"simple":case"heatmap":return Mt.fromBasicRenderer(m,c,g,T);case"map":return d.fromUVRenderer(m,c,g,T);case"interval":return W.fromCBRenderer(m,c,g,T);case"dictionary":return ot.fromDictionaryRenderer(m,c,g,T);case"pie-chart":return N.fromPieChartRenderer(m,c,g,T);case"subtype":return N.fromSubtypes(m,c,g,T)}})).apply(this,arguments)}class Mt{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(c,g,T,b){return(0,k.Z)(function*(){const D=new Mt;if(c.symbol){const P=yield(0,tt.B)(c.symbol,T,b),O=g.createTemplateGroup(P,null);D.setDefault(O)}return D})()}static fromPieChartRenderer(c,g,T,b){return(0,k.Z)(function*(){const D=new Mt;if(c.markerSymbol){const P=yield(0,tt.B)(c.markerSymbol,T,b);let O;c.fillSymbol&&(O=yield(0,tt.B)(c.fillSymbol,T,b));const K=g.createTemplateGroup(P,O);D.setDefault(K)}return D})()}size(){return 1}getDefault(){return this._defaultResult}setDefault(c){this._defaultResult=c}match(c,g,T,b,D){return this.getDefault()}analyze(c,g,T,b,D,P){return(0,k.Z)(function*(){return null})()}}class N extends Mt{constructor(c,g){super(),this._subMatchers=c,this._subtypeField=g}static fromSubtypes(c,g,T,b){return(0,k.Z)(function*(){const D=new Map,P=[];for(const O in c.renderers){const K=parseInt(O,10),I=ht(c.renderers[O],g,T,b).then(y=>D.set(K,y));P.push(I)}return yield Promise.all(P),new N(D,c.subtypeField)})()}match(c,g,T,b,D){const P=g.readAttribute(this._subtypeField),O=this._subMatchers.get(P);return O?O.match(c,g,T,b,D):null}}class W extends Mt{constructor(c,g,T,b){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=g,this._fieldIndex=b,this._field=c,this._normalizationInfo=T}static fromCBRenderer(c,g,T,b){return(0,k.Z)(function*(){const{isMaxInclusive:D,normalizationField:P,normalizationTotal:O,normalizationType:K}=c,y=new W(c.field,D,{normalizationField:P,normalizationTotal:O,normalizationType:K},c.fieldIndex),_=yield(0,tt.B)(c.backgroundFillSymbol,T,b);yield Promise.all(c.intervals.map(function(){var Q=(0,k.Z)(function*(it){const ct=yield(0,tt.B)(it.symbol,T,b),ft=yield g.createTemplateGroup(ct,_);y.add({min:it.min,max:it.max},ft)});return function(it){return Q.apply(this,arguments)}}()));const rt=yield(0,tt.B)(c.defaultSymbol,T,b);if(rt){const Q=yield g.createTemplateGroup(rt,_);y.setDefault(Q)}return y})()}add(c,g){this._intervals.push({interval:c,result:g}),this._intervals.sort((T,b)=>T.interval.min-b.interval.min)}size(){return super.size()+this._intervals.length}match(c,g,T,b,D){if(null==this._fieldIndex&&!this._field)return this.getDefault();const P=null!=this._fieldIndex?g.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(g);if(null==P||isNaN(P)||P===1/0||P===-1/0)return this.getDefault();for(let O=0;O<this._intervals.length;O++){const{interval:K,result:I}=this._intervals[O];if(P>=K.min&&(this._isMaxInclusive?P<=K.max:P<K.max))return I}return this.getDefault()}_needsNormalization(){const c=this._normalizationInfo;return c&&(c.normalizationField||c.normalizationTotal||c.normalizationType)}_getValueFromField(c){const g=c.readAttribute(this._field);if(!this._needsNormalization()||null==g)return g;const{normalizationField:T,normalizationTotal:b,normalizationType:D}=this._normalizationInfo,P=c.readAttribute(T)??1;if(D)switch(D){case"esriNormalizeByField":return P?g/P:void 0;case"esriNormalizeByLog":return Math.log(g)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return g/b*100;default:return void H.error(`Found unknown normalization type: ${D}`)}else H.error("Normalization is required, but no type was set!")}}class d extends Mt{constructor(c,g,T){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fields=[],this._fieldsIndex=T,this._fields=c,this._seperator=g||""}static fromUVRenderer(c,g,T,b){return(0,k.Z)(function*(){const D=c.fieldDelimiter,P=[c.field];c.field2&&P.push(c.field2),c.field3&&P.push(c.field3);const O=yield(0,tt.B)(c.backgroundFillSymbol,T,b),K=new d(P,D,c.fieldIndex);yield Promise.all(c.map.map(function(){var y=(0,k.Z)(function*(_,rt){const Q=yield(0,tt.B)(_.symbol,T,b),it=rt+1,ct=yield g.createTemplateGroup(Q,O,it);"<Null>"===_.value?K.setNullResult(ct):K.add(_.value,ct)});return function(_,rt){return y.apply(this,arguments)}}()));const I=yield(0,tt.B)(c.defaultSymbol,T,b);if(I){const y=Number.MAX_SAFE_INTEGER,_=yield g.createTemplateGroup(I,O,y);K.setDefault(_)}return K})()}setNullResult(c){this._nullResult=c}add(c,g){this._resultsMap.set(c.toString(),g)}size(){return super.size()+this._resultsMap.size}match(c,g,T,b,D){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const P=null!=this._fieldsIndex?g.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(g);if(null!==this._nullResult&&(null==P||""===P||"<Null>"===P))return this._nullResult;if(null==P)return this.getDefault();const O=P.toString();return this._resultsMap.has(O)?this._resultsMap.get(O):this.getDefault()}_getValueFromFields(c){const g=[];for(const T of this._fields){const b=c.readAttribute(T);g.push(null==b||""===b?"<Null>":b)}return g.join(this._seperator)}}function p(){return(p=(0,k.Z)(function*(m,c){const g=m||1;if("number"==typeof g)return(b,D,P)=>g;const T=yield(0,j.Yi)(g,c.spatialReference,c.fields);return(b,D,P)=>(0,q.Z)(T,b,{$view:P},c.geometryType,D)||1})).apply(this,arguments)}let S;function nt(){return at.apply(this,arguments)}function at(){return(at=(0,k.Z)(function*(){return S||(S=u.e(1945).then(u.bind(u,81945))),S})).apply(this,arguments)}class ot extends Mt{constructor(c,g,T,b,D,P){super(),this.type="dictionary",this._groupIdCache=new $.Z(100),this._loader=c,this._fieldMap=c.fieldMap,this._symbolFields=c.getSymbolFields(),this._templates=g,this._info=T,this._scaleFn=b,this._schemaUtilsModule=D,this._symbolOptions=P}static fromDictionaryRenderer(c,g,T,b){return(0,k.Z)(function*(){const[{DictionaryLoader:D},P]=yield Promise.all([Promise.resolve().then(u.bind(u,41275)),nt()]),O=new D(c.url,c.config,c.fieldMap);yield O.fetchResources({spatialReference:T.spatialReference,fields:T.fields});const K=yield function L(m,c){return p.apply(this,arguments)}(c.scaleExpression,T);return new ot(O,g,T,K,P,c.symbolOptions)})()}_analyzeFeature(c,g,T,b,D){var P=this;return(0,k.Z)(function*(){const O=c.readLegacyFeature(),K=P._scaleFn(O,T,b),I=P._attributeHash(O)+"-"+K,y=P._groupIdCache.get(I);if(y)return y;const _={...b,spatialReference:P._info.spatialReference,abortOptions:D,fields:P._info.fields},rt=yield P._loader.getSymbolAsync(O,_),Q=P._schemaUtilsModule.createSymbolSchema(rt,P._symbolOptions),it=(0,tt.B)(Q,P._info,g,D).then(ct=>{if("expanded-cim"!==ct?.type)return H.error(new _t.Z("mapview-bad-type",`Found unexpected type ${ct?.type} in dictionary response`)),null;ct.hash+="-"+K;for(const ft of ct.layers)ft.scaleFactor=K,ft.templateHash+="-"+K;return P._templates.createTemplateGroup(ct,null)});return P._groupIdCache.put(I,it,1),it})()}analyze(c,g,T,b,D,P){var O=this;return(0,k.Z)(function*(){const K=g.getCursor(),I=[];for(;K.next();)I.push(O._analyzeFeature(K,T,b,D,P));return Promise.all(I).then(y=>y.filter(F.pC))})()}match(c,g,T,b,D){return null}_attributeHash(c){let g="";for(const T of this._symbolFields){const b=this._fieldMap?.[T];b&&(g+=c.attributes[b]+"-")}return g}}},31829:(Zt,St,u)=>{u.d(St,{ok:()=>_t});var k=u(32995);function _t(mt,$){return!mt||!("name"in mt)||($&&$.error(new k.Z(mt.name,mt.message,mt.details)),!1)}},68741:(Zt,St,u)=>{u.d(St,{Z:()=>_t});class _t{get length(){return this._pos}constructor($,F){this._pos=0;const j=F?this._roundToNearest(F,$.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(j),this._buffer=new $(this._array),this._ctor=$,this._i16View=new Int16Array(this._array)}_roundToNearest($,F){const j=Math.round($);return j+(F-j%F)}_ensureSize($){if(this._pos+$>=this._buffer.length){const F=this._roundToNearest(1.25*(this._array.byteLength+$*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),j=new ArrayBuffer(F),q=new this._ctor(j);q.set(this._buffer,0),this._array=j,this._buffer=q,this._i16View=new Int16Array(this._array)}}ensureSize($){this._ensureSize($)}writeF32($){this._ensureSize(1);const F=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=$,this._pos++,F}push($){this._ensureSize(1);const F=this._pos;return this._buffer[this._pos++]=$,F}writeFixed($){this._buffer[this._pos++]=$}setValue($,F){this._buffer[$]=F}i1616Add($,F,j){this._i16View[2*$]+=F,this._i16View[2*$+1]+=j}getValue($){return this._buffer[$]}incr($){if(this._buffer.length<$)throw new Error("Increment index overflows the target buffer");this._buffer[$]++}decr($){this._buffer[$]--}writeRegion($){this._ensureSize($.length);const F=this._pos;return this._buffer.set($,this._pos),this._pos+=$.length,F}writeManyFrom($,F,j){this._ensureSize(j-F);for(let q=F;q!==j;q++)this.writeFixed($._buffer[q])}buffer(){const $=this._array.slice(0,4*this._pos);return this.destroy(),$}toArray(){const $=this._array,F=[];for(let j=0;j<$.byteLength/4;j++)F.push($[j]);return F}seek($){this._pos=$}destroy(){this._array=null,this._buffer=null}}},65342:(Zt,St,u)=>{function k(_t,mt,$,F){const j=_t.clone(),q=1<<j.level,tt=j.col+mt,H=j.row+$;return F&&tt<0?(j.col=tt+q,j.world-=1):tt>=q?(j.col=tt-q,j.world+=1):j.col=tt,j.row=H,j}u.d(St,{M:()=>k})},19805:(Zt,St,u)=>{function k(_t){if(null==_t)return[];const mt=new Array(_t.length);for(let $=0;$<_t.length;$++)mt[$]=_t.charCodeAt($);return mt}u.d(St,{_:()=>k})}}]);
//# sourceMappingURL=9764.7bac382f23a5e569.js.map