"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[9605,486],{58787:(G,P,a)=>{a.d(P,{D:()=>p});var m=a(65341);function p(I){I&&I.writtenProperties&&I.writtenProperties.forEach(({target:y,propName:g,newOrigin:_})=>{(0,m.l)(y)&&_&&y.originOf(g)!==_&&y.updateOrigin(g,_)})}},65341:(G,P,a)=>{function m(p){return p&&"getAtOrigin"in p&&"originOf"in p}a.d(P,{l:()=>m})},49605:(G,P,a)=>{a.d(P,{xp:()=>J,Vt:()=>se});var m=a(71670),p=a(18100),I=a(1897),y=a(32995),g=a(28191),_=a(53661),E=a(30801),b=a(55050),c=a(9497),O=(a(83382),a(19420),a(66508)),Z=a(20891),j=a(70425),T=a(58787),R=a(10465),N=a(96095),U=a(68230),M=a(4583),H=a(51299),s=a(27333);var w=a(37753),B=a(66673),A=a(11823),D=a(28772),V=a(90486);function S(u,i,t){return W.apply(this,arguments)}function W(){return(W=(0,m.Z)(function*(u,i,t){if(!i||!i.resources)return;const e=i.portalItem===u.portalItem?new Set(u.paths):new Set;u.paths.length=0,u.portalItem=i.portalItem;const r=new Set(i.resources.toKeep.map(l=>l.resource.path)),n=new Set,o=[];r.forEach(l=>{e.delete(l),u.paths.push(l)});for(const l of i.resources.toUpdate)if(e.delete(l.resource.path),r.has(l.resource.path)||n.has(l.resource.path)){const{resource:F,content:q,finish:ee,error:ae}=l,ne=(0,V.getSiblingOfSameTypeI)(F,(0,D.D)());u.paths.push(ne.path),o.push(Q({resource:ne,content:q,compress:l.compress,finish:ee,error:ae},t))}else u.paths.push(l.resource.path),o.push(oe(l,t)),n.add(l.resource.path);for(const l of i.resources.toAdd)o.push(Q(l,t)),u.paths.push(l.resource.path);if(e.forEach(l=>{if(i.portalItem){const F=i.portalItem.resourceFromPath(l);o.push(F.portalItem.removeResource(F).catch(()=>{}))}}),0===o.length)return;const v=yield(0,E.as)(o);(0,E.k_)(t);const x=v.filter(l=>"error"in l).map(l=>l.error);if(x.length>0)throw new y.Z("save:resources","Failed to save one or more resources",{errors:x})})).apply(this,arguments)}function Q(u,i){return z.apply(this,arguments)}function z(){return(z=(0,m.Z)(function*(u,i){const t={...(0,_.pC)(i)?i:{},compress:u.compress},e=yield(0,A.q6)(u.resource.portalItem.addResource(u.resource,u.content,t));if(!0!==e.ok)throw u.error?.(e.error),e.error;u.finish?.(u.resource)})).apply(this,arguments)}function oe(u,i){return Y.apply(this,arguments)}function Y(){return(Y=(0,m.Z)(function*(u,i){const t=yield(0,A.q6)(u.resource.update(u.content,i));if(!0!==t.ok)throw u.error?.(t.error),t.error;u.finish?.(u.resource)})).apply(this,arguments)}const te="esri.layers.mixins.SceneService",L=g.Z.getLogger(te),se=u=>{let i=class extends u{constructor(){var t;super(...arguments),t=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,E.Ds)(function(){var e=(0,m.Z)(function*(r,n,o){switch(r){case J.SAVE:return t._save(n);case J.SAVE_AS:return t._saveAs(o,n)}});return function(r,n,o){return e.apply(this,arguments)}}())}readSpatialReference(t,e){return this._readSpatialReference(e)}_readSpatialReference(t){if(null!=t.spatialReference)return U.Z.fromJSON(t.spatialReference);{const e=t.store,r=e.indexCRS||e.geographicCRS,n=r&&parseInt(r.substring(r.lastIndexOf("/")+1,r.length),10);return null!=n?new U.Z(n):null}}readFullExtent(t,e,r){if(null!=t&&"object"==typeof t){const v=null==t.spatialReference?{...t,spatialReference:this._readSpatialReference(e)}:t;return R.Z.fromJSON(v,r)}const n=e.store,o=this._readSpatialReference(e);return null==o||null==n||null==n.extent||!Array.isArray(n.extent)||n.extent.some(v=>v<k)?null:new R.Z({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(t){const e={major:Number.NaN,minor:Number.NaN,versionString:t},r=t.split(".");return r.length>=2&&(e.major=parseInt(r[0],10),e.minor=parseInt(r[1],10)),e}readVersion(t,e){const r=e.store,n=null!=r.version?r.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(t){return"item-title"!==this.sublayerTitleMode?void 0:t}readTitleService(t,e){const r=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,M.a7)(this.url,e.name);let n=e.name;if(!n&&this.url){const o=(0,M.Qc)(this.url);(0,_.pC)(o)&&(n=o.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&r&&(n=r+" - "+n),(0,M.ld)(n)}set url(t){const e=(0,M.XG)({layer:this,url:t,nonStandardUrlAllowed:!1,logger:L});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(t,e,r,n){(0,M.wH)(this,t,"layers",e,n)}get parsedUrl(){const t=this._get("url"),e=(0,b.mN)(t);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(t,e){var r=this;return(0,m.Z)(function*(){r.indexInfo=(0,s.T)(r.parsedUrl.path,r.rootNode,t,r.apiKey,L,e),null==r.fullExtent||r.fullExtent.hasZ||r._updateExtent(yield r.indexInfo)})()}_updateExtent(t){if("page"===t?.type){const e=t.rootIndex%t.pageSize,r=t.rootPage?.nodes?.[e];if(null==r||null==r.obb||null==r.obb.center||null==r.obb.halfSize)throw new y.Z("sceneservice:invalid-node-page","Invalid node page.");if(r.obb.center[0]<k||null==this.fullExtent||this.fullExtent.hasZ)return;const n=r.obb.halfSize,o=r.obb.center[2],v=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);this.fullExtent.zmin=o-v,this.fullExtent.zmax=o+v}else if("node"===t?.type){const e=t.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<k)return;const r=e[2],n=e[3],{fullExtent:o}=this;o&&(o.zmin=r-n,o.zmax=r+n)}}_fetchService(t){var e=this;return(0,m.Z)(function*(){if(null==e.url)throw new y.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const r=yield e._fetchFirstLayerId(t);null!=r&&(e.layerId=r)}return e._fetchServiceLayer(t)})()}_fetchFirstLayerId(t){var e=this;return(0,m.Z)(function*(){const r=yield(0,I.default)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id})()}_fetchServiceLayer(t){var e=this;return(0,m.Z)(function*(){const r=yield(0,I.default)(e.parsedUrl?.path??"",{query:{f:"json",token:e.apiKey},responseType:"json",signal:t});r.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let n=!1;if(r.data.layerType&&"Voxel"===r.data.layerType&&(n=!0),n)return e._fetchVoxelServiceLayer();const o=r.data;e.read(o,e._getServiceContext()),e.validateLayer(o)})()}_fetchVoxelServiceLayer(t){var e=this;return(0,m.Z)(function*(){const r=(yield(0,I.default)(e.parsedUrl?.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:t})).data;e.read(r,e._getServiceContext()),e.validateLayer(r)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var t=this;return(0,m.Z)(function*(){yield t.load(),"beforeSave"in t&&"function"==typeof t.beforeSave&&(yield t.beforeSave())})()}validateLayer(t){}_updateTypeKeywords(t,e,r){t.typeKeywords||(t.typeKeywords=[]);const n=e.getTypeKeywords();for(const o of n)t.typeKeywords.push(o);t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((o,v,x)=>x.indexOf(o)===v),r===$.newItem&&(t.typeKeywords=t.typeKeywords.filter(o=>"Hosted Service"!==o)))}_saveAs(t,e){var r=this;return(0,m.Z)(function*(){const n={...re,...e};let o=B.default.from(t);o||(L.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new y.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),o.id&&(o=o.clone(),o.id=null);const v=o.portal||w.Z.getDefault();yield r._ensureLoadBeforeSave(),o.type=X,o.portal=v;const x={origin:"portal-item",url:null,messages:[],portal:v,portalItem:o,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[r.write({},x)]};return yield Promise.all(x.resources.pendingOperations??[]),yield r._validateAgainstJSONSchema(l,x,n),o.url=r.url,o.title||(o.title=r.title),r._updateTypeKeywords(o,n,$.newItem),yield v.signIn(),yield v.user?.addItem({item:o,folder:n&&n.folder,data:l}),yield S(r.resourceReferences,x,null),r.portalItem=o,(0,T.D)(x),x.portalItem=o,o})()}_save(t){var e=this;return(0,m.Z)(function*(){const r={...re,...t};if(!e.portalItem)throw L.error("_save(): requires the .portalItem property to be set"),new y.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(e.portalItem.type!==X)throw L.error("_save(): Non-matching portal item type. Got "+e.portalItem.type+", expected "+X),new y.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${X}"`);yield e._ensureLoadBeforeSave();const n={origin:"portal-item",url:e.portalItem.itemUrl&&(0,b.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||w.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},o={layers:[e.write({},n)]};return yield Promise.all(n.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(o,n,r),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,r,$.existingItem),yield e.portalItem.update({data:o}),yield S(e.resourceReferences,n,null),(0,T.D)(n),e.portalItem})()}_validateAgainstJSONSchema(t,e,r){return(0,m.Z)(function*(){let n=e.messages?.filter(l=>"error"===l.type).map(l=>new y.Z(l.name,l.message,l.details))??[];r?.validationOptions?.ignoreUnsupported&&(n=n.filter(l=>"layer:unsupported"!==l.name&&"symbol:unsupported"!==l.name&&"symbol-layer:unsupported"!==l.name&&"property:unsupported"!==l.name&&"url:unsupported"!==l.name&&"scenemodification:unsupported"!==l.name));const o=r?.validationOptions,v=o?.enabled,x=null;if(v&&x){const l=(yield x()).validate(t,r.portalItemLayerType);if(l.length>0){const F=`Layer item did not validate:\n${l.join("\n")}`;if(L.error(`_validateAgainstJSONSchema(): ${F}`),"throw"===o.failPolicy){const q=l.map(ee=>new y.Z("sceneservice:schema-validation",ee)).concat(n);throw new y.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:q})}}}if(n.length>0)throw new y.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})})()}};return(0,p._)([(0,c.Cb)(H.id)],i.prototype,"id",void 0),(0,p._)([(0,c.Cb)({type:U.Z})],i.prototype,"spatialReference",void 0),(0,p._)([(0,O.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readSpatialReference",null),(0,p._)([(0,c.Cb)({type:R.Z})],i.prototype,"fullExtent",void 0),(0,p._)([(0,O.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],i.prototype,"readFullExtent",null),(0,p._)([(0,c.Cb)({readOnly:!0,type:N.Z})],i.prototype,"heightModelInfo",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],i.prototype,"minScale",void 0),(0,p._)([(0,c.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],i.prototype,"maxScale",void 0),(0,p._)([(0,c.Cb)({readOnly:!0})],i.prototype,"version",void 0),(0,p._)([(0,O.r)("version",["store.version"])],i.prototype,"readVersion",null),(0,p._)([(0,c.Cb)({type:String,json:{read:{source:"copyrightText"}}})],i.prototype,"copyright",void 0),(0,p._)([(0,c.Cb)({type:String,json:{read:!1}})],i.prototype,"sublayerTitleMode",void 0),(0,p._)([(0,c.Cb)({type:String})],i.prototype,"title",void 0),(0,p._)([(0,O.r)("portal-item","title")],i.prototype,"readTitlePortalItem",null),(0,p._)([(0,O.r)("service","title",["name"])],i.prototype,"readTitleService",null),(0,p._)([(0,c.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],i.prototype,"layerId",void 0),(0,p._)([(0,c.Cb)(H.HQ)],i.prototype,"url",null),(0,p._)([(0,j.c)("url")],i.prototype,"writeUrl",null),(0,p._)([(0,c.Cb)()],i.prototype,"parsedUrl",null),(0,p._)([(0,c.Cb)({readOnly:!0})],i.prototype,"store",void 0),(0,p._)([(0,c.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],i.prototype,"rootNode",void 0),i=(0,p._)([(0,Z.j)(te)],i),i},k=-1e38;var $,u;(u=$||($={}))[u.existingItem=0]="existingItem",u[u.newItem=1]="newItem";const X="Scene Service",re={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var J;!function(u){u[u.SAVE=0]="SAVE",u[u.SAVE_AS=1]="SAVE_AS"}(J||(J={}))},27333:(G,P,a)=>{a.d(P,{T:()=>g});var m=a(71670),p=a(1897),I=a(32995),y=a(53661);function g(E,b,c,K,C,O){return _.apply(this,arguments)}function _(){return(_=(0,m.Z)(function*(E,b,c,K,C,O){let Z=null;if((0,y.pC)(c)){const R=`${E}/nodepages/`,N=R+Math.floor(c.rootIndex/c.nodesPerPage);try{return{type:"page",rootPage:(yield(0,p.default)(N,{query:{f:"json",token:K},responseType:"json",signal:O})).data,rootIndex:c.rootIndex,pageSize:c.nodesPerPage,lodMetric:c.lodSelectionMetricType,urlPrefix:R}}catch(U){(0,y.pC)(C)&&C.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",N,U),Z=U}}if(!b)return null;const j=`${E}/nodes/`,T=j+(b&&b.split("/").pop());try{return{type:"node",rootNode:(yield(0,p.default)(T,{query:{f:"json",token:K},responseType:"json",signal:O})).data,urlPrefix:j}}catch(R){throw new I.Z("sceneservice:root-node-missing","Root node missing.",{pageError:Z,nodeError:R,url:T})}})).apply(this,arguments)}},90486:(G,P,a)=>{a.r(P),a.d(P,{addOrUpdateResource:()=>b,contentToBlob:()=>N,fetchResources:()=>_,getSiblingOfSameType:()=>M,getSiblingOfSameTypeI:()=>H,removeAllResources:()=>O,removeResource:()=>K,splitPrefixFileNameAndExtension:()=>T});var m=a(71670),p=a(1897),I=a(32995),y=a(53661),g=a(55050);function _(s){return E.apply(this,arguments)}function E(){return(E=(0,m.Z)(function*(s,d={},f){yield s.load(f);const h=(0,g.v_)(s.itemUrl,"resources"),{start:w=1,num:B=10,sortOrder:A="asc",sortField:D="created"}=d,V={query:{start:w,num:B,sortOrder:A,sortField:D,token:s.apiKey},signal:(0,y.U2)(f,"signal")},S=yield s.portal.request(h,V);return{total:S.total,nextStart:S.nextStart,resources:S.resources.map(({created:W,size:Q,resource:z})=>({created:new Date(W),size:Q,resource:s.resourceFromPath(z)}))}})).apply(this,arguments)}function b(s,d,f,h){return c.apply(this,arguments)}function c(){return(c=(0,m.Z)(function*(s,d,f,h){if(!s.hasPath())throw new I.Z(`portal-item-resource-${d}:invalid-path`,"Resource does not have a valid path");const w=s.portalItem;yield w.load(h);const B=(0,g.v_)(w.userItemUrl,"add"===d?"addResources":"updateResources"),[A,D]=j(s.path),V=yield N(f),S=new FormData;return A&&"."!==A&&S.append("resourcesPrefix",A),(0,y.pC)(h)&&h.compress&&S.append("compress","true"),S.append("fileName",D),S.append("file",V,D),S.append("f","json"),(0,y.pC)(h)&&h.access&&S.append("access",h.access),yield w.portal.request(B,{method:"post",body:S,signal:(0,y.U2)(h,"signal")}),s})).apply(this,arguments)}function K(s,d,f){return C.apply(this,arguments)}function C(){return(C=(0,m.Z)(function*(s,d,f){if(!d.hasPath())throw new I.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield s.load(f);const h=(0,g.v_)(s.userItemUrl,"removeResources");yield s.portal.request(h,{method:"post",query:{resource:d.path},signal:(0,y.U2)(f,"signal")}),d.portalItem=null})).apply(this,arguments)}function O(s,d){return Z.apply(this,arguments)}function Z(){return(Z=(0,m.Z)(function*(s,d){yield s.load(d);const f=(0,g.v_)(s.userItemUrl,"removeResources");return s.portal.request(f,{method:"post",query:{deleteAll:!0},signal:(0,y.U2)(d,"signal")})})).apply(this,arguments)}function j(s){const d=s.lastIndexOf("/");return-1===d?[".",s]:[s.slice(0,d),s.slice(d+1)]}function T(s){const[d,f]=function R(s){const d=(0,g.Ml)(s);return(0,y.Wi)(d)?[s,""]:[s.slice(0,s.length-d.length-1),`.${d}`]}(s),[h,w]=j(d);return[h,w,f]}function N(s){return U.apply(this,arguments)}function U(){return(U=(0,m.Z)(function*(s){return s instanceof Blob?s:(yield(0,p.default)(s.url,{responseType:"blob"})).data})).apply(this,arguments)}function M(s,d){if(!s.hasPath())return null;const[f,,h]=T(s.path);return s.portalItem.resourceFromPath((0,g.v_)(f,d+h))}function H(s,d){if(!s.hasPath())return null;const[f,,h]=T(s.path);return s.portalItem.resourceFromPath((0,g.v_)(f,d+h))}}}]);
//# sourceMappingURL=9605.dbed908af8729466.js.map