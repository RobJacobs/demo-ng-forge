"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[9194],{53971:(I,u,t)=>{t.d(u,{Z:()=>d});var n=t(67087),o=t(20753),E=t(83345),c=t(26877),M=t(67135);const h=(l,r)=>l.key.level-r.key.level!=0?l.key.level-r.key.level:l.key.row-r.key.row!=0?l.key.row-r.key.row:l.key.col-r.key.col;class d extends E.Z{constructor(r){super(),this._tileInfoView=r}get requiresDedicatedFBO(){return!1}renderChildren(r){this.sortChildren(h),this.setStencilReference(r),super.renderChildren(r)}createRenderParams(r){const{state:_}=r,a=super.createRenderParams(r);return a.requiredLevel=this._tileInfoView.getClosestInfoForScale(_.scale).level,a.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(_.scale),a}prepareRenderPasses(r){const _=super.prepareRenderPasses(r);return _.push(r.registerRenderPass({name:"stencil",brushes:[M.Z],drawPhase:o.jx.DEBUG|o.jx.MAP|o.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,n.Z)("esri-tiles-debug")&&_.push(r.registerRenderPass({name:"tileInfo",brushes:[c.Z],drawPhase:o.jx.DEBUG,target:()=>this.children})),_}getStencilTarget(){return this.children}setStencilReference(r){let _=1;for(const a of this.children)a.stencilRef=_++}}},11653:(I,u,t)=>{t.d(u,{I:()=>c});var n=t(38974),o=t(99390),E=t(67026);class c extends o.s{constructor(h,d,l,r,_,a,f=_,y=a){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new E.Z(h),this.resolution=d,this.x=l,this.y=r,this.width=_,this.height=a,this.rangeX=f,this.rangeY=y}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(h){const d=this.resolution/(h.resolution*h.pixelRatio),l=this.transforms.tileMat3,[r,_]=h.toScreenNoRotation([0,0],[this.x,this.y]);(0,n.s)(l,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,r,_,1),(0,n.m)(this.transforms.dvs,h.displayViewMat3,l)}}},54728:(I,u,t)=>{t.r(u),t.d(u,{default:()=>K});var n=t(71670),o=t(18100),E=t(28191),c=t(30801),M=t(7521),h=t(9497),r=(t(83382),t(19420),t(20891)),_=t(53492),a=t(41699),f=t(63982),y=t(20987),C=t(45396),v=t(67026),U=t(90026),B=t(58988),j=t(3589),S=t(34040);const W=[102113,102100,3857,3785,900913],A=[0,0];let P=class extends((0,S.Z)((0,a.Y)((0,f.y)(j.Z)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new C.Z(e),this._fetchQueue=new U.Z({tileInfoView:this._tileInfoView,concurrency:16,process:(s,i)=>this.fetchTile(s,i)}),this._tileStrategy=new B.Z({cachePolicy:"keep",resampling:!0,acquireTile:s=>this.acquireTile(s),releaseTile:s=>this.releaseTile(s),tileInfoView:this._tileInfoView}),this.addAttachHandles((0,M.YP)(()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet],()=>this._refresh())),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}acquireTile(e){const s=this._bitmapView.createTile(e),i=s.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(A,s.key),i.resolution=this._tileInfoView.getTileResolution(s.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(s),this._bitmapView.addChild(s),this.requestUpdate(),s}doRefresh(){var e=this;return(0,n.Z)(function*(){!e.attached||e.updateRequested||e.suspended||e._refresh()})()}isUpdating(){return this._fetchQueue?.updating??!1}fetchTile(e,s={}){var i=this;return(0,n.Z)(function*(){const D="tilemapCache"in i.layer?i.layer.tilemapCache:null,{signal:g,resamplingLevel:T=0}=s;if(!D)return i._fetchImage(e,g);const p=new v.Z(0,0,0,0);let R;try{yield D.fetchAvailabilityUpsample(e.level,e.row,e.col,p,{signal:g}),R=yield i._fetchImage(p,g)}catch(O){if((0,c.D_)(O))throw O;if(T<3){const L=i._tileInfoView.getTileParentId(e.id);if(L){const m=new v.Z(L),x=yield i.fetchTile(m,{...s,resamplingLevel:T+1});return(0,y.i)(i._tileInfoView,x,m,e)}}throw O}return(0,y.i)(i._tileInfoView,R,p,e)})()}canResume(){return super.canResume()&&null!==this.tileMatrixSet}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some(s=>(0,_.fS)(s.tileInfo?.spatialReference,e))??!1}_enqueueTileFetch(e){var s=this;return(0,n.Z)(function*(){if(!s._fetchQueue.has(e.key.id)){try{const i=yield s._fetchQueue.push(e.key);e.bitmap.source=i,e.bitmap.width=s._tileInfoView.tileInfo.size[0],e.bitmap.height=s._tileInfoView.tileInfo.size[1],e.once("attach",()=>s.requestUpdate())}catch(i){(0,c.D_)(i)||E.Z.getLogger(s.declaredClass).error(i)}s.requestUpdate()}})()}_fetchImage(e,s){var i=this;return(0,n.Z)(function*(){return i.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:s})})()}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(e=>{if(!e.bitmap.source)return;const s={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then(i=>{e.bitmap.source=i}).catch(i=>{(0,c.D_)(i)||(e.bitmap.source=null)}).finally(()=>{e.requestRender(),s.fulfilled=!0})};this._tileRequests.set(e,s)})}_getTileMatrixSetBySpatialReference(e){const s=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find(D=>(0,_.fS)(D.tileInfo?.spatialReference,s));return!i&&s.isWebMercator&&(i=e.tileMatrixSets.find(D=>W.includes(D.tileInfo?.spatialReference.wkid??-1))),i}};(0,o._)([(0,h.Cb)()],P.prototype,"_fetchQueue",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],P.prototype,"tileMatrixSet",null),P=(0,o._)([(0,r.j)("esri.views.2d.layers.WMTSLayerView2D")],P);const K=P},34040:(I,u,t)=>{t.d(u,{Z:()=>r});var n=t(18100),o=t(28191),E=t(30801),c=t(7521),M=t(9497),l=(t(83382),t(19420),t(20891));const r=_=>{let a=class extends _{initialize(){this.handles.add((0,c.on)(()=>this.layer,"refresh",f=>{this.doRefresh(f.dataChanged).catch(y=>{(0,E.D_)(y)||o.Z.getLogger(this.declaredClass).error(y)})}),"RefreshableLayerView")}};return(0,n._)([(0,M.Cb)()],a.prototype,"layer",void 0),a=(0,n._)([(0,l.j)("esri.layers.mixins.RefreshableLayerView")],a),a}}}]);
//# sourceMappingURL=9194.6e0a3aafc8d9bfd9.js.map