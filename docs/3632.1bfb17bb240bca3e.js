"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[3632],{38306:(te,W,x)=>{x.d(W,{e:()=>Z});var S,h,Z={};S={get exports(){return Z},set exports(D){Z=D}},void 0!==(h=function(){function D(e,t,r){r=r||2;var n,s,i,o,f,b,A,$=t&&t.length,_=$?t[0]*r:e.length,R=C(e,0,_,r,!0),E=[];if(!R||R.next===R.prev)return E;if($&&(R=function J(e,t,r,n){var s,i,o,f=[];for(s=0,i=t.length;s<i;s++)(o=C(e,t[s]*n,s<i-1?t[s+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),f.push(ee(o));for(f.sort(B),s=0;s<f.length;s++)r=I(r=k(f[s],r),r.next);return r}(e,t,R,r)),e.length>80*r){n=i=e[0],s=o=e[1];for(var M=r;M<_;M+=r)(f=e[M])<n&&(n=f),(b=e[M+1])<s&&(s=b),f>i&&(i=f),b>o&&(o=b);A=0!==(A=Math.max(i-n,o-s))?1/A:0}return O(R,E,r,n,s,A),E}function C(e,t,r,n,s){var i,o;if(s===w(e,t,r,n)>0)for(i=t;i<r;i+=n)o=z(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=z(i,e[i],e[i+1],o);if(o&&l(o,o.next)){var f=o.next;T(o),o=f}return o}function I(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!l(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{var s=n.prev;if(T(n),(n=t=s)===n.next)break;r=!0}}while(r||n!==t);return t}function O(e,t,r,n,s,i,o){if(e){!o&&i&&function q(e,t,r,n){var s=e;do{null===s.z&&(s.z=H(s.x,s.y,t,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function j(e){var t,r,n,s,i,o,f,b,A=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,f=0,t=0;t<A&&(f++,n=n.nextZ);t++);for(b=A;f>0||b>0&&n;)0!==f&&(0===b||!n||r.z<=n.z)?(s=r,r=r.nextZ,f--):(s=n,n=n.nextZ,b--),i?i.nextZ=s:e=s,s.prevZ=i,i=s;r=n}i.nextZ=null,A*=2}while(o>1)}(s)}(e,n,s,i);for(var f,b,A=e;e.prev!==e.next;)if(f=e.prev,b=e.next,i?P(e,n,s,i):d(e))t.push(f.i/r),t.push(e.i/r),t.push(b.i/r),T(e),e=b.next,A=b.next;else if((e=b)===A){o?1===o?O(e=U(I(e),t,r),t,r,n,s,i,2):2===o&&Y(e,t,r,n,s,i):O(I(e),t,r,n,s,i,1);break}}}function d(e){var t=e.prev,r=e,n=e.next;if(v(t,r,n)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(F(t.x,t.y,r.x,r.y,n.x,n.y,s.x,s.y)&&v(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function P(e,t,r,n){var s=e.prev,i=e,o=e.next;if(v(s,i,o)>=0)return!1;for(var A=s.x>i.x?s.x>o.x?s.x:o.x:i.x>o.x?i.x:o.x,$=s.y>i.y?s.y>o.y?s.y:o.y:i.y>o.y?i.y:o.y,_=H(s.x<i.x?s.x<o.x?s.x:o.x:i.x<o.x?i.x:o.x,s.y<i.y?s.y<o.y?s.y:o.y:i.y<o.y?i.y:o.y,t,r,n),R=H(A,$,t,r,n),E=e.prevZ,M=e.nextZ;E&&E.z>=_&&M&&M.z<=R;){if(E!==e.prev&&E!==e.next&&F(s.x,s.y,i.x,i.y,o.x,o.y,E.x,E.y)&&v(E.prev,E,E.next)>=0||(E=E.prevZ,M!==e.prev&&M!==e.next&&F(s.x,s.y,i.x,i.y,o.x,o.y,M.x,M.y)&&v(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;E&&E.z>=_;){if(E!==e.prev&&E!==e.next&&F(s.x,s.y,i.x,i.y,o.x,o.y,E.x,E.y)&&v(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;M&&M.z<=R;){if(M!==e.prev&&M!==e.next&&F(s.x,s.y,i.x,i.y,o.x,o.y,M.x,M.y)&&v(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function U(e,t,r){var n=e;do{var s=n.prev,i=n.next.next;!l(s,i)&&a(s,n,n.next,i)&&m(s,i)&&m(i,s)&&(t.push(s.i/r),t.push(n.i/r),t.push(i.i/r),T(n),T(n.next),n=e=i),n=n.next}while(n!==e);return I(n)}function Y(e,t,r,n,s,i){var o=e;do{for(var f=o.next.next;f!==o.prev;){if(o.i!==f.i&&G(o,f)){var b=p(o,f);return o=I(o,o.next),b=I(b,b.next),O(o,t,r,n,s,i),void O(b,t,r,n,s,i)}f=f.next}o=o.next}while(o!==e)}function B(e,t){return e.x-t.x}function X(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function k(e,t){var r=function Q(e,t){var r,n=t,s=e.x,i=e.y,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var f=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=s&&f>o){if(o=f,f===s){if(i===n.y)return n;if(i===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(s===o)return r;var b,A=r,$=r.x,_=r.y,R=1/0;n=r;do{s>=n.x&&n.x>=$&&s!==n.x&&F(i<_?s:o,i,$,_,i<_?o:s,i,n.x,n.y)&&(b=Math.abs(i-n.y)/(s-n.x),m(n,e)&&(b<R||b===R&&(n.x>r.x||n.x===r.x&&N(r,n)))&&(r=n,R=b)),n=n.next}while(n!==A);return r}(e,t);if(!r)return t;var n=p(r,e),s=I(r,r.next);let i=X(n);return I(i,i.next),s=X(s),X(t===r?s:t)}function N(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function H(e,t,r,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ee(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function F(e,t,r,n,s,i,o,f){return(s-o)*(t-f)-(e-o)*(i-f)>=0&&(e-o)*(n-f)-(r-o)*(t-f)>=0&&(r-o)*(i-f)-(s-o)*(n-f)>=0}function G(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function y(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&a(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(m(e,t)&&m(t,e)&&function g(e,t){var r=e,n=!1,s=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&s<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||l(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function l(e,t){return e.x===t.x&&e.y===t.y}function a(e,t,r,n){var s=c(v(e,t,r)),i=c(v(e,t,n)),o=c(v(r,n,e)),f=c(v(r,n,t));return s!==i&&o!==f||!(0!==s||!u(e,r,t))||!(0!==i||!u(e,n,t))||!(0!==o||!u(r,e,n))||!(0!==f||!u(r,t,n))}function u(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function c(e){return e>0?1:e<0?-1:0}function m(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function p(e,t){var r=new V(e.i,e.x,e.y),n=new V(t.i,t.x,t.y),s=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function z(e,t,r,n){var s=new V(e,t,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function V(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function w(e,t,r,n){for(var s=0,i=t,o=r-n;i<r;i+=n)s+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return s}return D.deviation=function(e,t,r,n){var s=t&&t.length,o=Math.abs(w(e,0,s?t[0]*r:e.length,r));if(s)for(var f=0,b=t.length;f<b;f++)o-=Math.abs(w(e,t[f]*r,f<b-1?t[f+1]*r:e.length,r));var _=0;for(f=0;f<n.length;f+=3){var R=n[f]*r,E=n[f+1]*r,M=n[f+2]*r;_+=Math.abs((e[R]-e[M])*(e[E+1]-e[R+1])-(e[R]-e[E])*(e[M+1]-e[R+1]))}return 0===o&&0===_?0:Math.abs((_-o)/o)},D.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var i=0;i<e[s].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[s][i][o]);s>0&&r.holes.push(n+=e[s-1].length)}return r},D}())&&(S.exports=h)},4645:(te,W,x)=>{x.d(W,{k3:()=>C,s5:()=>D}),Math;const L=256/360,h=1/Math.LN2;function D(d){return function Z(d,P){return(d%=P)>=0?d:d+P}(d*L,256)}function C(d){return Math.log(d)*h}},81925:(te,W,x)=>{var S,L,d;function h(d){switch(d){case"left":return S.Left;case"right":return S.Right;case"center":return S.Center}}function Z(d){switch(d){case"top":return L.Top;case"middle":return L.Center;case"baseline":return L.Baseline;case"bottom":return L.Bottom}}function K(d){switch(d){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[S.Right,L.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[S.Center,L.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[S.Left,L.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[S.Right,L.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[S.Center,L.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[S.Left,L.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[S.Right,L.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[S.Center,L.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[S.Left,L.Top];default:return console.debug(`Found invalid placement type ${d}`),[S.Center,L.Center]}}function D(d){switch(d){case S.Right:return-1;case S.Center:return 0;case S.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${d}`),0}}function C(d){switch(d){case L.Top:return 1;case L.Center:return 0;case L.Bottom:case L.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${d}`),0}}function I(d){switch(d){case"left":return S.Left;case"right":return S.Right;case"center":return S.Center}}function O(d){switch(d){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}x.d(W,{Hd:()=>I,M7:()=>S,NS:()=>O,TR:()=>L,b7:()=>Z,g:()=>D,kH:()=>h,qv:()=>K,tf:()=>C}),(d=S||(S={}))[d.Left=-1]="Left",d[d.Center=0]="Center",d[d.Right=1]="Right",function(d){d[d.Top=1]="Top",d[d.Center=0]="Center",d[d.Bottom=-1]="Bottom",d[d.Baseline=2]="Baseline"}(L||(L={}))},21605:(te,W,x)=>{x.d(W,{CA:()=>v,Gq:()=>w,Xp:()=>G,a:()=>T,dk:()=>p,hF:()=>a,jj:()=>l,jy:()=>F,m2:()=>u,mE:()=>z,qr:()=>V});var S=x(32995),L=x(81925),h=x(20753);const H=Object.keys(h.mD).filter(e=>"number"==typeof h.mD[e]).reduce((e,t)=>({...e,[t]:h.mD[t]}),{});function F(e){return e===h.mD.OUTLINE_FILL||e===h.mD.OUTLINE_FILL_SIMPLE}function G(e){return function ee(e){return e===h.mD.SIMPLE||e===h.mD.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function v(e){return F(e.symbologyType)}function l(e,t){switch(e){case h.LW.FILL:return p.from(t);case h.LW.LINE:return T.from(t);case h.LW.MARKER:return z.from(t);case h.LW.TEXT:return V.from(t);case h.LW.LABEL:return w.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function a(e){switch(u.load(e).geometryType){case h.LW.MARKER:return new z(e);case h.LW.FILL:return new p(e);case h.LW.LINE:return new T(e);case h.LW.TEXT:return new V(e);case h.LW.LABEL:return new w(e)}}class u{static load(t){const r=this.shared;return r.data=t,r}constructor(t){this._data=0,this._data=t}set data(t){this._data=t??0}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t??!1)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(t){this.setBits(t,21,26)}get geometryTypeString(){switch(this.geometryType){case h.LW.FILL:return"fill";case h.LW.MARKER:return"marker";case h.LW.LINE:return"line";case h.LW.TEXT:return"text";case h.LW.LABEL:return"label";default:throw new S.Z(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,r){const n=1<<t;r?this._data|=n:this._data&=~n}bit(t){return(this._data&1<<t)>>t}setBits(t,r,n){for(let s=r,i=0;s<n;s++,i++)this.setBit(s,0!=(t&1<<i))}bits(t,r){let n=0;for(let s=t,i=0;s<r;s++,i++)n|=this.bit(s)<<i;return n}hasVV(){return!1}setVV(t,r){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:h.mD[this.symbologyType],options:H,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}}u.shared=new u(0);const c=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,r){super.setVV(t,r);const n=function Z(e,t,r){const n=h.X.SIZE_FIELD_STOPS|h.X.SIZE_MINMAX_VALUE|h.X.SIZE_SCALE_STOPS|h.X.SIZE_UNIT_VALUE,s=(t&(h.mf.FIELD_TARGETS_OUTLINE|h.mf.MINMAX_TARGETS_OUTLINE|h.mf.SCALE_TARGETS_OUTLINE|h.mf.UNIT_TARGETS_OUTLINE))>>>4;return e===h.LW.LINE&&r.isOutline||e===h.LW.FILL&&F(r.symbologyType)?n&s:n&~s}(this.geometryType,t,r)&t;this.vvSizeMinMaxValue=!!(n&h.X.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(n&h.X.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(n&h.X.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(n&h.X.SIZE_SCALE_STOPS)}},y=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,r){super.setVV(t,r),this.vvRotation=!r.isOutline&&!!(t&h.X.ROTATION)}},m=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,r){super.setVV(t,r),this.vvColor=!r.isOutline&&!!(t&h.X.COLOR)}},g=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,r){super.setVV(t,r),this.vvOpacity=!r.isOutline&&!!(t&h.X.OPACITY)}};class p extends(m(g(c(u)))){static load(t){const r=this.shared;return r.data=t,r}static from(t){const{symbologyType:r,vvFlags:n}=t,s=this.load(0);return s.geometryType=h.LW.FILL,s.symbologyType=r,r!==h.mD.DOT_DENSITY&&s.setVV(n,t),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0);class z extends(m(g(y(c(u))))){static load(t){const r=this.shared;return r.data=t,r}static from(t){const{symbologyType:r,vvFlags:n}=t,s=this.load(0);return s.geometryType=h.LW.MARKER,s.symbologyType=r,r!==h.mD.HEATMAP&&s.setVV(n,t),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}z.shared=new z(0);class T extends(m(g(c(u)))){static load(t){const r=this.shared;return r.data=t,r}static from(t){const r=this.load(0);return r.geometryType=h.LW.LINE,r.symbologyType=t.symbologyType,r.setVV(t.vvFlags,t),r.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}T.shared=new T(0);class V extends(m(g(y(c(u))))){static load(t){const r=this.shared;return r.data=t,r}static from(t){const r=this.load(0);return r.geometryType=h.LW.TEXT,r.symbologyType=t.symbologyType,r.setVV(t.vvFlags,t),r.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}V.shared=new V(0);class w extends(c(u)){static load(t){const r=this.shared;return r.data=t,r}static from(t){const r=this.load(0);return r.geometryType=h.LW.LABEL,r.symbologyType=t.symbologyType,r.setVV(t.vvFlags,t),r.mapAligned=(0,L.NS)(t.placement),r.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0)},62386:(te,W,x)=>{x.r(W),x.d(W,{default:()=>v});var S=x(71670),L=x(18100),h=x(65489),C=(x(32995),x(67087),x(28191),x(53661)),I=x(30801),P=(x(83382),x(19420),x(20891)),U=x(51118),Y=x(68230),J=x(21288),B=x(20753),X=x(29541),k=x(13615),Q=x(79222),N=x(61995),q=x(19805),j=x(38672);class H{constructor(a){this._remoteClient=a,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){}fetchResource(a,u){var c=this;return(0,S.Z)(function*(){const y=c._resourceMap,m=y.get(a);if(m)return m;let g=c._inFlightResourceMap.get(a);if(g)return g;try{g=c._remoteClient.invoke("tileRenderer.fetchResource",{url:a},{...u}),c._inFlightResourceMap.set(a,g),g.then(p=>(c._inFlightResourceMap.delete(a),y.set(a,p),p))}catch(p){return(0,I.D_)(p)?null:{width:0,height:0}}return g})()}getResource(a){return this._resourceMap.get(a)??null}}function ee(l,a){return(!l.minScale||l.minScale>=a)&&(!l.maxScale||l.maxScale<=a)}function F(l){const a=l.message,u={message:{data:{},tileKey:a.tileKey,tileKeyOrigin:a.tileKeyOrigin,version:a.version},transferList:new Array};for(const c in a.data){const y=a.data[c];if(u.message.data[c]=null,(0,C.pC)(y)){const m=y.stride,g=y.indices.slice(0),p=y.vertices.slice(0),z=y.records.slice(0),T={stride:m,indices:g,vertices:p,records:z,metrics:(0,C.yw)(y.metrics,V=>V.slice(0))};u.transferList.push(g,p,z),u.message.data[c]=T}}return u}let G=class extends j.Z{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new H(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(l){this._bufferIds.forEach(a=>{a.forEach(l)})}update(l,a){var u=this;return(0,S.Z)(function*(){const c=a.schema.processors[0];if("symbol"!==c.type)return;const y=(0,U.Hg)(u._schema,c);((0,U.uD)(y,"mesh")||(0,U.uD)(y,"target"))&&(l.mesh=!0,l.why?.mesh.push("Symbology changed"),u._schema=c,u._factory=u._createFactory(c),u._factory.update(c,u.tileStore.tileScheme.tileInfo))})()}onTileMessage(l,a,u,c){return(0,I.k_)(c),this._onTileData(l,a,u,c)}onTileClear(l){return this._bufferData.delete(l.key.id),this._bufferIds.delete(l.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{clear:!0}})}onTileError(l,a,u){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:l.id,error:a},{signal:u.signal})}onTileUpdate(l){for(const a of l.removed)this._bufferData.has(a.key.id)&&this._bufferData.delete(a.key.id),this._bufferIds.has(a.key.id)&&this._bufferIds.delete(a.key.id);for(const a of l.added)this._bufferData.forEach(u=>{for(const c of u)c.message.tileKey===a.id&&this._updateTileMesh("append",a,F(c),[],!1,!1,null)})}_addBufferData(l,a){this._bufferData.has(l)||this._bufferData.set(l,[]),this._bufferData.get(l)?.push(F(a))}_createFactory(l){const{geometryType:a,objectIdField:u,fields:c}=this.service,m={geometryType:a,fields:c,spatialReference:Y.Z.fromJSON(this.spatialReference)},g=new Q.Wr((T,V)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",T,V),this.tileStore.tileScheme.tileInfo),{matcher:p,aggregateMatcher:z}=l.mesh;return this._store=g,this._matchers.feature=(0,N.fL)(p,g,m,this._resourceManagerProxy),this._matchers.aggregate=(0,C.yw)(z,T=>(0,N.fL)(T,g,m,this._resourceManagerProxy)),new k.j(a,u,g)}_onTileData(l,a,u,c){var y=this;return(0,S.Z)(function*(){(0,I.k_)(c);const{type:m,addOrUpdate:g,remove:p,clear:z,end:T}=a,V=!!y._schema.mesh.sortKey;if(!g)return y.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{type:m,addOrUpdate:null,remove:p,clear:z,end:T,sort:V}},c);const w=y._processFeatures(l,g,u,c,a.status?.version);try{const e=yield w;if((0,C.Wi)(e))return y.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l.id,data:{type:m,addOrUpdate:null,remove:p,clear:z,end:T,sort:V}},c);const t=[];for(const r of e){let n=!1;const s=r.message.bufferIds,i=l.key.id,o=r.message.tileKey;if(i!==o&&(0,C.pC)(s)){if(!y.tileStore.get(o)){y._addBufferData(i,r),t.push(r);continue}let f=y._bufferIds.get(o);f||(f=new Set,y._bufferIds.set(o,f));const b=Array.from(s);for(const A of b){if(f.has(A)){n=!0;break}f.add(A)}}n||(y._addBufferData(i,r),t.push(r))}yield Promise.all(t.map(r=>{const n=l.key.id===r.message.tileKey;return y._updateTileMesh(m,l,r,n?a.remove:[],n&&a.end,!!a.clear,c.signal)}))}catch(e){y._handleError(l,e,c)}})()}_updateTileMesh(l,a,u,c,y,m,g){var p=this;return(0,S.Z)(function*(){const z=l,T=u.message.tileKey,V=!!p._schema.mesh.sortKey;T!==a.key.id&&(y=!1);const w=(0,C.yw)(u,n=>n.message),e=(0,C.yw)(u,n=>n.transferList)||[],t={type:z,addOrUpdate:w,remove:c,clear:m,end:y,sort:V},r={transferList:(0,C.Wg)(e)||[],signal:g};return(0,I.k_)(r),p.remoteClient.invoke("tileRenderer.onTileData",{tileKey:T,data:t},r)})()}_processFeatures(l,a,u,c,y){var m=this;return(0,S.Z)(function*(){if((0,C.Wi)(a)||!a.hasFeatures)return null;const g={transform:l.transform,hasZ:!1,hasM:!1},p=m._factory,z={viewingMode:"",scale:l.scale},T=yield m._matchers.feature,V=yield m._matchers.aggregate;(0,I.k_)(c);const w=m._getLabelInfos(l,a);return yield p.analyze(a.getCursor(),m._resourceManagerProxy,T,V,g,z),(0,I.k_)(c),m._writeFeatureSet(l,a,g,w,p,u,y)})()}_writeFeatureSet(l,a,u,c,y,m,g){const p=a.getSize(),z=this._schema.mesh.matcher.symbologyType,T=new X._(l.key.id,{features:p,records:p,metrics:0},z,m,z!==B.mD.HEATMAP,g),V={viewingMode:"",scale:l.scale},w=a.getCursor();for(;w.next();)try{const t=w.getDisplayId(),r=(0,C.pC)(c)?c.get(t):null;y.writeCursor(T,w,u,V,l.level,r,this._resourceManagerProxy)}catch{}return T.serialize(l.tileInfoView.tileInfo.isWrappable)}_handleError(l,a,u){return(0,I.D_)(a)?Promise.resolve():this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:l.id,error:a.message},{signal:u.signal})}_getLabelingSchemaForScale(l){const a=this._schema.mesh.labels;if((0,C.Wi)(a))return null;if("subtype"===a.type){const c={type:"subtype",classes:{}};let y=!1;for(const m in a.classes){const g=a.classes[m].filter(p=>ee(p,l.scale));y=y||!!g.length,c.classes[m]=g}return y?c:null}const u=a.classes.filter(c=>ee(c,l.scale));return u.length?{type:"simple",classes:u}:null}_getLabels(l,a){if("subtype"===a.type){const c=(0,C.s3)(this.service.subtypeField,"Expected to find subtype Field"),y=l.readAttribute(c);return null==y?[]:a.classes[y]??[]}return a.classes}_getLabelInfos(l,a){const u=this._getLabelingSchemaForScale(l);if((0,C.Wi)(u))return null;const c=new Map,y=a.getCursor();for(;y.next();){const m=y.getDisplayId(),g=[],p=(0,J.nE)(m),z=p&&1!==y.readAttribute("cluster_count")?"aggregate":"feature",T=this._getLabels(y,u);for(const V of T){if(V.target!==z)continue;const e=y.getStorage().getComputedStringAtIndex(p&&"feature"===z?y.readAttribute("referenceId"):m,V.fieldIndex);if(!e)continue;const t=(0,h.E)(e.toString()),n=t[1];this._store.getMosaicItem(V.symbol,(0,q._)(t[0])).then(s=>{g[V.index]={glyphs:s.glyphMosaicItems??[],rtl:n,index:V.index}})}c.set(m,g)}return c}};G=(0,L._)([(0,P.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],G);const v=G},50439:(te,W,x)=>{x.d(W,{x:()=>G,B:()=>ee});var S=x(71670),L=x(61850),h=x(20753),Z=x(21605);const K={marker:h.LW.MARKER,fill:h.LW.FILL,line:h.LW.LINE,text:h.LW.TEXT};class D{constructor(l,a,u,c){const y={minScale:a?.minScale,maxScale:a?.maxScale},m=function C(v){return v.minScale||v.maxScale?v.minScale+"-"+v.maxScale:""}(y);this.layers=l,this.data=a,this.hash=this._createHash()+m,this.rendererKey=u;const g={isOutline:!1,placement:null,symbologyType:h.mD.DEFAULT,vvFlags:u};for(const p of l){const z=K[p.type];g.isOutline="line"===p.type&&p.isOutline,p.materialKey=(0,Z.jj)(z,g),p.maxVVSize=c,p.scaleInfo=y,p.templateHash+=m}}get type(){return"expanded-cim"}_createHash(){let l="";for(const a of this.layers)l+=a.templateHash;return l}}var I=x(29322),O=x(32995),d=x(53661),P=x(30801),U=x(55050),Y=x(37753),J=x(29184),B=x(32569);function X(v,l,a){return k.apply(this,arguments)}function k(){return k=(0,S.Z)(function*(v,l,a){if(!v.name)throw new O.Z("style-symbol-reference-name-missing","Missing name in style symbol reference");if(v.styleName&&"Esri2DPointSymbolsStyle"===v.styleName)return function Q(v,l){return N.apply(this,arguments)}(v,a);try{return function q(v,l,a,u){return j.apply(this,arguments)}(yield(0,B.n2)(v,l,a),v.name,l,a)}catch(u){return(0,P.k_)(u),null}}),k.apply(this,arguments)}function N(){return(N=(0,S.Z)(function*(v,l){const a=B.wm.replace(/\{SymbolName\}/gi,v.name);try{const u=yield(0,B.EJ)(a,l);return(0,B.KV)(u.data)}catch(u){return(0,P.k_)(u),null}})).apply(this,arguments)}function j(){return(j=(0,S.Z)(function*(v,l,a,u){const c=v.data,y={portal:a&&(0,d.pC)(a.portal)?a.portal:Y.Z.getDefault(),url:(0,U.mN)(v.baseUrl),origin:"portal-item"},m=c.items.find(p=>p.name===l);if(!m)throw new O.Z("symbolstyleutils:symbol-name-not-found",`The symbol name '${l}' could not be found`,{symbolName:l});let g=(0,J.f)((0,B.v9)(m,"cimRef"),y);(0,I.XO)()&&(g=(0,I.pJ)(g));try{const p=yield(0,B.EJ)(g,u);return(0,B.KV)(p.data)}catch(p){return(0,P.k_)(p),null}})).apply(this,arguments)}const H=function(){var v=(0,S.Z)(function*(l,a,u){return new D(yield(0,L.c)(l.data,a,u),l.data,l.rendererKey,l.maxVVSize)});return function(a,u,c){return v.apply(this,arguments)}}();function ee(v,l,a,u){return F.apply(this,arguments)}function F(){return(F=(0,S.Z)(function*(v,l,a,u){if(!v)return null;if("cim"===v.type)return H(v,l,a);if("web-style"===v.type){const c={type:"cim",data:(yield X(v,null,u))??void 0,rendererKey:v.rendererKey,maxVVSize:v.maxVVSize};return H(c,l,a)}return v})).apply(this,arguments)}function G(v){if(!v)return null;const{avoidSDFRasterization:l,type:a,cim:u,url:c,materialHash:y}=v,m={cim:u,type:a,mosaicHash:y,url:c,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null,avoidSDFRasterization:l};switch(a){case"marker":m.size=v.size,m.path=v.path,m.animatedSymbolProperties=v.animatedSymbolProperties;break;case"line":m.dashTemplate=v.dashTemplate;break;case"text":m.text=v.text,m.fontName=v.fontName}return m}}}]);
//# sourceMappingURL=3632.1bfb17bb240bca3e.js.map