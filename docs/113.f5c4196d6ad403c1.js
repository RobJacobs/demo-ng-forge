"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[113],{70113:(v,E,o)=>{o.r(E),o.d(E,{default:()=>j});var M=o(71670),u=o(18100),c=(o(67087),o(53661)),O=(o(28191),o(83382),o(19420),o(32995),o(20891)),C=o(51118),I=o(45811),R=o(80696),L=o(38672),i=o(65342);class d{constructor(t,r){this.offset=t,this.extent=r}}let f=class extends L.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(_,t){var r=this;return(0,M.Z)(function*(){const s=t.schema.processors[0];"heatmap"===s.type&&(0,C.Hg)(r._schema,s)&&(_.mesh=!0,r._schema=s)})()}onTileUpdate(_){for(const t of _.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(_){return this._tileKeyToFeatureSets.delete(_.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.id,data:{clear:!0}})}onTileMessage(_,t,r){var s=this;return(0,M.Z)(function*(){s._tileKeyToFeatureSets.has(_.key.id)||s._tileKeyToFeatureSets.set(_.key.id,new Map);const e=s._tileKeyToFeatureSets.get(_.key.id);if(e&&(0,c.pC)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&e.set(t.addOrUpdate.instance,t),t.end){const n=[],m=function g(_){const t=_.key,r=new Map,s=256,e=R.I_,n=_.tileInfoView.tileInfo.isWrappable;return r.set((0,i.M)(t,-1,-1,n).id,new d([-e,-e],[e-s,e-s,e,e])),r.set((0,i.M)(t,0,-1,n).id,new d([0,-e],[0,e-s,e,e])),r.set((0,i.M)(t,1,-1,n).id,new d([e,-e],[0,e-s,s,e])),r.set((0,i.M)(t,-1,0,n).id,new d([-e,0],[e-s,0,e,e])),r.set((0,i.M)(t,1,0,n).id,new d([e,0],[0,0,s,e])),r.set((0,i.M)(t,-1,1,n).id,new d([-e,e],[e-s,0,e,s])),r.set((0,i.M)(t,0,1,n).id,new d([0,e],[0,0,e,s])),r.set((0,i.M)(t,1,1,n).id,new d([e,e],[0,0,s,s])),r}(_);s._tileKeyToFeatureSets.forEach((K,T)=>{if(T===_.key.id)K.forEach(D=>(0,c.yw)(D.addOrUpdate,P=>n.push(P)));else if(m.has(T)){const D=m.get(T),[P,A]=D.offset;K.forEach(w=>(0,c.yw)(w.addOrUpdate,S=>{const F=S.transform(P,A,1,1);n.push(F)}))}});const U=(0,I.QM)(n,s._schema.mesh,512,512);return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.key.id,intensityInfo:U},{...r,transferList:[U.matrix]})}})()}onTileError(_,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:_.id,error:t},r)}};f=(0,u._)([(0,O.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const j=f},65342:(v,E,o)=>{function M(u,p,c,y){const a=u.clone(),h=1<<a.level,l=a.col+p,O=a.row+c;return y&&l<0?(a.col=l+h,a.world-=1):l>=h?(a.col=l-h,a.world+=1):a.col=l,a.row=O,a}o.d(E,{M:()=>M})}}]);
//# sourceMappingURL=113.f5c4196d6ad403c1.js.map