import{a as Re,j as $e}from"./chunk-YZXUHQVA.js";import{b as Be}from"./chunk-JHJLSUDM.js";import{a as Le}from"./chunk-P4NTETCS.js";import{a as G}from"./chunk-6VOI2BBA.js";import"./chunk-HP46DOOR.js";import"./chunk-IJTEU5B7.js";import"./chunk-PSWJZLWW.js";import"./chunk-BJ26DAUS.js";import"./chunk-3WV5GJ3R.js";import"./chunk-KGLI3JET.js";import{Ab as ne,Ac as we,B as S,Bc as ye,Bd as De,Cc as Oe,Cd as Ge,Db as ie,Dd as Ae,Eb as ae,Gb as ce,Hc as Me,Ic as Fe,Jc as Te,Kc as Ve,Lb as se,Mb as le,Sb as pe,Tb as me,Ub as de,Wc as Ee,Xc as Ie,Zb as he,_b as ue,c as W,d as X,f as Y,fc as fe,gc as ge,h as ee,ob as te,pc as _e,qc as ve,rc as Ce,sb as oe,tb as re,uc as Se,vb as O,vc as xe,wc as be,wd as Ne,xb as v,xd as ke,zc as Pe}from"./chunk-LBARSMJT.js";import{Cb as I,Db as N,Eb as Q,Fb as k,Gb as D,Gc as H,Hb as f,Ib as s,Jb as a,Kb as d,Ob as M,Pb as F,Qb as T,Rb as b,Ub as g,Va as p,Vb as _,ac as J,bc as U,cc as P,gc as m,ha as y,hc as w,ma as h,na as u,ob as K,pc as V,q as R,qa as q,qc as j,tb as x,tc as Z,u as B,uc as z,w as $,yc as E}from"./chunk-UQ3J2UFU.js";import{a as A,b as L}from"./chunk-OY7QI42D.js";var qe=["searchesPopover"],Ke=()=>({name:"name"}),Qe=()=>({name:"dateOfBirth"}),Je=()=>({name:"address"}),Ue=n=>({"operator__addon--selected":n}),je=(n,l)=>l.id;function Ze(n,l){if(n&1&&(d(0,"forge-divider",30),s(1,"span",31),m(2),a(),s(3,"span",32),m(4),a()),n&2){let c=_();p(2),w(c.searchName),p(2),w(c.searchDescription)}}function ze(n,l){if(n&1){let c=b();s(0,"forge-list-item",35)(1,"button",34),m(2),a(),s(3,"div",8)(4,"forge-icon-button",36),g("mousedown",function(o){let t=h(c).$implicit,e=_(2);return u(e.onSearchAction(o,"edit",t.id))}),d(5,"forge-icon",37),a(),s(6,"forge-icon-button",38),g("mousedown",function(o){let t=h(c).$implicit,e=_(2);return u(e.onSearchAction(o,"delete",t.id))}),d(7,"forge-icon",39),a()()()}if(n&2){let c=l.$implicit;f("value",c.id),p(2),w(c.name)}}function He(n,l){if(n&1){let c=b();s(0,"forge-list",33),g("forge-list-item-select",function(o){h(c);let t=_();return u(t.onSearchAction(o,"search",o.detail.value))}),s(1,"forge-list-item")(2,"button",34),m(3,"Add new search"),a()(),d(4,"forge-divider"),k(5,ze,8,2,"forge-list-item",35,je),a()}if(n&2){let c=_();p(5),D(c.searchCache.searches)}}function We(n,l){n&1&&T(0)}function Xe(n,l){n&1&&T(0)}function Ye(n,l){n&1&&T(0)}function et(n,l){if(n&1){let c=b();s(0,"forge-icon-button",40,4),g("click",function(o){let t=h(c).name,e=P(1),i=_();return u(i.onOperatorPopoverOpen(o,e,t))}),d(2,"forge-icon",41),a()}if(n&2){let c,r=l.name,o=_(),t=P(51);f("ngClass",j(2,Ue,(c=o.formGroup.get(r))==null?null:c.value.operator))("forgePopover",t)}}function tt(n,l){n&1&&d(0,"forge-icon",44)}function ot(n,l){if(n&1&&(s(0,"forge-list-item",43)(1,"button",34),m(2),a(),I(3,tt,1,0,"forge-icon",44),a()),n&2){let c=l.$implicit,r=_(2);f("value",c.value)("selected",(r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===c.value),p(2),w(c.label),p(),N((r.operatorPopoverFormGroup==null?null:r.operatorPopoverFormGroup.value.operator)===c.value?3:-1)}}function rt(n,l){if(n&1){let c=b();s(0,"forge-list",42),g("forge-list-item-select",function(o){h(c);let t=_();return u(t.onOperatorSelected(o.detail.value))}),k(1,ot,4,4,"forge-list-item",43,Q),a()}if(n&2){let c=_();p(),D(c.operatorOptions)}}var xt=(()=>{let l=class l{constructor(){this.destroyRef=y(q),this.dialogService=y(Se),this.toastService=y(De),this.dataService=y(Le),this.searchesPopover=H("searchesPopover"),this.storageKey="search-searches",this.searchCache={activeSearchId:void 0,searches:[]},this.formGroup=new O({name:new O({value:new v,operator:new v}),dateOfBirth:new O({value:new v,operator:new v}),address:new O({value:new v,operator:new v}),include:new v,facet:new v}),this.facetOptions=[],this.operatorOptions=[{value:null,label:"None"},{value:0,label:"Equal"},{value:1,label:"Not equal"},{value:2,label:"Greater than"},{value:3,label:"Less than"},{value:4,label:"Greater than equal to"},{value:5,label:"Less than equal to"},{value:6,label:"Range"},{value:7,label:"Contains"},{value:8,label:"Not contains"},{value:9,label:"Empty"}],this.nameFilter=r=>B(this.dataService.getPeople().pipe($(o=>o.data.filter(t=>t.firstName.toLocaleLowerCase().includes(r.toLocaleLowerCase())||t.lastName.toLocaleLowerCase().includes(r.toLocaleLowerCase())).map(t=>({label:`${t.firstName} ${t.lastName}`,value:t.id}))))),this.facetFilter=r=>R(this.facetOptions)}ngOnInit(){this.dataService.getSearches(this.storageKey).pipe(le(this.destroyRef)).subscribe({next:r=>{this.searchCache.searches=r||[];let o=this.searchCache.searches.find(t=>t.id===this.searchCache.activeSearchId);S(o)&&(this.searchName=o?.name,this.searchDescription=o?.description,this.formGroup.patchValue(o?.filters))}});for(let r=0;r<20;r++)this.facetOptions.push({value:r,label:`Facet Option ${r}`})}onSearch(){}onSaveSearch(r){let o=S(r)?r:this.searchCache.searches.find(e=>e.id===this.searchCache.activeSearchId),t={title:"Save search",name:o?.name,description:o?.description,isDefault:o?.isDefault};this.dialogService.open($e,{data:t,options:{persistent:!0}}).afterClosed.subscribe({next:e=>{if(e){if(S(o)){let i=this.searchCache.searches.findIndex(C=>C.id===o.id);i!==-1&&(this.searchCache.searches[i]=e)}else{let i=L(A({},e),{id:G.uniqueId(),filters:this.formGroup.value})}if(S(e.id)){let i=this.searchCache.searches.findIndex(C=>C.id===e.id);i!==-1&&(this.searchCache.searches[i]=e)}else e.id=G.uniqueId(),this.searchCache.searches.push(e);this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:()=>{this.searchCache.activeSearchId=e.id,this.searchName=e.name,this.searchDescription=e.description,this.toastService.show({message:"Search saved",theme:"success"})},error:()=>this.toastService.show({message:"Search save failed",theme:"error"})})}}})}onClearSearch(){this.formGroup.controls.include.setValue(null),this.formGroup.reset()}onSearchAction(r,o,t){if(r.stopPropagation(),this.searchesPopover()?.close(),!S(t))this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="",this.formGroup.reset();else{let e=this.searchCache.searches.find(i=>i.id===t);if(S(e))switch(o){case"search":this.searchCache.activeSearchId=e?.id,this.searchName=e?.name,this.searchDescription=e?.description,this.formGroup.patchValue(e?.filters),this.onSearch();break;case"edit":this.searchCache.activeSearchId=e?.id,this.searchName=e?.name,this.searchDescription=e?.description,this.formGroup.patchValue(e?.filters);break;case"copy":{let i=JSON.parse(JSON.stringify(e));i.id=void 0,i.name=`${i.name} copy`,i.isDefault=!1,this.onSaveSearch(i);break}case"delete":{let i=this.searchCache.searches.findIndex(C=>C.id===e?.id);i!==-1&&(this.searchCache.searches.splice(i,1),this.dataService.saveSearches(this.storageKey,this.searchCache.searches).subscribe({next:C=>{}})),this.searchCache.activeSearchId===e?.id&&(this.searchCache.activeSearchId=void 0,this.searchName="",this.searchDescription="");break}}}}onOperatorPopoverOpen(r,o,t){r.stopPropagation(),this.operatorPopoverFormGroup=this.formGroup.get(t),this.operatorPopover=o,this.operatorPopover.open()}onOperatorSelected(r){r=parseInt(r,10),this.operatorPopoverFormGroup?.get("operator")?.setValue(r),this.operatorPopover?.close()}};l.\u0275fac=function(o){return new(o||l)},l.\u0275cmp=K({type:l,selectors:[["app-search"]],viewQuery:function(o,t){o&1&&J(t.searchesPopover,qe,5),o&2&&U()},decls:52,vars:18,consts:[["searchesPopover","forgePopover"],["searchesPopoverTemplate",""],["opertatorAddonTemplate",""],["operatorPopoverTemplate",""],["operatorPopover","forgePopover"],[1,"header"],["slot","start"],[1,"forge-typography--subheading4"],["slot","end"],["variant","outlined",3,"click"],["variant","outlined",3,"click","forgePopover","forgePopoverPlacement"],["name","arrow_drop_down"],["variant","filled",3,"click"],[1,"body"],["novalidate","","autocomplete","off",1,"form",3,"ngSubmit","formGroup"],["formGroupName","name"],["multiple","true","formControlName","value","allow-unmatched","true",3,"filter"],["type","text","id","search--name"],["for","search--name"],["slot","end","name","arrow_drop_down",1,"forge-dropdown-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["formGroupName","dateOfBirth"],["formControlName","value"],["type","text","id","search--date-of-birth"],["for","search--date-of-birth"],["formGroupName","address"],["type","text","id","search--address","formControlName","value"],["for","search--address","slot","label"],["formControlName","facet","label","Facet",3,"optionFilter"],["threeState","true","formControlName","include",2,"align-self","flex-end"],["vertical",""],[1,"forge-typography--heading2"],[1,"forge-typography--subheading1"],[1,"searches-popover",3,"forge-list-item-select"],["type","button"],[3,"value"],["aria-label","Edit",3,"mousedown"],["name","edit"],["aria-label","Delete",3,"mousedown"],["name","delete"],["slot","addon-end","density","medium","aria-label","Filter operator",1,"operator__addon",3,"click","ngClass","forgePopover"],["name","bolt"],[1,"operator-popover",3,"forge-list-item-select"],[3,"value","selected"],["name","check","slot","end"]],template:function(o,t){if(o&1){let e=b();s(0,"forge-toolbar",5)(1,"div",6)(2,"h2",7),m(3,"Search"),a(),I(4,Ze,5,2),a(),s(5,"div",8)(6,"forge-button",9),g("click",function(){return h(e),u(t.onSaveSearch())}),m(7,"Save search"),a(),s(8,"forge-button",10,0),g("click",function(){h(e);let C=P(9);return u(C.open())}),s(10,"span"),m(11,"Saved searches"),a(),d(12,"forge-icon",11),a(),s(13,"forge-button",9),g("click",function(){return h(e),u(t.onClearSearch())}),m(14,"Clear all"),a(),s(15,"forge-button",12),g("click",function(){return h(e),u(t.onSearch())}),m(16,"Search"),a()()(),x(17,He,7,0,"ng-template",null,1,E),s(19,"div",13)(20,"form",14),g("ngSubmit",function(){return h(e),u(t.onSearch())}),M(21,15),s(22,"forge-autocomplete",16)(23,"forge-text-field"),d(24,"input",17),s(25,"label",18),m(26,"Name"),a(),d(27,"forge-icon",19),x(28,We,1,0,"ng-container",20),a()(),F(),M(29,21),s(30,"forge-date-picker",22)(31,"forge-text-field"),d(32,"input",23),s(33,"label",24),m(34,"Date"),a(),x(35,Xe,1,0,"ng-container",20),a()(),F(),M(36,25),s(37,"forge-text-field"),d(38,"input",26),s(39,"label",27),m(40,"Address"),a(),x(41,Ye,1,0,"ng-container",20),a(),F(),d(42,"app-autocomplete-range",28),s(43,"forge-checkbox",29),m(44,"Include"),a()(),s(45,"p"),m(46),Z(47,"json"),a()(),x(48,et,3,4,"ng-template",null,2,E)(50,rt,3,0,"ng-template",null,3,E)}if(o&2){let e=P(18),i=P(49);p(4),N(t.searchCache.activeSearchId?4:-1),p(4),f("forgePopover",e)("forgePopoverPlacement","bottom-start"),p(12),f("formGroup",t.formGroup),p(2),f("filter",t.nameFilter),p(6),f("ngTemplateOutlet",i)("ngTemplateOutletContext",V(15,Ke)),p(7),f("ngTemplateOutlet",i)("ngTemplateOutletContext",V(16,Qe)),p(6),f("ngTemplateOutlet",i)("ngTemplateOutletContext",V(17,Je)),p(),f("optionFilter",t.facetFilter),p(4),w(z(47,13,t.formGroup.getRawValue()))}},dependencies:[ee,W,X,se,ne,te,oe,re,ie,ce,ae,de,me,pe,ue,he,ge,fe,Ce,ve,_e,be,xe,Oe,ye,Pe,we,Te,Fe,Ve,Me,Ie,Ee,ke,Ne,Ae,Ge,Re,Be,Y],styles:[`[_nghost-%COMP%]{display:grid;grid-template-rows:auto 1fr;overflow:hidden}  .searches-popover{min-width:280px}  .searches-popover *[slot=trailing]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin-right:-16px}  .operator-popover{min-width:200px}  .operator-popover forge-list-item{cursor:pointer}.header[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.header[_ngcontent-%COMP%]   forge-button[_ngcontent-%COMP%]{margin-left:16px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   forge-divider[_ngcontent-%COMP%]{margin:0 16px;height:32px}.header[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]   span[_ngcontent-%COMP%] + span[_ngcontent-%COMP%]{margin-left:16px}.body[_ngcontent-%COMP%]{overflow:auto;padding:24px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{background-color:var(--forge-theme-surface);border-radius:var(--forge-shape-medium);border:1px solid var(--forge-theme-outline);padding:16px;display:grid;grid-template-columns:repeat(auto-fill,320px);gap:16px}.body[_ngcontent-%COMP%]   .form--row-break[_ngcontent-%COMP%]{grid-column-start:1}.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{grid-column:1/-1}.body[_ngcontent-%COMP%]   .form--col-span.body[_ngcontent-%COMP%]   .form--col-span[_ngcontent-%COMP%]{width:auto}.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{grid-column:span 2}.body[_ngcontent-%COMP%]   .form--col-span2.body[_ngcontent-%COMP%]   .form--col-span2[_ngcontent-%COMP%]{width:656px}.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{grid-column:span 3}.body[_ngcontent-%COMP%]   .form--col-span3.body[_ngcontent-%COMP%]   .form--col-span3[_ngcontent-%COMP%]{width:992px}.body[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   [slot=value][_ngcontent-%COMP%]:empty:before{content:"n/a";color:var(--forge-theme-text-medium);font-style:italic}.operator__addon--selected[_ngcontent-%COMP%]{color:var(--forge-theme-warning)}






/*# sourceMappingURL=search.component-ZSDATQI4.css.map */`]});let n=l;return n})();export{xt as SearchComponent};
//# sourceMappingURL=chunk-ZLYI2KFE.js.map
