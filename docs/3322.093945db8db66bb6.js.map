{"version":3,"file":"3322.093945db8db66bb6.js","mappings":"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","names":["a","e","r","t","o","attributeInfo","useElevation","d","Float64Array","storageInfo","i","buffer","b","Math","abs","p","c","transform","this","_transform","points","rgb","pointIdFilterMap","push","attributes","values","Promise","resolve","result","transferList","encoding","n","vertexAttributes","position","l","s","header","fields","u","offsetX","offsetY","offsetZ","f","scaleX","scaleY","scaleZ","length","schema","geometryBuffer","primaryAttributeData","modulationAttributeData","rendererJSON","isRGBRenderer","type","colorUniqueValueInfos","Uint8Array","fieldTransformType","includes","color","g","stops","value","colorClassBreakInfos","minValue","maxValue","colorModulation","rendererInfo","filterInfo","filterAttributesData","filter","map","Uint32Array","m","filterJSON","mode","requiredSetBits","requiredClearBits","includedReturns","userAttributesData","slice","_applyElevationOffsetInPlace","elevationOffset","_transformCoordinates","obb","inSR","outSR","Error","center","quaternion","Float32Array","halfSize","max","h"],"sourceRoot":"webpack:///","sources":["./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js","./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as o}from\"../../../../core/maybe.js\";import r from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import t from\"../../../../renderers/PointCloudStretchRenderer.js\";import l from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as n,createTypedView as s,readBinaryAttribute as i}from\"./I3SBinaryReader.js\";import{decodeXYZ as u}from\"./LEPCC.js\";function f(e,o,n,s){const{rendererJSON:i,isRGBRenderer:u}=e;let f=null,c=null;if(o&&u)f=o;else if(o&&\"pointCloudUniqueValueRenderer\"===i?.type){c=l.fromJSON(i);const e=c.colorUniqueValueInfos;f=new Uint8Array(3*s);const r=b(c.fieldTransformType);for(let t=0;t<s;t++){const l=(r?r(o[t]):o[t])+\"\";for(let o=0;o<e.length;o++)if(e[o].values.includes(l)){f[3*t]=e[o].color.r,f[3*t+1]=e[o].color.g,f[3*t+2]=e[o].color.b;break}}}else if(o&&\"pointCloudStretchRenderer\"===i?.type){c=t.fromJSON(i);const e=c.stops;f=new Uint8Array(3*s);const r=b(c.fieldTransformType);for(let t=0;t<s;t++){const l=r?r(o[t]):o[t],n=e.length-1;if(l<e[0].value)f[3*t]=e[0].color.r,f[3*t+1]=e[0].color.g,f[3*t+2]=e[0].color.b;else if(l>=e[n].value)f[3*t]=e[n].color.r,f[3*t+1]=e[n].color.g,f[3*t+2]=e[n].color.b;else for(let o=1;o<e.length;o++)if(l<e[o].value){const r=(l-e[o-1].value)/(e[o].value-e[o-1].value);f[3*t]=e[o].color.r*r+e[o-1].color.r*(1-r),f[3*t+1]=e[o].color.g*r+e[o-1].color.g*(1-r),f[3*t+2]=e[o].color.b*r+e[o-1].color.b*(1-r);break}}}else if(o&&\"pointCloudClassBreaksRenderer\"===i?.type){c=r.fromJSON(i);const e=c.colorClassBreakInfos;f=new Uint8Array(3*s);const t=b(c.fieldTransformType);for(let r=0;r<s;r++){const l=t?t(o[r]):o[r];for(let o=0;o<e.length;o++)if(l>=e[o].minValue&&l<=e[o].maxValue){f[3*r]=e[o].color.r,f[3*r+1]=e[o].color.g,f[3*r+2]=e[o].color.b;break}}}else{f=new Uint8Array(3*s);for(let e=0;e<f.length;e++)f[e]=255}if(n&&c&&c.colorModulation){const e=c.colorModulation.minValue,o=c.colorModulation.maxValue,r=.3;for(let t=0;t<s;t++){const l=n[t],s=l>=o?1:l<=e?r:r+(1-r)*(l-e)/(o-e);f[3*t]=s*f[3*t],f[3*t+1]=s*f[3*t+1],f[3*t+2]=s*f[3*t+2]}}return f}function c(o,r){if(null==o.encoding||\"\"===o.encoding){const t=n(r,o);if(e(t.vertexAttributes.position))return;const l=s(r,t.vertexAttributes.position),i=t.header.fields,u=[i.offsetX,i.offsetY,i.offsetZ],f=[i.scaleX,i.scaleY,i.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*f[0]+u[0],a[3*e+1]=l[3*e+1]*f[1]+u[1],a[3*e+2]=l[3*e+2]*f[2]+u[2];return a}if(\"lepcc-xyz\"===o.encoding)return u(r).result}function a(e,r,t){return o(e)&&e.attributeInfo.useElevation?r?d(r,t):null:o(e)&&e.attributeInfo.storageInfo?i(e.attributeInfo.storageInfo,e.buffer,t):null}function d(e,o){const r=new Float64Array(o);for(let t=0;t<o;t++)r[t]=e[3*t+2];return r}function m(e,o,r,t,l){const n=e.length/3;let s=0;for(let i=0;i<n;i++){let n=!0;for(let e=0;e<t.length&&n;e++){const{filterJSON:o}=t[e],r=l[e].values[i];switch(o.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===o.mode;o.values.includes(r)===e&&(n=!1);break}case\"pointCloudBitfieldFilter\":{const e=p(o.requiredSetBits),t=p(o.requiredClearBits);(r&e)===e&&0==(r&t)||(n=!1);break}case\"pointCloudReturnFilter\":{const e=15&r,t=r>>>4&15,l=t>1,s=1===e,i=e===t;let u=!1;for(const r of o.includedReturns)if(\"last\"===r&&i||\"firstOfMany\"===r&&s&&l||\"lastOfMany\"===r&&i&&l||\"single\"===r&&!l){u=!0;break}u||(n=!1);break}}}n&&(r[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],o[3*s]=o[3*i],o[3*s+1]=o[3*i+1],o[3*s+2]=o[3*i+2],s++)}return s}function b(e){return null==e||\"none\"===e?null:\"low-four-bit\"===e?e=>15&e:\"high-four-bit\"===e?e=>(240&e)>>4:\"absolute-value\"===e?e=>Math.abs(e):\"modulo-ten\"===e?e=>e%10:null}function p(e){let o=0;for(const r of e||[])o|=1<<r;return o}export{d as elevationFromPositions,f as evaluateRenderer,m as filterInPlace,a as getAttributeValues,c as readGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as i}from\"../../../chunks/vec3f32.js\";import{projectBuffer as n}from\"../../../geometry/projection.js\";import s from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],i=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&i&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:i});const n=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&n&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:n});let c=b(r.rendererInfo,i,n,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const i=r.filterAttributesData.filter(t).map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,i)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,s.fromJSON(r.inSR),s.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,s,u){if(!n(t,s,0,t,u,0,r))throw new Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=i(),m=i();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],"x_google_ignoreList":[0,1]}