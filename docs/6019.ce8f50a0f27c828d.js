"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[6019],{26019:(J,Z,l)=>{l.r(Z),l.d(Z,{default:()=>z});var f=l(71670),W=l(1897),w=l(11823),T=l(32995),G=l(28191),F=l(53661),U=l(30801),x=l(71182),M=l(53492),v=l(50805),g=l(63689),m=l(19482),C=l(59266),R=l(70554),D=l(34524),I=l(65210),Q=l(19346),$=l(43651),N=l(21230);const k={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class z{constructor(){var i=this;this._queryEngine=null,this._snapshotFeatures=function(){var o=(0,f.Z)(function*(s){const a=yield i._fetch(s);return i._createFeatures(a)});return function(s){return o.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=this._fieldsIndex=this._createDefaultAttributes=null}load(i,o={}){var s=this;return(0,f.Z)(function*(){s._loadOptions={url:i.url,customParameters:i.customParameters};const a=[];yield s._checkProjection(i.spatialReference);let p=null;i.url&&(p=yield s._fetch(o?.signal));const d=(0,R.my)(p,{geometryType:i.geometryType}),_=i.fields||d.fields||[],h=null!=i.hasZ?i.hasZ:d.hasZ,e=d.geometryType;let t=i.objectIdField||d.objectIdFieldName||"__OBJECTID";const n=i.spatialReference||M.Zn;let r=i.timeInfo;_===d.fields&&d.unknownFields.length>0&&a.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:d.unknownFields}});let u=new Q.Z(_).get(t);u?("esriFieldTypeString"!==u.type&&(u.type="esriFieldTypeOID"),u.editable=!1,u.nullable=!1,t=u.name):(u={alias:t,name:t,type:"string"===d.objectIdFieldType?"esriFieldTypeString":"esriFieldTypeOID",editable:!1,nullable:!1},_.unshift(u));const y={};for(const c of _){if(null==c.name&&(c.name=c.alias),null==c.alias&&(c.alias=c.name),!c.name)throw new T.Z("geojson-layer:invalid-field-name","field name is missing",{field:c});if(!$.v.jsonValues.includes(c.type))throw new T.Z("geojson-layer:invalid-field-type",`invalid type for field "${c.name}"`,{field:c});if(c.name!==u.name){const P=(0,N.os)(c);void 0!==P&&(y[c.name]=P)}}s._fieldsIndex=new Q.Z(_);const S=s._fieldsIndex.requiredFields.indexOf(u);if(S>-1&&s._fieldsIndex.requiredFields.splice(S,1),r){if(r.startTimeField){const c=s._fieldsIndex.get(r.startTimeField);c?(r.startTimeField=c.name,c.type="esriFieldTypeDate"):r.startTimeField=null}if(r.endTimeField){const c=s._fieldsIndex.get(r.endTimeField);c?(r.endTimeField=c.name,c.type="esriFieldTypeDate"):r.endTimeField=null}if(r.trackIdField){const c=s._fieldsIndex.get(r.trackIdField);c?r.trackIdField=c.name:(r.trackIdField=null,a.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:r}}))}r.startTimeField||r.endTimeField||(a.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:r}}),r=null)}const E=e?(0,D.bU)(e):void 0,O={warnings:a,featureErrors:[],layerDefinition:{...k,drawingInfo:E??void 0,templates:(0,D.Hq)(y),extent:void 0,geometryType:e,objectIdField:t,fields:_,hasZ:!!h,timeInfo:r}};s._queryEngine=new C.q({fields:_,geometryType:e,hasM:!1,hasZ:h,objectIdField:t,spatialReference:n,timeInfo:r,featureStore:new g.Z({geometryType:e,hasM:!1,hasZ:h}),cacheSpatialQueries:!0}),s._createDefaultAttributes=(0,D.Dm)(y,t);const j=yield s._createFeatures(p);s._objectIdGenerator=s._createObjectIdGenerator(s._queryEngine,j);const K=s._normalizeFeatures(j,O.warnings,O.featureErrors);s._queryEngine.featureStore.addMany(K);const{fullExtent:q,timeExtent:b}=yield s._queryEngine.fetchRecomputedExtents();if(O.layerDefinition.extent=q,b){const{start:c,end:P}=b;O.layerDefinition.timeInfo.timeExtent=[c,P]}return O})()}applyEdits(i){var o=this;return(0,f.Z)(function*(){const{spatialReference:s,geometryType:a}=o._queryEngine;return yield Promise.all([(0,I.b)(s,a),(0,m._W)(i.adds,s),(0,m._W)(i.updates,s)]),yield o._waitSnapshotComplete(),o._applyEdits(i)})()}queryFeatures(i={},o={}){var s=this;return(0,f.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQuery(i,o.signal)})()}queryFeatureCount(i={},o={}){var s=this;return(0,f.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForCount(i,o.signal)})()}queryObjectIds(i={},o={}){var s=this;return(0,f.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForIds(i,o.signal)})()}queryExtent(i={},o={}){var s=this;return(0,f.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForExtent(i,o.signal)})()}querySnapping(i,o={}){var s=this;return(0,f.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForSnapping(i,o.signal)})()}refresh(i){var o=this;return(0,f.Z)(function*(){o._loadOptions.customParameters=i,o._snapshotTask?.abort(),o._snapshotTask=(0,w.vr)(o._snapshotFeatures),o._snapshotTask.promise.then(p=>{o._queryEngine.featureStore.clear(),o._objectIdGenerator=o._createObjectIdGenerator(o._queryEngine,p);const d=o._normalizeFeatures(p);d&&o._queryEngine.featureStore.addMany(d)},p=>{o._queryEngine.featureStore.clear(),(0,U.D_)(p)||G.Z.getLogger("esri.layers.GeoJSONLayer").error(new T.Z("geojson-layer:refresh","An error occurred during refresh",{error:p}))}),yield o._waitSnapshotComplete();const{fullExtent:s,timeExtent:a}=yield o._queryEngine.fetchRecomputedExtents();return{extent:s,timeExtent:a}})()}_createFeatures(i){var o=this;return(0,f.Z)(function*(){if(null==i)return[];const{geometryType:s,hasZ:a,objectIdField:p}=o._queryEngine,d=(0,R.lG)(i,{geometryType:s,hasZ:a,objectIdField:p});if(!(0,M.fS)(o._queryEngine.spatialReference,M.Zn))for(const _ of d)(0,F.pC)(_.geometry)&&(_.geometry=(0,v.GH)((0,m.iV)((0,v.di)(_.geometry,o._queryEngine.geometryType,o._queryEngine.hasZ,!1),M.Zn,o._queryEngine.spatialReference)));return d})()}_waitSnapshotComplete(){var i=this;return(0,f.Z)(function*(){if(i._snapshotTask&&!i._snapshotTask.finished){try{yield i._snapshotTask.promise}catch{}return i._waitSnapshotComplete()}})()}_fetch(i){var o=this;return(0,f.Z)(function*(){const{url:s,customParameters:a}=o._loadOptions,p=(yield(0,W.default)(s,{responseType:"json",query:{...a},signal:i})).data;return yield(0,R.O3)(p),p})()}_normalizeFeatures(i,o,s){const{objectIdField:a}=this._queryEngine,p=[];for(const d of i){const _=this._createDefaultAttributes(),h=(0,I.O0)(this._fieldsIndex,_,d.attributes,!0,o);h?s?.push(h):(this._assignObjectId(_,d.attributes,!0),d.attributes=_,d.objectId=_[a],p.push(d))}return p}_applyEdits(i){var o=this;return(0,f.Z)(function*(){const{adds:s,updates:a,deletes:p}=i,d={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(s&&s.length&&o._applyAddEdits(d,s),a&&a.length&&o._applyUpdateEdits(d,a),p&&p.length){for(const e of p)d.deleteResults.push((0,I.d1)(e));o._queryEngine.featureStore.removeManyById(p)}const{fullExtent:_,timeExtent:h}=yield o._queryEngine.fetchRecomputedExtents();return{extent:_,timeExtent:h,featureEditResults:d}})()}_applyAddEdits(i,o){const{addResults:s}=i,{geometryType:a,hasM:p,hasZ:d,objectIdField:_,spatialReference:h,featureStore:e}=this._queryEngine,t=[];for(const n of o){if(n.geometry&&a!==(0,x.Ji)(n.geometry)){s.push((0,I.av)("Incorrect geometry type."));continue}const r=this._createDefaultAttributes(),u=(0,I.O0)(this._fieldsIndex,r,n.attributes);if(u)s.push(u);else{if(this._assignObjectId(r,n.attributes),n.attributes=r,null!=n.uid&&(i.uidToObjectId[n.uid]=n.attributes[_]),(0,F.pC)(n.geometry)){const y=n.geometry.spatialReference??h;n.geometry=(0,m.iV)((0,I.og)(n.geometry,y),y,h)}t.push(n),s.push((0,I.d1)(n.attributes[_]))}}e.addMany((0,v.Yn)([],t,a,d,p,_))}_applyUpdateEdits({updateResults:i},o){const{geometryType:s,hasM:a,hasZ:p,objectIdField:d,spatialReference:_,featureStore:h}=this._queryEngine;for(const e of o){const{attributes:t,geometry:n}=e,r=t&&t[d];if(null==r){i.push((0,I.av)(`Identifier field ${d} missing`));continue}if(!h.has(r)){i.push((0,I.av)(`Feature with object id ${r} missing`));continue}const u=(0,v.EI)(h.getFeature(r),s,p,a);if((0,F.pC)(n)){if(s!==(0,x.Ji)(n)){i.push((0,I.av)("Incorrect geometry type."));continue}const y=n.spatialReference??_;u.geometry=(0,m.iV)((0,I.og)(n,y),y,_)}if(t){const y=(0,I.O0)(this._fieldsIndex,u.attributes,t);if(y){i.push(y);continue}}h.add((0,v.XA)(u,s,p,a,d)),i.push((0,I.d1)(r))}}_createObjectIdGenerator(i,o){const s=i.fieldsIndex.get(i.objectIdField);if("esriFieldTypeString"===s.type)return()=>s.name+"-"+Date.now().toString(16);let a=Number.NEGATIVE_INFINITY;for(const p of o)p.objectId&&(a=Math.max(a,p.objectId));return a=Math.max(0,a)+1,()=>a++}_assignObjectId(i,o,s=!1){const a=this._queryEngine.objectIdField;i[a]=s&&a in o?o[a]:this._objectIdGenerator()}_checkProjection(i){return(0,f.Z)(function*(){try{yield(0,m._W)(M.Zn,i)}catch{throw new T.Z("geojson-layer","Projection not supported")}})()}}},70554:(J,Z,l)=>{l.d(Z,{O3:()=>d,lG:()=>h,my:()=>_,q9:()=>F});var f=l(32995),W=l(33510),w=l(93846),T=l(21230);const G={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function F(e){return G[e]}function*U(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*x(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const n of t)yield*n}}function v(e){for(const t of e)if(t.length>2)return!0;return!1}function C(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n],u=e[(n+1)%e.length];t+=r[0]*u[1]-u[0]*r[1]}return t<=0}function R(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function D(e,t,n){switch(t.type){case"LineString":return function I(e,t,n){return o(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function Q(e,t,n){for(const r of t.coordinates)o(e,r,n);return e}(e,t,n);case"MultiPoint":return function $(e,t,n){return o(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function N(e,t,n){for(const r of t.coordinates){H(e,r[0],n);for(let u=1;u<r.length;u++)i(e,r[u],n)}return e}(e,t,n);case"Point":return function k(e,t,n){return a(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function z(e,t,n){const r=t.coordinates;H(e,r[0],n);for(let u=1;u<r.length;u++)i(e,r[u],n);return e}(e,t,n)}}function H(e,t,n){const r=R(t);!function g(e){return!C(e)}(r)?o(e,r,n):s(e,r,n)}function i(e,t,n){const r=R(t);!function m(e){return C(e)}(r)?o(e,r,n):s(e,r,n)}function o(e,t,n){for(const r of t)a(e,r,n);e.lengths.push(t.length)}function s(e,t,n){for(let r=t.length-1;r>=0;r--)a(e,t[r],n);e.lengths.push(t.length)}function a(e,t,n){const[r,u,y]=t;e.coords.push(r,u),n.hasZ&&e.coords.push(y||0)}function p(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function d(e){if(!e)throw new f.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new f.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const n="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!r.test(n))throw new f.Z("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function _(e,t={}){const n=[],r=new Set,u=new Set;let y,S=!1,E=null,O=!1,{geometryType:j=null}=t,K=!1;for(const b of U(e)){const{geometry:c,properties:P,id:L}=b;if((!c||(j||(j=F(c.type)),F(c.type)===j))&&(S||(S=v(x(c))),O||(O=null!=L,O&&(y=typeof L,P&&(E=Object.keys(P).filter(B=>P[B]===L)))),P&&E&&O&&null!=L&&(E.length>1?E=E.filter(B=>P[B]===L):1===E.length&&(E=P[E[0]]===L?E:[])),!K&&P)){let B=!0;for(const A in P){if(r.has(A))continue;const V=P[A];if(null==V){B=!1,u.add(A);continue}const Y=p(V);if("unknown"===Y){u.add(A);continue}u.delete(A),r.add(A);const X=(0,T.q6)(A);X&&n.push({name:X,alias:A,type:Y})}K=B}}const q=(0,T.q6)(1===E?.length&&E[0]||null)??void 0;if(q)for(const b of n)if(b.name===q&&(0,T.H7)(b)){b.type="esriFieldTypeOID";break}return{fields:n,geometryType:j,hasZ:S,objectIdFieldName:q,objectIdFieldType:y,unknownFields:Array.from(u)}}function h(e,t){return Array.from(function*M(e,t={}){const{geometryType:n,objectIdField:r}=t;for(const u of e){const{geometry:y,properties:S,id:E}=u;if(y&&F(y.type)!==n)continue;const O=S||{};let j;r&&(j=O[r],null==E||j||(O[r]=j=E)),yield new W.u_(y?D(new w.Z,y,t):null,O,null,j??void 0)}}(U(e),t))}},34524:(J,Z,l)=>{l.d(Z,{Dm:()=>x,Hq:()=>M,MS:()=>v,bU:()=>G});var f=l(67087),W=l(88684),w=l(29374),T=l(66071);function G(g){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===g||"esriGeometryMultipoint"===g?T.I4:"esriGeometryPolyline"===g?T.ET:T.lF}}}const F=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let U=1;function x(g,m){if((0,f.Z)("esri-csp-restrictions"))return()=>({[m]:null,...g});try{let C=`this.${m} = null;`;for(const D in g)C+=`this${F.test(D)?`.${D}`:`["${D}"]`} = ${JSON.stringify(g[D])};`;const R=new Function(`\n      return class AttributesClass$${U++} {\n        constructor() {\n          ${C};\n        }\n      }\n    `)();return()=>new R}catch{return()=>({[m]:null,...g})}}function M(g={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,W.d9)(g)}}]}function v(g,m){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:g},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:m,supportsDelete:m,supportsEditing:m,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:m,supportsExceedsLimitStatistics:!0},query:w.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:m,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);
//# sourceMappingURL=6019.ce8f50a0f27c828d.js.map