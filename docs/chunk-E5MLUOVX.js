import{c as ye}from"./chunk-OHW3R4WQ.js";import{a as Ce}from"./chunk-WTEGRGZ6.js";import{Ab as _,C as v,Cd as ve,Db as Y,Dd as xe,Fb as k,Fc as le,Gc as ae,Hc as pe,Ib as z,Ic as ue,Kb as K,Lb as W,Mb as X,Nb as Z,Pb as ee,Rc as me,Sc as de,Vc as ce,Wb as te,Wc as fe,Yb as re,Zb as ie,cc as ne,d as R,dc as oe,f as L,i as H,jd as _e,kd as se,ld as ge,rb as U,tb as q,vb as j,wb as J,yb as P}from"./chunk-WGIND62E.js";import{$b as b,Ab as O,Bb as x,Cb as C,Db as y,Eb as o,Fb as p,Gb as a,Hb as f,Lb as B,Mb as E,Nb as F,Ob as S,Rb as G,Sb as u,Va as n,dc as d,ec as M,ha as h,ia as T,kc as c,lb as N,nc as A,oc as I,qb as g,sc as D,tc as $,xc as Q,zb as V}from"./chunk-UXY6XTJ4.js";import"./chunk-NCBA65HR.js";var Fe=(t,l)=>({formGroup:t,index:l}),be=t=>({formGroup:t});function he(t,l){t&1&&F(0)}function Te(t,l){if(t&1&&(p(0,"div",4),g(1,he,1,0,"ng-container",7),a()),t&2){let e=l.$implicit,r=l.$index;u();let i=b(11);n(),o("ngTemplateOutlet",i)("ngTemplateOutletContext",I(2,Fe,e,r))}}function Ve(t,l){t&1&&F(0)}function Oe(t,l){if(t&1&&g(0,Ve,1,0,"ng-container",7),t&2){let e=u().formGroup;u();let r=b(13);o("ngTemplateOutlet",r)("ngTemplateOutletContext",A(2,be,e))}}function Ge(t,l){if(t&1&&(p(0,"forge-option",16),d(1),a()),t&2){let e=l.$implicit;o("value",e.value),n(),M(e.label)}}function Me(t,l){if(t&1&&(p(0,"div",17)(1,"forge-text-field",24)(2,"label",12),d(3,"Minimum"),a(),f(4,"input",25),a(),p(5,"forge-text-field",26)(6,"label",12),d(7,"Maximum"),a(),f(8,"input",27),a()()),t&2){let e=u(),r=e.formGroup,i=e.index;n(),o("appFormControlInvalid",r.controls.minValue),n(),o("for",c("query-builder--filter-min-"+i)),n(2),o("id",c("query-builder--filter-min-"+i)),n(),o("appFormControlInvalid",r.controls.maxValue)("invalidMessage",r.controls.maxValue.errors.required?"A maximum value is required":r.controls.maxValue.errors.range?"Max value must be greater or equal to min value":""),n(),o("for",c("query-builder--filter-max-"+i)),n(2),o("id",c("query-builder--filter-max-"+i))}}function qe(t,l){if(t&1&&(p(0,"forge-text-field",18)(1,"label",12),d(2,"Value"),a(),f(3,"input",28),a()),t&2){let e=u(),r=e.formGroup,i=e.index;o("appFormControlInvalid",r.controls.value),n(),o("for",c("query-builder--filter-value-"+i)),n(2),o("id",c("query-builder--filter-value-"+i))}}function we(t,l){t&1&&F(0)}function Be(t,l){t&1&&F(0)}function Ee(t,l){if(t&1&&(g(0,we,1,0,"ng-container",7),p(1,"div",4),g(2,Be,1,0,"ng-container",7),a()),t&2){let e=l.$implicit,r=l.$index;u(3);let i=b(11),m=b(13);o("ngTemplateOutlet",m)("ngTemplateOutletContext",A(4,be,e)),n(2),o("ngTemplateOutlet",i)("ngTemplateOutletContext",I(6,Fe,e,r))}}function Se(t,l){if(t&1&&(B(0,3),C(1,Ee,3,9,null,null,x),E()),t&2){let e=u().formGroup;n(),y(e.controls.filters.controls)}}function Ae(t,l){if(t&1){let e=S();V(0,Oe,1,4,"ng-container"),B(1,8),p(2,"div",9)(3,"forge-autocomplete",10)(4,"forge-text-field",11)(5,"label",12),d(6,"Property"),a(),f(7,"input",13)(8,"forge-icon",14),a()(),p(9,"forge-select",15),C(10,Ge,2,2,"forge-option",16,x),a(),V(12,Me,9,11,"div",17)(13,qe,4,5,"forge-text-field",18),p(14,"div",19)(15,"forge-menu",20),G("forge-menu-select",function(i){let m=h(e).formGroup,s=u();return T(s.onAddFilter(m,i.detail.value))}),p(16,"forge-icon-button",21),f(17,"forge-icon",6),a()(),p(18,"forge-icon-button",22),G("click",function(){let i=h(e).formGroup,m=u();return T(m.onDeleteFilter(i))}),f(19,"forge-icon",23),a()()(),V(20,Se,3,0,"ng-container",3),E()}if(t&2){let e=l.formGroup,r=l.index,i=u();O(r>0?0:-1),n(),o("formGroup",e),n(2),o("filter",i.propertyFilter),n(),o("appFormControlInvalid",e.controls.property),n(),o("for",c("query-builder--filter-property-"+r)),n(2),o("id",c("query-builder--filter-property-"+r)),n(2),o("appFormControlInvalid",e.controls.operator),n(),y(i.operatorOptions),n(2),O(e.controls.operator.value===6?12:13),n(3),o("options",i.filterOptions),n(5),O(e.controls.filters.controls!=null&&e.controls.filters.controls.length?20:-1)}}function Ie(t,l){if(t&1&&(p(0,"forge-option",16),d(1),a()),t&2){let e=l.$implicit;o("value",e.value),n(),M(e.label)}}function Qe(t,l){if(t&1&&(p(0,"div",29)(1,"forge-select",30),C(2,Ie,2,2,"forge-option",16,x),a()()),t&2){let e=l.formGroup,r=u();n(),o("formControl",e.get("condition")),n(),y(r.conditionOptions)}}var Je=(()=>{class t{constructor(){this.formGroup=new P({filters:new k([this.buildFilterFormGroup()])}),this.conditionOptions=[{value:"and",label:"And"},{value:"or",label:"Or"}],this.propertyOptions=[{value:"firstName",label:"First name"},{value:"lastName",label:"Last name"},{value:"dateOfBirth",label:"Date of birth"},{value:"gender",label:"Gender"},{value:"occupation",label:"Occupation"}],this.operatorOptions=[{value:0,label:"Equal"},{value:1,label:"Not equal"},{value:2,label:"Greater than"},{value:3,label:"Less than"},{value:4,label:"Greater than equal to"},{value:5,label:"Less than equal to"},{value:6,label:"Range"},{value:7,label:"Contains"},{value:8,label:"Not contains"},{value:9,label:"Empty"}],this.filterOptions=[{value:"condition",label:"Add condition"},{value:"group",label:"Add group"}],this.propertyFilter=e=>Ce.filterData(this.propertyOptions,[{key:"label",value:e}])}onAddFilter(e,r){if(e===this.formGroup)this.formGroup.controls.filters.push(this.buildFilterFormGroup());else switch(r){case"condition":{let i=e.parent.controls.indexOf(e)+1;e.parent.insert(i,this.buildFilterFormGroup());break}case"group":e.get("filters").push(this.buildFilterFormGroup());break}}onDeleteFilter(e){let r=e.parent,i=r.controls.indexOf(e);i!==-1&&r.removeAt(i)}buildFilterFormGroup(e){return new P({property:new _(e?.property,{validators:[q.required]}),condition:new _(e?.condition||"and",{validators:[q.required]}),operator:new _(e?.operator,{validators:[q.required]}),value:new _(e?.value,{validators:[this.validateFilterValue("value")]}),minValue:new _(e?.minValue,{validators:[this.validateFilterValue("minValue")]}),maxValue:new _(e?.minValue,{validators:[this.validateFilterValue("maxValue")]}),filters:new k([])})}validateFilterValue(e){return r=>{let i=r.parent;if(!i)return null;let m=i.value.operator;if(!v(m))return null;switch(m){case 6:{if(e==="value")return null;if(!v(r.value)||!r.value.toString().length)return{required:!0};let s=i.value.minValue,w=i.value.maxValue;if(e==="minValue"&&v(w)&&s.localeCompare(w,navigator.language,{numeric:!0,ignorePunctuation:!0})<1&&i.get("maxValue")?.setErrors(null),e==="maxValue"){if(!v(s))return null;if(s.localeCompare(w,navigator.language,{numeric:!0,ignorePunctuation:!0})>0)return{range:!0}}return null}default:return e==="minValue"||e==="maxValue"?null:!v(r.value)||!r.value.toString().length?{required:!0}:null}}}static{this.\u0275fac=function(r){return new(r||t)}}static{this.\u0275cmp=N({type:t,selectors:[["app-query-builder"]],decls:14,vars:4,consts:[["filterFormTemplate",""],["filterHeaderTemplate",""],["novalidate","","autocomplete","off",3,"formGroup"],["formArrayName","filters"],[1,"filter__group"],["variant","tonal",1,"filter__group__add",3,"click"],["name","add_circle"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"formGroup"],[1,"filter__form"],["formControlName","property",3,"filter"],["required","","invalidMessage","A property is required",3,"appFormControlInvalid"],["slot","label",3,"for"],["type","text",3,"id"],["slot","end","name","arrow_drop_down",1,"forge-dropdown-icon"],["formControlName","operator","label","Operator","required","","invalidMessage","An operator is required",3,"appFormControlInvalid"],[3,"value"],[1,"filter__form__range"],["required","","invalidMessage","A value is required",3,"appFormControlInvalid"],[1,"filter__form__action"],[3,"forge-menu-select","options"],["aria-label","Add filter"],["aria-label","Delete filter",3,"click"],["name","delete"],["required","","invalidMessage","A minimum value is required",3,"appFormControlInvalid"],["type","text","formControlName","minValue",3,"id"],["required","",3,"appFormControlInvalid","invalidMessage"],["type","text","formControlName","maxValue",3,"id"],["type","text","formControlName","value",3,"id"],[1,"filter__header"],[1,"filter__header__condition",3,"formControl"]],template:function(r,i){if(r&1){let m=S();p(0,"form",2)(1,"div",3),C(2,Te,2,5,"div",4,x),a(),p(4,"forge-button",5),G("click",function(){return h(m),T(i.onAddFilter(i.formGroup,"condition"))}),f(5,"forge-icon",6),d(6," Add a new condition "),a(),p(7,"p"),d(8),D(9,"json"),a()(),g(10,Ae,21,12,"ng-template",null,0,Q)(12,Qe,4,1,"ng-template",null,1,Q)}r&2&&(o("formGroup",i.formGroup),n(2),y(i.formGroup.controls.filters.controls),n(6),M($(9,2,i.formGroup.getRawValue())))},dependencies:[H,R,ee,Y,U,j,J,Z,z,X,W,K,ie,re,te,oe,ne,ue,pe,le,ae,de,me,fe,ce,ge,se,_e,xe,ve,ye,L],styles:[`[_nghost-%COMP%]{display:block;padding:24px}.filter__header[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin:8px 0}.filter__header__condition[_ngcontent-%COMP%]{--forge-field-height: 2.5rem;--forge-field-outline-style: none;--forge-field-background: var(--forge-theme-surface-container)}.filter__form[_ngcontent-%COMP%]{display:grid;grid-gap:0 16px;grid-template-columns:216px 168px minmax(400px,1fr) 96px;align-items:start}.filter__form__range[_ngcontent-%COMP%]{display:grid;grid-gap:0 16px;grid-template-columns:minmax(192px,1fr) minmax(192px,1fr);align-items:start}.filter__form__action[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:center;margin-top:1rem}.filter__group[_ngcontent-%COMP%]{background-color:var(--forge-theme-surface);border-radius:var(--forge-shape-medium);border:1px solid var(--forge-theme-outline);padding:16px}.filter__group[_ngcontent-%COMP%]   .filter__group[_ngcontent-%COMP%]{border:1px dashed var(--forge-theme-outline);margin:8px 0;padding:8px 16px}.filter__group[_ngcontent-%COMP%]{border-left:4px solid var(--forge-theme-primary);margin:16px 0}.filter__group[_ngcontent-%COMP%]:first-of-type{margin-top:0}.filter__group__add[_ngcontent-%COMP%]{--forge-button-height: 3rem}






/*# sourceMappingURL=query-builder.component-EN2GP2Y5.css.map */`]})}}return t})();export{Je as QueryBuilderComponent};
//# sourceMappingURL=chunk-E5MLUOVX.js.map
