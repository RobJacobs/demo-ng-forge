"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[5230],{82734:(W,L,E)=>{E.d(L,{Qn:()=>h,iG:()=>_});var y,C=E(43918),v=E(64626);class I{}I.instance=new v.vF("Etc/UTC"),(y||(y={})).TimeZoneNotRecognised="TimeZoneNotRecognised";const b={[y.TimeZoneNotRecognised]:"Timezone identifier has not been recognised."};class T extends Error{constructor(u,l){super((0,C.Hy)(b[u],l)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,T)}}class _{constructor(u){this._date=u,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(u=0,l=1,x=1,U=0,z=0,P=0,D=0,A){if(isNaN(u)||isNaN(l)||isNaN(x)||isNaN(U)||isNaN(z)||isNaN(P)||isNaN(D))return null;let O=0;const R=v.ou.local(u,l).daysInMonth;x<1&&(O=x-1,x=1),x>R&&(O=x-R,x=R);let F=0;l>12?(F=l-12,l=12):l<1&&(F=l-1,l=1);let B=0;z>59?(B=z-59,z=59):z<0&&(B=z,z=0);let Z=0;P>59?(Z=P-59,P=59):P<0&&(Z=P,P=0);let m=0;D>999?(m=D-999,D=999):D<0&&(m=D,D=0);let g=v.ou.fromObject({day:x,year:u,month:l,hour:U,minute:z,second:P,millisecond:D},{zone:h(A)});return 0!==F&&(g=g.plus({months:F})),0!==O&&(g=g.plus({days:O})),0!==B&&(g=g.plus({minutes:B})),0!==Z&&(g=g.plus({seconds:Z})),0!==m&&(g=g.plus({milliseconds:m})),new _(g)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(u,l){const x=h(l);return u.isUnknownTimeZone||x===I.instance?_.fromParts(u.year,u.monthJS+1,u.day,u.hour,u.minute,u.second,u.millisecond,x):new _(u._date.setZone(l))}static dateJSToArcadeDate(u){return new _(v.ou.fromJSDate(u,{zone:"system"}))}static dateJSAndZoneToArcadeDate(u,l="system"){return new _(v.ou.fromJSDate(u,{zone:l}))}static unknownEpochToArcadeDate(u){return new _(v.ou.fromMillis(u,{zone:I.instance}))}static unknownDateJSToArcadeDate(u){return new _(v.ou.fromMillis(u.getTime(),{zone:I.instance}))}static epochToArcadeDate(u,l="system"){return new _(v.ou.fromMillis(u,{zone:l}))}static dateTimeToArcadeDate(u){return new _(u)}changeTimeZone(u){const l=h(u);return _.dateTimeToArcadeDate(this._date.setZone(l))}static dateTimeAndZoneToArcadeDate(u,l){const x=h(l);return u.zone===I.instance||x===I.instance?_.fromParts(u.year,u.month,u.day,u.hour,u.minute,u.second,u.millisecond,x):new _(u.setZone(x))}static nowToArcadeDate(u){return new _(v.ou.fromJSDate(new Date,{zone:u}))}static nowUTCToArcadeDate(){return new _(v.ou.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===_.systemTimeZoneCanonicalName}equals(u){return this.isSystem&&u.isSystem?this.toNumber()===u.toNumber():this.isUnknownTimeZone===u.isUnknownTimeZone&&this._date.equals(u._date)}get isUnknownTimeZone(){return this._date.zone===I.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let u=this._date.weekday;return u>6&&(u=0),u}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const u=this.zone;return"fixed"===u.type?0===u.fixed?"utc":u.formatOffset(0,"short"):u.name}stringify(){return JSON.stringify(this.toJSDate())}plus(u){return new _(this._date.plus(u))}diff(u,l="milliseconds"){return this._date.diff(u._date,l)[l]}toISOString(u){return this._date.toISO(u?{suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}:{includeOffset:!this.isUnknownTimeZone})}toFormat(u,l){return this._date.toFormat(u,l)}toJSDate(){return this._date.toJSDate()}toSQLString(){return"timestamp '"+this._date.toFormat("yyyy-LL-dd HH:mm:ss")+"'"}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new _(this._date.toUTC())}toLocal(){return new _(this._date.toLocal())}toString(){return this.toISOString(!0)}}function h(f){if(f instanceof v.ld)return f;if("system"===f.toLowerCase())return"system";if("utc"===f.toLowerCase())return"utc";if("unknown"===f.toLowerCase())return I.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(f)){const l=v.Qf.parseSpecifier("UTC"+(f.startsWith("+")||f.startsWith("-")?"":"+")+f);if(l)return l}const u=v.vF.create(f);if(!u.isValid)throw new T(y.TimeZoneNotRecognised);return u}},68621:(W,L,E)=>{E.d(L,{nu:()=>f}),E(82734);var v=E(19346),b=(E(27655),E(64626),E(8127));class f{constructor(){this.dateTimeReferenceMetaData=null,this._fieldTimeZoneIndex={},this._fieldIndex=null,this._ianaPreferred=null,this._ianaTimeInfo=null,this._ianaEditFields=null,this._ianaLayerDateFields=null}static create(l,x){const U=new f;return U.dateTimeReferenceMetaData=x,U._fieldIndex=l instanceof v.Z?l:new v.Z(l),U}static createFromLayer(l){if(!l)return null;if(!l.fieldsIndex)return!l.declaredClass&&l.fields?f.create(l.fields,l):null;const x=new f;return x._fieldIndex=l.fieldsIndex,x.dateTimeReferenceMetaData={timeInfo:l?.timeInfo?.toJSON()??null,editFieldsInfo:l?.editFieldsInfo?.toJSON()??null,dateFieldsTimeReference:l?.dateFieldsTimeReference?.toJSON()??null,preferredTimeReference:l?.preferredTimeReference?.toJSON()??null,datesInUnknownTimezone:!0===l?.datesInUnknownTimezone},x}fieldTimeZone(l){const x=this._fieldIndex?.get(l);if(!x||"date"!==x.type&&"esriFieldTypeDate"!==x.type)return null;const U=this._fieldTimeZoneIndex[x.name];if(void 0!==U)return U;const z=[{field:this.dateTimeReferenceMetaData?.editFieldsInfo?.creationDateField,timeReference:this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.editFieldsInfo?.editDateField,timeReference:this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.timeInfo?.startTimeField,timeReference:this.dateTimeReferenceMetaData?.timeInfo?.timeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone},{field:this.dateTimeReferenceMetaData?.timeInfo?.endTimeField,timeReference:this.dateTimeReferenceMetaData?.timeInfo?.timeReference,isunknown:!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone}];for(const D of z)if(D.field===x.name){const A=this.convertToIANA(D.timeReference,D.isunknown);return this._fieldTimeZoneIndex[x.name]=A,A}const P=this.convertToIANA(this.dateTimeReferenceMetaData?.dateFieldsTimeReference,this.dateTimeReferenceMetaData?.datesInUnknownTimezone);return this._fieldTimeZoneIndex[x.name]=P,P}convertToIANA(l,x){return x?"unknown":function h(u){return u?.timeZoneIANA?u?.timeZoneIANA:u?.timeZone?(0,b.G)(u,""):""}(l)}get layerPreferredTimeZone(){if(null!==this._ianaPreferred)return this._ianaPreferred;this._ianaPreferred="";const l=this.dateTimeReferenceMetaData?.preferredTimeReference;return this._ianaPreferred=this.convertToIANA(l,!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone),this._ianaPreferred}get layerTimeInfoTimeZone(){if(null!==this._ianaTimeInfo)return this._ianaTimeInfo;this._ianaTimeInfo="";const l=this.dateTimeReferenceMetaData?.timeInfo?.timeReference;return this._ianaTimeInfo=this.convertToIANA(l,!1),this._ianaTimeInfo}get layerEditFieldsTimeZone(){if(null!==this._ianaEditFields)return this._ianaEditFields;this._ianaEditFields="";const l=this.dateTimeReferenceMetaData?.editFieldsInfo?.dateFieldsTimeReference;return this._ianaEditFields=this.convertToIANA(l,this.dateTimeReferenceMetaData?.datesInUnknownTimezone),this._ianaEditFields}get layerDateFieldsTimeZone(){if(null!==this._ianaLayerDateFields)return this._ianaLayerDateFields;this._ianaLayerDateFields="";const l=this.dateTimeReferenceMetaData?.dateFieldsTimeReference;return this._ianaLayerDateFields=this.convertToIANA(l,!0===this.dateTimeReferenceMetaData?.datesInUnknownTimezone),this._ianaLayerDateFields}}},21288:(W,L,E)=>{E.d(L,{KS:()=>f,PX:()=>b,QS:()=>l,_I:()=>C,jL:()=>h,nE:()=>u,vs:()=>_,xp:()=>T});const C=8388607,v=8388608,b=0,T=1,_=x=>(x&v)>>>23,h=x=>x&C,f=x=>_(x)===T?254:255;function u(x){return _(x)===T}function l(x,U){return((U?v:0)|x)>>>0}},13458:(W,L,E)=>{E.d(L,{J:()=>v,g:()=>C});const C=(I,y)=>I&&((...b)=>y.warn("DEBUG:",...b))||(()=>null),v=!1},25534:(W,L,E)=>{E.d(L,{Z:()=>B});var C=E(71670),v=E(32995),I=E(67087),y=E(28191),b=E(93142),T=E(53661),_=E(30801),h=E(51118),f=E(19346),u=E(80696),l=E(21288),x=E(52300),U=E(13458),z=E(99890),P=E(69923);const D=y.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),A=(0,U.g)(U.J,D),O={sharedArrayBuffer:(0,I.Z)("esri-shared-array-buffer"),atomics:(0,I.Z)("esri-atomics")};function R(Z,m){return g=>m(Z(g))}class F{constructor(m,g,n,c){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:p,layout:S,textureOnly:M}=c;this.textureOnly=M||!1,this.pixelType=p,this._ctype=g,this.layout=S,this._resetRange(),this._shared=m,this.size=n,M||(this.data=this._initData(p,n,m,g))}get buffer(){return(0,T.yw)(this.data,m=>m.buffer)}unsetComponentAllTexels(m,g){const n=(0,T.Wg)(this.data);for(let c=0;c<this.size*this.size;c++)n[c*this.texelSize+m]&=~g;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(m,g){const n=(0,T.Wg)(this.data);for(let c=0;c<this.size*this.size;c++)n[c*this.texelSize+m]|=255&g;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(m,g,n){const c=(0,T.Wg)(this.data);for(const p of n)c[p*this.texelSize+m]|=g,this.dirtyStart=Math.min(this.dirtyStart,p),this.dirtyEnd=Math.max(this.dirtyEnd,p)}setComponentTexel(m,g,n){(0,T.Wg)(this.data)[n*this.texelSize+m]|=g,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}unsetComponentTexel(m,g,n){(0,T.Wg)(this.data)[n*this.texelSize+m]&=~g,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}getData(m,g){const n=(0,l.jL)(m);return(0,T.Wg)(this.data)[n*this.texelSize+g]}setData(m,g,n){const c=(0,l.jL)(m);this.layout&1<<g?(0,T.Wi)(this.data)||(this.data[c*this.texelSize+g]=n,this.dirtyStart=Math.min(this.dirtyStart,c),this.dirtyEnd=Math.max(this.dirtyEnd,c)):D.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){this.pixelType===P.Br.UNSIGNED_BYTE&&this._shared&&O.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){this.pixelType===P.Br.UNSIGNED_BYTE&&this._shared&&O.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(m){if(this.size=m,!this.textureOnly){const g=this._initData(this.pixelType,m,this._shared,this._ctype),n=(0,T.Wg)(this.data);g.set(n),this.data=g}}toMessage(){const m=this.dirtyStart,g=this.dirtyEnd,n=this.texelSize;if(m>g)return null;this._resetRange();const c=!(this._shared||"local"===this._ctype),p=this.pixelType,S=this.layout,M=(0,T.Wg)(this.data);return{start:m,end:g,data:c&&M.slice(m*n,(g+1)*n)||null,pixelType:p,layout:S}}_initData(m,g,n,c){const p=n&&"local"!==c?SharedArrayBuffer:ArrayBuffer,S=(0,x.UK)(m),M=new S(new p(g*g*4*S.BYTES_PER_ELEMENT));for(let N=0;N<M.length;N+=4)M[N+1]=255;return M}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class B{constructor(m,g,n=(()=>{})){this._client=m,this.config=g,this._notifyChange=n,this._blocks=new Array,this._filters=new Array(u.m4),this._attributeComputeInfo=null,this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._nextUpdate=null,this._currUpdate=null,this._idsToHighlight=new Set;const c=g.supportsTextureFloat?P.Br.FLOAT:P.Br.UNSIGNED_BYTE;A(`Creating AttributeStore ${O.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:P.Br.UNSIGNED_BYTE,layout:1},{pixelType:P.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:P.Br.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:c,layout:15},{pixelType:c,layout:15},{pixelType:c,layout:15},{pixelType:c,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}get hasHighlight(){return this._idsToHighlight.size>0}isUpdating(){return!!this._currUpdate||!!this._nextUpdate}update(m,g){this.config=g;const n=g.schema.processors[0].storage,c=(0,h.Hg)(this._schema,n);if((m.targets.feature||m.targets.aggregate)&&(m.storage.data=!0),c&&((0,I.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",c),m.storage.data=!0,this._schema=n,this._attributeComputeInfo=null,!(0,T.Wi)(n))){switch(n.target){case"feature":this._targetType=l.PX;break;case"aggregate":this._targetType=l.xp}if("subtype"===n.type){this._attributeComputeInfo={isSubtype:!0,subtypeField:n.subtypeField,map:new Map};for(const p in n.mapping){const S=n.mapping[p];if((0,T.pC)(S)&&(0,T.pC)(S.vvMapping))for(const M of S.vvMapping)this._bindAttribute(M,parseInt(p,10))}}else{if(this._attributeComputeInfo={isSubtype:!1,map:new Map},(0,T.pC)(n.vvMapping))for(const p of n.vvMapping)this._bindAttribute(p);if((0,T.pC)(n.attributeMapping))for(const p of n.attributeMapping)this._bindAttribute(p)}}}onTileData(m,g){if((0,T.Wi)(g.addOrUpdate))return;const n=g.addOrUpdate.getCursor();for(;n.next();){const c=n.getDisplayId();this.setAttributeData(c,n)}}setHighlight(m,g){var n=this;return(0,C.Z)(function*(){const p=n._getBlock(0),S=g.map(M=>(0,l.jL)(M));p.lock(),p.unsetComponentAllTexels(0,1),p.setComponent(0,1,S),p.unlock(),n._idsToHighlight.clear();for(const M of m)n._idsToHighlight.add(M);yield n.sendUpdates()})()}updateFilters(m,g,n){var c=this;return(0,C.Z)(function*(){const{service:p,spatialReference:S}=n,{filters:M}=g,N=M.map((w,j)=>c._updateFilter(w,j,p,S));(yield Promise.all(N)).some(w=>w)&&(m.storage.filters=!0,(0,I.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))})()}setData(m,g,n,c){const p=(0,l.jL)(m);this._ensureSizeForTexel(p),this._getBlock(g).setData(m,n,c)}getData(m,g,n){return this._getBlock(g).getData(m,n)}getHighlightFlag(m){return this._idsToHighlight.has(m)?u.uG:0}unsetAttributeData(m){const g=(0,l.jL)(m);this._getBlock(0).setData(g,0,0)}setAttributeData(m,g){const n=(0,l.jL)(m);if(this._ensureSizeForTexel(n),this._getBlock(0).setData(n,0,this.getFilterFlags(g)),this._targetType!==(0,l.vs)(m))return;const c=this._attributeComputeInfo,p=this.config.supportsTextureFloat?1:2;let M=null;c&&(M=c.isSubtype?c.map.get(g.readAttribute(c.subtypeField)):c.map,M&&M.size&&M.forEach((N,w)=>{const j=w*p%4,K=Math.floor(w*p/4),k=this._getBlock(K+u.aK),G=N(g);if(this.config.supportsTextureFloat)k.setData(n,j,G);else if(G===u.AI)k.setData(n,j,255),k.setData(n,j+1,255);else{const J=(0,b.uZ)(Math.round(G),-32767,32766)+32768,V=(65280&J)>>8;k.setData(n,j,255&J),k.setData(n,j+1,V)}}))}sendUpdates(){if((0,I.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate"),this._notifyChange(),this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,_.hh)(),this._nextUpdate.promise;const m={blocks:this._blocks.map(g=>(0,T.pC)(g)?g.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const g=()=>{if(this._currUpdate=null,this._nextUpdate){const c=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>c.resolve())}else(0,I.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::No additional updates queued");this._notifyChange()};(0,I.Z)("esri-2d-update-debug")&&console.debug("AttributeStore::sendUpdate::client.update");const n=this._client.update(m,this._signal).then(g).catch(g);return this._client.render(this._signal),n}).catch(g=>{if((0,_.D_)(g))return this._createResourcesPromise=null,this._createResources();this._notifyChange(),D.error(new v.Z("mapview-attribute-store","Encountered an error during client update",g))}),this._currUpdate}_ensureSizeForTexel(m){for(;m>=this._size*this._size;)if(this._expand())return}_bindAttribute(m,g){let p;if(null!=m.fieldIndex)p=function c(){return m.normalizationField&&D.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),w=>w.getComputedNumericAtIndex(m.fieldIndex)}();else{if(!m.field)return;p=function n(){const{normalizationField:w}=m;return w?j=>{const K=j.readAttribute(w);return K?j.readAttribute(m.field)/K:null}:j=>j.readAttribute(m.field)}()}const{valueRepresentation:S}=m;S&&(p=R(p,w=>(0,z.qc)(w,S)));const M=w=>null===w||isNaN(w)||w===1/0||w===-1/0?u.AI:w,N=this._attributeComputeInfo;if(N.isSubtype){const w=N.map.get(g)??new Map;w.set(m.binding,R(p,M)),N.map.set(g,w)}else N.map.set(m.binding,R(p,M))}_createResources(){if((0,T.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(u.xl),this._getBlock(u.pU),A("Initializing AttributeStore");const m={shared:O.sharedArrayBuffer&&"local"!==this._client.type,size:this._size,blocks:(0,T.Fd)(this._blocks,n=>({textureOnly:n.textureOnly,buffer:n.buffer,pixelType:n.pixelType}))},g=this._client.initialize(m,this._signal).catch(n=>{(0,_.D_)(n)?this._createResourcesPromise=null:D.error(new v.Z("mapview-attribute-store","Encountered an error during client initialization",n))});return this._createResourcesPromise=g,g.then(()=>(0,T.Wi)(this._createResourcesPromise)?this._createResources():void 0),g}_getBlock(m){const g=this._blocks[m];if((0,T.pC)(g))return g;A(`Initializing AttributeBlock at index ${m}`);const p=new F(O.sharedArrayBuffer,this._client.type,this._size,this._blockDescriptors[m]);return this._blocks[m]=p,this._createResourcesPromise=null,p}_expand(){if(this._size<this.config.maxTextureSize){const m=this._size<<=1;return A("Expanding block size to",m,this._blocks),(0,T.JR)(this._blocks,g=>g.expand(m)),this._createResourcesPromise=null,this._size=m,0}return D.error(new v.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(m,g,n,c){var p=this;return(0,C.Z)(function*(){const S=p._filters[g],M=(0,T.pC)(S)&&S.hash;if(!S&&!m||M===JSON.stringify(m))return!1;if((0,T.Wi)(m)){if(!S)return!1;const w=1<<g+1,j=p._getBlock(0);return p._filters[g]=null,j.setComponentAllTexels(0,w),p.sendUpdates(),!0}return yield(yield p._getFilter(g,n)).update(m,c),!0})()}_getFilter(m,g){var n=this;return(0,C.Z)(function*(){const c=n._filters[m];if((0,T.pC)(c))return c;const{default:p}=yield Promise.all([E.e(8592),E.e(1614)]).then(E.bind(E,32201)),S=new p({geometryType:g.geometryType,hasM:!1,hasZ:!1,timeInfo:g.timeInfo,fieldsIndex:new f.Z(g.fields)});return n._filters[m]=S,S})()}isVisible(m){return!!(2&this._getBlock(0).getData(m,0))}getFilterFlags(m){let g=0;const n=(0,l.KS)(m.getDisplayId());for(let p=0;p<this._filters.length;p++){const M=this._filters[p];g|=(n&1<<p&&!(0,T.Wi)(M)&&!M.check(m)?0:1)<<p}let c=0;if(this._idsToHighlight.size){const p=m.getObjectId();c=this.getHighlightFlag(p)}return g<<1|c}}},26440:(W,L,E)=>{E.d(L,{O:()=>b});var C=E(21288);class v{constructor(){this._freeIds=[],this._idCounter=1}createId(_=!1){return(0,C.QS)(this._getFreeId(),_)}releaseId(_){this._freeIds.push(_)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var I=E(43065);function y(T,_,h){if(!(T.length>_))for(;T.length<=_;)T.push(h)}class b{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new v,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const _=this._bitsets.length;return this._bitsets.push(I.p.create(this._allocatedSize,C._I)),_+1}getBitset(_){return this._bitsets[_-1]}_expand(){this._allocatedSize<<=1;for(const _ of this._bitsets)_.resize(this._allocatedSize)}_ensureNumeric(_,h){this._numerics[_]||(this._numerics[_]=[]),y(this._numerics[_],h,0)}_ensureInstanceId(_){y(this._instanceIds,_,0)}_ensureString(_,h){this._strings[_]||(this._strings[_]=[]),y(this._strings[_],h,null)}createDisplayId(_=!1){const h=this._idGenerator.createId();return h>this._allocatedSize&&this._expand(),(0,C.QS)(h,_)}releaseDisplayId(_){for(const h of this._bitsets)h.unset(_);return this._idGenerator.releaseId(_&C._I)}getComputedNumeric(_,h){return this.getComputedNumericAtIndex(_&C._I,0)}setComputedNumeric(_,h,f){return this.setComputedNumericAtIndex(_&C._I,f,0)}getComputedString(_,h){return this.getComputedStringAtIndex(_&C._I,0)}setComputedString(_,h,f){return this.setComputedStringAtIndex(_&C._I,0,f)}getComputedNumericAtIndex(_,h){const f=_&C._I;return this._ensureNumeric(h,f),this._numerics[h][f]}setComputedNumericAtIndex(_,h,f){const u=_&C._I;this._ensureNumeric(h,u),this._numerics[h][u]=f}getInstanceId(_){const h=_&C._I;return this._ensureInstanceId(h),this._instanceIds[h]}setInstanceId(_,h){const f=_&C._I;this._ensureInstanceId(f),this._instanceIds[f]=h}getComputedStringAtIndex(_,h){const f=_&C._I;return this._ensureString(h,f),this._strings[h][f]}setComputedStringAtIndex(_,h,f){const u=_&C._I;this._ensureString(h,u),this._strings[h][u]=f}getXMin(_){return this._bounds[4*(_&C._I)]}getYMin(_){return this._bounds[4*(_&C._I)+1]}getXMax(_){return this._bounds[4*(_&C._I)+2]}getYMax(_){return this._bounds[4*(_&C._I)+3]}setBounds(_,h){const f=h.readHydratedGeometry();if(!f||!f.coords.length)return!1;let u=1/0,l=1/0,x=-1/0,U=-1/0;f.forEachVertex((P,D)=>{u=Math.min(u,P),l=Math.min(l,D),x=Math.max(x,P),U=Math.max(U,D)});const z=_&C._I;return y(this._bounds,4*z+4,0),this._bounds[4*z]=u,this._bounds[4*z+1]=l,this._bounds[4*z+2]=x,this._bounds[4*z+3]=U,!0}}},80074:(W,L,E)=>{E.d(L,{s:()=>m}),E(6010);var v=E(82734),I=E(68621),y=E(67087),b=E(53661),T=E(74486),_=E(50805),h=E(93846),f=E(43065),u=E(71182);let l=0;const x=(0,y.Z)("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],U=x[0],z=x[1],P=x[2],D=x[3],A=(0,y.Z)("featurelayer-simplify-payload-size-factors")??[1,2,4],O=A[0],R=A[1],F=A[2],B=(0,y.Z)("featurelayer-simplify-mobile-factor")??2,Z=(0,y.Z)("esri-mobile");class m{constructor(n,c){this.type="FeatureSetReader",this.arcadeDeclaredClass="esri.arcade.Feature",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this._datetimeMetadata=null,this.contextTimeReference=null,this.instance=n,this._layerSchema=c}static createInstance(){return l++,l=l>65535?0:l,l}get isEmpty(){return(0,b.pC)(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(n){this._level=n}getAreaSimplificationThreshold(n,c){let p=1;const S=Z?B:1;c>4e6?p=F*S:c>1e6?p=R*S:c>5e5?p=O*S:c>1e5&&(p=S);let M=0;n>4e3?M=D*p:n>2e3?M=P*p:n>100?M=z:n>15&&(M=U);let N=8;return this._level<4?N=1:this._level<5?N=2:this._level<6&&(N=4),M*N}createQuantizedExtrudedQuad(n,c){return new h.Z([5],[n-1,c,1,-1,1,1,-1,1,-1,-1])}setArcadeSpatialReference(n){this._arcadeSpatialReference=n}attachStorage(n){this._storage=n}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(n){return this.getComputedNumericAtIndex(0)}setComputedNumeric(n,c){return this.setComputedNumericAtIndex(c,0)}getComputedString(n){return this.getComputedStringAtIndex(0)}setComputedString(n,c){return this.setComputedStringAtIndex(0,c)}getComputedNumericAtIndex(n){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),n)}setComputedNumericAtIndex(n,c){this._storage.setComputedNumericAtIndex(this.getDisplayId(),n,c)}getComputedStringAtIndex(n){return this._storage.getComputedStringAtIndex(this.getDisplayId(),n)}setComputedStringAtIndex(n,c){return this._storage.setComputedStringAtIndex(this.getDisplayId(),n,c)}transform(n,c,p,S){const M=this.copy();return M._tx+=n,M._ty+=c,M._sx*=p,M._sy*=S,M}readAttribute(n,c=!1){const p=this._readAttribute(n,c);if(void 0!==p)return p;for(const S of this._joined){S.setIndex(this.getIndex());const M=S._readAttribute(n,c);if(void 0!==M)return M}}readAttributes(){const n=this._readAttributes();for(const c of this._joined){c.setIndex(this.getIndex());const p=c._readAttributes();for(const S of Object.keys(p))n[S]=p[S]}return n}joinAttributes(n){this._joined.push(n)}readArcadeFeature(){return this}geometry(){const n=this.readHydratedGeometry(),c=(0,_.di)(n,this.geometryType,this.hasZ,this.hasM),p=(0,u.im)(c);return p&&(p.spatialReference=this._arcadeSpatialReference),p}get dateTimeReferenceFieldIndex(){return this._datetimeMetadata||(this._datetimeMetadata=I.nu.create(this._layerSchema.fields,this._layerSchema)),this._datetimeMetadata}autocastArcadeDate(n,c){return c&&c instanceof Date?this.isUnknownDateTimeField(n)?v.iG.unknownDateJSToArcadeDate(c):v.iG.dateJSAndZoneToArcadeDate(c,this.contextTimeReference?.timeZone??"system"):c}isUnknownDateTimeField(n){return"unknown"===this.dateTimeReferenceFieldIndex?.fieldTimeZone(n)}fieldSourceTimeZone(n){return this.dateTimeReferenceFieldIndex?.fieldTimeZone(n)??""}get layerPreferredTimeZone(){return this.dateTimeReferenceFieldIndex?.layerPreferredTimeZone??""}field(n){if(this.hasField(n))return this.autocastArcadeDate(n,this.readAttribute(n,!0));for(const c of this._joined)if(c.setIndex(this.getIndex()),c.hasField(n)){const p=c._readAttribute(n,!0);return this.autocastArcadeDate(n,p)}throw new Error(`Field ${n} does not exist`)}setField(n,c){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.getFieldNames()}castToText(n=!1){if(!n)return JSON.stringify(this.readLegacyFeature());const c=this.readLegacyFeature();if(!c)return JSON.stringify(null);const p={geometry:c.geometry,attributes:{...c.attributes?c.attributes:{}}};for(const S in p.attributes){const M=p.attributes[S];M instanceof Date&&(p.attributes[S]=M.getTime())}return JSON.stringify(p)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(n=null){return{attributes:this._readAttributes(),geometry:!0===n?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(n=null,c=null){return Promise.resolve(this.castAsJson(c))}removeIds(n){if((0,b.Wi)(this._objectIdToIndex)){const p=new Map,S=this.getCursor();for(;S.next();){const M=(0,b.s3)(S.getObjectId());p.set(M,S.getIndex())}this._objectIdToIndex=p}const c=this._objectIdToIndex;for(const p of n)c.has(p)&&this.removeAtIndex(c.get(p))}removeAtIndex(n){(0,b.Wi)(this._deleted)&&(this._deleted=f.p.create(this.getSize())),this._deleted.set(n)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const n=this.getCursor();for(;n.next();)yield n.readOptimizedFeature()}_getExists(){return(0,b.Wi)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const n=this.readUnquantizedGeometry();if(!n||n.hasIndeterminateRingOrder)return null;const c=(0,b.Pt)(this.getQuantizationTransform(),null);return(0,T.Y)(new h.Z,n,this.hasM,this.hasZ,c)}copyInto(n){n.seen=this.seen,n._storage=this._storage,n._arcadeSpatialReference=this._arcadeSpatialReference,n._joined=this._joined,n._tx=this._tx,n._ty=this._ty,n._sx=this._sx,n._sy=this._sy,n._deleted=this._deleted,n._objectIdToIndex=this._objectIdToIndex}}},80416:(W,L,E)=>{E.d(L,{i:()=>T});var C=E(53661),v=E(50805),I=E(33510),y=E(80074);class T extends y.s{static fromFeatures(h,f){const{objectIdField:u,geometryType:l}=f,x=(0,v.Yn)([],h,l,!1,!1,u);for(let U=0;U<x.length;U++)x[U].displayId=h[U].displayId;return T.fromOptimizedFeatures(x,f)}static fromFeatureSet(h,f){const u=(0,v.h_)(h,f.objectIdField);return T.fromOptimizedFeatureSet(u,f)}static fromOptimizedFeatureSet(h,f){const{features:u}=h,l=T.fromOptimizedFeatures(u,f);l._exceededTransferLimit=h.exceededTransferLimit,l._transform=h.transform;for(const x of h.fields)"esriFieldTypeDate"===x.type&&l._dateFields.add(x.name);return l}static fromOptimizedFeatures(h,f,u){const l=y.s.createInstance(),x=new T(l,h,f);return x._transform=u,x}constructor(h,f,u){super(h,u),this._exceededTransferLimit=!1,this._featureIndex=-1,this._dateFields=new Set,this._geometryType=u?.geometryType,this._features=f}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(h){const f=new Set(h);this._features=this._features.filter(u=>!(u.objectId&&f.has(u.objectId)))}append(h){for(const f of h)this._features.push(f)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let h="";for(const f in this._current.attributes)h+=this._current.attributes[f];return h}getIndex(){return this._featureIndex}setIndex(h){this._featureIndex=h}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(h){this._current.displayId=h}getGroupId(){return this._current.groupId}setGroupId(h){this._current.groupId=h}copy(){const h=new T(this.instance,this._features,this.fullSchema());return this.copyInto(h),h}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,v.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const h=this.readGeometry();return(0,v.di)(h,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const h=this.readCentroid();return(0,C.Wi)(h)?null:{x:h.coords[0]*this._sx+this._tx,y:h.coords[1]*this._sy+this._ty}}readGeometryArea(){return(0,I.S6)(this._current)?(0,v.lz)(this._current.geometry,2):0}readUnquantizedGeometry(){const h=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!h)return h;const f=h.clone();return function b({coords:_,lengths:h}){let f=0;for(const u of h){for(let l=1;l<u;l++)_[2*(f+l)]+=_[2*(f+l)-2],_[2*(f+l)+1]+=_[2*(f+l)-1];f+=u}}(f),f}readHydratedGeometry(){const h=this._current.geometry;if((0,C.Wi)(h))return null;const f=h.clone();return(0,C.pC)(this._transform)&&(0,v.$g)(f,f,this.hasZ,this.hasM,this._transform),f}getXHydrated(){if(!(0,I.S6)(this._current))return 0;const h=this._current.geometry.coords[0],f=this.getQuantizationTransform();return(0,C.Wi)(f)?h:h*f.scale[0]+f.translate[0]}getYHydrated(){if(!(0,I.S6)(this._current))return 0;const h=this._current.geometry.coords[1],f=this.getQuantizationTransform();return(0,C.Wi)(f)?h:f.translate[1]-h*f.scale[1]}getX(){return(0,I.S6)(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return(0,I.S6)(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!(0,I.S6)(this._current)){if((0,C.pC)(this._current.centroid)){const[u,l]=this._current.centroid.coords;return this.createQuantizedExtrudedQuad(u,l)}return null}const h=this._current.geometry.clone();if(h.isPoint)return h.coords[0]=h.coords[0]*this._sx+this._tx,h.coords[1]=h.coords[1]*this._sy+this._ty,h;let f=0;for(const u of h.lengths)h.coords[2*f]=h.coords[2*f]*this._sx+this._tx,h.coords[2*f+1]=h.coords[2*f+1]*this._sy+this._ty,f+=u;return h}readCentroid(){return(0,I.S6)(this._current)?this._computeCentroid():this._current.centroid}hasField(h){return h in this._current.attributes||this.getFieldNames().map(f=>f.toLowerCase()).includes(h.toLowerCase())}getFieldNames(){return Object.keys(this._current.attributes)}_readAttribute(h,f){const u=this._current.attributes[h];if(void 0!==u)return null!=u&&f&&this._dateFields.has(h)?new Date(u):u;const l=this.readAttributes(),x=h?.toLocaleLowerCase().trim();for(const U in l)if(U.toLocaleLowerCase().trim()===x){const z=this._current.attributes[U];return null!=z&&f&&this._dateFields.has(U)?new Date(z):z}}copyInto(h){super.copyInto(h),h._featureIndex=this._featureIndex,h._transform=this._transform,h._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}},43065:(W,L,E)=>{E.d(L,{p:()=>C});class C{static fromBuffer(I,y){return new C(I,y)}static create(I,y=4294967295){const b=new Uint32Array(Math.ceil(I/32));return new C(b,y)}constructor(I,y){this._mask=0,this._buf=I,this._mask=y}_getIndex(I){return Math.floor(I/32)}has(I){const y=this._mask&I;return!!(this._buf[this._getIndex(y)]&1<<y%32)}hasRange(I,y){let b=I,T=y;for(;b%32&&b!==T;){if(this.has(b))return!0;b++}for(;T%32&&b!==T;){if(this.has(b))return!0;T--}if(b===T)return!1;for(let _=b/32;_!==T/32;_++)if(this._buf[_])return!0;return!1}set(I){const y=this._mask&I,b=this._getIndex(y);this._buf[b]|=1<<y%32}setRange(I,y){let b=I,T=y;for(;b%32&&b!==T;)this.set(b++);for(;T%32&&b!==T;)this.set(T--);if(b!==T)for(let _=b/32;_!==T/32;_++)this._buf[_]=4294967295}unset(I){const y=this._mask&I,b=this._getIndex(y);this._buf[b]&=4294967295^1<<y%32}resize(I){const y=this._buf,b=new Uint32Array(Math.ceil(I/32));b.set(y),this._buf=b}or(I){for(let y=0;y<this._buf.length;y++)this._buf[y]|=I._buf[y];return this}and(I){for(let y=0;y<this._buf.length;y++)this._buf[y]&=I._buf[y];return this}xor(I){for(let y=0;y<this._buf.length;y++)this._buf[y]^=I._buf[y];return this}ior(I){for(let y=0;y<this._buf.length;y++)this._buf[y]|=~I._buf[y];return this}iand(I){for(let y=0;y<this._buf.length;y++)this._buf[y]&=~I._buf[y];return this}ixor(I){for(let y=0;y<this._buf.length;y++)this._buf[y]^=~I._buf[y];return this}any(){for(let I=0;I<this._buf.length;I++)if(this._buf[I])return!0;return!1}copy(I){for(let y=0;y<this._buf.length;y++)this._buf[y]=I._buf[y];return this}clone(){return new C(this._buf.slice(),this._mask)}clear(){for(let I=0;I<this._buf.length;I++)this._buf[I]=0}forEachSet(I){for(let y=0;y<this._buf.length;y++){let b=this._buf[y],T=32*y;if(b)for(;b;)1&b&&I(T),b>>>=1,T++}}countSet(){let I=0;return this.forEachSet(y=>{I++}),I}}},99890:(W,L,E)=>{E.d(L,{I:()=>x,qc:()=>_});var C=E(53661),v=E(55798),I=E(9203),y=E(80696),b=E(20753),T=E(75683);function _(D,A){if(!D||!A)return D;switch(A){case"radius":case"distance":return 2*D;case"diameter":case"width":return D;case"area":return Math.sqrt(D)}return D}function f(D){return(D??[]).map(A=>function h(D){return{value:D.value,size:(0,v.t_)(D.size)}}(A))}function u(D){return"string"==typeof D||"number"==typeof D?(0,v.t_)(D):{type:"size",expression:D.expression,stops:f(D.stops)}}const l=D=>{const A=[],O=[],R=f(D),F=R.length;for(let B=0;B<6;B++){const Z=R[Math.min(B,F-1)];A.push(Z.value),O.push(null==Z.size?y.AI:(0,v.F2)(Z.size))}return{values:new Float32Array(A),sizes:new Float32Array(O)}};function x(D){const A=D&&D.length>0?{}:null,O=A?{}:null;if(!A||!O)return{vvFields:A,vvRanges:O};for(const R of D)if(R.field&&(A[R.type]=R.field),"size"===R.type){O.size||(O.size={});const F=R;switch((0,T.a)(F)){case b.X.SIZE_MINMAX_VALUE:O.size.minMaxValue={minDataValue:F.minDataValue,maxDataValue:F.maxDataValue,minSize:u(F.minSize),maxSize:u(F.maxSize)};break;case b.X.SIZE_SCALE_STOPS:O.size.scaleStops={stops:f(F.stops)};break;case b.X.SIZE_FIELD_STOPS:if(F.levels){const B={};for(const Z in F.levels)B[Z]=l(F.levels[Z]);O.size.fieldStops={type:"level-dependent",levels:B}}else O.size.fieldStops={type:"static",...l(F.stops)};break;case b.X.SIZE_UNIT_VALUE:O.size.unitValue={unit:F.valueUnit,valueRepresentation:F.valueRepresentation??void 0}}}else"color"===R.type?O.color=P(R):"opacity"===R.type?O.opacity=U(R):"rotation"===R.type&&(O.rotation={type:R.rotationType});return{vvFields:A,vvRanges:O}}function U(D){const A={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof D.field){if(!D.stops)return null;{if(D.stops.length>8)return null;const O=D.stops;for(let R=0;R<8;++R){const F=O[Math.min(R,O.length-1)];A.values[R]=F.value,A.opacities[R]=F.opacity}}}else{if(!(D.stops&&D.stops.length>=0))return null;{const O=D.stops&&D.stops.length>=0?D.stops[0].opacity:0;for(let R=0;R<8;R++)A.values[R]=1/0,A.opacities[R]=O}}return A}function z(D,A,O){D[4*A+0]=O.r/255,D[4*A+1]=O.g/255,D[4*A+2]=O.b/255,D[4*A+3]=O.a}function P(D){if((0,C.Wi)(D)||D.normalizationField)return null;const A={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof D.field){if(!D.stops)return null;{if(D.stops.length>8)return null;A.field=D.field;const O=D.stops;for(let R=0;R<8;++R){const F=O[Math.min(R,O.length-1)];A.values[R]=F.value,z(A.colors,R,F.color)}}}else{if(!(D.stops&&D.stops.length>=0))return null;{const O=D.stops&&D.stops.length>=0&&D.stops[0].color;for(let R=0;R<8;R++)A.values[R]=1/0,z(A.colors,R,O)}}for(let O=0;O<32;O+=4)(0,I.pr)(A.colors,O,!0);return A}}}]);
//# sourceMappingURL=5230.2c11e347bc30a4a9.js.map