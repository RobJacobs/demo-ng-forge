"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[9774],{88770:(P,x,e)=>{e.d(x,{JZ:()=>m,RL:()=>v,eY:()=>c});var _=e(71670),p=e(53661),f=e(30801),o=e(38974),R=e(40334),h=e(12288),g=e(99390),u=e(7585),a=e(87652),l=e(69923),s=e(74697);function m(d){return d&&"render"in d}function v(d){const t=document.createElement("canvas");return t.width=d.width,t.height=d.height,d.render(t.getContext("2d")),t}class c extends g.s{constructor(t=null,n){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this._texture=null,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=n.immutable??!1,this.requestRenderOnSourceChangedEnabled=n.requestRenderOnSourceChangedEnabled??!0,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),(0,p.pC)(this._uploadStatus)&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){null==t&&null==this._source||(this._source=t,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width),this.invalidateTexture())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t)}setSourceAsync(t,n){var i=this;return(0,_.Z)(function*(){(0,p.pC)(i._uploadStatus)&&i._uploadStatus.controller.abort();const y=new AbortController,E=(0,f.hh)();return(0,f.$F)(n,()=>y.abort()),(0,f.$F)(y,D=>E.reject(D)),i._uploadStatus={controller:y,resolver:E},i.source=t,E.promise})()}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}updateTransitionProperties(t,n){t>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(t,n)}setTransform(t){const n=(0,o.g)(this.transforms.dvs),[i,y]=t.toScreenNoRotation([0,0],[this.x,this.y]),E=this.resolution/this.pixelRatio/t.resolution,D=E*this.width,T=E*this.height,B=Math.PI*this.rotation/180;(0,o.h)(n,n,(0,h.f)(i,y)),(0,o.h)(n,n,(0,h.f)(D/2,T/2)),(0,o.r)(n,n,-B),(0,o.h)(n,n,(0,h.f)(-D/2,-T/2)),(0,o.k)(n,n,(0,h.f)(D,T)),(0,o.m)(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,n){this._texture&&t.bindTexture(this._texture,n)}updateTexture({context:t,painter:n}){var i=this;return(0,_.Z)(function*(){if(!i._textureInvalidated)return;if(i._textureInvalidated=!1,i._texture||(i._texture=i._createTexture(t)),!i.source)return void i._texture.setData(null);i._texture.resize(i._sourceWidth,i._sourceHeight);const y=function r(d){return m(d)?d instanceof u.Z?(0,p.yw)(d.getRenderedRasterPixels(),t=>t.renderedRasterPixels):v(d):d}(i.source);try{if((0,p.pC)(i._uploadStatus)){const{controller:E,resolver:D}=i._uploadStatus,T={signal:E.signal},{width:B,height:I}=i,M=i._texture;yield n.textureUploadManager.enqueueTextureUpdate({data:y,texture:M,width:B,height:I},T),D.resolve(),i._uploadStatus=null}else i._texture.setData(y);i.ready()}catch(E){(0,f.H9)(E)}})()}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,R.c)()}}_createTexture(t){const n=this.immutable&&t.type===a.zO.WEBGL2;return new s.x(t,{target:l.No.TEXTURE_2D,pixelFormat:l.VI.RGBA,internalFormat:n?l.lP.RGBA8:l.VI.RGBA,dataType:l.Br.UNSIGNED_BYTE,wrapMode:l.e8.CLAMP_TO_EDGE,isImmutable:n,width:this._sourceWidth,height:this._sourceHeight})}}},57762:(P,x,e)=>{e.d(x,{s:()=>a});var _=e(6848),p=e(40334),f=e(88770),o=e(11653);class R extends o.I{constructor(s,m,v,r,c,d,t=null){super(s,m,v,r,c,d),this.bitmap=new f.eY(t,{immutable:!1,requestRenderOnSourceChangedEnabled:!1}),this.bitmap.coordScale=[c,d],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(s){super.beforeRender(s),this.bitmap.beforeRender(s)}afterRender(s){super.afterRender(s),this.bitmap.afterRender(s)}set stencilRef(s){this.bitmap.stencilRef=s}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:(0,p.c)(),tileMat3:(0,p.c)()}}setTransform(s){super.setTransform(s),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var h=e(23529),g=e(20753),u=e(53971);class a extends u.Z{get requiresDedicatedFBO(){return this.children.some(s=>"additive"===s.bitmap.blendFunction)}createTile(s){const m=this._tileInfoView.getTileBounds((0,_.Ue)(),s),v=this._tileInfoView.getTileResolution(s.level),[r,c]=this._tileInfoView.tileInfo.size;return new R(s,v,m[0],m[3],r,c)}prepareRenderPasses(s){const m=s.registerRenderPass({name:"bitmap (tile)",brushes:[h.U.bitmap],target:()=>this.children.map(v=>v.bitmap),drawPhase:g.jx.MAP});return[...super.prepareRenderPasses(s),m]}doRender(s){this.visible&&s.drawPhase===g.jx.MAP&&super.doRender(s)}}},7585:(P,x,e)=>{e.d(x,{Z:()=>p});var _=e(53661);class p{constructor(o,R,h){this.pixelBlock=o,this.extent=R,this.originalPixelBlock=h}get width(){return(0,_.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,_.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(o){const R=this.pixelBlock;if((0,_.Wi)(R))return;const h=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??R});if((0,_.Wi)(h.pixelBlock))return;h.pixelBlock.maskIsAlpha&&(h.pixelBlock.premultiplyAlpha=!0);const g=h.pixelBlock.getAsRGBA(),u=o.createImageData(h.pixelBlock.width,h.pixelBlock.height);u.data.set(g),o.putImageData(u,0,0)}getRenderedRasterPixels(){const o=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return(0,_.Wi)(o.pixelBlock)?null:(o.pixelBlock.maskIsAlpha&&(o.pixelBlock.premultiplyAlpha=!0),{width:o.pixelBlock.width,height:o.pixelBlock.height,renderedRasterPixels:new Uint8Array(o.pixelBlock.getAsRGBA().buffer)})}}},53971:(P,x,e)=>{e.d(x,{Z:()=>g});var _=e(67087),p=e(20753),f=e(83345),o=e(26877),R=e(67135);const h=(u,a)=>u.key.level-a.key.level!=0?u.key.level-a.key.level:u.key.row-a.key.row!=0?u.key.row-a.key.row:u.key.col-a.key.col;class g extends f.Z{constructor(a){super(),this._tileInfoView=a}get requiresDedicatedFBO(){return!1}renderChildren(a){this.sortChildren(h),this.setStencilReference(a),super.renderChildren(a)}createRenderParams(a){const{state:l}=a,s=super.createRenderParams(a);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(l.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(l.scale),s}prepareRenderPasses(a){const l=super.prepareRenderPasses(a);return l.push(a.registerRenderPass({name:"stencil",brushes:[R.Z],drawPhase:p.jx.DEBUG|p.jx.MAP|p.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,_.Z)("esri-tiles-debug")&&l.push(a.registerRenderPass({name:"tileInfo",brushes:[o.Z],drawPhase:p.jx.DEBUG,target:()=>this.children})),l}getStencilTarget(){return this.children}setStencilReference(a){let l=1;for(const s of this.children)s.stencilRef=l++}}},11653:(P,x,e)=>{e.d(x,{I:()=>o});var _=e(38974),p=e(99390),f=e(67026);class o extends p.s{constructor(h,g,u,a,l,s,m=l,v=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new f.Z(h),this.resolution=g,this.x=u,this.y=a,this.width=l,this.height=s,this.rangeX=m,this.rangeY=v}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(h){const g=this.resolution/(h.resolution*h.pixelRatio),u=this.transforms.tileMat3,[a,l]=h.toScreenNoRotation([0,0],[this.x,this.y]);(0,_.s)(u,this.width/this.rangeX*g,0,0,0,this.height/this.rangeY*g,0,a,l,1),(0,_.m)(this.transforms.dvs,h.displayViewMat3,u)}}},99774:(P,x,e)=>{e.r(x),e.d(x,{default:()=>v});var _=e(18100),g=(e(28191),e(83382),e(19420),e(32995),e(67087),e(20891)),u=e(45811),a=e(57762),l=e(43363);class s{constructor(){this.gradient=null,this.height=512,this.intensities=null,this.width=512}render(c){(0,u.hy)(c,512,this.intensities,this.gradient,this.minDensity,this.maxDensity)}}let m=class extends l.Z{constructor(r){super(r),this._intensityInfo={minDensity:0,maxDensity:0},this.type="heatmap",this.featuresView={attributeView:{initialize:()=>{},requestUpdate:()=>{}},requestRender:()=>{}},this._container=new a.s(r.tileInfoView)}createTile(r){const c=this._container.createTile(r);return this.tileInfoView.getTileCoords(c.bitmap,r),c.bitmap.resolution=this.tileInfoView.getTileResolution(r),c}onConfigUpdate(){const r=this.layer.renderer;if("heatmap"===r.type){const{minDensity:c,maxDensity:d,colorStops:t}=r;this._intensityInfo.minDensity=c,this._intensityInfo.maxDensity=d,this._gradient=(0,u.uI)(t),this.tiles.forEach(n=>{const i=n.bitmap.source;i&&(i.minDensity=c,i.maxDensity=d,i.gradient=this._gradient,n.bitmap.invalidateTexture())})}}hitTest(){return Promise.resolve([])}install(r){r.addChild(this._container)}uninstall(r){this._container.removeAllChildren(),r.removeChild(this._container)}disposeTile(r){this._container.removeChild(r),r.destroy()}supportsRenderer(r){return r&&"heatmap"===r.type}onTileData(r){const c=this.tiles.get(r.tileKey);if(!c)return;const d=r.intensityInfo,{minDensity:t,maxDensity:n}=this._intensityInfo,i=c.bitmap.source||new s;i.intensities=d&&d.matrix||null,i.minDensity=t,i.maxDensity=n,i.gradient=this._gradient,c.bitmap.source=i,this._container.addChild(c),this._container.requestRender(),this.requestUpdate()}onTileError(r){console.error(r)}lockGPUUploads(){}unlockGPUUploads(){}fetchResource(r,c){return console.error(r),Promise.reject()}};m=(0,_._)([(0,g.j)("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],m);const v=m}}]);
//# sourceMappingURL=9774.e7c47999e5d91c87.js.map