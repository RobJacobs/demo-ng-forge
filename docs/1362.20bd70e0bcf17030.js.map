{"version":3,"file":"1362.20bd70e0bcf17030.js","mappings":"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","names":["E","constructor","_this","this","_queryEngine","_customParameters","_snapshotFeatures","_ref","_asyncToGenerator","e","objectIdField","t","r","d","_getFeatureUrl","_featureType","typeName","_getFeatureOutputFormat","customParameters","dateFields","fieldsIndex","map","name","signal","g","i","a","f","geometryType","hasZ","n","spatialReference","u","s","geometry","p","c","h","o","_","_fieldsIndex","attributes","objectId","_x","apply","arguments","destroy","load","_this2","getFeatureUrl","getFeatureOutputFormat","fields","featureType","w","_checkProjection","l","hasM","timeInfo","featureStore","y","m","addMany","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_this3","_waitSnapshotComplete","executeQuery","queryFeatureCount","_this4","executeQueryForCount","queryObjectIds","_this5","executeQueryForIds","queryExtent","_this6","executeQueryForExtent","querySnapping","_this7","executeQueryForSnapping","refresh","_this8","_snapshotTask","abort","promise","then","clear","error","_this9","finished"],"sourceRoot":"webpack:///","sources":["./node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.26/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{isSome as s,unwrap as a}from\"../../../core/maybe.js\";import{throwIfAborted as i,isAbortError as o}from\"../../../core/promiseUtils.js\";import{equals as n,WGS84 as u}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as p,convertToGeometry as h}from\"../featureConversionUtils.js\";import y from\"../data/FeatureStore.js\";import{project as c,checkProjectionSupport as m}from\"../data/projectionSupport.js\";import{QueryEngine as l}from\"../data/QueryEngine.js\";import{validateGeoJSON as g,createOptimizedFeatures as f}from\"./geojson/geojson.js\";import{mixAttributes as _}from\"./support/sourceUtils.js\";import{getFeature as d}from\"../../ogc/wfsUtils.js\";import w from\"../../support/FieldsIndex.js\";class E{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,r=await d(this._getFeatureUrl??\"\",this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await g(r),i(e);const a=f(r,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!n(this._queryEngine.spatialReference,u))for(const i of a)s(i.geometry)&&(i.geometry=p(c(h(i.geometry,this._queryEngine.geometryType,!1,!1),u,this._queryEngine.spatialReference)));let o=1;for(const s of a){const e={};_(this._fieldsIndex,e,s.attributes,!0),s.attributes=e,null==s.attributes[t]&&(s.objectId=s.attributes[t]=o++)}return a}}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:r,getFeatureOutputFormat:s,spatialReference:o,fields:n,geometryType:u,featureType:p,objectIdField:h,customParameters:c}=e;this._featureType=p,this._customParameters=c,this._getFeatureUrl=r,this._getFeatureOutputFormat=s,this._fieldsIndex=new w(n),await this._checkProjection(o),i(t),this._queryEngine=new l({fields:n,geometryType:u,hasM:!1,hasZ:!1,objectIdField:h,spatialReference:o,timeInfo:null,featureStore:new y({geometryType:u,hasM:!1,hasZ:!1})});const m=await this._snapshotFeatures(a(t.signal));return this._queryEngine.featureStore.addMany(m),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(s){return this._customParameters=s,this._snapshotTask?.abort(),this._snapshotTask=e(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),o(e)||r.getLogger(\"esri.layers.WFSLayer\").error(new t(\"wfs-layer:getfeature-error\",\"An error occurred during the GetFeature request\",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await m(u,e)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{spatialReference:e})}}}export{E as default};\n"],"x_google_ignoreList":[0]}