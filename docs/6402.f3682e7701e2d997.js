"use strict";(self.webpackChunkdemo_ng_forge=self.webpackChunkdemo_ng_forge||[]).push([[6402],{1167:(ee,N,r)=>{function I(D){const O=D.layer;return"floorInfo"in O&&O.floorInfo?.floorField&&"floors"in D.view?S(D.view.floors,O.floorInfo.floorField):null}function h(D,O){return"floorInfo"in O&&O.floorInfo?.floorField?S(D,O.floorInfo.floorField):null}function S(D,O){if(!D?.length)return null;const w=D.filter(m=>""!==m).map(m=>`'${m}'`);return w.push("''"),`${O} IN (${w.join(",")}) OR ${O} IS NULL`}r.d(N,{c:()=>I,f:()=>h})},48878:(ee,N,r)=>{r.d(N,{FN:()=>D,QV:()=>S,ac:()=>w});var I=r(53661),h=r(61434);function S(m,g,p){return g.flatten(({sublayers:c})=>c).length!==m.length||!!m.some(c=>c.originIdOf("minScale")>p||c.originIdOf("maxScale")>p||c.originIdOf("renderer")>p||c.originIdOf("labelingInfo")>p||c.originIdOf("opacity")>p||c.originIdOf("labelsVisible")>p||c.originIdOf("source")>p)||!O(m,g)}function D(m,g,p){return!!m.some(v=>{const c=v.source;return!(!c||"map-layer"===c.type&&c.mapLayerId===v.id&&((0,I.Wi)(c.gdbVersion)||c.gdbVersion===p))||v.originIdOf("renderer")>h.s3.SERVICE||v.originIdOf("labelingInfo")>h.s3.SERVICE||v.originIdOf("opacity")>h.s3.SERVICE||v.originIdOf("labelsVisible")>h.s3.SERVICE})||!O(m,g)}function O(m,g){if(!m||!m.length||(0,I.Wi)(g))return!0;const p=g.slice().reverse().flatten(({sublayers:T})=>T&&T.toArray().reverse()).map(T=>T.id).toArray();if(m.length>p.length)return!1;let v=0;const c=p.length;for(const{id:T}of m){for(;v<c&&p[v]!==T;)v++;if(v>=c)return!1}return!0}function w(m){return!!m&&m.some(g=>null!=g.minScale||g.layerDefinition&&null!=g.layerDefinition.minScale)}},99704:(ee,N,r)=>{r.d(N,{T:()=>A});var I=r(71670),h=r(30801),S=r(20834),D=r(28679),O=r(53971),w=r(53661),m=r(55798),g=r(82769),p=r(1611),v=r(52300),c=r(70260),T=r(51399),y=r(86626);function H($,i){const d=i.length;if($<i[0].value||1===d)return i[0].size;for(let u=1;u<d;u++)if($<i[u].value)return i[u-1].size+($-i[u-1].value)/(i[u].value-i[u-1].value)*(i[u].size-i[u-1].size);return i[d-1].size}class J{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=c.v}getSizeVVFieldStops(i){const d=this._vvSizeFieldStops;if(d)switch(d.type){case"static":return d;case"level-dependent":return(0,w.Pt)(d.levels[i],()=>{let u=1/0,b=0;for(const x in d.levels){const M=parseFloat(x),j=Math.abs(i-M);j<u&&(u=j,b=M)}if(u===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const F=2**((i-b)/2),Q=(0,w.Wg)(d.levels[b]),V=new Float32Array(Q.values);return V[2]*=F,V[3]*=F,{sizes:(0,w.Wg)(Q.sizes),values:V}});default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(i){(0,w.pC)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,i)}setInfo(i,d,u){this._updateEffects(u),this._vvInfo=d,this._technique=(0,T.EJ)(i),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,i)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,y.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(i){this.outsideLabelsVisible=!!(0,w.pC)(i)&&i.excludedLabelsVisible}_updateVisualVariables(i,d){const u=this._vvMaterialParameters;if(u.vvOpacityEnabled=!1,u.vvSizeEnabled=!1,u.vvColorEnabled=!1,u.vvRotationEnabled=!1,!i)return;const b=i.size;if(b){if(u.vvSizeEnabled=!0,b.minMaxValue){const x=b.minMaxValue;let M,j;if((0,v.$K)(x.minSize)&&(0,v.$K)(x.maxSize))if((0,v.hj)(x.minSize)&&(0,v.hj)(x.maxSize))M=(0,m.F2)(x.minSize),j=(0,m.F2)(x.maxSize);else{const Z=d.scale;M=(0,m.F2)(H(Z,x.minSize.stops)),j=(0,m.F2)(H(Z,x.maxSize.stops))}this.vvSizeMinMaxValue.set([x.minDataValue,x.maxDataValue,M,j])}if(b.scaleStops&&(this.vvSizeScaleStopsValue=(0,m.F2)(H(d.scale,b.scaleStops.stops))),b.unitValue){const x=(0,g.c9)(d.spatialReference)/p.a[b.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=x/d.resolution}b.fieldStops&&(this._vvSizeFieldStops=b.fieldStops)}const F=i.color;F&&(u.vvColorEnabled=!0,this.vvColorValues.set(F.values),this.vvColors.set(F.colors));const Q=i.opacity;Q&&(u.vvOpacityEnabled=!0,this.vvOpacityValues.set(Q.values),this.vvOpacities.set(Q.opacities));const V=i.rotation;V&&(u.vvRotationEnabled=!0,u.vvRotationType=V.type)}}class A extends O.Z{constructor(i){super(i),this._rendererInfo=new J,this._materialItemsRequestQueue=new S.Z,this.attributeView=new D.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(i=>i.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(i,d,u){this._rendererInfo.setInfo(i,d,u),this.requestRender()}getMaterialItems(i,d){var u=this;return(0,I.Z)(function*(){if(!i||0===i.length)return[];const b=(0,h.hh)();return u._materialItemsRequestQueue.push({items:i,abortOptions:d,resolver:b}),u.requestRender(),b.promise})()}doRender(i){if(i.context.capabilities.enable("textureFloat"),i.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let d=this._materialItemsRequestQueue.pop();for(;d;)this._processMaterialItemRequest(i,d),d=this._materialItemsRequestQueue.pop()}super.doRender(i)}renderChildren(i){for(const d of this.children)d.commit(i);this._rendererInfo.update(i.state),super.renderChildren(i)}updateTransforms(i){if(this.children.some(d=>d.hasData))for(const d of this.children)d.setTransform(i)}createRenderParams(i){const d=super.createRenderParams(i);return d.rendererInfo=this._rendererInfo,d.attributeView=this.attributeView,d}onAttributeStoreUpdate(){}_processMaterialItemRequest(i,{items:d,abortOptions:u,resolver:b}){const{painter:F,pixelRatio:Q}=i,V=d.map(x=>F.textureManager.rasterizeItem(x.symbol,Q,x.glyphIds,u));Promise.all(V).then(x=>{if(!this.stage)return void b.reject();const M=x.map((j,Z)=>({id:d[Z].id,mosaicItem:j}));b.resolve(M)},b.reject)}}},53971:(ee,N,r)=>{r.d(N,{Z:()=>m});var I=r(67087),h=r(20753),S=r(83345),D=r(26877),O=r(67135);const w=(g,p)=>g.key.level-p.key.level!=0?g.key.level-p.key.level:g.key.row-p.key.row!=0?g.key.row-p.key.row:g.key.col-p.key.col;class m extends S.Z{constructor(p){super(),this._tileInfoView=p}get requiresDedicatedFBO(){return!1}renderChildren(p){this.sortChildren(w),this.setStencilReference(p),super.renderChildren(p)}createRenderParams(p){const{state:v}=p,c=super.createRenderParams(p);return c.requiredLevel=this._tileInfoView.getClosestInfoForScale(v.scale).level,c.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(v.scale),c}prepareRenderPasses(p){const v=super.prepareRenderPasses(p);return v.push(p.registerRenderPass({name:"stencil",brushes:[O.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,I.Z)("esri-tiles-debug")&&v.push(p.registerRenderPass({name:"tileInfo",brushes:[D.Z],drawPhase:h.jx.DEBUG,target:()=>this.children})),v}getStencilTarget(){return this.children}setStencilReference(p){let v=1;for(const c of this.children)c.stencilRef=v++}}},37436:(ee,N,r)=>{r.d(N,{Z:()=>$});var I=r(53661),h=r(99704),S=r(38974),D=r(40334),O=r(12288),w=r(49533),m=r(42758),g=r(99390),p=r(52300),v=r(10615),c=r(69923),T=r(19955);const y=Math.PI/180;class J extends g.s{constructor(d){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,D.c)(),this._localOrigin={x:0,y:0},this._getBounds=d}destroy(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,I.M2)(this._program)}doRender(d){const{context:u}=d,b=this._getBounds();if(b.length<1)return;this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(d),this._updateBufferData(u,b),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(c.zi.ONE,c.zi.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0);const F=this._program;u.bindVAO(this._vao),u.useProgram(F),F.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(c.MX.LINES,8*b.length,c.g.UNSIGNED_INT,0),u.bindVAO()}_createTransforms(){return{dvs:(0,D.c)()}}_createShaderProgram(d){this._program||(this._program=d.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",A().attributes))}_updateMatricesAndLocalOrigin(d){const{state:u}=d,{displayMat3:b,size:F,resolution:Q,pixelRatio:V,rotation:x,viewpoint:M}=u,j=y*x,{x:Z,y:le}=M.targetGeometry,ue=(0,m.or)(Z,u.spatialReference);this._localOrigin.x=ue,this._localOrigin.y=le;const oe=V*F[0],ae=V*F[1],de=Q*oe,ce=Q*ae,q=(0,S.g)(this._dvsMat3);(0,S.m)(q,q,b),(0,S.h)(q,q,(0,O.f)(oe/2,ae/2)),(0,S.d)(q,q,(0,w.f)(F[0]/de,-ae/ce,1)),(0,S.r)(q,q,-j)}_updateBufferData(d,u){const{x:b,y:F}=this._localOrigin,V=new Float32Array(8*u.length),x=new Uint32Array(8*u.length);let M=0,j=0;for(const Z of u)Z&&(V[2*M+0]=Z[0]-b,V[2*M+1]=Z[1]-F,V[2*M+2]=Z[0]-b,V[2*M+3]=Z[3]-F,V[2*M+4]=Z[2]-b,V[2*M+5]=Z[3]-F,V[2*M+6]=Z[2]-b,V[2*M+7]=Z[1]-F,x[j+0]=M+0,x[j+1]=M+3,x[j+2]=M+3,x[j+3]=M+2,x[j+4]=M+2,x[j+5]=M+1,x[j+6]=M+1,x[j+7]=M+0,M+=4,j+=8);if(this._vertexBuffer?this._vertexBuffer.setData(V.buffer):this._vertexBuffer=v.f.createVertex(d,c.l1.DYNAMIC_DRAW,V.buffer),this._indexBuffer?this._indexBuffer.setData(x):this._indexBuffer=v.f.createIndex(d,c.l1.DYNAMIC_DRAW,x),!this._vao){const Z=A();this._vao=new T.U(d,Z.attributes,Z.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const A=()=>(0,p.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:c.g.FLOAT}]});let $=class extends h.T{constructor(i){super(i),this.hasHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,I.SC)(this._boundsRenderer)}enableRenderingBounds(i){this._boundsRenderer=new J(i),this.requestRender()}get hasLabels(){return!1}onTileData(i,d){i.patch(d),this.contains(i)||this.addChild(i),this.requestRender()}onTileError(i){i.clear(),this.contains(i)||this.addChild(i)}_renderChildren(i,d){for(const u of this.children)u.isReady&&u.hasData&&(u.commit(i),i.context.setStencilFunction(c.wb.EQUAL,u.stencilRef,255),u.getDisplayList().replay(i,u,d))}}},15097:(ee,N,r)=>{r.d(N,{Z:()=>T});var I=r(18100),m=(r(28191),r(83382),r(19420),r(32995),r(67087),r(20891)),g=r(20753),p=r(37436),v=r(69923);let c=class extends p.Z{doRender(y){y.drawPhase===g.jx.HIGHLIGHT&&super.doRender(y)}renderChildren(y){if(this.attributeView.update(),!this.children.some(A=>A.hasData))return;this.attributeView.bindTextures(y.context),super.renderChildren(y);const{painter:H}=y,J=H.effects.highlight;J.bind(y),y.context.setColorMask(!0,!0,!0,!0),y.context.clear(v.lk.COLOR_BUFFER_BIT),this._renderChildren(y,J.defines.concat(["highlightAll"])),J.draw(y),J.unbind()}};c=(0,I._)([(0,m.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],c);const T=c},34040:(ee,N,r)=>{r.d(N,{Z:()=>p});var I=r(18100),h=r(28191),S=r(30801),D=r(7521),O=r(9497),g=(r(83382),r(19420),r(20891));const p=v=>{let c=class extends v{initialize(){this.handles.add((0,D.on)(()=>this.layer,"refresh",T=>{this.doRefresh(T.dataChanged).catch(y=>{(0,S.D_)(y)||h.Z.getLogger(this.declaredClass).error(y)})}),"RefreshableLayerView")}};return(0,I._)([(0,O.Cb)()],c.prototype,"layer",void 0),c=(0,I._)([(0,g.j)("esri.layers.mixins.RefreshableLayerView")],c),c}},5848:(ee,N,r)=>{r.d(N,{VF:()=>re,Uf:()=>Ae});var I=r(71670),h=r(18100),S=r(26763),D=r(6365),O=r(97621),w=r(32995),m=r(67087),g=r(20359),p=r(53661),v=r(30801),c=r(7521),T=r(82769),y=r(9497),H=r(83382),A=(r(19420),r(20891)),$=r(10465),i=r(78998),d=r(1167);function u(s,e){return e?"xoffset"in e&&e.xoffset?Math.max(s,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(s,Math.abs(e.yoffset||0)):s:s}function F(s,e){return"number"==typeof s?s:s&&s.stops&&s.stops.length?function b(s){let e=0,o=0;for(let l=0;l<s.length;l++){const a=s[l].size;"number"==typeof a&&(e+=a,o++)}return e/o}(s.stops):e}function V(s){const e=s&&s.renderer,o="touch"===(s&&s.event&&s.event.pointerType)?9:6;if(!e)return o;const l="visualVariables"in e?function Q(s,e){if(!e)return s;const o=e.filter(_=>"size"===_.type).map(_=>{const{maxSize:W,minSize:E}=_;return(F(W,s)+F(E,s))/2});let l=0;const a=o.length;if(0===a)return s;for(let _=0;_<a;_++)l+=o[_];const f=Math.floor(l/a);return Math.max(f,s)}(o,e.visualVariables):o;if("simple"===e.type)return u(l,e.symbol);if("unique-value"===e.type){let a=l;return e.uniqueValueInfos?.forEach(f=>{a=u(a,f.symbol)}),a}if("class-breaks"===e.type){let a=l;return e.classBreakInfos.forEach(f=>{a=u(a,f.symbol)}),a}return l}var x=r(1897),M=r(42758),j=r(25820),Z=r(96204),le=r(71182),ue=r(48878);const oe=s=>s.spatialReference.wkid||JSON.stringify(s.spatialReference);var he,q=r(6010),xe=r(55025),ve=r(44480),Ie=r(68230);let B=he=class extends ve.wq{static from(s){return(0,H.TJ)(he,s)}constructor(s){super(s),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"dpi",void 0),(0,h._)([(0,y.Cb)()],B.prototype,"floors",void 0),(0,h._)([(0,y.Cb)({type:String,json:{write:!0}})],B.prototype,"gdbVersion",void 0),(0,h._)([(0,y.Cb)({types:q.qM,json:{read:le.im,write:!0}})],B.prototype,"geometry",void 0),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"geometryPrecision",void 0),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"height",void 0),(0,h._)([(0,y.Cb)({type:[Number],json:{write:!0}})],B.prototype,"layerIds",void 0),(0,h._)([(0,y.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],B.prototype,"layerOption",void 0),(0,h._)([(0,y.Cb)({type:$.Z,json:{write:!0}})],B.prototype,"mapExtent",void 0),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"maxAllowableOffset",void 0),(0,h._)([(0,y.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"returnFieldName",void 0),(0,h._)([(0,y.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"returnGeometry",void 0),(0,h._)([(0,y.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"returnM",void 0),(0,h._)([(0,y.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"returnUnformattedValues",void 0),(0,h._)([(0,y.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"returnZ",void 0),(0,h._)([(0,y.Cb)({type:Ie.Z,json:{write:!0}})],B.prototype,"spatialReference",void 0),(0,h._)([(0,y.Cb)()],B.prototype,"sublayers",void 0),(0,h._)([(0,y.Cb)({type:xe.Z,json:{write:!0}})],B.prototype,"timeExtent",void 0),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"tolerance",void 0),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],B.prototype,"width",void 0),B=he=(0,h._)([(0,A.j)("esri.rest.support.IdentifyParameters")],B);const ge=B;var Oe=r(66508),Re=r(70425),Me=r(86230);let te=class extends ve.wq{constructor(s){super(s),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(s,e){return S.Z.fromJSON({attributes:{...e.attributes},geometry:{...e.geometry}})}writeFeature(s,e){if(!s)return;const{attributes:o,geometry:l}=s;o&&(e.attributes={...o}),(0,p.pC)(l)&&(e.geometry=l.toJSON(),e.geometryType=Me.P.toJSON(l.type))}};(0,h._)([(0,y.Cb)({type:String,json:{write:!0}})],te.prototype,"displayFieldName",void 0),(0,h._)([(0,y.Cb)({type:S.Z})],te.prototype,"feature",void 0),(0,h._)([(0,Oe.r)("feature",["attributes","geometry"])],te.prototype,"readFeature",null),(0,h._)([(0,Re.c)("feature")],te.prototype,"writeFeature",null),(0,h._)([(0,y.Cb)({type:Number,json:{write:!0}})],te.prototype,"layerId",void 0),(0,h._)([(0,y.Cb)({type:String,json:{write:!0}})],te.prototype,"layerName",void 0),te=(0,h._)([(0,A.j)("esri.rest.support.IdentifyResult")],te);const Pe=te;function pe(){return(pe=(0,I.Z)(function*(s,e,o){const l=(e=function De(s){return ge.from(s)}(e)).geometry?[e.geometry]:[],a=(0,j.en)(s);return a.path+="/identify",(0,M.aX)(l).then(f=>{const _=function ae(s,e){const{dpi:o,gdbVersion:l,geometry:a,geometryPrecision:f,height:_,layerOption:W,mapExtent:E,maxAllowableOffset:C,returnFieldName:P,returnGeometry:R,returnUnformattedValues:U,returnZ:z,spatialReference:L,timeExtent:X,tolerance:K,width:G}=s.toJSON(),{dynamicLayers:k,layerDefs:se,layerIds:ne}=function de(s){const{mapExtent:e,floors:o,width:l,sublayers:a,layerIds:f,layerOption:_,gdbVersion:W}=s,E=a?.find(L=>null!=L.layer)?.layer?.serviceSublayers,C="popup"===_,P={},R=(0,i.yZ)({extent:e,width:l,spatialReference:e?.spatialReference}),U=[],z=L=>{if(L.visible&&(0===R||(0===L.minScale||R<=L.minScale)&&(0===L.maxScale||R>=L.maxScale)))if(L.sublayers)L.sublayers.forEach(z);else{if(!1===f?.includes(L.id)||C&&(!L.popupTemplate||!L.popupEnabled))return;U.unshift(L)}};if(a?.forEach(z),a&&!U.length)P.layerIds=[];else{const L=(0,ue.FN)(U,E,W),X=U.map(K=>{const G=(0,d.f)(o,K);return K.toExportImageJSON(G)});if(L)P.dynamicLayers=JSON.stringify(X);else{if(a){let G=U.map(({id:k})=>k);f&&(G=G.filter(k=>f.includes(k))),P.layerIds=G}else f?.length&&(P.layerIds=f);const K=function ce(s,e){const o=!!s?.length,l=e.filter(a=>null!=a.definitionExpression||o&&null!=a.floorInfo);return l.length?l.map(a=>{const f=(0,d.f)(s,a),_=(0,Z._)(f,a.definitionExpression);return{id:a.id,definitionExpression:(0,p.Pt)(_,void 0)}}):null}(o,U);if((0,p.pC)(K)&&K.length){const G={};for(const k of K)k.definitionExpression&&(G[k.id]=k.definitionExpression);Object.keys(G).length&&(P.layerDefs=JSON.stringify(G))}}}return P}(s),_e=e&&(0,p.pC)(e.geometry)?e.geometry:null,Y={geometryPrecision:f,maxAllowableOffset:C,returnFieldName:P,returnGeometry:R,returnUnformattedValues:U,returnZ:z,tolerance:K},ie=_e&&_e.toJSON()||a;if(Y.imageDisplay=`${G},${_},${o}`,l&&(Y.gdbVersion=l),ie&&(delete ie.spatialReference,Y.geometry=JSON.stringify(ie),Y.geometryType=(0,le.Ji)(ie)),L?Y.sr=L.wkid||JSON.stringify(L):ie&&ie.spatialReference?Y.sr=oe(ie):E&&E.spatialReference&&(Y.sr=oe(E)),Y.time=X?[X.start,X.end].join(","):null,E){const{xmin:Be,ymin:we,xmax:Ze,ymax:We}=E;Y.mapExtent=`${Be},${we},${Ze},${We}`}return se&&(Y.layerDefs=se),k&&!se&&(Y.dynamicLayers=k),Y.layers="popup"===W?"visible":W,ne&&!k&&(Y.layers+=`:${ne.join(",")}`),Y}(e,{geometry:f&&f[0]}),W=(0,j.cv)({...a.query,f:"json",..._}),E=(0,j.lA)(W,o);return(0,x.default)(a.path,E).then(Se).then(C=>function Te(s,e){if(!e?.length)return s;const o=new Map;e.forEach(function l(a){o.set(a.id,a),a.sublayers&&a.sublayers.forEach(l)});for(const a of s.results)a.feature.sourceLayer=o.get(a.layerId);return s}(C,e.sublayers))})})).apply(this,arguments)}function Se(s){const e=s.data;return e.results=e.results||[],e.exceededTransferLimit=!!e.exceededTransferLimit,e.results=e.results.map(o=>Pe.fromJSON(o)),e}var Ue=r(77238),Ee=r(84738),be=r(24927);let fe=null;function Ae(s,e){return"tile"===e.type||"map-image"===e.type}let re=class extends D.Z{constructor(s){var e;super(s),e=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,v.Ds)(function(){var o=(0,I.Z)(function*(l){e.destroyed||e.updatingHandles.addPromise(e._updateHighlightedFeaturesGeometries(l).catch(()=>{}))});return function(l){return o.apply(this,arguments)}}())}initialize(){const s=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,c.on)(()=>this.highlightGraphics,"change",e=>s(e.added),{onListenerAdd:e=>s(e)})])}fetchPopupFeatures(s,e){var o=this;return(0,I.Z)(function*(){const{layerView:{layer:l,view:{scale:a}}}=o;if(!s)throw new w.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:l});const f=function Ve(s,e,o){const l=[],a=f=>{if(f.visible&&(0===f.minScale||e<=f.minScale)&&(0===f.maxScale||e>=f.maxScale))if(f.sublayers)f.sublayers.forEach(a);else if(f.popupEnabled){const E=(0,be.V)(f,{...o,defaultPopupTemplateEnabled:!1});(0,p.pC)(E)&&l.unshift({sublayer:f,popupTemplate:E})}};return(s?.toArray()??[]).reverse().map(a),l}(l.sublayers,a,e);if(!f.length)return[];const _=yield function Le(s,e){return ye.apply(this,arguments)}(l,f);if(!((l.capabilities?.operations?.supportsIdentify??1)&&l.version>=10.5||_))throw new w.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:l});return _?o._fetchPopupFeaturesUsingQueries(s,f,e):o._fetchPopupFeaturesUsingIdentify(s,f,e)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(s){const e=this.highlightGraphics;if(!e)return{remove(){}};let o=null;if(s instanceof S.Z?o=[s]:O.Z.isCollection(s)&&s.length>0?o=s.toArray():Array.isArray(s)&&s.length>0&&(o=s),o=o?.filter(p.pC),!o||!o.length)return{remove:()=>{}};for(const l of o){const a=l.sourceLayer;null!=a&&"geometryType"in a&&"point"===a.geometryType&&(l.visible=!1)}return e.addMany(o),{remove:()=>{e.removeMany(o??[])}}}_updateHighlightedFeaturesSymbols(s){var e=this;return(0,I.Z)(function*(){const{layerView:{view:o},highlightGraphics:l,highlightGraphicUpdated:a}=e;if(l&&a)for(const f of s){const _=f.sourceLayer&&"renderer"in f.sourceLayer&&f.sourceLayer.renderer;f.sourceLayer&&"geometryType"in f.sourceLayer&&"point"===f.sourceLayer.geometryType&&_&&"getSymbolAsync"in _&&_.getSymbolAsync(f).then(function(){var W=(0,I.Z)(function*(E){E||(E=new Ee.Z);let C=null;const P="visualVariables"in _?_.visualVariables?.find(R=>"size"===R.type):void 0;P&&(fe||(fe=(yield Promise.resolve().then(r.bind(r,35162))).getSize),C=fe(P,f,{view:o.type,scale:o.scale,shape:"simple-marker"===E.type?E.style:null})),C||(C="width"in E&&"height"in E&&null!=E.width&&null!=E.height?Math.max(E.width,E.height):"size"in E?E.size:16),l.includes(f)&&(f.symbol=new Ee.Z({style:"square",size:C,xoffset:"xoffset"in E?E.xoffset:0,yoffset:"yoffset"in E?E.yoffset:0}),a(f,"symbol"),f.visible=!0)});return function(E){return W.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(s){var e=this;return(0,I.Z)(function*(){const{layerView:{layer:o,view:l},highlightGraphics:a,highlightGraphicUpdated:f}=e;if(e._highlightGeometriesResolution=s,!f||!a?.length||!o.capabilities.operations.supportsQuery)return;const _=e._getTargetResolution(s),W=new Map;for(const P of a)(!e._featuresResolutions.has(P)||e._featuresResolutions.get(P)>_)&&(0,g.s1)(W,P.sourceLayer,()=>new Map).set(P.getObjectId(),P);const E=Array.from(W,([P,R])=>{const U=P.createQuery();return U.objectIds=[...R.keys()],U.outFields=[P.objectIdField],U.returnGeometry=!0,U.maxAllowableOffset=_,U.outSpatialReference=l.spatialReference,P.queryFeatures(U)}),C=yield Promise.all(E);if(!e.destroyed)for(const{features:P}of C)for(const R of P){const z=W.get(R.sourceLayer).get(R.getObjectId());z&&a.includes(z)&&(z.geometry=R.geometry,f(z,"geometry"),e._featuresResolutions.set(z,_))}})()}_getTargetResolution(s){const e=s*(0,T.c9)(this.layerView.view.spatialReference),o=e/16;return o<=10?0:s/e*o}_fetchPopupFeaturesUsingIdentify(s,e,o){var l=this;return(0,I.Z)(function*(){const a=yield l._createIdentifyParameters(s,e,o);if((0,p.Wi)(a))return[];const{results:f}=yield function Ce(s,e,o){return pe.apply(this,arguments)}(l.layerView.layer.parsedUrl,a);return f.map(_=>_.feature)})()}_createIdentifyParameters(s,e,o){var l=this;return(0,I.Z)(function*(){const{floors:a,layer:f,timeExtent:_,view:{spatialReference:W,scale:E}}=l.layerView,C=(0,p.pC)(o)?o.event:null;if(!e.length)return null;yield Promise.all(e.map(({sublayer:X})=>X.load().catch(()=>{})));const P=Math.min((0,m.Z)("mapservice-popup-identify-max-tolerance"),f.allSublayers.reduce((X,K)=>K.renderer?V({renderer:K.renderer,event:C}):X,2)),R=l.createFetchPopupFeaturesQueryGeometry(s,P),U=(0,i.dp)(E,W),z=Math.round(R.width/U),L=new $.Z({xmin:R.center.x-U*z,ymin:R.center.y-U*z,xmax:R.center.x+U*z,ymax:R.center.y+U*z,spatialReference:R.spatialReference});return new ge({floors:a,gdbVersion:"gdbVersion"in f?f.gdbVersion:void 0,geometry:s,height:z,layerOption:"popup",mapExtent:L,returnGeometry:!0,spatialReference:W,sublayers:f.sublayers,timeExtent:_,tolerance:P,width:z})})()}_fetchPopupFeaturesUsingQueries(s,e,o){var l=this;return(0,I.Z)(function*(){const{layerView:{floors:a,timeExtent:f}}=l,_=(0,p.pC)(o)?o.event:null,W=e.map(function(){var E=(0,I.Z)(function*({sublayer:C,popupTemplate:P}){if(yield C.load().catch(()=>{}),C.capabilities&&!C.capabilities.operations.supportsQuery)return[];const R=C.createQuery(),U=V({renderer:C.renderer,event:_}),z=l.createFetchPopupFeaturesQueryGeometry(s,U);if(R.geometry=z,R.outFields=yield(0,be.e)(C,P),R.timeExtent=f,a){const se=a.clone(),ne=(0,d.f)(se,C);(0,p.pC)(ne)&&(R.where=R.where?`(${R.where}) AND (${ne})`:ne)}const L=l._getTargetResolution(z.width/U),X=yield function je(s){return s.expressionInfos?.length||Array.isArray(s.content)&&s.content.some(e=>"expression"===e.type)?(0,Ue.LC)():Promise.resolve()}(P),K="point"===C.geometryType||X&&X.arcadeUtils.hasGeometryOperations(P);K||(R.maxAllowableOffset=L);let{features:G}=yield C.queryFeatures(R);const k=K?0:L;G=yield function Fe(s,e){return me.apply(this,arguments)}(C,G);for(const se of G)l._featuresResolutions.set(se,k);return G});return function(C){return E.apply(this,arguments)}}());return(yield(0,v.as)(W)).reverse().reduce((E,C)=>C.value?[...E,...C.value]:E,[]).filter(E=>null!=E)})()}};function ye(){return(ye=(0,I.Z)(function*(s,e){if(s.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(e.map(({sublayer:o})=>o.load().then(()=>o.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function me(){return(me=(0,I.Z)(function*(s,e){const o=s.renderer;return o&&"defaultSymbol"in o&&!o.defaultSymbol&&(e=o.valueExpression?yield Promise.all(e.map(l=>o.getSymbolAsync(l).then(a=>a?l:null))).then(l=>l.filter(a=>null!=a)):e.filter(l=>null!=o.getSymbol(l))),e})).apply(this,arguments)}(0,h._)([(0,y.Cb)({constructOnly:!0})],re.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,h._)([(0,y.Cb)({constructOnly:!0})],re.prototype,"layerView",void 0),(0,h._)([(0,y.Cb)({constructOnly:!0})],re.prototype,"highlightGraphics",void 0),(0,h._)([(0,y.Cb)({constructOnly:!0})],re.prototype,"highlightGraphicUpdated",void 0),(0,h._)([(0,y.Cb)({constructOnly:!0})],re.prototype,"updatingHandles",void 0),re=(0,h._)([(0,A.j)("esri.views.layers.support.MapService")],re)},24927:(ee,N,r)=>{r.d(N,{V:()=>w,e:()=>D});var I=r(71670),h=r(53661),S=r(21230);function D(m){return O.apply(this,arguments)}function O(){return(O=(0,I.Z)(function*(m,g=m.popupTemplate){if((0,h.Wi)(g))return[];const p=yield g.getRequiredFields(m.fieldsIndex),{lastEditInfoEnabled:v}=g,{objectIdField:c,typeIdField:T,globalIdField:y,relationships:H}=m;if(p.includes("*"))return["*"];const J=v?yield(0,S.CH)(m):[],A=(0,S.Q0)(m.fieldsIndex,[...p,...J]);return T&&A.push(T),A&&c&&m.fieldsIndex?.has(c)&&!A.includes(c)&&A.push(c),A&&y&&m.fieldsIndex?.has(y)&&!A.includes(y)&&A.push(y),H&&H.forEach($=>{const{keyField:i}=$;A&&i&&m.fieldsIndex?.has(i)&&!A.includes(i)&&A.push(i)}),A})).apply(this,arguments)}function w(m,g){return m.popupTemplate?m.popupTemplate:(0,h.pC)(g)&&g.defaultPopupTemplateEnabled&&(0,h.pC)(m.defaultPopupTemplate)?m.defaultPopupTemplate:null}},95655:(ee,N,r)=>{r.d(N,{K:()=>O}),r(6010);var h=r(53661),S=r(82769),D=r(10465);function O(g,p,v,c=new D.Z){let T=0;if("2d"===v.type)T=p*(v.resolution??0);else if("3d"===v.type){const i=v.overlayPixelSizeInMapUnits(g),d=v.basemapSpatialReference;T=(0,h.pC)(d)&&!d.equals(v.spatialReference)?(0,S.c9)(d)/(0,S.c9)(v.spatialReference):p*i}const y=g.x-T,H=g.y-T,J=g.x+T,A=g.y+T,{spatialReference:$}=v;return c.xmin=Math.min(y,J),c.ymin=Math.min(H,A),c.xmax=Math.max(y,J),c.ymax=Math.max(H,A),c.spatialReference=$,c}new D.Z}}]);
//# sourceMappingURL=6402.f3682e7701e2d997.js.map